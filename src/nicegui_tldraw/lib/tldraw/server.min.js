var C2=Object.create;var ep=Object.defineProperty;var N2=Object.getOwnPropertyDescriptor;var $2=Object.getOwnPropertyNames;var x2=Object.getPrototypeOf,k2=Object.prototype.hasOwnProperty;var S=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),L2=(e,t)=>{for(var r in t)ep(e,r,{get:t[r],enumerable:!0})},D2=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $2(t))!k2.call(e,s)&&s!==r&&ep(e,s,{get:()=>t[s],enumerable:!(n=N2(t,s))||n.enumerable});return e};var Tr=(e,t,r)=>(r=e!=null?C2(x2(e)):{},D2(t||!e||!e.__esModule?ep(r,"default",{value:e,enumerable:!0}):r,e));var Qv=S((Pde,tp)=>{"use strict";var q2=/at\s{1}(?:.*\.)?plugin\s{1}.*\n\s*(.*)/,M2=/(\w*(\.\w*)*)\..*/;tp.exports=function(t){if(t.name.length>0)return t.name;let r=Error.stackTraceLimit;Error.stackTraceLimit=10;try{throw new Error("anonymous function")}catch(n){return Error.stackTraceLimit=r,Zv(n.stack)}};function Zv(e){let t=e.match(q2);return t?t[1].split(/[/\\]/).slice(-1)[0].match(M2)[1]:"anonymous"}tp.exports.extractPluginName=Zv});var tE=S((Ide,eE)=>{"use strict";eE.exports=function(t){return t[0]==="@"&&(t=t.slice(1).replace("/","-")),t.replace(/-(.)/g,function(r,n){return n.toUpperCase()})}});var np=S((Ade,Fc)=>{"use strict";var j2=Qv(),F2=tE(),V2=0;function rp(e,t={}){let r=!1;if(e.default!==void 0&&(e=e.default),typeof e!="function")throw new TypeError(`fastify-plugin expects a function, instead got a '${typeof e}'`);if(typeof t=="string"&&(t={fastify:t}),typeof t!="object"||Array.isArray(t)||t===null)throw new TypeError("The options object should be an object");if(t.fastify!==void 0&&typeof t.fastify!="string")throw new TypeError(`fastify-plugin expects a version string, instead got '${typeof t.fastify}'`);t.name||(r=!0,t.name=j2(e)+"-auto-"+V2++),e[Symbol.for("skip-override")]=t.encapsulate!==!0,e[Symbol.for("fastify.display-name")]=t.name,e[Symbol.for("plugin-meta")]=t,e.default||(e.default=e);let n=F2(t.name);return!r&&!e[n]&&(e[n]=e),e}Fc.exports=rp;Fc.exports.default=rp;Fc.exports.fastifyPlugin=rp});var ap=S(Mr=>{"use strict";var sp=class{constructor(t=1e3,r=0){if(isNaN(t)||t<0)throw new Error("Invalid max value");if(isNaN(r)||r<0)throw new Error("Invalid ttl value");this.first=null,this.items=new Map,this.last=null,this.max=t,this.ttl=r}get size(){return this.items.size}clear(){this.items=new Map,this.first=null,this.last=null}delete(t){if(this.items.has(t)){let r=this.items.get(t);this.items.delete(t),r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}}deleteMany(t){for(var r=0;r<t.length;r++)this.delete(t[r])}evict(){if(this.size>0){let t=this.first;this.items.delete(t.key),this.size===0?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}}expiresAt(t){if(this.items.has(t))return this.items.get(t).expiry}get(t){if(this.items.has(t)){let r=this.items.get(t);if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t);return}return r.value}}getMany(t){let r=[];for(var n=0;n<t.length;n++)r.push(this.get(t[n]));return r}keys(){return this.items.keys()}set(t,r){if(this.items.has(t)){let s=this.items.get(t);s.value=r,s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl;return}this.max>0&&this.size===this.max&&this.evict();let n={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r};this.items.set(t,n),this.size===1?this.first=n:this.last.next=n,this.last=n}},ip=class{constructor(t=1e3,r=0){if(isNaN(t)||t<0)throw new Error("Invalid max value");if(isNaN(r)||r<0)throw new Error("Invalid ttl value");this.first=null,this.items=new Map,this.last=null,this.max=t,this.ttl=r}get size(){return this.items.size}bumpLru(t){if(this.last===t)return;let r=this.last,n=t.next,s=t.prev;this.first===t&&(this.first=n),t.next=null,t.prev=r,r.next=t,s!==null&&(s.next=n),n!==null&&(n.prev=s),this.last=t}clear(){this.items=new Map,this.first=null,this.last=null}delete(t){if(this.items.has(t)){let r=this.items.get(t);this.items.delete(t),r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}}deleteMany(t){for(var r=0;r<t.length;r++)this.delete(t[r])}evict(){if(this.size>0){let t=this.first;this.items.delete(t.key),this.size===0?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}}expiresAt(t){if(this.items.has(t))return this.items.get(t).expiry}get(t){if(this.items.has(t)){let r=this.items.get(t);if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t);return}return this.bumpLru(r),r.value}}getMany(t){let r=[];for(var n=0;n<t.length;n++)r.push(this.get(t[n]));return r}keys(){return this.items.keys()}set(t,r){if(this.items.has(t)){let s=this.items.get(t);s.value=r,s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl,this.last!==s&&this.bumpLru(s);return}this.max>0&&this.size===this.max&&this.evict();let n={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r};this.items.set(t,n),this.size===1?this.first=n:this.last.next=n,this.last=n}},ga=class{constructor(t=1e3,r=0){if(isNaN(t)||t<0)throw new Error("Invalid max value");if(isNaN(r)||r<0)throw new Error("Invalid ttl value");this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this.max=t,this.ttl=r}bumpLru(t){if(this.last===t)return;let r=this.last,n=t.next,s=t.prev;this.first===t&&(this.first=n),t.next=null,t.prev=r,r.next=t,s!==null&&(s.next=n),n!==null&&(n.prev=s),this.last=t}clear(){this.items=Object.create(null),this.first=null,this.last=null,this.size=0}delete(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];delete this.items[t],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}}deleteMany(t){for(var r=0;r<t.length;r++)this.delete(t[r])}evict(){if(this.size>0){let t=this.first;delete this.items[t.key],--this.size===0?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}}expiresAt(t){if(Object.prototype.hasOwnProperty.call(this.items,t))return this.items[t].expiry}get(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t);return}return this.bumpLru(r),r.value}}getMany(t){let r=[];for(var n=0;n<t.length;n++)r.push(this.get(t[n]));return r}keys(){return Object.keys(this.items)}set(t,r){if(Object.prototype.hasOwnProperty.call(this.items,t)){let s=this.items[t];s.value=r,s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl,this.last!==s&&this.bumpLru(s);return}this.max>0&&this.size===this.max&&this.evict();let n={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r};this.items[t]=n,++this.size===1?this.first=n:this.last.next=n,this.last=n}},Vc=class{constructor(){this.records={}}initForCache(t,r){this.records[t]={[r]:{cacheSize:0,hits:0,falsyHits:0,emptyHits:0,misses:0,expirations:0,evictions:0,invalidateOne:0,invalidateAll:0,sets:0}}}resetForCache(t){for(let r of Object.keys(this.records[t]))this.records[t][r]={cacheSize:0,hits:0,falsyHits:0,emptyHits:0,misses:0,expirations:0,evictions:0,invalidateOne:0,invalidateAll:0,sets:0}}getStatistics(){return this.records}};function rE(e){return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}var op=class{constructor(t,r,n){this.cacheId=t,this.statisticTtlInHours=r,this.collectionStart=new Date,this.currentTimeStamp=rE(this.collectionStart),this.records=n||new Vc,this.records.initForCache(this.cacheId,this.currentTimeStamp)}get currentRecord(){return this.records.records[this.cacheId][this.currentTimeStamp]||(this.records.records[this.cacheId][this.currentTimeStamp]={cacheSize:0,hits:0,falsyHits:0,emptyHits:0,misses:0,expirations:0,evictions:0,sets:0,invalidateOne:0,invalidateAll:0}),this.records.records[this.cacheId][this.currentTimeStamp]}hoursPassed(){return(Date.now()-this.collectionStart)/1e3/60/60}addHit(){this.archiveIfNeeded(),this.currentRecord.hits++}addFalsyHit(){this.archiveIfNeeded(),this.currentRecord.falsyHits++}addEmptyHit(){this.archiveIfNeeded(),this.currentRecord.emptyHits++}addMiss(){this.archiveIfNeeded(),this.currentRecord.misses++}addEviction(){this.archiveIfNeeded(),this.currentRecord.evictions++}setCacheSize(t){this.archiveIfNeeded(),this.currentRecord.cacheSize=t}addExpiration(){this.archiveIfNeeded(),this.currentRecord.expirations++}addSet(){this.archiveIfNeeded(),this.currentRecord.sets++}addInvalidateOne(){this.archiveIfNeeded(),this.currentRecord.invalidateOne++}addInvalidateAll(){this.archiveIfNeeded(),this.currentRecord.invalidateAll++}getStatistics(){return this.records.getStatistics()}archiveIfNeeded(){this.hoursPassed()>=this.statisticTtlInHours&&(this.collectionStart=new Date,this.currentTimeStamp=rE(this.collectionStart),this.records.initForCache(this.cacheId,this.currentTimeStamp))}},Uc=class extends ga{constructor(t,r,n,s,i){if(super(t||1e3,r||0),!n)throw new Error("Cache id is mandatory");this.hitStatistics=new op(n,i!==void 0?i:24,s)}getStatistics(){return this.hitStatistics.getStatistics()}set(t,r){super.set(t,r),this.hitStatistics.addSet(),this.hitStatistics.setCacheSize(this.size)}evict(){super.evict(),this.hitStatistics.addEviction(),this.hitStatistics.setCacheSize(this.size)}delete(t,r=!1){super.delete(t),r||this.hitStatistics.addInvalidateOne(),this.hitStatistics.setCacheSize(this.size)}clear(){super.clear(),this.hitStatistics.addInvalidateAll(),this.hitStatistics.setCacheSize(this.size)}get(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t,!0),this.hitStatistics.addExpiration();return}return this.bumpLru(r),r.value||this.hitStatistics.addFalsyHit(),(r.value===void 0||r.value===null||r.value==="")&&this.hitStatistics.addEmptyHit(),this.hitStatistics.addHit(),r.value}this.hitStatistics.addMiss()}},Hc=class{constructor(t=1e3,r=0){if(isNaN(t)||t<0)throw new Error("Invalid max value");if(isNaN(r)||r<0)throw new Error("Invalid ttl value");this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this.max=t,this.ttl=r}clear(){this.items=Object.create(null),this.first=null,this.last=null,this.size=0}delete(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];delete this.items[t],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}}deleteMany(t){for(var r=0;r<t.length;r++)this.delete(t[r])}evict(){if(this.size>0){let t=this.first;delete this.items[t.key],--this.size===0?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}}expiresAt(t){if(Object.prototype.hasOwnProperty.call(this.items,t))return this.items[t].expiry}get(t){if(Object.prototype.hasOwnProperty.call(this.items,t)){let r=this.items[t];if(this.ttl>0&&r.expiry<=Date.now()){this.delete(t);return}return r.value}}getMany(t){let r=[];for(var n=0;n<t.length;n++)r.push(this.get(t[n]));return r}keys(){return Object.keys(this.items)}set(t,r){if(Object.prototype.hasOwnProperty.call(this.items,t)){let s=this.items[t];s.value=r,s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl;return}this.max>0&&this.size===this.max&&this.evict();let n={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:r};this.items[t]=n,++this.size===1?this.first=n:this.last.next=n,this.last=n}};Mr.Fifo=Hc;Mr.FifoMap=sp;Mr.FifoObject=Hc;Mr.HitStatisticsRecord=Vc;Mr.Lru=ga;Mr.LruHitStatistics=Uc;Mr.LruMap=ip;Mr.LruObject=ga;Mr.LruObjectHitStatistics=Uc});var sE=S((Nde,ya)=>{"use strict";var{FifoMap:U2}=ap(),H2=/^[!#$%&'*+\-.^\w`|~]+$/u;function B2(e){if(H2.test(e)===!1)throw new TypeError("Fieldname contains invalid characters.")}function nE(e){e=e.trim().toLowerCase();let t=[];if(e.length!==0)if(e.indexOf(",")===-1)t.push(e);else{let r=e.length,n=0,s=0,i;for(n;n<r;++n)i=e[n],i===" "?s=n+1:i===","&&(s!==n&&t.push(e.slice(s,n)),s=n+1);s!==n&&t.push(e.slice(s,n))}return t}function lp(e){let t=new U2(1e3);return B2(e),function(r){let n=r.getHeader("Vary");if(!n){r.header("Vary",e);return}if(n==="*")return;if(e==="*"){r.header("Vary","*");return}if(Array.isArray(n)&&(n=n.join(", ")),t.get(n)===void 0){let i=nE(n);i.indexOf("*")!==-1?t.set(n,"*"):i.indexOf(e.toLowerCase())===-1?t.set(n,n+", "+e):t.set(n,null)}let s=t.get(n);s!==null&&r.header("Vary",s)}}ya.exports.createAddFieldnameToVary=lp;ya.exports.addOriginToVaryHeader=lp("Origin");ya.exports.addAccessControlRequestHeadersToVaryHeader=lp("Access-Control-Request-Headers");ya.exports.parse=nE});var cE=S(($de,zc)=>{"use strict";var z2=np(),{addAccessControlRequestHeadersToVaryHeader:G2,addOriginToVaryHeader:W2}=sE(),up={origin:"*",methods:"GET,HEAD,POST",hook:"onRequest",preflightContinue:!1,optionsSuccessStatus:204,credentials:!1,exposedHeaders:null,allowedHeaders:null,maxAge:null,preflight:!0,strictPreflight:!0},K2=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend"],cp=["preSerialization","preParsing","onSend"];function aE(e,t){K2.indexOf(e)===-1&&t(new TypeError("@fastify/cors: Invalid hook option provided."))}function J2(e,t,r){e.decorateRequest("corsPreflightEnabled",!1);let n=!0;if(typeof t=="function")iE(t,e,{hook:up.hook},r);else if(t.delegator){let{delegator:s,...i}=t;iE(s,e,i,r)}else{t.hideOptionsRoute!==void 0&&(n=t.hideOptionsRoute);let s=Bc(t);aE(s.hook,r),cp.indexOf(s.hook)!==-1?e.addHook(s.hook,function(o,a,l,c){_a(e,s,o,a,c)}):e.addHook(s.hook,function(o,a,l){_a(e,s,o,a,l)})}e.options("*",{schema:{hide:n}},(s,i)=>{if(!s.corsPreflightEnabled){i.callNotFound();return}i.send()}),r()}function iE(e,t,r,n){let s=r?.hook||up.hook;aE(s,n),e.length===2?cp.indexOf(s)!==-1?t.addHook(s,function(o,a,l,c){oE(e,t,o,a,c)}):t.addHook(s,function(o,a,l){oE(e,t,o,a,l)}):cp.indexOf(s)!==-1?t.addHook(s,function(o,a,l,c){let u=e(o);if(u&&typeof u.then=="function"){u.then(f=>_a(t,Bc(f,!0),o,a,c)).catch(c);return}c(new Error("Invalid CORS origin option"))}):t.addHook(s,function(o,a,l){let c=e(o);if(c&&typeof c.then=="function"){c.then(u=>_a(t,Bc(u,!0),o,a,l)).catch(l);return}l(new Error("Invalid CORS origin option"))})}function oE(e,t,r,n,s){e(r,(i,o)=>{i?s(i):_a(t,Bc(o,!0),r,n,s)})}function Bc(e,t){let r={...up,...e};return Array.isArray(e.origin)&&e.origin.indexOf("*")!==-1&&(r.origin="*"),Number.isInteger(r.cacheControl)?r.cacheControl=`max-age=${r.cacheControl}`:typeof r.cacheControl!="string"&&(r.cacheControl=null),r.dynamic=t||!1,r}function _a(e,t,r,n,s){(typeof t.origin!="string"&&t.origin!==!1||t.dynamic)&&W2(n),(typeof t.origin=="function"?Z2(e,t.origin):(o,a)=>a(null,t.origin))(r,(o,a)=>{if(o!==null)return s(o);if(a===!1||r.routeOptions.config?.cors===!1)return s();if(!a)return s(new Error("Invalid CORS origin option"));if(Y2(r,n,a,t),r.raw.method==="OPTIONS"&&t.preflight===!0){if(t.strictPreflight===!0&&(!r.headers.origin||!r.headers["access-control-request-method"])){n.status(400).type("text/plain").send("Invalid Preflight Request");return}if(r.corsPreflightEnabled=!0,X2(r,n,t),!t.preflightContinue){n.code(t.optionsSuccessStatus).header("Content-Length","0").send();return}}return s()})}function Y2(e,t,r,n){let s=Q2(e.headers.origin,r);s&&t.header("Access-Control-Allow-Origin",s),n.credentials&&t.header("Access-Control-Allow-Credentials","true"),n.exposedHeaders!==null&&t.header("Access-Control-Expose-Headers",Array.isArray(n.exposedHeaders)?n.exposedHeaders.join(", "):n.exposedHeaders)}function X2(e,t,r){if(t.header("Access-Control-Allow-Methods",Array.isArray(r.methods)?r.methods.join(", "):r.methods),r.allowedHeaders===null){G2(t);let n=e.headers["access-control-request-headers"];n!==void 0&&t.header("Access-Control-Allow-Headers",n)}else t.header("Access-Control-Allow-Headers",Array.isArray(r.allowedHeaders)?r.allowedHeaders.join(", "):r.allowedHeaders);r.maxAge!==null&&t.header("Access-Control-Max-Age",String(r.maxAge)),r.cacheControl&&t.header("Cache-Control",r.cacheControl)}function Z2(e,t){return function(r,n){let s=t.call(e,r.headers.origin,n);s&&typeof s.then=="function"&&s.then(i=>n(null,i),n)}}function Q2(e,t){return typeof t=="string"?t:lE(e,t)?e:!1}function lE(e,t){if(Array.isArray(t)){for(let r=0;r<t.length;++r)if(lE(e,t[r]))return!0;return!1}else return typeof t=="string"?e===t:t instanceof RegExp?(t.lastIndex=0,t.test(e)):!!t}var fp=z2(J2,{fastify:"5.x",name:"@fastify/cors"});zc.exports=fp;zc.exports.fastifyCors=fp;zc.exports.default=fp});var un=S((xde,dE)=>{"use strict";var uE=["nodebuffer","arraybuffer","fragments"],fE=typeof Blob<"u";fE&&uE.push("blob");dE.exports={BINARY_TYPES:uE,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:fE,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ba=S((kde,Gc)=>{"use strict";var{EMPTY_BUFFER:eF}=un(),dp=Buffer[Symbol.species];function tF(e,t){if(e.length===0)return eF;if(e.length===1)return e[0];let r=Buffer.allocUnsafe(t),n=0;for(let s=0;s<e.length;s++){let i=e[s];r.set(i,n),n+=i.length}return n<t?new dp(r.buffer,r.byteOffset,n):r}function hE(e,t,r,n,s){for(let i=0;i<s;i++)r[n+i]=e[i]^t[i&3]}function pE(e,t){for(let r=0;r<e.length;r++)e[r]^=t[r&3]}function rF(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)}function hp(e){if(hp.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=new dp(e):ArrayBuffer.isView(e)?t=new dp(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),hp.readOnly=!1),t}Gc.exports={concat:tF,mask:hE,toArrayBuffer:rF,toBuffer:hp,unmask:pE};if(!process.env.WS_NO_BUFFER_UTIL)try{let e=require("bufferutil");Gc.exports.mask=function(t,r,n,s,i){i<48?hE(t,r,n,s,i):e.mask(t,r,n,s,i)},Gc.exports.unmask=function(t,r){t.length<32?pE(t,r):e.unmask(t,r)}}catch{}});var yE=S((Lde,gE)=>{"use strict";var mE=Symbol("kDone"),pp=Symbol("kRun"),mp=class{constructor(t){this[mE]=()=>{this.pending--,this[pp]()},this.concurrency=t||1/0,this.jobs=[],this.pending=0}add(t){this.jobs.push(t),this[pp]()}[pp](){if(this.pending!==this.concurrency&&this.jobs.length){let t=this.jobs.shift();this.pending++,t(this[mE])}}};gE.exports=mp});var Ea=S((Dde,vE)=>{"use strict";var Sa=require("zlib"),_E=ba(),nF=yE(),{kStatusCode:bE}=un(),sF=Buffer[Symbol.species],iF=Buffer.from([0,0,255,255]),Jc=Symbol("permessage-deflate"),fn=Symbol("total-length"),va=Symbol("callback"),Un=Symbol("buffers"),Kc=Symbol("error"),Wc,gp=class{constructor(t,r,n){if(this._maxPayload=n|0,this._options=t||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Wc){let s=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Wc=new nF(s)}}static get extensionName(){return"permessage-deflate"}offer(){let t={};return this._options.serverNoContextTakeover&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(t.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(t.client_max_window_bits=!0),t}accept(t){return t=this.normalizeParams(t),this.params=this._isServer?this.acceptAsServer(t):this.acceptAsClient(t),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let t=this._deflate[va];this._deflate.close(),this._deflate=null,t&&t(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(t){let r=this._options,n=t.find(s=>!(r.serverNoContextTakeover===!1&&s.server_no_context_takeover||s.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>s.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!s.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(t){let r=t[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(t){return t.forEach(r=>{Object.keys(r).forEach(n=>{let s=r[n];if(s.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(s=s[0],n==="client_max_window_bits"){if(s!==!0){let i=+s;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${s}`);s=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${s}`)}else if(n==="server_max_window_bits"){let i=+s;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${n}": ${s}`);s=i}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(s!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${s}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=s})}),t}decompress(t,r,n){Wc.add(s=>{this._decompress(t,r,(i,o)=>{s(),n(i,o)})})}compress(t,r,n){Wc.add(s=>{this._compress(t,r,(i,o)=>{s(),n(i,o)})})}_decompress(t,r,n){let s=this._isServer?"client":"server";if(!this._inflate){let i=`${s}_max_window_bits`,o=typeof this.params[i]!="number"?Sa.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Sa.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Jc]=this,this._inflate[fn]=0,this._inflate[Un]=[],this._inflate.on("error",aF),this._inflate.on("data",SE)}this._inflate[va]=n,this._inflate.write(t),r&&this._inflate.write(iF),this._inflate.flush(()=>{let i=this._inflate[Kc];if(i){this._inflate.close(),this._inflate=null,n(i);return}let o=_E.concat(this._inflate[Un],this._inflate[fn]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[fn]=0,this._inflate[Un]=[],r&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),n(null,o)})}_compress(t,r,n){let s=this._isServer?"server":"client";if(!this._deflate){let i=`${s}_max_window_bits`,o=typeof this.params[i]!="number"?Sa.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Sa.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[fn]=0,this._deflate[Un]=[],this._deflate.on("data",oF)}this._deflate[va]=n,this._deflate.write(t),this._deflate.flush(Sa.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=_E.concat(this._deflate[Un],this._deflate[fn]);r&&(i=new sF(i.buffer,i.byteOffset,i.length-4)),this._deflate[va]=null,this._deflate[fn]=0,this._deflate[Un]=[],r&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),n(null,i)})}};vE.exports=gp;function oF(e){this[Un].push(e),this[fn]+=e.length}function SE(e){if(this[fn]+=e.length,this[Jc]._maxPayload<1||this[fn]<=this[Jc]._maxPayload){this[Un].push(e);return}this[Kc]=new RangeError("Max payload size exceeded"),this[Kc].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Kc][bE]=1009,this.removeListener("data",SE),this.reset()}function aF(e){this[Jc]._inflate=null,e[bE]=1007,this[va](e)}});var Li=S((qde,Yc)=>{"use strict";var{isUtf8:EE}=require("buffer"),{hasBlob:lF}=un(),cF=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function uF(e){return e>=1e3&&e<=1014&&e!==1004&&e!==1005&&e!==1006||e>=3e3&&e<=4999}function yp(e){let t=e.length,r=0;for(;r<t;)if((e[r]&128)===0)r++;else if((e[r]&224)===192){if(r+1===t||(e[r+1]&192)!==128||(e[r]&254)===192)return!1;r+=2}else if((e[r]&240)===224){if(r+2>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||e[r]===224&&(e[r+1]&224)===128||e[r]===237&&(e[r+1]&224)===160)return!1;r+=3}else if((e[r]&248)===240){if(r+3>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||(e[r+3]&192)!==128||e[r]===240&&(e[r+1]&240)===128||e[r]===244&&e[r+1]>143||e[r]>244)return!1;r+=4}else return!1;return!0}function fF(e){return lF&&typeof e=="object"&&typeof e.arrayBuffer=="function"&&typeof e.type=="string"&&typeof e.stream=="function"&&(e[Symbol.toStringTag]==="Blob"||e[Symbol.toStringTag]==="File")}Yc.exports={isBlob:fF,isValidStatusCode:uF,isValidUTF8:yp,tokenChars:cF};if(EE)Yc.exports.isValidUTF8=function(e){return e.length<24?yp(e):EE(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=require("utf-8-validate");Yc.exports.isValidUTF8=function(t){return t.length<32?yp(t):e(t)}}catch{}});var Ep=S((Mde,AE)=>{"use strict";var{Writable:dF}=require("stream"),wE=Ea(),{BINARY_TYPES:hF,EMPTY_BUFFER:RE,kStatusCode:pF,kWebSocket:mF}=un(),{concat:_p,toArrayBuffer:gF,unmask:yF}=ba(),{isValidStatusCode:_F,isValidUTF8:TE}=Li(),Xc=Buffer[Symbol.species],ir=0,OE=1,PE=2,IE=3,bp=4,Sp=5,Zc=6,vp=class extends dF{constructor(t={}){super(),this._allowSynchronousEvents=t.allowSynchronousEvents!==void 0?t.allowSynchronousEvents:!0,this._binaryType=t.binaryType||hF[0],this._extensions=t.extensions||{},this._isServer=!!t.isServer,this._maxPayload=t.maxPayload|0,this._skipUTF8Validation=!!t.skipUTF8Validation,this[mF]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=ir}_write(t,r,n){if(this._opcode===8&&this._state==ir)return n();this._bufferedBytes+=t.length,this._buffers.push(t),this.startLoop(n)}consume(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(t<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Xc(n.buffer,n.byteOffset+t,n.length-t),new Xc(n.buffer,n.byteOffset,t)}let r=Buffer.allocUnsafe(t);do{let n=this._buffers[0],s=r.length-t;t>=n.length?r.set(this._buffers.shift(),s):(r.set(new Uint8Array(n.buffer,n.byteOffset,t),s),this._buffers[0]=new Xc(n.buffer,n.byteOffset+t,n.length-t)),t-=n.length}while(t>0);return r}startLoop(t){this._loop=!0;do switch(this._state){case ir:this.getInfo(t);break;case OE:this.getPayloadLength16(t);break;case PE:this.getPayloadLength64(t);break;case IE:this.getMask();break;case bp:this.getData(t);break;case Sp:case Zc:this._loop=!1;return}while(this._loop);this._errored||t()}getInfo(t){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let s=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");t(s);return}let n=(r[0]&64)===64;if(n&&!this._extensions[wE.extensionName]){let s=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(s);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let s=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(s);return}if(!this._fragmented){let s=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");t(s);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let s=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");t(s);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let s=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");t(s);return}if(n){let s=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");t(s);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let s=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");t(s);return}}else{let s=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");t(s);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let s=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");t(s);return}}else if(this._masked){let s=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");t(s);return}this._payloadLength===126?this._state=OE:this._payloadLength===127?this._state=PE:this.haveLength(t)}getPayloadLength16(t){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(t)}getPayloadLength64(t){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let s=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");t(s);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(t)}haveLength(t){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(r);return}this._masked?this._state=IE:this._state=bp}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=bp}getData(t){let r=RE;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&yF(r,this._mask)}if(this._opcode>7){this.controlMessage(r,t);return}if(this._compressed){this._state=Sp,this.decompress(r,t);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(t)}decompress(t,r){this._extensions[wE.extensionName].decompress(t,this._fin,(s,i)=>{if(s)return r(s);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(o);return}this._fragments.push(i)}this.dataMessage(r),this._state===ir&&this.startLoop(r)})}dataMessage(t){if(!this._fin){this._state=ir;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let s;this._binaryType==="nodebuffer"?s=_p(n,r):this._binaryType==="arraybuffer"?s=gF(_p(n,r)):this._binaryType==="blob"?s=new Blob(n):s=n,this._allowSynchronousEvents?(this.emit("message",s,!0),this._state=ir):(this._state=Zc,setImmediate(()=>{this.emit("message",s,!0),this._state=ir,this.startLoop(t)}))}else{let s=_p(n,r);if(!this._skipUTF8Validation&&!TE(s)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._state===Sp||this._allowSynchronousEvents?(this.emit("message",s,!1),this._state=ir):(this._state=Zc,setImmediate(()=>{this.emit("message",s,!1),this._state=ir,this.startLoop(t)}))}}controlMessage(t,r){if(this._opcode===8){if(t.length===0)this._loop=!1,this.emit("conclude",1005,RE),this.end();else{let n=t.readUInt16BE(0);if(!_F(n)){let i=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(i);return}let s=new Xc(t.buffer,t.byteOffset+2,t.length-2);if(!this._skipUTF8Validation&&!TE(s)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(i);return}this._loop=!1,this.emit("conclude",n,s),this.end()}this._state=ir;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",t),this._state=ir):(this._state=Zc,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",t),this._state=ir,this.startLoop(r)}))}createError(t,r,n,s,i){this._loop=!1,this._errored=!0;let o=new t(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(o,this.createError),o.code=i,o[pF]=s,o}};AE.exports=vp});var Tp=S((Fde,$E)=>{"use strict";var{Duplex:jde}=require("stream"),{randomFillSync:bF}=require("crypto"),CE=Ea(),{EMPTY_BUFFER:SF,kWebSocket:vF,NOOP:EF}=un(),{isBlob:Di,isValidStatusCode:wF}=Li(),{mask:NE,toBuffer:Is}=ba(),or=Symbol("kByteLength"),RF=Buffer.alloc(4),Qc=8*1024,As,qi=Qc,Or=0,TF=1,OF=2,wp=class e{constructor(t,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=t,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=Or,this.onerror=EF,this[vF]=void 0}static frame(t,r){let n,s=!1,i=2,o=!1;r.mask&&(n=r.maskBuffer||RF,r.generateMask?r.generateMask(n):(qi===Qc&&(As===void 0&&(As=Buffer.alloc(Qc)),bF(As,0,Qc),qi=0),n[0]=As[qi++],n[1]=As[qi++],n[2]=As[qi++],n[3]=As[qi++]),o=(n[0]|n[1]|n[2]|n[3])===0,i=6);let a;typeof t=="string"?(!r.mask||o)&&r[or]!==void 0?a=r[or]:(t=Buffer.from(t),a=t.length):(a=t.length,s=r.mask&&r.readOnly&&!o);let l=a;a>=65536?(i+=8,l=127):a>125&&(i+=2,l=126);let c=Buffer.allocUnsafe(s?a+i:i);return c[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(c[0]|=64),c[1]=l,l===126?c.writeUInt16BE(a,2):l===127&&(c[2]=c[3]=0,c.writeUIntBE(a,4,6)),r.mask?(c[1]|=128,c[i-4]=n[0],c[i-3]=n[1],c[i-2]=n[2],c[i-1]=n[3],o?[c,t]:s?(NE(t,n,c,i,a),[c]):(NE(t,n,t,0,a),[c,t])):[c,t]}close(t,r,n,s){let i;if(t===void 0)i=SF;else{if(typeof t!="number"||!wF(t))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(t,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(t,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let o={[or]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==Or?this.enqueue([this.dispatch,i,!1,o,s]):this.sendFrame(e.frame(i,o),s)}ping(t,r,n){let s,i;if(typeof t=="string"?(s=Buffer.byteLength(t),i=!1):Di(t)?(s=t.size,i=!1):(t=Is(t),s=t.length,i=Is.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[or]:s,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};Di(t)?this._state!==Or?this.enqueue([this.getBlobData,t,!1,o,n]):this.getBlobData(t,!1,o,n):this._state!==Or?this.enqueue([this.dispatch,t,!1,o,n]):this.sendFrame(e.frame(t,o),n)}pong(t,r,n){let s,i;if(typeof t=="string"?(s=Buffer.byteLength(t),i=!1):Di(t)?(s=t.size,i=!1):(t=Is(t),s=t.length,i=Is.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[or]:s,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};Di(t)?this._state!==Or?this.enqueue([this.getBlobData,t,!1,o,n]):this.getBlobData(t,!1,o,n):this._state!==Or?this.enqueue([this.dispatch,t,!1,o,n]):this.sendFrame(e.frame(t,o),n)}send(t,r,n){let s=this._extensions[CE.extensionName],i=r.binary?2:1,o=r.compress,a,l;typeof t=="string"?(a=Buffer.byteLength(t),l=!1):Di(t)?(a=t.size,l=!1):(t=Is(t),a=t.length,l=Is.readOnly),this._firstFragment?(this._firstFragment=!1,o&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=s._threshold),this._compress=o):(o=!1,i=0),r.fin&&(this._firstFragment=!0);let c={[or]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:l,rsv1:o};Di(t)?this._state!==Or?this.enqueue([this.getBlobData,t,this._compress,c,n]):this.getBlobData(t,this._compress,c,n):this._state!==Or?this.enqueue([this.dispatch,t,this._compress,c,n]):this.dispatch(t,this._compress,c,n)}getBlobData(t,r,n,s){this._bufferedBytes+=n[or],this._state=OF,t.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(Rp,this,a,s);return}this._bufferedBytes-=n[or];let o=Is(i);r?this.dispatch(o,r,n,s):(this._state=Or,this.sendFrame(e.frame(o,n),s),this.dequeue())}).catch(i=>{process.nextTick(PF,this,i,s)})}dispatch(t,r,n,s){if(!r){this.sendFrame(e.frame(t,n),s);return}let i=this._extensions[CE.extensionName];this._bufferedBytes+=n[or],this._state=TF,i.compress(t,n.fin,(o,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");Rp(this,l,s);return}this._bufferedBytes-=n[or],this._state=Or,n.readOnly=!1,this.sendFrame(e.frame(a,n),s),this.dequeue()})}dequeue(){for(;this._state===Or&&this._queue.length;){let t=this._queue.shift();this._bufferedBytes-=t[3][or],Reflect.apply(t[0],this,t.slice(1))}}enqueue(t){this._bufferedBytes+=t[3][or],this._queue.push(t)}sendFrame(t,r){t.length===2?(this._socket.cork(),this._socket.write(t[0]),this._socket.write(t[1],r),this._socket.uncork()):this._socket.write(t[0],r)}};$E.exports=wp;function Rp(e,t,r){typeof r=="function"&&r(t);for(let n=0;n<e._queue.length;n++){let s=e._queue[n],i=s[s.length-1];typeof i=="function"&&i(t)}}function PF(e,t,r){Rp(e,t,r),e.onerror(t)}});var VE=S((Vde,FE)=>{"use strict";var{kForOnEventAttribute:wa,kListener:Op}=un(),xE=Symbol("kCode"),kE=Symbol("kData"),LE=Symbol("kError"),DE=Symbol("kMessage"),qE=Symbol("kReason"),Mi=Symbol("kTarget"),ME=Symbol("kType"),jE=Symbol("kWasClean"),dn=class{constructor(t){this[Mi]=null,this[ME]=t}get target(){return this[Mi]}get type(){return this[ME]}};Object.defineProperty(dn.prototype,"target",{enumerable:!0});Object.defineProperty(dn.prototype,"type",{enumerable:!0});var Cs=class extends dn{constructor(t,r={}){super(t),this[xE]=r.code===void 0?0:r.code,this[qE]=r.reason===void 0?"":r.reason,this[jE]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[xE]}get reason(){return this[qE]}get wasClean(){return this[jE]}};Object.defineProperty(Cs.prototype,"code",{enumerable:!0});Object.defineProperty(Cs.prototype,"reason",{enumerable:!0});Object.defineProperty(Cs.prototype,"wasClean",{enumerable:!0});var ji=class extends dn{constructor(t,r={}){super(t),this[LE]=r.error===void 0?null:r.error,this[DE]=r.message===void 0?"":r.message}get error(){return this[LE]}get message(){return this[DE]}};Object.defineProperty(ji.prototype,"error",{enumerable:!0});Object.defineProperty(ji.prototype,"message",{enumerable:!0});var Ra=class extends dn{constructor(t,r={}){super(t),this[kE]=r.data===void 0?null:r.data}get data(){return this[kE]}};Object.defineProperty(Ra.prototype,"data",{enumerable:!0});var IF={addEventListener(e,t,r={}){for(let s of this.listeners(e))if(!r[wa]&&s[Op]===t&&!s[wa])return;let n;if(e==="message")n=function(i,o){let a=new Ra("message",{data:o?i:i.toString()});a[Mi]=this,eu(t,this,a)};else if(e==="close")n=function(i,o){let a=new Cs("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Mi]=this,eu(t,this,a)};else if(e==="error")n=function(i){let o=new ji("error",{error:i,message:i.message});o[Mi]=this,eu(t,this,o)};else if(e==="open")n=function(){let i=new dn("open");i[Mi]=this,eu(t,this,i)};else return;n[wa]=!!r[wa],n[Op]=t,r.once?this.once(e,n):this.on(e,n)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[Op]===t&&!r[wa]){this.removeListener(e,r);break}}};FE.exports={CloseEvent:Cs,ErrorEvent:ji,Event:dn,EventTarget:IF,MessageEvent:Ra};function eu(e,t,r){typeof e=="object"&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}});var Pp=S((Ude,UE)=>{"use strict";var{tokenChars:Ta}=Li();function jr(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}function AF(e){let t=Object.create(null),r=Object.create(null),n=!1,s=!1,i=!1,o,a,l=-1,c=-1,u=-1,f=0;for(;f<e.length;f++)if(c=e.charCodeAt(f),o===void 0)if(u===-1&&Ta[c]===1)l===-1&&(l=f);else if(f!==0&&(c===32||c===9))u===-1&&l!==-1&&(u=f);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f);let d=e.slice(l,u);c===44?(jr(t,d,r),r=Object.create(null)):o=d,l=u=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(u===-1&&Ta[c]===1)l===-1&&(l=f);else if(c===32||c===9)u===-1&&l!==-1&&(u=f);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f),jr(r,e.slice(l,u),!0),c===44&&(jr(t,o,r),r=Object.create(null),o=void 0),l=u=-1}else if(c===61&&l!==-1&&u===-1)a=e.slice(l,f),l=u=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(s){if(Ta[c]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);l===-1?l=f:n||(n=!0),s=!1}else if(i)if(Ta[c]===1)l===-1&&(l=f);else if(c===34&&l!==-1)i=!1,u=f;else if(c===92)s=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(c===34&&e.charCodeAt(f-1)===61)i=!0;else if(u===-1&&Ta[c]===1)l===-1&&(l=f);else if(l!==-1&&(c===32||c===9))u===-1&&(u=f);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f);let d=e.slice(l,u);n&&(d=d.replace(/\\/g,""),n=!1),jr(r,a,d),c===44&&(jr(t,o,r),r=Object.create(null),o=void 0),a=void 0,l=u=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(l===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=f);let p=e.slice(l,u);return o===void 0?jr(t,p,r):(a===void 0?jr(r,p,!0):n?jr(r,a,p.replace(/\\/g,"")):jr(r,a,p),jr(t,o,r)),t}function CF(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(n=>[t].concat(Object.keys(n).map(s=>{let i=n[s];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?s:`${s}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}UE.exports={format:CF,parse:AF}});var su=S((zde,ew)=>{"use strict";var NF=require("events"),$F=require("https"),xF=require("http"),zE=require("net"),kF=require("tls"),{randomBytes:LF,createHash:DF}=require("crypto"),{Duplex:Hde,Readable:Bde}=require("stream"),{URL:Ip}=require("url"),Hn=Ea(),qF=Ep(),MF=Tp(),{isBlob:jF}=Li(),{BINARY_TYPES:HE,EMPTY_BUFFER:tu,GUID:FF,kForOnEventAttribute:Ap,kListener:VF,kStatusCode:UF,kWebSocket:ot,NOOP:GE}=un(),{EventTarget:{addEventListener:HF,removeEventListener:BF}}=VE(),{format:zF,parse:GF}=Pp(),{toBuffer:WF}=ba(),KF=30*1e3,WE=Symbol("kAborted"),Cp=[8,13],hn=["CONNECTING","OPEN","CLOSING","CLOSED"],JF=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Le=class e extends NF{constructor(t,r,n){super(),this._binaryType=HE[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=tu,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=e.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,t!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),KE(this,t,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(t){HE.includes(t)&&(this._binaryType=t,this._receiver&&(this._receiver._binaryType=t))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(t,r,n){let s=new qF({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new MF(t,this._extensions,n.generateMask);this._receiver=s,this._sender=i,this._socket=t,s[ot]=this,i[ot]=this,t[ot]=this,s.on("conclude",ZF),s.on("drain",QF),s.on("error",e4),s.on("message",t4),s.on("ping",r4),s.on("pong",n4),i.onerror=s4,t.setTimeout&&t.setTimeout(0),t.setNoDelay&&t.setNoDelay(),r.length>0&&t.unshift(r),t.on("close",XE),t.on("data",nu),t.on("end",ZE),t.on("error",QE),this._readyState=e.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=e.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Hn.extensionName]&&this._extensions[Hn.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=e.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(t,r){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){Yt(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===e.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=e.CLOSING,this._sender.close(t,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),YE(this)}}pause(){this.readyState===e.CONNECTING||this.readyState===e.CLOSED||(this._paused=!0,this._socket.pause())}ping(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(n=t,t=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Np(this,t,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(t||tu,r,n)}pong(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(n=t,t=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Np(this,t,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(t||tu,r,n)}resume(){this.readyState===e.CONNECTING||this.readyState===e.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Np(this,t,n);return}let s={binary:typeof t!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Hn.extensionName]||(s.compress=!1),this._sender.send(t||tu,s,n)}terminate(){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){Yt(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=e.CLOSING,this._socket.destroy())}}};Object.defineProperty(Le,"CONNECTING",{enumerable:!0,value:hn.indexOf("CONNECTING")});Object.defineProperty(Le.prototype,"CONNECTING",{enumerable:!0,value:hn.indexOf("CONNECTING")});Object.defineProperty(Le,"OPEN",{enumerable:!0,value:hn.indexOf("OPEN")});Object.defineProperty(Le.prototype,"OPEN",{enumerable:!0,value:hn.indexOf("OPEN")});Object.defineProperty(Le,"CLOSING",{enumerable:!0,value:hn.indexOf("CLOSING")});Object.defineProperty(Le.prototype,"CLOSING",{enumerable:!0,value:hn.indexOf("CLOSING")});Object.defineProperty(Le,"CLOSED",{enumerable:!0,value:hn.indexOf("CLOSED")});Object.defineProperty(Le.prototype,"CLOSED",{enumerable:!0,value:hn.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(Le.prototype,e,{enumerable:!0})});["open","error","close","message"].forEach(e=>{Object.defineProperty(Le.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[Ap])return t[VF];return null},set(t){for(let r of this.listeners(e))if(r[Ap]){this.removeListener(e,r);break}typeof t=="function"&&this.addEventListener(e,t,{[Ap]:!0})}})});Le.prototype.addEventListener=HF;Le.prototype.removeEventListener=BF;ew.exports=Le;function KE(e,t,r,n){let s={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Cp[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=s.autoPong,!Cp.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${Cp.join(", ")})`);let i;if(t instanceof Ip)i=t;else try{i=new Ip(t)}catch{throw new SyntaxError(`Invalid URL: ${t}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),e._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",l;if(i.protocol!=="ws:"&&!o&&!a?l=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!i.pathname?l="The URL's pathname is empty":i.hash&&(l="The URL contains a fragment identifier"),l){let m=new SyntaxError(l);if(e._redirects===0)throw m;ru(e,m);return}let c=o?443:80,u=LF(16).toString("base64"),f=o?$F.request:xF.request,p=new Set,d;if(s.createConnection=s.createConnection||(o?XF:YF),s.defaultPort=s.defaultPort||c,s.port=i.port||c,s.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,s.headers={...s.headers,"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},s.path=i.pathname+i.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(d=new Hn(s.perMessageDeflate!==!0?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=zF({[Hn.extensionName]:d.offer()})),r.length){for(let m of r){if(typeof m!="string"||!JF.test(m)||p.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(m)}s.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(i.username||i.password)&&(s.auth=`${i.username}:${i.password}`),a){let m=s.path.split(":");s.socketPath=m[0],s.path=m[1]}let h;if(s.followRedirects){if(e._redirects===0){e._originalIpc=a,e._originalSecure=o,e._originalHostOrSocketPath=a?s.socketPath:i.host;let m=n&&n.headers;if(n={...n,headers:{}},m)for(let[y,b]of Object.entries(m))n.headers[y.toLowerCase()]=b}else if(e.listenerCount("redirect")===0){let m=a?e._originalIpc?s.socketPath===e._originalHostOrSocketPath:!1:e._originalIpc?!1:i.host===e._originalHostOrSocketPath;(!m||e._originalSecure&&!o)&&(delete s.headers.authorization,delete s.headers.cookie,m||delete s.headers.host,s.auth=void 0)}s.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),h=e._req=f(s),e._redirects&&e.emit("redirect",e.url,h)}else h=e._req=f(s);s.timeout&&h.on("timeout",()=>{Yt(e,h,"Opening handshake has timed out")}),h.on("error",m=>{h===null||h[WE]||(h=e._req=null,ru(e,m))}),h.on("response",m=>{let y=m.headers.location,b=m.statusCode;if(y&&s.followRedirects&&b>=300&&b<400){if(++e._redirects>s.maxRedirects){Yt(e,h,"Maximum redirects exceeded");return}h.abort();let v;try{v=new Ip(y,t)}catch{let g=new SyntaxError(`Invalid URL: ${y}`);ru(e,g);return}KE(e,v,r,n)}else e.emit("unexpected-response",h,m)||Yt(e,h,`Unexpected server response: ${m.statusCode}`)}),h.on("upgrade",(m,y,b)=>{if(e.emit("upgrade",m),e.readyState!==Le.CONNECTING)return;h=e._req=null;let v=m.headers.upgrade;if(v===void 0||v.toLowerCase()!=="websocket"){Yt(e,y,"Invalid Upgrade header");return}let _=DF("sha1").update(u+FF).digest("base64");if(m.headers["sec-websocket-accept"]!==_){Yt(e,y,"Invalid Sec-WebSocket-Accept header");return}let g=m.headers["sec-websocket-protocol"],T;if(g!==void 0?p.size?p.has(g)||(T="Server sent an invalid subprotocol"):T="Server sent a subprotocol but none was requested":p.size&&(T="Server sent no subprotocol"),T){Yt(e,y,T);return}g&&(e._protocol=g);let R=m.headers["sec-websocket-extensions"];if(R!==void 0){if(!d){Yt(e,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let w;try{w=GF(R)}catch{Yt(e,y,"Invalid Sec-WebSocket-Extensions header");return}let P=Object.keys(w);if(P.length!==1||P[0]!==Hn.extensionName){Yt(e,y,"Server indicated an extension that was not requested");return}try{d.accept(w[Hn.extensionName])}catch{Yt(e,y,"Invalid Sec-WebSocket-Extensions header");return}e._extensions[Hn.extensionName]=d}e.setSocket(y,b,{allowSynchronousEvents:s.allowSynchronousEvents,generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),s.finishRequest?s.finishRequest(h,e):h.end()}function ru(e,t){e._readyState=Le.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function YF(e){return e.path=e.socketPath,zE.connect(e)}function XF(e){return e.path=void 0,!e.servername&&e.servername!==""&&(e.servername=zE.isIP(e.host)?"":e.host),kF.connect(e)}function Yt(e,t,r){e._readyState=Le.CLOSING;let n=new Error(r);Error.captureStackTrace(n,Yt),t.setHeader?(t[WE]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(ru,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Np(e,t,r){if(t){let n=jF(t)?t.size:WF(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${e.readyState} (${hn[e.readyState]})`);process.nextTick(r,n)}}function ZF(e,t){let r=this[ot];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,r._socket[ot]!==void 0&&(r._socket.removeListener("data",nu),process.nextTick(JE,r._socket),e===1005?r.close():r.close(e,t))}function QF(){let e=this[ot];e.isPaused||e._socket.resume()}function e4(e){let t=this[ot];t._socket[ot]!==void 0&&(t._socket.removeListener("data",nu),process.nextTick(JE,t._socket),t.close(e[UF])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function BE(){this[ot].emitClose()}function t4(e,t){this[ot].emit("message",e,t)}function r4(e){let t=this[ot];t._autoPong&&t.pong(e,!this._isServer,GE),t.emit("ping",e)}function n4(e){this[ot].emit("pong",e)}function JE(e){e.resume()}function s4(e){let t=this[ot];t.readyState!==Le.CLOSED&&(t.readyState===Le.OPEN&&(t._readyState=Le.CLOSING,YE(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function YE(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),KF)}function XE(){let e=this[ot];this.removeListener("close",XE),this.removeListener("data",nu),this.removeListener("end",ZE),e._readyState=Le.CLOSING;let t;!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&(t=e._socket.read())!==null&&e._receiver.write(t),e._receiver.end(),this[ot]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",BE),e._receiver.on("finish",BE))}function nu(e){this[ot]._receiver.write(e)||this.pause()}function ZE(){let e=this[ot];e._readyState=Le.CLOSING,e._receiver.end(),this.end()}function QE(){let e=this[ot];this.removeListener("error",QE),this.on("error",GE),e&&(e._readyState=Le.CLOSING,this.destroy())}});var sw=S((Wde,nw)=>{"use strict";var Gde=su(),{Duplex:i4}=require("stream");function tw(e){e.emit("close")}function o4(){!this.destroyed&&this._writableState.finished&&this.destroy()}function rw(e){this.removeListener("error",rw),this.destroy(),this.listenerCount("error")===0&&this.emit("error",e)}function a4(e,t){let r=!0,n=new i4({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(i,o){let a=!o&&n._readableState.objectMode?i.toString():i;n.push(a)||e.pause()}),e.once("error",function(i){n.destroyed||(r=!1,n.destroy(i))}),e.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(s,i){if(e.readyState===e.CLOSED){i(s),process.nextTick(tw,n);return}let o=!1;e.once("error",function(l){o=!0,i(l)}),e.once("close",function(){o||i(s),process.nextTick(tw,n)}),r&&e.terminate()},n._final=function(s){if(e.readyState===e.CONNECTING){e.once("open",function(){n._final(s)});return}e._socket!==null&&(e._socket._writableState.finished?(s(),n._readableState.endEmitted&&n.destroy()):(e._socket.once("finish",function(){s()}),e.close()))},n._read=function(){e.isPaused&&e.resume()},n._write=function(s,i,o){if(e.readyState===e.CONNECTING){e.once("open",function(){n._write(s,i,o)});return}e.send(s,o)},n.on("end",o4),n.on("error",rw),n}nw.exports=a4});var ow=S((Kde,iw)=>{"use strict";var{tokenChars:l4}=Li();function c4(e){let t=new Set,r=-1,n=-1,s=0;for(s;s<e.length;s++){let o=e.charCodeAt(s);if(n===-1&&l4[o]===1)r===-1&&(r=s);else if(s!==0&&(o===32||o===9))n===-1&&r!==-1&&(n=s);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${s}`);n===-1&&(n=s);let a=e.slice(r,n);if(t.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);t.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${s}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let i=e.slice(r,s);if(t.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return t.add(i),t}iw.exports={parse:c4}});var hw=S((Yde,dw)=>{"use strict";var u4=require("events"),iu=require("http"),{Duplex:Jde}=require("stream"),{createHash:f4}=require("crypto"),aw=Pp(),Ns=Ea(),d4=ow(),h4=su(),{GUID:p4,kWebSocket:m4}=un(),g4=/^[+/0-9A-Za-z]{22}==$/,lw=0,cw=1,fw=2,$p=class extends u4{constructor(t,r){if(super(),t={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:h4,...t},t.port==null&&!t.server&&!t.noServer||t.port!=null&&(t.server||t.noServer)||t.server&&t.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(t.port!=null?(this._server=iu.createServer((n,s)=>{let i=iu.STATUS_CODES[426];s.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),s.end(i)}),this._server.listen(t.port,t.host,t.backlog,r)):t.server&&(this._server=t.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=y4(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(s,i,o)=>{this.handleUpgrade(s,i,o,n)}})}t.perMessageDeflate===!0&&(t.perMessageDeflate={}),t.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=t,this._state=lw}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(this._state===fw){t&&this.once("close",()=>{t(new Error("The server is not running"))}),process.nextTick(Oa,this);return}if(t&&this.once("close",t),this._state!==cw)if(this._state=cw,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Oa,this):process.nextTick(Oa,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Oa(this)})}}shouldHandle(t){if(this.options.path){let r=t.url.indexOf("?");if((r!==-1?t.url.slice(0,r):t.url)!==this.options.path)return!1}return!0}handleUpgrade(t,r,n,s){r.on("error",uw);let i=t.headers["sec-websocket-key"],o=t.headers.upgrade,a=+t.headers["sec-websocket-version"];if(t.method!=="GET"){$s(this,t,r,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){$s(this,t,r,400,"Invalid Upgrade header");return}if(i===void 0||!g4.test(i)){$s(this,t,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){$s(this,t,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(t)){Pa(r,400);return}let l=t.headers["sec-websocket-protocol"],c=new Set;if(l!==void 0)try{c=d4.parse(l)}catch{$s(this,t,r,400,"Invalid Sec-WebSocket-Protocol header");return}let u=t.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&u!==void 0){let p=new Ns(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let d=aw.parse(u);d[Ns.extensionName]&&(p.accept(d[Ns.extensionName]),f[Ns.extensionName]=p)}catch{$s(this,t,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:t.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(t.socket.authorized||t.socket.encrypted),req:t};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(d,h,m,y)=>{if(!d)return Pa(r,h||401,m,y);this.completeUpgrade(f,i,c,t,r,n,s)});return}if(!this.options.verifyClient(p))return Pa(r,401)}this.completeUpgrade(f,i,c,t,r,n,s)}completeUpgrade(t,r,n,s,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[m4])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>lw)return Pa(i,503);let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${f4("sha1").update(r+p4).digest("base64")}`],u=new this.options.WebSocket(null,void 0,this.options);if(n.size){let f=this.options.handleProtocols?this.options.handleProtocols(n,s):n.values().next().value;f&&(c.push(`Sec-WebSocket-Protocol: ${f}`),u._protocol=f)}if(t[Ns.extensionName]){let f=t[Ns.extensionName].params,p=aw.format({[Ns.extensionName]:[f]});c.push(`Sec-WebSocket-Extensions: ${p}`),u._extensions=t}this.emit("headers",c,s),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",uw),u.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Oa,this)})),a(u,s)}};dw.exports=$p;function y4(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let n of Object.keys(t))e.removeListener(n,t[n])}}function Oa(e){e._state=fw,e.emit("close")}function uw(){this.destroy()}function Pa(e,t,r,n){r=r||iu.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${iu.STATUS_CODES[t]}\r
`+Object.keys(n).map(s=>`${s}: ${n[s]}`).join(`\r
`)+`\r
\r
`+r)}function $s(e,t,r,n,s){if(e.listenerCount("wsClientError")){let i=new Error(s);Error.captureStackTrace(i,$s),e.emit("wsClientError",i,r,t)}else Pa(r,n,s)}});var mw=S((Xde,pw)=>{"use strict";var pn=su();pn.createWebSocketStream=sw();pn.Server=hw();pn.Receiver=Ep();pn.Sender=Tp();pn.WebSocket=pn;pn.WebSocketServer=pn.Server;pw.exports=pn});var xp=S((Zde,gw)=>{gw.exports=require("stream")});var Ew=S((Qde,vw)=>{"use strict";function yw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function _w(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yw(Object(r),!0).forEach(function(n){_4(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yw(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _4(e,t,r){return t=Sw(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bw(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sw(n.key),n)}}function S4(e,t,r){return t&&bw(e.prototype,t),r&&bw(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Sw(e){var t=v4(e,"string");return typeof t=="symbol"?t:String(t)}function v4(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var E4=require("buffer"),ou=E4.Buffer,w4=require("util"),kp=w4.inspect,R4=kp&&kp.custom||"inspect";function T4(e,t,r){ou.prototype.copy.call(e,t,r)}vw.exports=function(){function e(){b4(this,e),this.head=null,this.tail=null,this.length=0}return S4(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,s=""+n.data;n=n.next;)s+=r+n.data;return s}},{key:"concat",value:function(r){if(this.length===0)return ou.alloc(0);for(var n=ou.allocUnsafe(r>>>0),s=this.head,i=0;s;)T4(s.data,n,i),i+=s.data.length,s=s.next;return n}},{key:"consume",value:function(r,n){var s;return r<this.head.data.length?(s=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?s=this.shift():s=n?this._getString(r):this._getBuffer(r),s}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,s=1,i=n.data;for(r-=i.length;n=n.next;){var o=n.data,a=r>o.length?o.length:r;if(a===o.length?i+=o:i+=o.slice(0,r),r-=a,r===0){a===o.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=o.slice(a));break}++s}return this.length-=s,i}},{key:"_getBuffer",value:function(r){var n=ou.allocUnsafe(r),s=this.head,i=1;for(s.data.copy(n),r-=s.data.length;s=s.next;){var o=s.data,a=r>o.length?o.length:r;if(o.copy(n,n.length-r,0,a),r-=a,r===0){a===o.length?(++i,s.next?this.head=s.next:this.head=this.tail=null):(this.head=s,s.data=o.slice(a));break}++i}return this.length-=i,n}},{key:R4,value:function(r,n){return kp(this,_w(_w({},n),{},{depth:0,customInspect:!1}))}}]),e}()});var Dp=S((ehe,Rw)=>{"use strict";function O4(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return n||s?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Lp,this,e)):process.nextTick(Lp,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(i){!t&&i?r._writableState?r._writableState.errorEmitted?process.nextTick(au,r):(r._writableState.errorEmitted=!0,process.nextTick(ww,r,i)):process.nextTick(ww,r,i):t?(process.nextTick(au,r),t(i)):process.nextTick(au,r)}),this)}function ww(e,t){Lp(e,t),au(e)}function au(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function P4(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Lp(e,t){e.emit("error",t)}function I4(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}Rw.exports={destroy:O4,undestroy:P4,errorOrDestroy:I4}});var Bn=S((the,Pw)=>{"use strict";var Ow={};function ar(e,t,r){r||(r=Error);function n(i,o,a){return typeof t=="string"?t:t(i,o,a)}class s extends r{constructor(o,a,l){super(n(o,a,l))}}s.prototype.name=r.name,s.prototype.code=e,Ow[e]=s}function Tw(e,t){if(Array.isArray(e)){let r=e.length;return e=e.map(n=>String(n)),r>2?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:r===2?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}else return`of ${t} ${String(e)}`}function A4(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function C4(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function N4(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}ar("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError);ar("ERR_INVALID_ARG_TYPE",function(e,t,r){let n;typeof t=="string"&&A4(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";let s;if(C4(e," argument"))s=`The ${e} ${n} ${Tw(t,"type")}`;else{let i=N4(e,".")?"property":"argument";s=`The "${e}" ${i} ${n} ${Tw(t,"type")}`}return s+=`. Received type ${typeof r}`,s},TypeError);ar("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");ar("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"});ar("ERR_STREAM_PREMATURE_CLOSE","Premature close");ar("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"});ar("ERR_MULTIPLE_CALLBACK","Callback called multiple times");ar("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");ar("ERR_STREAM_WRITE_AFTER_END","write after end");ar("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);ar("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError);ar("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Pw.exports.codes=Ow});var qp=S((rhe,Iw)=>{"use strict";var $4=Bn().codes.ERR_INVALID_OPT_VALUE;function x4(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function k4(e,t,r,n){var s=x4(t,n,r);if(s!=null){if(!(isFinite(s)&&Math.floor(s)===s)||s<0){var i=n?r:"highWaterMark";throw new $4(i,s)}return Math.floor(s)}return e.objectMode?16:16*1024}Iw.exports={getHighWaterMark:k4}});var Aw=S((nhe,Mp)=>{typeof Object.create=="function"?Mp.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Mp.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}});var xs=S((she,Fp)=>{try{if(jp=require("util"),typeof jp.inherits!="function")throw"";Fp.exports=jp.inherits}catch{Fp.exports=Aw()}var jp});var Nw=S((ihe,Cw)=>{Cw.exports=require("util").deprecate});var Hp=S((ohe,qw)=>{"use strict";qw.exports=Ve;function xw(e){var t=this;this.next=null,this.entry=null,this.finish=function(){aV(t,e)}}var Fi;Ve.WritableState=Aa;var L4={deprecate:Nw()},kw=xp(),cu=require("buffer").Buffer,D4=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function q4(e){return cu.from(e)}function M4(e){return cu.isBuffer(e)||e instanceof D4}var Up=Dp(),j4=qp(),F4=j4.getHighWaterMark,zn=Bn().codes,V4=zn.ERR_INVALID_ARG_TYPE,U4=zn.ERR_METHOD_NOT_IMPLEMENTED,H4=zn.ERR_MULTIPLE_CALLBACK,B4=zn.ERR_STREAM_CANNOT_PIPE,z4=zn.ERR_STREAM_DESTROYED,G4=zn.ERR_STREAM_NULL_VALUES,W4=zn.ERR_STREAM_WRITE_AFTER_END,K4=zn.ERR_UNKNOWN_ENCODING,Vi=Up.errorOrDestroy;xs()(Ve,kw);function J4(){}function Aa(e,t,r){Fi=Fi||ks(),e=e||{},typeof r!="boolean"&&(r=t instanceof Fi),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=F4(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(s){rV(t,s)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new xw(this)}Aa.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};(function(){try{Object.defineProperty(Aa.prototype,"buffer",{get:L4.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var lu;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(lu=Function.prototype[Symbol.hasInstance],Object.defineProperty(Ve,Symbol.hasInstance,{value:function(t){return lu.call(this,t)?!0:this!==Ve?!1:t&&t._writableState instanceof Aa}})):lu=function(t){return t instanceof this};function Ve(e){Fi=Fi||ks();var t=this instanceof Fi;if(!t&&!lu.call(Ve,this))return new Ve(e);this._writableState=new Aa(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),kw.call(this)}Ve.prototype.pipe=function(){Vi(this,new B4)};function Y4(e,t){var r=new W4;Vi(e,r),process.nextTick(t,r)}function X4(e,t,r,n){var s;return r===null?s=new G4:typeof r!="string"&&!t.objectMode&&(s=new V4("chunk",["string","Buffer"],r)),s?(Vi(e,s),process.nextTick(n,s),!1):!0}Ve.prototype.write=function(e,t,r){var n=this._writableState,s=!1,i=!n.objectMode&&M4(e);return i&&!cu.isBuffer(e)&&(e=q4(e)),typeof t=="function"&&(r=t,t=null),i?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=J4),n.ending?Y4(this,r):(i||X4(this,n,e,r))&&(n.pendingcb++,s=Q4(this,n,i,e,t,r)),s};Ve.prototype.cork=function(){this._writableState.corked++};Ve.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&Lw(this,e))};Ve.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new K4(t);return this._writableState.defaultEncoding=t,this};Object.defineProperty(Ve.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Z4(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=cu.from(t,r)),t}Object.defineProperty(Ve.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Q4(e,t,r,n,s,i){if(!r){var o=Z4(t,n,s);n!==o&&(r=!0,s="buffer",n=o)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:s,isBuf:r,callback:i,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Vp(e,t,!1,a,n,s,i);return l}function Vp(e,t,r,n,s,i,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new z4("write")):r?e._writev(s,t.onwrite):e._write(s,i,t.onwrite),t.sync=!1}function eV(e,t,r,n,s){--t.pendingcb,r?(process.nextTick(s,n),process.nextTick(Ia,e,t),e._writableState.errorEmitted=!0,Vi(e,n)):(s(n),e._writableState.errorEmitted=!0,Vi(e,n),Ia(e,t))}function tV(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function rV(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if(typeof s!="function")throw new H4;if(tV(r),t)eV(e,r,n,t,s);else{var i=Dw(r)||e.destroyed;!i&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Lw(e,r),n?process.nextTick($w,e,r,i,s):$w(e,r,i,s)}}function $w(e,t,r,n){r||nV(e,t),t.pendingcb--,n(),Ia(e,t)}function nV(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function Lw(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,s=new Array(n),i=t.corkedRequestsFree;i.entry=r;for(var o=0,a=!0;r;)s[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;s.allBuffers=a,Vp(e,t,!0,t.length,s,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new xw(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,u=r.callback,f=t.objectMode?1:l.length;if(Vp(e,t,!1,f,l,c,u),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}Ve.prototype._write=function(e,t,r){r(new U4("_write()"))};Ve.prototype._writev=null;Ve.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||oV(this,n,r),this};Object.defineProperty(Ve.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Dw(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function sV(e,t){e._final(function(r){t.pendingcb--,r&&Vi(e,r),t.prefinished=!0,e.emit("prefinish"),Ia(e,t)})}function iV(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,process.nextTick(sV,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function Ia(e,t){var r=Dw(t);if(r&&(iV(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function oV(e,t,r){t.ending=!0,Ia(e,t),r&&(t.finished?process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function aV(e,t,r){var n=e.entry;for(e.entry=null;n;){var s=n.callback;t.pendingcb--,s(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(Ve.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}});Ve.prototype.destroy=Up.destroy;Ve.prototype._undestroy=Up.undestroy;Ve.prototype._destroy=function(e,t){t(e)}});var ks=S((ahe,jw)=>{"use strict";var lV=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};jw.exports=Fr;var Mw=Gp(),zp=Hp();xs()(Fr,Mw);for(Bp=lV(zp.prototype),uu=0;uu<Bp.length;uu++)fu=Bp[uu],Fr.prototype[fu]||(Fr.prototype[fu]=zp.prototype[fu]);var Bp,fu,uu;function Fr(e){if(!(this instanceof Fr))return new Fr(e);Mw.call(this,e),zp.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",cV)))}Object.defineProperty(Fr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(Fr.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Fr.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function cV(){this._writableState.ended||process.nextTick(uV,this)}function uV(e){e.end()}Object.defineProperty(Fr.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=t,this._writableState.destroyed=t)}})});var Uw=S((Wp,Vw)=>{var du=require("buffer"),Vr=du.Buffer;function Fw(e,t){for(var r in e)t[r]=e[r]}Vr.from&&Vr.alloc&&Vr.allocUnsafe&&Vr.allocUnsafeSlow?Vw.exports=du:(Fw(du,Wp),Wp.Buffer=Ls);function Ls(e,t,r){return Vr(e,t,r)}Ls.prototype=Object.create(Vr.prototype);Fw(Vr,Ls);Ls.from=function(e,t,r){if(typeof e=="number")throw new TypeError("Argument must not be a number");return Vr(e,t,r)};Ls.alloc=function(e,t,r){if(typeof e!="number")throw new TypeError("Argument must be a number");var n=Vr(e);return t!==void 0?typeof r=="string"?n.fill(t,r):n.fill(t):n.fill(0),n};Ls.allocUnsafe=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return Vr(e)};Ls.allocUnsafeSlow=function(e){if(typeof e!="number")throw new TypeError("Argument must be a number");return du.SlowBuffer(e)}});var Yp=S(Bw=>{"use strict";var Jp=Uw().Buffer,Hw=Jp.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function fV(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function dV(e){var t=fV(e);if(typeof t!="string"&&(Jp.isEncoding===Hw||!Hw(e)))throw new Error("Unknown encoding: "+e);return t||e}Bw.StringDecoder=Ca;function Ca(e){this.encoding=dV(e);var t;switch(this.encoding){case"utf16le":this.text=_V,this.end=bV,t=4;break;case"utf8":this.fillLast=mV,t=4;break;case"base64":this.text=SV,this.end=vV,t=3;break;default:this.write=EV,this.end=wV;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Jp.allocUnsafe(t)}Ca.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""};Ca.prototype.end=yV;Ca.prototype.text=gV;Ca.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function Kp(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function hV(e,t,r){var n=t.length-1;if(n<r)return 0;var s=Kp(t[n]);return s>=0?(s>0&&(e.lastNeed=s-1),s):--n<r||s===-2?0:(s=Kp(t[n]),s>=0?(s>0&&(e.lastNeed=s-2),s):--n<r||s===-2?0:(s=Kp(t[n]),s>=0?(s>0&&(s===2?s=0:e.lastNeed=s-3),s):0))}function pV(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function mV(e){var t=this.lastTotal-this.lastNeed,r=pV(this,e,t);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function gV(e,t){var r=hV(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function yV(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function _V(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function bV(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function SV(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function vV(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function EV(e){return e.toString(this.encoding)}function wV(e){return e&&e.length?this.write(e):""}});var hu=S((che,Ww)=>{"use strict";var zw=Bn().codes.ERR_STREAM_PREMATURE_CLOSE;function RV(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];e.apply(this,n)}}}function TV(){}function OV(e){return e.setHeader&&typeof e.abort=="function"}function Gw(e,t,r){if(typeof t=="function")return Gw(e,null,t);t||(t={}),r=RV(r||TV);var n=t.readable||t.readable!==!1&&e.readable,s=t.writable||t.writable!==!1&&e.writable,i=function(){e.writable||a()},o=e._writableState&&e._writableState.finished,a=function(){s=!1,o=!0,n||r.call(e)},l=e._readableState&&e._readableState.endEmitted,c=function(){n=!1,l=!0,s||r.call(e)},u=function(h){r.call(e,h)},f=function(){var h;if(n&&!l)return(!e._readableState||!e._readableState.ended)&&(h=new zw),r.call(e,h);if(s&&!o)return(!e._writableState||!e._writableState.ended)&&(h=new zw),r.call(e,h)},p=function(){e.req.on("finish",a)};return OV(e)?(e.on("complete",a),e.on("abort",f),e.req?p():e.on("request",p)):s&&!e._writableState&&(e.on("end",i),e.on("close",i)),e.on("end",c),e.on("finish",a),t.error!==!1&&e.on("error",u),e.on("close",f),function(){e.removeListener("complete",a),e.removeListener("abort",f),e.removeListener("request",p),e.req&&e.req.removeListener("finish",a),e.removeListener("end",i),e.removeListener("close",i),e.removeListener("finish",a),e.removeListener("end",c),e.removeListener("error",u),e.removeListener("close",f)}}Ww.exports=Gw});var Jw=S((uhe,Kw)=>{"use strict";var pu;function Gn(e,t,r){return t=PV(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PV(e){var t=IV(e,"string");return typeof t=="symbol"?t:String(t)}function IV(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AV=hu(),Wn=Symbol("lastResolve"),Ds=Symbol("lastReject"),Na=Symbol("error"),mu=Symbol("ended"),qs=Symbol("lastPromise"),Xp=Symbol("handlePromise"),Ms=Symbol("stream");function Kn(e,t){return{value:e,done:t}}function CV(e){var t=e[Wn];if(t!==null){var r=e[Ms].read();r!==null&&(e[qs]=null,e[Wn]=null,e[Ds]=null,t(Kn(r,!1)))}}function NV(e){process.nextTick(CV,e)}function $V(e,t){return function(r,n){e.then(function(){if(t[mu]){r(Kn(void 0,!0));return}t[Xp](r,n)},n)}}var xV=Object.getPrototypeOf(function(){}),kV=Object.setPrototypeOf((pu={get stream(){return this[Ms]},next:function(){var t=this,r=this[Na];if(r!==null)return Promise.reject(r);if(this[mu])return Promise.resolve(Kn(void 0,!0));if(this[Ms].destroyed)return new Promise(function(o,a){process.nextTick(function(){t[Na]?a(t[Na]):o(Kn(void 0,!0))})});var n=this[qs],s;if(n)s=new Promise($V(n,this));else{var i=this[Ms].read();if(i!==null)return Promise.resolve(Kn(i,!1));s=new Promise(this[Xp])}return this[qs]=s,s}},Gn(pu,Symbol.asyncIterator,function(){return this}),Gn(pu,"return",function(){var t=this;return new Promise(function(r,n){t[Ms].destroy(null,function(s){if(s){n(s);return}r(Kn(void 0,!0))})})}),pu),xV),LV=function(t){var r,n=Object.create(kV,(r={},Gn(r,Ms,{value:t,writable:!0}),Gn(r,Wn,{value:null,writable:!0}),Gn(r,Ds,{value:null,writable:!0}),Gn(r,Na,{value:null,writable:!0}),Gn(r,mu,{value:t._readableState.endEmitted,writable:!0}),Gn(r,Xp,{value:function(i,o){var a=n[Ms].read();a?(n[qs]=null,n[Wn]=null,n[Ds]=null,i(Kn(a,!1))):(n[Wn]=i,n[Ds]=o)},writable:!0}),r));return n[qs]=null,AV(t,function(s){if(s&&s.code!=="ERR_STREAM_PREMATURE_CLOSE"){var i=n[Ds];i!==null&&(n[qs]=null,n[Wn]=null,n[Ds]=null,i(s)),n[Na]=s;return}var o=n[Wn];o!==null&&(n[qs]=null,n[Wn]=null,n[Ds]=null,o(Kn(void 0,!0))),n[mu]=!0}),t.on("readable",NV.bind(null,n)),n};Kw.exports=LV});var Qw=S((fhe,Zw)=>{"use strict";function Yw(e,t,r,n,s,i,o){try{var a=e[i](o),l=a.value}catch(c){r(c);return}a.done?t(l):Promise.resolve(l).then(n,s)}function DV(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(l){Yw(i,n,s,o,a,"next",l)}function a(l){Yw(i,n,s,o,a,"throw",l)}o(void 0)})}}function Xw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function qV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xw(Object(r),!0).forEach(function(n){MV(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xw(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MV(e,t,r){return t=jV(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jV(e){var t=FV(e,"string");return typeof t=="symbol"?t:String(t)}function FV(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var VV=Bn().codes.ERR_INVALID_ARG_TYPE;function UV(e,t,r){var n;if(t&&typeof t.next=="function")n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])n=t[Symbol.iterator]();else throw new VV("iterable",["Iterable"],t);var s=new e(qV({objectMode:!0},r)),i=!1;s._read=function(){i||(i=!0,o())};function o(){return a.apply(this,arguments)}function a(){return a=DV(function*(){try{var l=yield n.next(),c=l.value,u=l.done;u?s.push(null):s.push(yield c)?o():i=!1}catch(f){s.destroy(f)}}),a.apply(this,arguments)}return s}Zw.exports=UV});var Gp=S((hhe,cR)=>{"use strict";cR.exports=fe;var Ui;fe.ReadableState=nR;var dhe=require("events").EventEmitter,rR=function(t,r){return t.listeners(r).length},xa=xp(),gu=require("buffer").Buffer,HV=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function BV(e){return gu.from(e)}function zV(e){return gu.isBuffer(e)||e instanceof HV}var Zp=require("util"),re;Zp&&Zp.debuglog?re=Zp.debuglog("stream"):re=function(){};var GV=Ew(),im=Dp(),WV=qp(),KV=WV.getHighWaterMark,yu=Bn().codes,JV=yu.ERR_INVALID_ARG_TYPE,YV=yu.ERR_STREAM_PUSH_AFTER_EOF,XV=yu.ERR_METHOD_NOT_IMPLEMENTED,ZV=yu.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Hi,Qp,em;xs()(fe,xa);var $a=im.errorOrDestroy,tm=["error","close","destroy","pause","resume"];function QV(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function nR(e,t,r){Ui=Ui||ks(),e=e||{},typeof r!="boolean"&&(r=t instanceof Ui),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=KV(this,e,"readableHighWaterMark",r),this.buffer=new GV,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Hi||(Hi=Yp().StringDecoder),this.decoder=new Hi(e.encoding),this.encoding=e.encoding)}function fe(e){if(Ui=Ui||ks(),!(this instanceof fe))return new fe(e);var t=this instanceof Ui;this._readableState=new nR(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),xa.call(this)}Object.defineProperty(fe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}});fe.prototype.destroy=im.destroy;fe.prototype._undestroy=im.undestroy;fe.prototype._destroy=function(e,t){t(e)};fe.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=gu.from(e,t),t=""),n=!0),sR(this,e,t,!1,n)};fe.prototype.unshift=function(e){return sR(this,e,null,!0,!1)};function sR(e,t,r,n,s){re("readableAddChunk",t);var i=e._readableState;if(t===null)i.reading=!1,r3(e,i);else{var o;if(s||(o=e3(i,t)),o)$a(e,o);else if(i.objectMode||t&&t.length>0)if(typeof t!="string"&&!i.objectMode&&Object.getPrototypeOf(t)!==gu.prototype&&(t=BV(t)),n)i.endEmitted?$a(e,new ZV):rm(e,i,t,!0);else if(i.ended)$a(e,new YV);else{if(i.destroyed)return!1;i.reading=!1,i.decoder&&!r?(t=i.decoder.write(t),i.objectMode||t.length!==0?rm(e,i,t,!1):sm(e,i)):rm(e,i,t,!1)}else n||(i.reading=!1,sm(e,i))}return!i.ended&&(i.length<i.highWaterMark||i.length===0)}function rm(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&_u(e)),sm(e,t)}function e3(e,t){var r;return!zV(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new JV("chunk",["string","Buffer","Uint8Array"],t)),r}fe.prototype.isPaused=function(){return this._readableState.flowing===!1};fe.prototype.setEncoding=function(e){Hi||(Hi=Yp().StringDecoder);var t=new Hi(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var eR=1073741824;function t3(e){return e>=eR?e=eR:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function tR(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=t3(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}fe.prototype.read=function(e){re("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return re("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?nm(this):_u(this),null;if(e=tR(e,t),e===0&&t.ended)return t.length===0&&nm(this),null;var n=t.needReadable;re("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,re("length less than watermark",n)),t.ended||t.reading?(n=!1,re("reading or ended",n)):n&&(re("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=tR(r,t)));var s;return e>0?s=aR(e,t):s=null,s===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&nm(this)),s!==null&&this.emit("data",s),s};function r3(e,t){if(re("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?_u(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,iR(e)))}}function _u(e){var t=e._readableState;re("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(re("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(iR,e))}function iR(e){var t=e._readableState;re("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,om(e)}function sm(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(n3,e,t))}function n3(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(re("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}fe.prototype._read=function(e){$a(this,new XV("_read()"))};fe.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,re("pipe count=%d opts=%j",n.pipesCount,t);var s=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,i=s?a:m;n.endEmitted?process.nextTick(i):r.once("end",i),e.on("unpipe",o);function o(y,b){re("onunpipe"),y===r&&b&&b.hasUnpiped===!1&&(b.hasUnpiped=!0,u())}function a(){re("onend"),e.end()}var l=s3(r);e.on("drain",l);var c=!1;function u(){re("cleanup"),e.removeListener("close",d),e.removeListener("finish",h),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",o),r.removeListener("end",a),r.removeListener("end",m),r.removeListener("data",f),c=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&l()}r.on("data",f);function f(y){re("ondata");var b=e.write(y);re("dest.write",b),b===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&lR(n.pipes,e)!==-1)&&!c&&(re("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(y){re("onerror",y),m(),e.removeListener("error",p),rR(e,"error")===0&&$a(e,y)}QV(e,"error",p);function d(){e.removeListener("finish",h),m()}e.once("close",d);function h(){re("onfinish"),e.removeListener("close",d),m()}e.once("finish",h);function m(){re("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(re("pipe resume"),r.resume()),e};function s3(e){return function(){var r=e._readableState;re("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&rR(e,"data")&&(r.flowing=!0,om(e))}}fe.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,s=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<s;i++)n[i].emit("unpipe",this,{hasUnpiped:!1});return this}var o=lR(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)};fe.prototype.on=function(e,t){var r=xa.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,re("on readable",n.length,n.reading),n.length?_u(this):n.reading||process.nextTick(i3,this)),r};fe.prototype.addListener=fe.prototype.on;fe.prototype.removeListener=function(e,t){var r=xa.prototype.removeListener.call(this,e,t);return e==="readable"&&process.nextTick(oR,this),r};fe.prototype.removeAllListeners=function(e){var t=xa.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&process.nextTick(oR,this),t};function oR(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function i3(e){re("readable nexttick read 0"),e.read(0)}fe.prototype.resume=function(){var e=this._readableState;return e.flowing||(re("resume"),e.flowing=!e.readableListening,o3(this,e)),e.paused=!1,this};function o3(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(a3,e,t))}function a3(e,t){re("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),om(e),t.flowing&&!t.reading&&e.read(0)}fe.prototype.pause=function(){return re("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(re("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function om(e){var t=e._readableState;for(re("flow",t.flowing);t.flowing&&e.read()!==null;);}fe.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(re("wrapped end"),r.decoder&&!r.ended){var o=r.decoder.end();o&&o.length&&t.push(o)}t.push(null)}),e.on("data",function(o){if(re("wrapped data"),r.decoder&&(o=r.decoder.write(o)),!(r.objectMode&&o==null)&&!(!r.objectMode&&(!o||!o.length))){var a=t.push(o);a||(n=!0,e.pause())}});for(var s in e)this[s]===void 0&&typeof e[s]=="function"&&(this[s]=function(a){return function(){return e[a].apply(e,arguments)}}(s));for(var i=0;i<tm.length;i++)e.on(tm[i],this.emit.bind(this,tm[i]));return this._read=function(o){re("wrapped _read",o),n&&(n=!1,e.resume())},this};typeof Symbol=="function"&&(fe.prototype[Symbol.asyncIterator]=function(){return Qp===void 0&&(Qp=Jw()),Qp(this)});Object.defineProperty(fe.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(fe.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(fe.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}});fe._fromList=aR;Object.defineProperty(fe.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function aR(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function nm(e){var t=e._readableState;re("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(l3,t,e))}function l3(e,t){if(re("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(fe.from=function(e,t){return em===void 0&&(em=Qw()),em(fe,e,t)});function lR(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}});var am=S((phe,fR)=>{"use strict";fR.exports=mn;var bu=Bn().codes,c3=bu.ERR_METHOD_NOT_IMPLEMENTED,u3=bu.ERR_MULTIPLE_CALLBACK,f3=bu.ERR_TRANSFORM_ALREADY_TRANSFORMING,d3=bu.ERR_TRANSFORM_WITH_LENGTH_0,Su=ks();xs()(mn,Su);function h3(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new u3);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function mn(e){if(!(this instanceof mn))return new mn(e);Su.call(this,e),this._transformState={afterTransform:h3.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",p3)}function p3(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){uR(e,t,r)}):uR(this,null,null)}mn.prototype.push=function(e,t){return this._transformState.needTransform=!1,Su.prototype.push.call(this,e,t)};mn.prototype._transform=function(e,t,r){r(new c3("_transform()"))};mn.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var s=this._readableState;(n.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}};mn.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};mn.prototype._destroy=function(e,t){Su.prototype._destroy.call(this,e,function(r){t(r)})};function uR(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new d3;if(e._transformState.transforming)throw new f3;return e.push(null)}});var pR=S((mhe,hR)=>{"use strict";hR.exports=ka;var dR=am();xs()(ka,dR);function ka(e){if(!(this instanceof ka))return new ka(e);dR.call(this,e)}ka.prototype._transform=function(e,t,r){r(null,e)}});var bR=S((ghe,_R)=>{"use strict";var lm;function m3(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var yR=Bn().codes,g3=yR.ERR_MISSING_ARGS,y3=yR.ERR_STREAM_DESTROYED;function mR(e){if(e)throw e}function _3(e){return e.setHeader&&typeof e.abort=="function"}function b3(e,t,r,n){n=m3(n);var s=!1;e.on("close",function(){s=!0}),lm===void 0&&(lm=hu()),lm(e,{readable:t,writable:r},function(o){if(o)return n(o);s=!0,n()});var i=!1;return function(o){if(!s&&!i){if(i=!0,_3(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(o||new y3("pipe"))}}}function gR(e){e()}function S3(e,t){return e.pipe(t)}function v3(e){return!e.length||typeof e[e.length-1]!="function"?mR:e.pop()}function E3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=v3(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new g3("streams");var s,i=t.map(function(o,a){var l=a<t.length-1,c=a>0;return b3(o,l,c,function(u){s||(s=u),u&&i.forEach(gR),!l&&(i.forEach(gR),n(s))})});return t.reduce(S3)}_R.exports=E3});var SR=S((lr,Da)=>{var La=require("stream");process.env.READABLE_STREAM==="disable"&&La?(Da.exports=La.Readable,Object.assign(Da.exports,La),Da.exports.Stream=La):(lr=Da.exports=Gp(),lr.Stream=La||lr,lr.Readable=lr,lr.Writable=Hp(),lr.Duplex=ks(),lr.Transform=am(),lr.PassThrough=pR(),lr.finished=hu(),lr.pipeline=bR())});var wR=S((yhe,ER)=>{ER.exports=vR;function vR(e,t){if(e&&t)return vR(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(n){r[n]=e[n]}),r;function r(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];var i=e.apply(this,n),o=n[n.length-1];return typeof i=="function"&&i!==o&&Object.keys(o).forEach(function(a){i[a]=o[a]}),i}}});var OR=S((_he,cm)=>{var RR=wR();cm.exports=RR(vu);cm.exports.strict=RR(TR);vu.proto=vu(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return vu(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return TR(this)},configurable:!0})});function vu(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function TR(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}});var AR=S((bhe,IR)=>{var w3=OR(),R3=function(){},T3=function(e){return e.setHeader&&typeof e.abort=="function"},O3=function(e){return e.stdio&&Array.isArray(e.stdio)&&e.stdio.length===3},PR=function(e,t,r){if(typeof t=="function")return PR(e,null,t);t||(t={}),r=w3(r||R3);var n=e._writableState,s=e._readableState,i=t.readable||t.readable!==!1&&e.readable,o=t.writable||t.writable!==!1&&e.writable,a=!1,l=function(){e.writable||c()},c=function(){o=!1,i||r.call(e)},u=function(){i=!1,o||r.call(e)},f=function(y){r.call(e,y?new Error("exited with error code: "+y):null)},p=function(y){r.call(e,y)},d=function(){process.nextTick(h)},h=function(){if(!a){if(i&&!(s&&s.ended&&!s.destroyed))return r.call(e,new Error("premature close"));if(o&&!(n&&n.ended&&!n.destroyed))return r.call(e,new Error("premature close"))}},m=function(){e.req.on("finish",c)};return T3(e)?(e.on("complete",c),e.on("abort",d),e.req?m():e.on("request",m)):o&&!n&&(e.on("end",l),e.on("close",l)),O3(e)&&e.on("exit",f),e.on("end",u),e.on("finish",c),t.error!==!1&&e.on("error",p),e.on("close",d),function(){a=!0,e.removeListener("complete",c),e.removeListener("abort",d),e.removeListener("request",m),e.req&&e.req.removeListener("finish",c),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",c),e.removeListener("exit",f),e.removeListener("end",u),e.removeListener("error",p),e.removeListener("close",d)}};IR.exports=PR});var NR=S((She,CR)=>{CR.exports=P3;function P3(e){var t=e._readableState;return t?t.objectMode||typeof e._duplexState=="number"?e.read():e.read(I3(t)):null}function I3(e){if(e.buffer.length){var t=e.bufferIndex||0;if(e.buffer.head)return e.buffer.head.data.length;if(e.buffer.length-t>0&&e.buffer[t])return e.buffer[t].length}return e.length}});var DR=S((vhe,LR)=>{var Eu=SR(),$R=AR(),A3=xs(),C3=NR(),xR=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from([0]):new Buffer([0]),um=function(e,t){e._corked?e.once("uncork",t):t()},N3=function(e,t){e._autoDestroy&&e.destroy(t)},kR=function(e,t){return function(r){r?N3(e,r.message==="premature close"?null:r):t&&!e._ended&&e.end()}},$3=function(e,t){if(!e||e._writableState&&e._writableState.finished)return t();if(e._writableState)return e.end(t);e.end(),t()},x3=function(){},k3=function(e){return new Eu.Readable({objectMode:!0,highWaterMark:16}).wrap(e)},dt=function(e,t,r){if(!(this instanceof dt))return new dt(e,t,r);Eu.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||r.autoDestroy!==!1,this._forwardDestroy=!r||r.destroy!==!1,this._forwardEnd=!r||r.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};A3(dt,Eu.Duplex);dt.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new dt(e,t,r)};dt.prototype.cork=function(){++this._corked===1&&this.emit("cork")};dt.prototype.uncork=function(){this._corked&&--this._corked===0&&this.emit("uncork")};dt.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed){e&&e.destroy&&e.destroy();return}if(e===null||e===!1){this.end();return}var t=this,r=$R(e,{writable:!0,readable:!1},kR(this,this._forwardEnd)),n=function(){var i=t._ondrain;t._ondrain=null,i&&i()},s=function(){t._writable.removeListener("drain",n),r()};this._unwrite&&process.nextTick(n),this._writable=e,this._writable.on("drain",n),this._unwrite=s,this.uncork()};dt.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed){e&&e.destroy&&e.destroy();return}if(e===null||e===!1){this.push(null),this.resume();return}var t=this,r=$R(e,{writable:!1,readable:!0},kR(this)),n=function(){t._forward()},s=function(){t.push(null)},i=function(){t._readable2.removeListener("readable",n),t._readable2.removeListener("end",s),r()};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:k3(e),this._readable2.on("readable",n),this._readable2.on("end",s),this._unread=i,this._forward()};dt.prototype._read=function(){this._drained=!0,this._forward()};dt.prototype._forward=function(){if(!(this._forwarding||!this._readable2||!this._drained)){this._forwarding=!0;for(var e;this._drained&&(e=C3(this._readable2))!==null;)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}};dt.prototype.destroy=function(e,t){if(t||(t=x3),this.destroyed)return t(null);this.destroyed=!0;var r=this;process.nextTick(function(){r._destroy(e),t(null)})};dt.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")};dt.prototype._write=function(e,t,r){if(!this.destroyed){if(this._corked)return um(this,this._write.bind(this,e,t,r));if(e===xR)return this._finish(r);if(!this._writable)return r();this._writable.write(e)===!1?this._ondrain=r:this.destroyed||r()}};dt.prototype._finish=function(e){var t=this;this.emit("preend"),um(this,function(){$3(t._forwardEnd&&t._writable,function(){t._writableState.prefinished===!1&&(t._writableState.prefinished=!0),t.emit("prefinish"),um(t,e)})})};dt.prototype.end=function(e,t,r){return typeof e=="function"?this.end(null,null,e):typeof t=="function"?this.end(e,null,t):(this._ended=!0,e&&this.write(e),!this._writableState.ending&&!this._writableState.destroyed&&this.write(xR),Eu.Writable.prototype.end.call(this,r))};LR.exports=dt});var FR=S((Ehe,Ru)=>{"use strict";var{ServerResponse:L3}=require("node:http"),{PassThrough:qR}=require("node:stream"),{randomBytes:D3}=require("node:crypto"),q3=np(),MR=mw(),jR=DR(),js=Symbol("ws-socket"),wu=Symbol("ws-head"),M3=/HTTP\/1.1 (\d+)/u;function fm(e,t,r){e.decorateRequest("ws",null);let n=d;if(t.errorHandler){if(typeof t.errorHandler!="function")return r(new Error("invalid errorHandler function"));n=t.errorHandler}let s=f;if(t?.preClose){if(typeof t.preClose!="function")return r(new Error("invalid preClose function"));s=t.preClose}if(t.options?.noServer)return r(new Error("fastify-websocket doesn't support the ws noServer option. If you want to create a websocket server detatched from fastify, use the ws library directly."));let i=Object.assign({noServer:!0},t.options);i.path&&e.log.warn("ws server path option shouldn't be provided, use a route instead");let o=i.server||e.server;delete i.server;let a=new MR.Server(i);e.decorate("websocketServer",a);async function l(h="/",m={}){let y=new qR,b=new qR,v=new jR(y,b),_=new jR(b,y),g=new MR(null,void 0,{isServer:!1}),T=Buffer.from([]),R,w,P=new Promise((q,C)=>{R=q,w=C});g.on("open",()=>{_.removeListener("data",O),R(g)});let O=q=>{if(q.toString().includes("HTTP/1.1 101 Switching Protocols"))g._isServer=!1,g.setSocket(_,T,{maxPayload:0});else{_.removeListener("data",O);let C=Number(M3.exec(q.toString())[1]);w(new Error("Unexpected server response: "+C))}};_.on("data",O);let A={...m,method:"GET",headers:{...m.headers,connection:"upgrade",upgrade:"websocket","sec-websocket-version":13,"sec-websocket-key":D3(16).toString("base64")},httpVersion:"1.1",url:h,[js]:v,[wu]:T};return o.emit("upgrade",A,A[js],A[wu]),P}e.decorate("injectWS",l);function c(h,m,y){h[js]=m,h[wu]=y;let b=new L3(h);try{b.assignSocket(m),e.routing(h,b)}catch(v){e.log.warn({err:v},"websocket upgrade failed")}}o.on("upgrade",c);let u=(h,m)=>{a.handleUpgrade(h,h[js],h[wu],y=>{a.emit("connection",y,h),y.on("error",b=>{e.log.error(b)}),m(y)})};e.addHook("onRequest",(h,m,y)=>{h.raw[js]?h.ws=!0:h.ws=!1,y()}),e.addHook("onResponse",(h,m,y)=>{h.ws&&h.raw[js].destroy(),y()}),e.addHook("onRoute",h=>{let m=!1,y=h.wsHandler,b=h.handler;if(h.websocket||h.wsHandler){if(h.method==="HEAD")return;if(h.method!=="GET")throw new Error("websocket handler can only be declared in GET method");if(m=!0,h.websocket&&(y=h.handler,b=function(v,_){_.code(404).send()}),typeof y!="function")throw new TypeError("invalid wsHandler function")}h.handler=function(v,_){if(v.raw[js])_.hijack(),u(v.raw,g=>{let T;try{m?T=y.call(this,g,v):T=p.call(this,g,v)}catch(R){return n.call(this,R,g,v,_)}T&&typeof T.catch=="function"&&T.catch(R=>n.call(this,R,g,v,_))});else return b.call(this,v,_)}}),e.addHook("preClose",s);function f(h){let m=this.websocketServer;if(m.clients)for(let y of m.clients)y.close();e.server.removeListener("upgrade",c),m.close(h),h()}function p(h,m){this.log.info({path:m.url},"closed incoming websocket connection for path with no websocket handler"),h.close()}function d(h,m,y){y.log.error(h),m.terminate()}r()}Ru.exports=q3(fm,{fastify:"5.x",name:"@fastify/websocket"});Ru.exports.default=fm;Ru.exports.fastifyWebsocket=fm});var UR=S((whe,VR)=>{"use strict";function j3(e){var t=new e,r=t;function n(){var i=t;return i.next?t=i.next:(t=new e,r=t),i.next=null,i}function s(i){r.next=i,r=i}return{get:n,release:s}}VR.exports=j3});var BR=S((Rhe,dm)=>{"use strict";var F3=UR();function HR(e,t,r){if(typeof e=="function"&&(r=t,t=e,e=null),!(r>=1))throw new Error("fastqueue concurrency must be equal to or greater than 1");var n=F3(V3),s=null,i=null,o=0,a=null,l={push:m,drain:cr,saturated:cr,pause:u,paused:!1,get concurrency(){return r},set concurrency(T){if(!(T>=1))throw new Error("fastqueue concurrency must be equal to or greater than 1");if(r=T,!l.paused)for(;s&&o<r;)o++,b()},running:c,resume:d,idle:h,length:f,getQueue:p,unshift:y,empty:cr,kill:v,killAndDrain:_,error:g};return l;function c(){return o}function u(){l.paused=!0}function f(){for(var T=s,R=0;T;)T=T.next,R++;return R}function p(){for(var T=s,R=[];T;)R.push(T.value),T=T.next;return R}function d(){if(l.paused){if(l.paused=!1,s===null){o++,b();return}for(;s&&o<r;)o++,b()}}function h(){return o===0&&l.length()===0}function m(T,R){var w=n.get();w.context=e,w.release=b,w.value=T,w.callback=R||cr,w.errorHandler=a,o>=r||l.paused?i?(i.next=w,i=w):(s=w,i=w,l.saturated()):(o++,t.call(e,w.value,w.worked))}function y(T,R){var w=n.get();w.context=e,w.release=b,w.value=T,w.callback=R||cr,w.errorHandler=a,o>=r||l.paused?s?(w.next=s,s=w):(s=w,i=w,l.saturated()):(o++,t.call(e,w.value,w.worked))}function b(T){T&&n.release(T);var R=s;R&&o<=r?l.paused?o--:(i===s&&(i=null),s=R.next,R.next=null,t.call(e,R.value,R.worked),i===null&&l.empty()):--o===0&&l.drain()}function v(){s=null,i=null,l.drain=cr}function _(){s=null,i=null,l.drain(),l.drain=cr}function g(T){a=T}}function cr(){}function V3(){this.value=null,this.callback=cr,this.next=null,this.release=cr,this.context=null,this.errorHandler=null;var e=this;this.worked=function(r,n){var s=e.callback,i=e.errorHandler,o=e.value;e.value=null,e.callback=cr,e.errorHandler&&i(r,o),s.call(e.context,r,n),e.release(e)}}function U3(e,t,r){typeof e=="function"&&(r=t,t=e,e=null);function n(u,f){t.call(this,u).then(function(p){f(null,p)},f)}var s=HR(e,n,r),i=s.push,o=s.unshift;return s.push=a,s.unshift=l,s.drained=c,s;function a(u){var f=new Promise(function(p,d){i(u,function(h,m){if(h){d(h);return}p(m)})});return f.catch(cr),f}function l(u){var f=new Promise(function(p,d){o(u,function(h,m){if(h){d(h);return}p(m)})});return f.catch(cr),f}function c(){var u=new Promise(function(f){process.nextTick(function(){if(s.idle())f();else{var p=s.drain;s.drain=function(){typeof p=="function"&&p(),f(),s.drain=p}}})});return u}}dm.exports=HR;dm.exports.promise=U3});var hm=S((The,Tu)=>{"use strict";var{format:H3}=require("node:util");function B3(){return`${this.name} [${this.code}]: ${this.message}`}function qa(e,t,r=500,n=Error,s=qa.captureStackTrace){if(!e)throw new Error("Fastify error code must not be empty");if(!t)throw new Error("Fastify error message must not be empty");e=e.toUpperCase(),!r&&(r=void 0);function i(...o){if(!new.target)return new i(...o);this.code=e,this.name="FastifyError",this.statusCode=r;let a=o.length-1;a!==-1&&o[a]&&typeof o[a]=="object"&&"cause"in o[a]&&(this.cause=o.pop().cause),this.message=H3(t,...o),Error.stackTraceLimit&&s&&Error.captureStackTrace(this,i)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),i.prototype[Symbol.toStringTag]="Error",i.prototype.toString=B3,i}qa.captureStackTrace=!0;Tu.exports=qa;Tu.exports.default=qa;Tu.exports.createError=qa});var Ou=S((Ohe,zR)=>{"use strict";var{createError:Jn}=hm();zR.exports={AVV_ERR_EXPOSE_ALREADY_DEFINED:Jn("AVV_ERR_EXPOSE_ALREADY_DEFINED","'%s' is already defined, specify an expose option for '%s'"),AVV_ERR_ATTRIBUTE_ALREADY_DEFINED:Jn("AVV_ERR_ATTRIBUTE_ALREADY_DEFINED","'%s' is already defined"),AVV_ERR_CALLBACK_NOT_FN:Jn("AVV_ERR_CALLBACK_NOT_FN","Callback for '%s' hook is not a function. Received: '%s'"),AVV_ERR_PLUGIN_NOT_VALID:Jn("AVV_ERR_PLUGIN_NOT_VALID","Plugin must be a function or a promise. Received: '%s'"),AVV_ERR_ROOT_PLG_BOOTED:Jn("AVV_ERR_ROOT_PLG_BOOTED","Root plugin has already booted"),AVV_ERR_PARENT_PLG_LOADED:Jn("AVV_ERR_PARENT_PLG_LOADED","Impossible to load '%s' plugin because the parent '%s' was already loaded"),AVV_ERR_READY_TIMEOUT:Jn("AVV_ERR_READY_TIMEOUT","Plugin did not start in time: '%s'. You may have forgotten to call 'done' function or to resolve a Promise"),AVV_ERR_PLUGIN_EXEC_TIMEOUT:Jn("AVV_ERR_PLUGIN_EXEC_TIMEOUT","Plugin did not start in time: '%s'. You may have forgotten to call 'done' function or to resolve a Promise")}});var Bi=S((Phe,GR)=>{"use strict";var z3=Symbol("avvio.Boot"),G3=Symbol("isOnCloseHandler"),W3=Symbol("avvio.ThenifyDoNotWrap"),K3=Symbol("avvio.TimeTree.untrackNode"),J3=Symbol("avvio.TimeTree.trackNode"),Y3=Symbol("avvio.TimeTree.getParent"),X3=Symbol("avvio.TimeTree.getNode"),Z3=Symbol("avvio.TimeTree.addNode"),Q3=Symbol.for("plugin-meta");GR.exports={kAvvio:z3,kIsOnCloseHandler:G3,kThenifyDoNotWrap:W3,kUntrackNode:K3,kTrackNode:J3,kGetParent:Y3,kGetNode:X3,kAddNode:Z3,kPluginMeta:Q3}});var QR=S((Ihe,ZR)=>{"use strict";var{kUntrackNode:WR,kTrackNode:pm,kGetParent:KR,kGetNode:JR,kAddNode:YR}=Bi(),mm=class{constructor(){this.root=null,this.tableId=new Map,this.tableLabel=new Map}[pm](t){this.tableId.set(t.id,t),this.tableLabel.has(t.label)?this.tableLabel.get(t.label).push(t):this.tableLabel.set(t.label,[t])}[WR](t){this.tableId.delete(t.id);let r=this.tableLabel.get(t.label);r.pop(),r.length===0&&this.tableLabel.delete(t.label)}[KR](t){if(t===null)return null;if(this.tableLabel.has(t)){let r=this.tableLabel.get(t);return r[r.length-1]}else return null}[JR](t){return this.tableId.get(t)}[YR](t,r,n){let s=this[KR](t);if(s===null)return this.root={parent:null,id:"root",label:r,nodes:[],start:n,stop:null,diff:-1},this[pm](this.root),this.root.id;let o=`${r}-${Math.random()}`,a={parent:t,id:o,label:r,nodes:[],start:n,stop:null,diff:-1};return s.nodes.push(a),this[pm](a),o}start(t,r,n=Date.now()){return this[YR](t,r,n)}stop(t,r=Date.now()){let n=this[JR](t);n&&(n.stop=r,n.diff=n.stop-n.start||0,this[WR](n))}toJSON(){return Object.assign({},this.root)}prettyPrint(){return XR(this.toJSON())}};function XR(e,t=""){let r=t,n=e.nodes.length,s=n-1;r+=`${e.label} ${e.diff} ms
`;for(let i=0;i<n;++i){let o=e.nodes[i],a=t+(i===s?"  ":"\u2502 ");r+=t,r+=i===s?"\u2514\u2500":"\u251C\u2500",r+=o.nodes.length===0?"\u2500 ":"\u252C ",r+=XR(o,a).slice(t.length+2)}return r}ZR.exports={TimeTree:mm}});var Pu=S((Ahe,eT)=>{"use strict";var{debuglog:eU}=require("node:util"),tU=eU("avvio");eT.exports={debug:tU}});var rT=S((Che,tT)=>{"use strict";function rU(){let e={resolve:null,reject:null,promise:null};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}tT.exports={createPromise:rU}});var sT=S((Nhe,nT)=>{"use strict";var{kPluginMeta:gm}=Bi();function nU(e,t){return e[gm]&&e[gm].name?e[gm].name:t&&t.name?t.name:e.name?e.name:e.toString().split(`
`).slice(0,2).map(r=>r.trim()).join(" -- ")}nT.exports={getPluginName:nU}});var Iu=S(($he,iT)=>{"use strict";function sU(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}iT.exports={isPromiseLike:sU}});var aT=S((xhe,oT)=>{"use strict";var{EventEmitter:iU}=require("node:events"),{inherits:oU}=require("node:util"),{debug:ht}=Pu(),{createPromise:aU}=rT(),{AVV_ERR_PLUGIN_EXEC_TIMEOUT:lU}=Ou(),{getPluginName:cU}=sT(),{isPromiseLike:uU}=Iu();function zi(e,t,r,n,s){this.queue=e,this.func=t,this.options=r,this.isAfter=n,this.timeout=s,this.started=!1,this.name=cU(t,r),this.queue.pause(),this._error=null,this.loaded=!1,this._promise=null,this.startTime=null}oU(zi,iU);zi.prototype.exec=function(e,t){ht("exec",this.name),this.server=e;let r=this.func,n=this.name,s=!1;this.options=typeof this.options=="function"?this.options(this.server):this.options;let i=null,o=l=>{if(s){ht("loading complete",n);return}this._error=l,ht(l?"exec errored":"exec completed",n),s=!0,i&&clearTimeout(i),t(l)};this.timeout>0&&(ht("setting up timeout",n,this.timeout),i=setTimeout(function(){ht("timed out",n),i=null;let l=new lU(n);l.fn=r,o(l)},this.timeout)),this.started=!0,this.startTime=Date.now(),this.emit("start",this.server?this.server.name:null,this.name,Date.now());let a=r(this.server,this.options,o);uU(a)?(ht("exec: resolving promise",n),a.then(()=>process.nextTick(o),l=>process.nextTick(o,l))):r.length<3&&o()};zi.prototype.loadedSoFar=function(){if(ht("loadedSoFar",this.name),this.loaded)return Promise.resolve();let e=()=>{this.server.after((r,n)=>{this._error=r,this.queue.pause(),this._promise&&(r?(ht("rejecting promise",this.name,r),this._promise.reject(r)):(ht("resolving promise",this.name),this._promise.resolve()),this._promise=null),process.nextTick(n,r)}),this.queue.resume()},t;return this._promise?t=Promise.resolve():(this._promise=aU(),t=this._promise.promise,this.server?e():this.on("start",e)),t};zi.prototype.enqueue=function(e,t){ht("enqueue",this.name,e.name),this.emit("enqueue",this.server?this.server.name:null,this.name,Date.now()),this.queue.push(e,t)};zi.prototype.finish=function(e,t){ht("finish",this.name,e);let r=()=>{this.loaded||(ht("loaded",this.name),this.emit("loaded",this.server?this.server.name:null,this.name,Date.now()),this.loaded=!0,t(e))};if(e){this._promise&&(this._promise.reject(e),this._promise=null),r();return}let n=()=>{if(ht("check",this.name,this.queue.length(),this.queue.running(),this._promise),this.queue.length()===0&&this.queue.running()===0)if(this._promise){let s=()=>{ht("wrap"),queueMicrotask(n)};this._promise.resolve(),this._promise.promise.then(s,s),this._promise=null}else r();else ht("delayed",this.name),this.queue.drain=()=>{ht("drain",this.name),this.queue.drain=fU,queueMicrotask(n)}};queueMicrotask(n),this.queue.resume()};function fU(){}oT.exports={Plugin:zi}});var cT=S((khe,lT)=>{"use strict";var{AVV_ERR_PLUGIN_NOT_VALID:ym}=Ou();function dU(e){if(!(e&&(typeof e=="function"||typeof e.then=="function")))throw Array.isArray(e)?new ym("array"):e===null?new ym("null"):new ym(typeof e)}lT.exports={validatePlugin:dU}});var fT=S((Lhe,uT)=>{"use strict";function hU(e){return e!==null&&typeof e=="object"&&typeof e.default=="function"}uT.exports={isBundledOrTypescriptPlugin:hU}});var pT=S((Dhe,hT)=>{"use strict";var{debug:dT}=Pu(),{kThenifyDoNotWrap:_m}=Bi();function pU(){if(this.booted){dT("thenify returning undefined because we are already booted");return}if(this[_m]){this[_m]=!1;return}return dT("thenify"),(e,t)=>this._loadRegistered().then(()=>(this[_m]=!0,e(this._server)),t)}hT.exports={thenify:pU}});var gT=S((qhe,mT)=>{"use strict";var{isPromiseLike:mU}=Iu(),{kAvvio:gU}=Bi();function yU(e,t,r){let n=e.apply(e,t);mU(n)&&!n[gU]?n.then(()=>process.nextTick(r),s=>process.nextTick(r,s)):r&&process.nextTick(r)}mT.exports={executeWithThenable:yU}});var TT=S((Mhe,RT)=>{"use strict";var Au=BR(),_U=require("node:events").EventEmitter,bU=require("node:util").inherits,{AVV_ERR_EXPOSE_ALREADY_DEFINED:Ma,AVV_ERR_CALLBACK_NOT_FN:Gi,AVV_ERR_ROOT_PLG_BOOTED:SU,AVV_ERR_READY_TIMEOUT:vU,AVV_ERR_ATTRIBUTE_ALREADY_DEFINED:EU}=Ou(),{kAvvio:bT,kIsOnCloseHandler:ST}=Bi(),{TimeTree:wU}=QR(),{Plugin:vT}=aT(),{debug:Wi}=Pu(),{validatePlugin:RU}=cT(),{isBundledOrTypescriptPlugin:TU}=fT(),{isPromiseLike:OU}=Iu(),{thenify:ET}=pT(),{executeWithThenable:yT}=gT();function et(e,t,r){if(typeof e=="function"&&arguments.length===1&&(r=e,t={},e=null),typeof t=="function"&&(r=t,t={}),t=t||{},t.autostart=t.autostart!==!1,t.timeout=Number(t.timeout)||0,t.expose=t.expose||{},!new.target)return new et(e,t,r);this._server=e||this,this._opts=t,e&&this._expose(),this._current=[],this._error=null,this._lastUsed=null,this.setMaxListeners(0),r&&this.once("start",r),this.started=!1,this.booted=!1,this.pluginTree=new wU,this._readyQ=Au(this,wT,1),this._readyQ.pause(),this._readyQ.drain=()=>{this.emit("start"),this._readyQ.drain=_T},this._closeQ=Au(this,IU,1),this._closeQ.pause(),this._closeQ.drain=()=>{this.emit("close"),this._closeQ.drain=_T},this._doStart=null;let n=this;this._root=new vT(Au(this,this._loadPluginNextTick,1),function(i,o,a){n._doStart=a,o.autostart&&n.start()},t,!1,0),this._trackPluginLoading(this._root),this._loadPlugin(this._root,s=>{Wi("root plugin ready");try{this.emit("preReady"),this._root=null}catch(i){s=s||this._error||i}if(s){if(this._error=s,this._readyQ.length()===0)throw s}else this.booted=!0;this._readyQ.resume()})}bU(et,_U);et.prototype.start=function(){return this.started=!0,process.nextTick(this._doStart),this};et.prototype.override=function(e,t,r){return e};et.prototype[bT]=!0;et.prototype.use=function(e,t){return this._lastUsed=this._addPlugin(e,t,!1),this};et.prototype._loadRegistered=function(){let e=this._current[0];return!this.started&&!this.booted&&process.nextTick(()=>this._root.queue.resume()),e?e.loadedSoFar():Promise.resolve()};Object.defineProperty(et.prototype,"then",{get:ET});et.prototype._addPlugin=function(e,t,r){if(TU(e)&&(e=e.default),RU(e),t=t||{},this.booted)throw new SU;let n=this._current[0],s=this._opts.timeout;if(!n.loaded&&n.timeout>0){let o=Date.now()-n.startTime;s=n.timeout-(o+3)}let i=new vT(Au(this,this._loadPluginNextTick,1),e,t,r,s);if(this._trackPluginLoading(i),n.loaded)throw new Error(i.name,n.name);return n.enqueue(i,o=>{o&&(this._error=o)}),i};et.prototype._expose=function(){let t=this,r=t._server,{use:n="use",after:s="after",ready:i="ready",onClose:o="onClose",close:a="close"}=this._opts.expose;if(r[n])throw new Ma(n,"use");if(r[n]=function(l,c){return t.use(l,c),this},r[s])throw new Ma(s,"after");if(r[s]=function(l){return typeof l!="function"?t._loadRegistered():(t.after(bm(l,this)),this)},r[i])throw new Ma(i,"ready");if(r[i]=function(l){if(l&&typeof l!="function")throw new Gi(i,typeof l);return t.ready(l?bm(l,this):void 0)},r[o])throw new Ma(o,"onClose");if(r[o]=function(l){if(typeof l!="function")throw new Gi(o,typeof l);return t.onClose(AU(l,this)),this},r[a])throw new Ma(a,"close");if(r[a]=function(l){if(l&&typeof l!="function")throw new Gi(a,typeof l);return l?(t.close(bm(l,this)),this):t.close()},r.then)throw new EU("then");Object.defineProperty(r,"then",{get:ET.bind(t)}),r[bT]=!0};et.prototype.after=function(e){if(!e)return this._loadRegistered();this._addPlugin(t.bind(this),{},!0);function t(r,n,s){wT.call(this,e,s)}return this};et.prototype.onClose=function(e){if(typeof e!="function")throw new Gi("onClose",typeof e);return e[ST]=!0,this._closeQ.unshift(e,t=>{t&&(this._error=t)}),this};et.prototype.close=function(e){let t;if(e){if(typeof e!="function")throw new Gi("close",typeof e)}else t=new Promise(function(r,n){e=function(s){if(s)return n(s);r()}});return this.ready(()=>{this._error=null,this._closeQ.push(e),process.nextTick(this._closeQ.resume.bind(this._closeQ))}),t};et.prototype.ready=function(e){if(e){if(typeof e!="function")throw new Gi("ready",typeof e);this._readyQ.push(e),queueMicrotask(this.start.bind(this));return}return new Promise((t,r)=>{this._readyQ.push(s),this.start();let n=this._current[0].server;function s(i,o,a){i?r(i):t(n),process.nextTick(a)}})};et.prototype._trackPluginLoading=function(e){let t=this._current[0]?.name||null;e.once("start",(r,n,s)=>{let i=this.pluginTree.start(t||null,n,s);e.once("loaded",(o,a,l)=>{this.pluginTree.stop(i,l)})})};et.prototype.prettyPrint=function(){return this.pluginTree.prettyPrint()};et.prototype.toJSON=function(){return this.pluginTree.toJSON()};et.prototype._loadPlugin=function(e,t){let r=this;if(OU(e.func)){e.func.then(o=>{typeof o.default=="function"&&(o=o.default),e.func=o,this._loadPlugin(e,t)},t);return}let n=r._current[0];if(r._current.unshift(e),r._error&&!e.isAfter){Wi("skipping loading of plugin as instance errored and it is not an after",e.name),process.nextTick(i);return}let s=n&&n.server||r._server;if(!e.isAfter)try{s=r.override(s,e.func,e.options)}catch(o){return Wi("override errored",e.name),i(o)}e.exec(s,i);function i(o){e.finish(o,a=>{r._current.shift(),t(a)})}};et.prototype._loadPluginNextTick=function(e,t){process.nextTick(this._loadPlugin.bind(this),e,t)};function _T(){}function wT(e,t){let r=this._server,n=this._error;if(this._error=null,e.length===0)this._error=n,yT(e,[],t);else if(e.length===1)yT(e,[n],t);else if(this._opts.timeout===0){let s=i=>{this._error=i,t(this._error)};e.length===2?e(n,s):e(n,r,s)}else PU.call(this,e,n,r,t)}function PU(e,t,r,n){let s=e.unwrappedName??e.name;Wi("setting up ready timeout",s,this._opts.timeout);let i=setTimeout(()=>{Wi("timed out",s),i=null;let a=new vU(s);a.fn=e,this._error=a,n(a)},this._opts.timeout);e.length===2?e(t,o.bind(this)):e(t,r,o.bind(this));function o(a){i&&(clearTimeout(i),this._error=a,n(this._error))}}function IU(e,t){let r=this._server,n=e[ST];if(e.length===0||e.length===1){let s;n?s=e(r):s=e(this._error),s&&typeof s.then=="function"?(Wi("resolving close/onClose promise"),s.then(()=>process.nextTick(t),i=>process.nextTick(t,i))):process.nextTick(t)}else e.length===2?e(n?r:this._error,t):n?e(r,t):e(this._error,r,t)}function AU(e,t){return r.bind(t);function r(n,s){let i;e.length===0?(i=e(),i&&i.then?i.then(function(){process.nextTick(s)},s):process.nextTick(s)):e.length===1?(i=e(this),i&&i.then?i.then(function(){process.nextTick(s)},s):process.nextTick(s)):e(this,s)}}function bm(e,t){let r=n.bind(t);return r.unwrappedName=e.name,r;function n(s,i){let o;e?e.length===0?(o=e(),o&&o.then?o.then(function(){process.nextTick(i,s)},i):process.nextTick(i,s)):e.length===1?(o=e(s),o&&o.then?o.then(function(){process.nextTick(i)},i):process.nextTick(i)):e.length===2?e(s,i):e(s,this,i):process.nextTick(i)}}RT.exports=et});var at=S((jhe,OT)=>{"use strict";var CU={kAvvioBoot:Symbol("fastify.avvioBoot"),kChildren:Symbol("fastify.children"),kServerBindings:Symbol("fastify.serverBindings"),kBodyLimit:Symbol("fastify.bodyLimit"),kSupportedHTTPMethods:Symbol("fastify.acceptedHTTPMethods"),kRoutePrefix:Symbol("fastify.routePrefix"),kLogLevel:Symbol("fastify.logLevel"),kLogSerializers:Symbol("fastify.logSerializers"),kHooks:Symbol("fastify.hooks"),kContentTypeParser:Symbol("fastify.contentTypeParser"),kState:Symbol("fastify.state"),kOptions:Symbol("fastify.options"),kDisableRequestLogging:Symbol("fastify.disableRequestLogging"),kPluginNameChain:Symbol("fastify.pluginNameChain"),kRouteContext:Symbol("fastify.context"),kGenReqId:Symbol("fastify.genReqId"),kSchemaController:Symbol("fastify.schemaController"),kSchemaHeaders:Symbol("headers-schema"),kSchemaParams:Symbol("params-schema"),kSchemaQuerystring:Symbol("querystring-schema"),kSchemaBody:Symbol("body-schema"),kSchemaResponse:Symbol("response-schema"),kSchemaErrorFormatter:Symbol("fastify.schemaErrorFormatter"),kSchemaVisited:Symbol("fastify.schemas.visited"),kRequest:Symbol("fastify.Request"),kRequestPayloadStream:Symbol("fastify.RequestPayloadStream"),kRequestAcceptVersion:Symbol("fastify.RequestAcceptVersion"),kRequestCacheValidateFns:Symbol("fastify.request.cache.validateFns"),kRequestOriginalUrl:Symbol("fastify.request.originalUrl"),kFourOhFour:Symbol("fastify.404"),kCanSetNotFoundHandler:Symbol("fastify.canSetNotFoundHandler"),kFourOhFourLevelInstance:Symbol("fastify.404LogLevelInstance"),kFourOhFourContext:Symbol("fastify.404ContextKey"),kDefaultJsonParse:Symbol("fastify.defaultJSONParse"),kReply:Symbol("fastify.Reply"),kReplySerializer:Symbol("fastify.reply.serializer"),kReplyIsError:Symbol("fastify.reply.isError"),kReplyHeaders:Symbol("fastify.reply.headers"),kReplyTrailers:Symbol("fastify.reply.trailers"),kReplyHasStatusCode:Symbol("fastify.reply.hasStatusCode"),kReplyHijacked:Symbol("fastify.reply.hijacked"),kReplyStartTime:Symbol("fastify.reply.startTime"),kReplyNextErrorHandler:Symbol("fastify.reply.nextErrorHandler"),kReplyEndTime:Symbol("fastify.reply.endTime"),kReplyErrorHandlerCalled:Symbol("fastify.reply.errorHandlerCalled"),kReplyIsRunningOnErrorHook:Symbol("fastify.reply.isRunningOnErrorHook"),kReplySerializerDefault:Symbol("fastify.replySerializerDefault"),kReplyCacheSerializeFns:Symbol("fastify.reply.cache.serializeFns"),kTestInternals:Symbol("fastify.testInternals"),kErrorHandler:Symbol("fastify.errorHandler"),kChildLoggerFactory:Symbol("fastify.childLoggerFactory"),kHasBeenDecorated:Symbol("fastify.hasBeenDecorated"),kKeepAliveConnections:Symbol("fastify.keepAliveConnections"),kRouteByFastify:Symbol("fastify.routeByFastify")};OT.exports=CU});var Em=S((Fhe,Cu)=>{"use strict";var{format:Sm}=require("node:util");function NU(e){return PT({...e,name:"DeprecationWarning"})}function PT({name:e,code:t,message:r,unlimited:n=!1}={}){if(!e)throw new Error("Warning name must not be empty");if(!t)throw new Error("Warning code must not be empty");if(!r)throw new Error("Warning message must not be empty");if(typeof n!="boolean")throw new Error("Warning opts.unlimited must be a boolean");t=t.toUpperCase();let s={[e]:function(o,a,l){i.emitted===!0&&i.unlimited!==!0||(i.emitted=!0,process.emitWarning(i.format(o,a,l),i.name,i.code))}};n&&(s={[e]:function(o,a,l){i.emitted=!0,process.emitWarning(i.format(o,a,l),i.name,i.code)}});let i=s[e];return i.emitted=!1,i.message=r,i.unlimited=n,i.code=t,i.format=function(o,a,l){let c;return o&&a&&l?c=Sm(r,o,a,l):o&&a?c=Sm(r,o,a):o?c=Sm(r,o):c=r,c},i}var vm={createWarning:PT,createDeprecation:NU};Cu.exports=vm;Cu.exports.default=vm;Cu.exports.processWarning=vm});var Nu=S((Vhe,IT)=>{"use strict";var{createWarning:wm}=Em(),$U=wm({name:"FastifyWarning",code:"FSTWRN001",message:"The %s schema for %s: %s is missing. This may indicate the schema is not well specified.",unlimited:!0}),xU=wm({name:"FastifyWarning",code:"FSTWRN003",message:"The %s mixes async and callback styles that may lead to unhandled rejections. Please use only one of them.",unlimited:!0}),kU=wm({name:"FastifySecurity",code:"FSTSEC001",message:'You are using /%s/ Content-Type which may be vulnerable to CORS attack. Please make sure your RegExp start with "^" or include ";?" to proper detection of the essence MIME type.',unlimited:!0});IT.exports={FSTWRN001:$U,FSTWRN003:xU,FSTSEC001:kU}});var pt=S((Uhe,$u)=>{"use strict";var L=hm(),Fs={FST_ERR_NOT_FOUND:L("FST_ERR_NOT_FOUND","Not Found",404),FST_ERR_OPTIONS_NOT_OBJ:L("FST_ERR_OPTIONS_NOT_OBJ","Options must be an object",500,TypeError),FST_ERR_QSP_NOT_FN:L("FST_ERR_QSP_NOT_FN","querystringParser option should be a function, instead got '%s'",500,TypeError),FST_ERR_SCHEMA_CONTROLLER_BUCKET_OPT_NOT_FN:L("FST_ERR_SCHEMA_CONTROLLER_BUCKET_OPT_NOT_FN","schemaController.bucket option should be a function, instead got '%s'",500,TypeError),FST_ERR_SCHEMA_ERROR_FORMATTER_NOT_FN:L("FST_ERR_SCHEMA_ERROR_FORMATTER_NOT_FN","schemaErrorFormatter option should be a non async function. Instead got '%s'.",500,TypeError),FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_OBJ:L("FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_OBJ","ajv.customOptions option should be an object, instead got '%s'",500,TypeError),FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_ARR:L("FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_ARR","ajv.plugins option should be an array, instead got '%s'",500,TypeError),FST_ERR_VALIDATION:L("FST_ERR_VALIDATION","%s",400),FST_ERR_LISTEN_OPTIONS_INVALID:L("FST_ERR_LISTEN_OPTIONS_INVALID","Invalid listen options: '%s'",500,TypeError),FST_ERR_ERROR_HANDLER_NOT_FN:L("FST_ERR_ERROR_HANDLER_NOT_FN","Error Handler must be a function",500,TypeError),FST_ERR_CTP_ALREADY_PRESENT:L("FST_ERR_CTP_ALREADY_PRESENT","Content type parser '%s' already present."),FST_ERR_CTP_INVALID_TYPE:L("FST_ERR_CTP_INVALID_TYPE","The content type should be a string or a RegExp",500,TypeError),FST_ERR_CTP_EMPTY_TYPE:L("FST_ERR_CTP_EMPTY_TYPE","The content type cannot be an empty string",500,TypeError),FST_ERR_CTP_INVALID_HANDLER:L("FST_ERR_CTP_INVALID_HANDLER","The content type handler should be a function",500,TypeError),FST_ERR_CTP_INVALID_PARSE_TYPE:L("FST_ERR_CTP_INVALID_PARSE_TYPE","The body parser can only parse your data as 'string' or 'buffer', you asked '%s' which is not supported.",500,TypeError),FST_ERR_CTP_BODY_TOO_LARGE:L("FST_ERR_CTP_BODY_TOO_LARGE","Request body is too large",413,RangeError),FST_ERR_CTP_INVALID_MEDIA_TYPE:L("FST_ERR_CTP_INVALID_MEDIA_TYPE","Unsupported Media Type: %s",415),FST_ERR_CTP_INVALID_CONTENT_LENGTH:L("FST_ERR_CTP_INVALID_CONTENT_LENGTH","Request body size did not match Content-Length",400,RangeError),FST_ERR_CTP_EMPTY_JSON_BODY:L("FST_ERR_CTP_EMPTY_JSON_BODY","Body cannot be empty when content-type is set to 'application/json'",400),FST_ERR_CTP_INSTANCE_ALREADY_STARTED:L("FST_ERR_CTP_INSTANCE_ALREADY_STARTED",'Cannot call "%s" when fastify instance is already started!',400),FST_ERR_DEC_ALREADY_PRESENT:L("FST_ERR_DEC_ALREADY_PRESENT","The decorator '%s' has already been added!"),FST_ERR_DEC_DEPENDENCY_INVALID_TYPE:L("FST_ERR_DEC_DEPENDENCY_INVALID_TYPE","The dependencies of decorator '%s' must be of type Array.",500,TypeError),FST_ERR_DEC_MISSING_DEPENDENCY:L("FST_ERR_DEC_MISSING_DEPENDENCY","The decorator is missing dependency '%s'."),FST_ERR_DEC_AFTER_START:L("FST_ERR_DEC_AFTER_START","The decorator '%s' has been added after start!"),FST_ERR_DEC_REFERENCE_TYPE:L("FST_ERR_DEC_REFERENCE_TYPE","The decorator '%s' of type '%s' is a reference type. Use the { getter, setter } interface instead."),FST_ERR_HOOK_INVALID_TYPE:L("FST_ERR_HOOK_INVALID_TYPE","The hook name must be a string",500,TypeError),FST_ERR_HOOK_INVALID_HANDLER:L("FST_ERR_HOOK_INVALID_HANDLER","%s hook should be a function, instead got %s",500,TypeError),FST_ERR_HOOK_INVALID_ASYNC_HANDLER:L("FST_ERR_HOOK_INVALID_ASYNC_HANDLER","Async function has too many arguments. Async hooks should not use the 'done' argument.",500,TypeError),FST_ERR_HOOK_NOT_SUPPORTED:L("FST_ERR_HOOK_NOT_SUPPORTED","%s hook not supported!",500,TypeError),FST_ERR_MISSING_MIDDLEWARE:L("FST_ERR_MISSING_MIDDLEWARE","You must register a plugin for handling middlewares, visit fastify.dev/docs/latest/Reference/Middleware/ for more info.",500),FST_ERR_HOOK_TIMEOUT:L("FST_ERR_HOOK_TIMEOUT","A callback for '%s' hook%s timed out. You may have forgotten to call 'done' function or to resolve a Promise"),FST_ERR_LOG_INVALID_DESTINATION:L("FST_ERR_LOG_INVALID_DESTINATION","Cannot specify both logger.stream and logger.file options"),FST_ERR_LOG_INVALID_LOGGER:L("FST_ERR_LOG_INVALID_LOGGER","Invalid logger object provided. The logger instance should have these functions(s): '%s'.",500,TypeError),FST_ERR_LOG_INVALID_LOGGER_INSTANCE:L("FST_ERR_LOG_INVALID_LOGGER_INSTANCE","loggerInstance only accepts a logger instance.",500,TypeError),FST_ERR_LOG_INVALID_LOGGER_CONFIG:L("FST_ERR_LOG_INVALID_LOGGER_CONFIG","logger options only accepts a configuration object.",500,TypeError),FST_ERR_LOG_LOGGER_AND_LOGGER_INSTANCE_PROVIDED:L("FST_ERR_LOG_LOGGER_AND_LOGGER_INSTANCE_PROVIDED","You cannot provide both logger and loggerInstance. Please provide only one.",500,TypeError),FST_ERR_REP_INVALID_PAYLOAD_TYPE:L("FST_ERR_REP_INVALID_PAYLOAD_TYPE","Attempted to send payload of invalid type '%s'. Expected a string or Buffer.",500,TypeError),FST_ERR_REP_RESPONSE_BODY_CONSUMED:L("FST_ERR_REP_RESPONSE_BODY_CONSUMED","Response.body is already consumed."),FST_ERR_REP_READABLE_STREAM_LOCKED:L("FST_ERR_REP_READABLE_STREAM_LOCKED","ReadableStream was locked. You should call releaseLock() method on reader before sending."),FST_ERR_REP_ALREADY_SENT:L("FST_ERR_REP_ALREADY_SENT",'Reply was already sent, did you forget to "return reply" in "%s" (%s)?'),FST_ERR_REP_SENT_VALUE:L("FST_ERR_REP_SENT_VALUE","The only possible value for reply.sent is true.",500,TypeError),FST_ERR_SEND_INSIDE_ONERR:L("FST_ERR_SEND_INSIDE_ONERR","You cannot use `send` inside the `onError` hook"),FST_ERR_SEND_UNDEFINED_ERR:L("FST_ERR_SEND_UNDEFINED_ERR","Undefined error has occurred"),FST_ERR_BAD_STATUS_CODE:L("FST_ERR_BAD_STATUS_CODE","Called reply with an invalid status code: %s"),FST_ERR_BAD_TRAILER_NAME:L("FST_ERR_BAD_TRAILER_NAME","Called reply.trailer with an invalid header name: %s"),FST_ERR_BAD_TRAILER_VALUE:L("FST_ERR_BAD_TRAILER_VALUE","Called reply.trailer('%s', fn) with an invalid type: %s. Expected a function."),FST_ERR_FAILED_ERROR_SERIALIZATION:L("FST_ERR_FAILED_ERROR_SERIALIZATION","Failed to serialize an error. Error: %s. Original error: %s"),FST_ERR_MISSING_SERIALIZATION_FN:L("FST_ERR_MISSING_SERIALIZATION_FN",'Missing serialization function. Key "%s"'),FST_ERR_MISSING_CONTENTTYPE_SERIALIZATION_FN:L("FST_ERR_MISSING_CONTENTTYPE_SERIALIZATION_FN",'Missing serialization function. Key "%s:%s"'),FST_ERR_REQ_INVALID_VALIDATION_INVOCATION:L("FST_ERR_REQ_INVALID_VALIDATION_INVOCATION",'Invalid validation invocation. Missing validation function for HTTP part "%s" nor schema provided.'),FST_ERR_SCH_MISSING_ID:L("FST_ERR_SCH_MISSING_ID","Missing schema $id property"),FST_ERR_SCH_ALREADY_PRESENT:L("FST_ERR_SCH_ALREADY_PRESENT","Schema with id '%s' already declared!"),FST_ERR_SCH_CONTENT_MISSING_SCHEMA:L("FST_ERR_SCH_CONTENT_MISSING_SCHEMA","Schema is missing for the content type '%s'"),FST_ERR_SCH_DUPLICATE:L("FST_ERR_SCH_DUPLICATE","Schema with '%s' already present!"),FST_ERR_SCH_VALIDATION_BUILD:L("FST_ERR_SCH_VALIDATION_BUILD","Failed building the validation schema for %s: %s, due to error %s"),FST_ERR_SCH_SERIALIZATION_BUILD:L("FST_ERR_SCH_SERIALIZATION_BUILD","Failed building the serialization schema for %s: %s, due to error %s"),FST_ERR_SCH_RESPONSE_SCHEMA_NOT_NESTED_2XX:L("FST_ERR_SCH_RESPONSE_SCHEMA_NOT_NESTED_2XX",'response schemas should be nested under a valid status code, e.g { 2xx: { type: "object" } }'),FST_ERR_HTTP2_INVALID_VERSION:L("FST_ERR_HTTP2_INVALID_VERSION","HTTP2 is available only from node >= 8.8.1"),FST_ERR_INIT_OPTS_INVALID:L("FST_ERR_INIT_OPTS_INVALID","Invalid initialization options: '%s'"),FST_ERR_FORCE_CLOSE_CONNECTIONS_IDLE_NOT_AVAILABLE:L("FST_ERR_FORCE_CLOSE_CONNECTIONS_IDLE_NOT_AVAILABLE","Cannot set forceCloseConnections to 'idle' as your HTTP server does not support closeIdleConnections method"),FST_ERR_DUPLICATED_ROUTE:L("FST_ERR_DUPLICATED_ROUTE","Method '%s' already declared for route '%s'"),FST_ERR_BAD_URL:L("FST_ERR_BAD_URL","'%s' is not a valid url component",400,URIError),FST_ERR_ASYNC_CONSTRAINT:L("FST_ERR_ASYNC_CONSTRAINT","Unexpected error from async constraint",500),FST_ERR_INVALID_URL:L("FST_ERR_INVALID_URL","URL must be a string. Received '%s'",400,TypeError),FST_ERR_ROUTE_OPTIONS_NOT_OBJ:L("FST_ERR_ROUTE_OPTIONS_NOT_OBJ",'Options for "%s:%s" route must be an object',500,TypeError),FST_ERR_ROUTE_DUPLICATED_HANDLER:L("FST_ERR_ROUTE_DUPLICATED_HANDLER",'Duplicate handler for "%s:%s" route is not allowed!',500),FST_ERR_ROUTE_HANDLER_NOT_FN:L("FST_ERR_ROUTE_HANDLER_NOT_FN","Error Handler for %s:%s route, if defined, must be a function",500,TypeError),FST_ERR_ROUTE_MISSING_HANDLER:L("FST_ERR_ROUTE_MISSING_HANDLER",'Missing handler function for "%s:%s" route.',500),FST_ERR_ROUTE_METHOD_INVALID:L("FST_ERR_ROUTE_METHOD_INVALID","Provided method is invalid!",500,TypeError),FST_ERR_ROUTE_METHOD_NOT_SUPPORTED:L("FST_ERR_ROUTE_METHOD_NOT_SUPPORTED","%s method is not supported.",500),FST_ERR_ROUTE_BODY_VALIDATION_SCHEMA_NOT_SUPPORTED:L("FST_ERR_ROUTE_BODY_VALIDATION_SCHEMA_NOT_SUPPORTED","Body validation schema for %s:%s route is not supported!",500),FST_ERR_ROUTE_BODY_LIMIT_OPTION_NOT_INT:L("FST_ERR_ROUTE_BODY_LIMIT_OPTION_NOT_INT","'bodyLimit' option must be an integer > 0. Got '%s'",500,TypeError),FST_ERR_ROUTE_REWRITE_NOT_STR:L("FST_ERR_ROUTE_REWRITE_NOT_STR",'Rewrite url for "%s" needs to be of type "string" but received "%s"',500,TypeError),FST_ERR_REOPENED_CLOSE_SERVER:L("FST_ERR_REOPENED_CLOSE_SERVER","Fastify has already been closed and cannot be reopened"),FST_ERR_REOPENED_SERVER:L("FST_ERR_REOPENED_SERVER","Fastify is already listening"),FST_ERR_INSTANCE_ALREADY_LISTENING:L("FST_ERR_INSTANCE_ALREADY_LISTENING","Fastify instance is already listening. %s"),FST_ERR_PLUGIN_VERSION_MISMATCH:L("FST_ERR_PLUGIN_VERSION_MISMATCH","fastify-plugin: %s - expected '%s' fastify version, '%s' is installed"),FST_ERR_PLUGIN_NOT_PRESENT_IN_INSTANCE:L("FST_ERR_PLUGIN_NOT_PRESENT_IN_INSTANCE","The decorator '%s'%s is not present in %s"),FST_ERR_PLUGIN_INVALID_ASYNC_HANDLER:L("FST_ERR_PLUGIN_INVALID_ASYNC_HANDLER","The %s plugin being registered mixes async and callback styles. Async plugin should not mix async and callback style.",500,TypeError),FST_ERR_PLUGIN_CALLBACK_NOT_FN:L("FST_ERR_PLUGIN_CALLBACK_NOT_FN","fastify-plugin: %s",500,TypeError),FST_ERR_PLUGIN_NOT_VALID:L("FST_ERR_PLUGIN_NOT_VALID","fastify-plugin: %s"),FST_ERR_ROOT_PLG_BOOTED:L("FST_ERR_ROOT_PLG_BOOTED","fastify-plugin: %s"),FST_ERR_PARENT_PLUGIN_BOOTED:L("FST_ERR_PARENT_PLUGIN_BOOTED","fastify-plugin: %s"),FST_ERR_PLUGIN_TIMEOUT:L("FST_ERR_PLUGIN_TIMEOUT","fastify-plugin: %s")};function LU(e,t){return t.cause=e,t}$u.exports=Fs;$u.exports.appendStackTrace=LU;$u.exports.AVVIO_ERRORS_MAP={AVV_ERR_CALLBACK_NOT_FN:Fs.FST_ERR_PLUGIN_CALLBACK_NOT_FN,AVV_ERR_PLUGIN_NOT_VALID:Fs.FST_ERR_PLUGIN_NOT_VALID,AVV_ERR_ROOT_PLG_BOOTED:Fs.FST_ERR_ROOT_PLG_BOOTED,AVV_ERR_PARENT_PLG_LOADED:Fs.FST_ERR_PARENT_PLUGIN_BOOTED,AVV_ERR_READY_TIMEOUT:Fs.FST_ERR_PLUGIN_TIMEOUT,AVV_ERR_PLUGIN_EXEC_TIMEOUT:Fs.FST_ERR_PLUGIN_TIMEOUT}});var Yn=S((Hhe,qT)=>{"use strict";var DU=["onRoute","onRegister","onReady","onListen","preClose","onClose"],$T=["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError","onRequestAbort"],qU=$T.concat(DU),{FST_ERR_HOOK_INVALID_TYPE:MU,FST_ERR_HOOK_INVALID_HANDLER:jU,FST_ERR_SEND_UNDEFINED_ERR:xu,FST_ERR_HOOK_TIMEOUT:FU,FST_ERR_HOOK_NOT_SUPPORTED:VU,AVVIO_ERRORS_MAP:AT,appendStackTrace:CT}=pt(),{kChildren:ja,kHooks:xT,kRequestPayloadStream:NT}=at();function Fa(){this.onRequest=[],this.preParsing=[],this.preValidation=[],this.preSerialization=[],this.preHandler=[],this.onResponse=[],this.onSend=[],this.onError=[],this.onRoute=[],this.onRegister=[],this.onReady=[],this.onListen=[],this.onTimeout=[],this.onRequestAbort=[],this.preClose=[]}Fa.prototype=Object.create(null);Fa.prototype.validate=function(e,t){if(typeof e!="string")throw new MU;if(Array.isArray(this[e])===!1)throw new VU(e);if(typeof t!="function")throw new jU(e,Object.prototype.toString.call(t))};Fa.prototype.add=function(e,t){this.validate(e,t),this[e].push(t)};function UU(e){let t=new Fa;return t.onRequest=e.onRequest.slice(),t.preParsing=e.preParsing.slice(),t.preValidation=e.preValidation.slice(),t.preSerialization=e.preSerialization.slice(),t.preHandler=e.preHandler.slice(),t.onSend=e.onSend.slice(),t.onResponse=e.onResponse.slice(),t.onError=e.onError.slice(),t.onRoute=e.onRoute.slice(),t.onRegister=e.onRegister.slice(),t.onTimeout=e.onTimeout.slice(),t.onRequestAbort=e.onRequestAbort.slice(),t.onReady=[],t.onListen=[],t.preClose=[],t}function kT(e,t,r,n){let s=r[xT][e],i=0,o=0;l();function a(u){let f=s[i-1]?.name,p=f?` "${f}"`:"";if(u){u.code==="AVV_ERR_READY_TIMEOUT"?u=CT(u,new FU(e,p)):u=AT[u.code]!=null?CT(u,new AT[u.code](u.message)):u,n(u);return}n()}function l(u){if(u){a(u);return}if(i===s.length&&o===r[ja].length){i===0&&o===0?a():t(function(p,d){a(p),d(p)});return}if(i===s.length&&o<r[ja].length){let f=r[ja][o++];kT(e,t,f,l);return}t(c(s[i++],r)),l()}function c(u,f){return function(p,d){if(p){d(p);return}if(u.length===1){try{u.call(f,d)}catch(h){d(h)}return}try{let h=u.call(f);if(h&&typeof h.then=="function"){h.then(d,d);return}}catch(h){p=h}d(p)}}}function LT(e){let t=e[xT].onListen,r=t.length,n=0,s=0;i();function i(a){if(a&&e.log.error(a),n===r){for(;s<e[ja].length;){let l=e[ja][s++];LT(l)}return}o(t[n++],e,i)}async function o(a,l,c){if(a.length===1){try{a.call(l,c)}catch(u){c(u)}return}try{let u=a.call(l);if(u&&typeof u.then=="function"){u.then(c,c);return}c()}catch(u){c(u)}}}function Ki(e){return function(r,n,s,i){let o=0;function a(u){if(u||o===r.length){i(u,n,s);return}let f;try{f=e(r[o++],n,s,a)}catch(p){i(p,n,s);return}f&&typeof f.then=="function"&&f.then(l,c)}function l(){a()}function c(u){u||(u=new xu),i(u,n,s)}a()}}function HU(e,t,r,n){return e(t,r,n)}var BU=Ki(HU),zU=Ki(Va),GU=Ki(Va),WU=Ki(Va),KU=Ki(Va);function DT(e,t,r,n,s){let i=0;function o(c,u){if(c){s(c,t,r,n);return}if(u!==void 0&&(n=u),i===e.length){s(null,t,r,n);return}let f;try{f=e[i++](t,r,n,o)}catch(p){s(p,t,r);return}f&&typeof f.then=="function"&&f.then(a,l)}function a(c){o(null,c)}function l(c){c||(c=new xu),s(c,t,r,n)}o()}var JU=DT;function YU(e,t,r,n){let s=0;function i(l,c){if(r.sent)return;if(c!==void 0&&(t[NT]=c),l||s===e.length){n(l,t,r);return}let u;try{u=e[s++](t,r,t[NT],i)}catch(f){n(f,t,r);return}u&&typeof u.then=="function"&&u.then(o,a)}function o(l){i(null,l)}function a(l){l||(l=new xu),n(l,t,r)}i()}function XU(e,t,r){let n=0;function s(a){if(a||n===e.length){r(a,t);return}let l;try{l=e[n++](t,s)}catch(c){r(c,t);return}l&&typeof l.then=="function"&&l.then(i,o)}function i(){s()}function o(a){a||(a=new xu),r(a,t)}s()}function Va(e,t,r,n){if(r.sent!==!0)return e(t,r,n)}qT.exports={Hooks:Fa,buildHooks:UU,hookRunnerGenerator:Ki,preParsingHookRunner:YU,onResponseHookRunner:BU,onSendHookRunner:DT,preSerializationHookRunner:JU,onRequestAbortHookRunner:XU,hookIterator:Va,hookRunnerApplication:kT,onListenHookRunner:LT,preHandlerHookRunner:GU,preValidationHookRunner:zU,onRequestHookRunner:KU,onTimeoutHookRunner:WU,lifecycleHooks:$T,supportedHooks:qU}});var WT=S((Bhe,GT)=>{"use strict";var ZU=require("node:http"),QU=require("node:https"),eH=require("node:dns"),tH=require("node:os"),{kState:Et,kOptions:rH,kServerBindings:nH}=at(),{FSTWRN003:sH}=Nu(),{onListenHookRunner:ku}=Yn(),{FST_ERR_HTTP2_INVALID_VERSION:iH,FST_ERR_REOPENED_CLOSE_SERVER:FT,FST_ERR_REOPENED_SERVER:VT,FST_ERR_LISTEN_OPTIONS_INVALID:oH}=pt();GT.exports.createServer=aH;function UT(e){return`Server listening at ${e}`}function aH(e,t){let r=BT(e,t);function n(s={port:0,host:"localhost"},i=void 0){if(typeof i=="function"&&(i.constructor.name==="AsyncFunction"&&sH("listen method"),s.cb=i),s.signal){if(typeof s.signal.on!="function"&&typeof s.signal.addEventListener!="function")throw new oH("Invalid options.signal");if(s.signal.aborted)this.close();else{let a=()=>{this.close()};s.signal.addEventListener("abort",a,{once:!0})}}let o;if(s.path==null?o=s.host??"localhost":o=s.host,(!Object.hasOwn(s,"host")||s.host==null)&&(s.host=o),o==="localhost"?s.cb=(a,l)=>{if(a){i(a,l);return}MT.call(this,r,t,e,s,()=>{this[Et].listening=!0,i(null,l),ku(this)})}:s.cb=(a,l)=>{if(a){i(a,l);return}this[Et].listening=!0,i(null,l),ku(this)},i===void 0)return lH.call(this,r,s).then(l=>new Promise((c,u)=>{o==="localhost"?MT.call(this,r,t,e,s,()=>{this[Et].listening=!0,c(l),ku(this)}):(c(l),ku(this))}));this.ready(HT.call(this,r,s))}return{server:r,listen:n}}function MT(e,t,r,n,s){this[Et].listening=!1,eH.lookup(n.host,{all:!0},(i,o)=>{if(i){s();return}let a=e.listening&&r.serverFactory,l=0,c=0;if(!a){let f=e.address();for(let p of o)if(p.address!==f.address){l++;let d=Object.assign({},n,{host:p.address,port:f.port,cb:y=>{c++,y||this[nH].push(h),c===l&&s()}}),h=BT(r,t),m=()=>{h.close(()=>{}),typeof h.closeAllConnections=="function"&&r.forceCloseConnections===!0&&h.closeAllConnections()};h.on("upgrade",e.emit.bind(e,"upgrade")),e.on("unref",m),e.on("close",m),e.on("error",m),this[Et].listening=!1,HT.call(this,h,d)()}}if(l===0){s();return}let u=e.unref;e.unref=function(){u.call(e),e.emit("unref")}})}function HT(e,t){let r=n=>{if(e.removeListener("error",r),e.removeListener("listening",r),n)this[Et].listening=!1,t.cb(n,null);else{let s=zT.call(this,e,t.listenTextResolver||UT);t.cb(null,s)}};return n=>{if(n!=null)return t.cb(n);if(this[Et].listening&&this[Et].closing)return t.cb(new FT,null);if(this[Et].listening)return t.cb(new VT,null);e.once("error",r),this[Et].closing||(e.once("listening",r),e.listen(t),this[Et].listening=!0)}}function lH(e,t){return this[Et].listening&&this[Et].closing?Promise.reject(new FT):this[Et].listening?Promise.reject(new VT):this.ready().then(()=>{let r,n;function s(){e.removeListener("error",r),e.removeListener("listening",n)}let i=new Promise((a,l)=>{r=c=>{s(),this[Et].listening=!1,l(c)},e.once("error",r)}),o=new Promise((a,l)=>{n=()=>{s(),this[Et].listening=!0,a(zT.call(this,e,t.listenTextResolver||UT))},e.once("listening",n)});return e.listen(t),Promise.race([i,o])})}function BT(e,t){let r=null,n=e.https===!0?{}:e.https;return e.serverFactory?r=e.serverFactory(t,e):e.http2?(typeof n=="object"?r=jT().createSecureServer(n,t):r=jT().createServer(t),r.on("session",uH(e.http2SessionTimeout))):(n?r=QU.createServer(n,t):r=ZU.createServer(e.http,t),r.keepAliveTimeout=e.keepAliveTimeout,r.requestTimeout=e.requestTimeout,e.maxRequestsPerSocket>0&&(r.maxRequestsPerSocket=e.maxRequestsPerSocket)),e.serverFactory||r.setTimeout(e.connectionTimeout),r}function cH(e){return e.address==="0.0.0.0"?Object.values(tH.networkInterfaces()).flatMap(t=>t.filter(r=>r.family==="IPv4")).sort(t=>t.internal?-1:1).map(t=>t.address):[e.address]}function zT(e,t){let r;typeof e.address()=="string"?r=[e.address()]:(e.address().address.indexOf(":")===-1?r=cH(e.address()).map(s=>s+":"+e.address().port):r=["["+e.address().address+"]:"+e.address().port],r=r.map(s=>"http"+(this[rH].https?"s":"")+"://"+s));for(let s of r)this.log.info(t(s));return r[0]}function jT(){try{return require("node:http2")}catch{throw new iH}}function uH(e){return function(t){t.setTimeout(e,fH)}}function fH(){this.close()}});var Om=S((zhe,JT)=>{"use strict";var{kSchemaHeaders:qu,kSchemaParams:Rm,kSchemaQuerystring:Tm,kSchemaBody:Vs,kSchemaResponse:KT}=at(),dH=/^[1-5](?:\d{2}|xx)$|^default$/,{FST_ERR_SCH_RESPONSE_SCHEMA_NOT_NESTED_2XX:hH}=pt(),{FSTWRN001:Lu}=Nu();function pH(e,t){if(!e.schema||!e.schema.response)return;let{method:r,url:n}=e.config||{};e[KT]=Object.keys(e.schema.response).reduce(function(s,i){let o=e.schema.response[i];if(i=i.toLowerCase(),!dH.test(i))throw new hH;if(o.content){let a={};for(let l of Object.keys(o.content)){let c=o.content[l].schema;a[l]=t({schema:c,url:n,method:r,httpStatus:i,contentType:l})}s[i]=a}else s[i]=t({schema:o,url:n,method:r,httpStatus:i});return s},{})}function mH(e,t,r){let{schema:n}=e;if(!n)return;let{method:s,url:i}=e.config||{},o=n.headers;if(o&&(r||Object.getPrototypeOf(o)!==Object.prototype))e[qu]=t({schema:o,method:s,url:i,httpPart:"headers"});else if(o){let a={};Object.keys(o).forEach(l=>{a[l]=o[l]}),a.required instanceof Array&&(a.required=a.required.map(l=>l.toLowerCase())),o.properties&&(a.properties={},Object.keys(o.properties).forEach(l=>{a.properties[l.toLowerCase()]=o.properties[l]})),e[qu]=t({schema:a,method:s,url:i,httpPart:"headers"})}else Object.hasOwn(n,"headers")&&Lu("headers",s,i);if(n.body){let a=n.body.content;if(a){let l={};for(let c of Object.keys(a)){let u=a[c].schema;l[c]=t({schema:u,method:s,url:i,httpPart:"body",contentType:c})}e[Vs]=l}else e[Vs]=t({schema:n.body,method:s,url:i,httpPart:"body"})}else Object.hasOwn(n,"body")&&Lu("body",s,i);n.querystring?e[Tm]=t({schema:n.querystring,method:s,url:i,httpPart:"querystring"}):Object.hasOwn(n,"querystring")&&Lu("querystring",s,i),n.params?e[Rm]=t({schema:n.params,method:s,url:i,httpPart:"params"}):Object.hasOwn(n,"params")&&Lu("params",s,i)}function Du(e,t,r){let n=t[r]===void 0,s=e&&e(n?null:t[r]);if(s&&typeof s.then=="function")return s.then(o=>i(o)).catch(o=>o);return i(s);function i(o){return o===!1?e.errors:o&&o.error?o.error:(o&&o.value&&(t[r]=o.value),!1)}}function Mu(e,t,r){let n=r===void 0;if(n||!r.skipParams){let i=Du(e[Rm],t,"params");if(i)return typeof i.then!="function"?Xn(i,"params",e.schemaErrorFormatter):gH(i,e,t)}if(n||!r.skipBody){let i=null;if(typeof e[Vs]=="function")i=e[Vs];else if(e[Vs]){let a=t.headers["content-type"]?.split(";",1)[0],l=e[Vs][a];l&&(i=l)}let o=Du(i,t,"body");if(o)return typeof o.then!="function"?Xn(o,"body",e.schemaErrorFormatter):yH(o,e,t)}if(n||!r.skipQuery){let i=Du(e[Tm],t,"query");if(i)return typeof i.then!="function"?Xn(i,"querystring",e.schemaErrorFormatter):_H(i,e,t)}let s=Du(e[qu],t,"headers");return s?typeof s.then!="function"?Xn(s,"headers",e.schemaErrorFormatter):bH(s,e,t):!1}function gH(e,t,r){return e.then(n=>n?Xn(n,"params",t.schemaErrorFormatter):Mu(t,r,{skipParams:!0}))}function yH(e,t,r){return e.then(n=>n?Xn(n,"body",t.schemaErrorFormatter):Mu(t,r,{skipParams:!0,skipBody:!0}))}function _H(e,t,r){return e.then(n=>n?Xn(n,"querystring",t.schemaErrorFormatter):Mu(t,r,{skipParams:!0,skipBody:!0,skipQuery:!0}))}function bH(e,t,r){return e.then(n=>n?Xn(n,"headers",t.schemaErrorFormatter):!1)}function Xn(e,t,r){if(e instanceof Error)return e.statusCode=e.statusCode||400,e.code=e.code||"FST_ERR_VALIDATION",e.validationContext=e.validationContext||t,e;let n=r(e,t);return n.statusCode=n.statusCode||400,n.code=n.code||"FST_ERR_VALIDATION",n.validation=e,n.validationContext=t,n}JT.exports={symbols:{bodySchema:Vs,querystringSchema:Tm,responseSchema:KT,paramsSchema:Rm,headersSchema:qu},compileSchemasForValidation:mH,compileSchemasForSerialization:pH,validate:Mu}});var Pm=S((Ghe,XT)=>{"use strict";var{kReplyIsError:YT,kReplyHijacked:SH}=at(),vH=require("node:diagnostics_channel"),Ua=vH.tracingChannel("fastify.request.handler");function EH(e,t,r){r&&(r.async=!0),e.then(function(n){if(t[SH]!==!0){r&&Ua.asyncStart.publish(r);try{if(n!==void 0||t.sent===!1&&t.raw.headersSent===!1&&t.request.raw.aborted===!1&&t.request.socket&&!t.request.socket.destroyed)try{t.send(n)}catch(s){t[YT]=!0,t.send(s)}}finally{r&&Ua.asyncEnd.publish(r)}}},function(n){r&&(r.error=n,Ua.error.publish(r),Ua.asyncStart.publish(r));try{if(t.sent===!0){t.log.error({err:n},"Promise errored, but reply.sent = true was set");return}t[YT]=!0,t.send(n)}catch(s){t.send(s)}finally{r&&Ua.asyncEnd.publish(r)}})}XT.exports=EH});var Nm=S((Whe,Cm)=>{"use strict";var wH=require("node:diagnostics_channel"),{validate:RH}=Om(),{preValidationHookRunner:TH,preHandlerHookRunner:OH}=Yn(),PH=Pm(),{kReplyIsError:ju,kRouteContext:gn,kFourOhFourContext:IH,kSupportedHTTPMethods:ZT}=at(),Ha=wH.tracingChannel("fastify.request.handler");function AH(e,t,r){if(r.sent===!0)return;if(e!=null){r[ju]=!0,r.send(e);return}let n=t.raw.method,s=t.headers,i=t[gn];if(this[ZT].bodyless.has(n)){Us(t,r);return}if(this[ZT].bodywith.has(n)){let o=s["content-type"],a=s["content-length"],l=s["transfer-encoding"];if(o===void 0)(a===void 0||a==="0")&&l===void 0?Us(t,r):i.contentTypeParser.run("",Us,t,r);else{if(a===void 0&&l===void 0&&n==="OPTIONS"){Us(t,r);return}i.contentTypeParser.run(o,Us,t,r)}return}Us(t,r)}function Us(e,t){try{e[gn].preValidation!==null?TH(e[gn].preValidation,e,t,Im):Im(null,e,t)}catch(r){Im(r,e,t)}}function Im(e,t,r){if(r.sent===!0)return;if(e!=null){r[ju]=!0,r.send(e);return}let n=RH(r[gn],t);if(n&&typeof n.then=="function"||!1){let i=QT.bind(null,t,r);n.then(i,i)}else QT(t,r,n)}function QT(e,t,r){if(r){if(t[gn].attachValidation===!1){t.send(r);return}t.request.validationError=r}e[gn].preHandler!==null?OH(e[gn].preHandler,e,t,Am):Am(null,e,t)}function Am(e,t,r){if(r.sent)return;let n=t[gn];if(!Ha.hasSubscribers||n[IH]===null)eO(e,t,r);else{let s={request:t,reply:r,async:!1,route:{url:n.config.url,method:n.config.method}};Ha.start.runStores(s,eO,void 0,e,t,r,s)}}function eO(e,t,r,n){let s=t[gn];try{if(e!=null){r[ju]=!0,r.send(e),n&&(n.error=e,Ha.error.publish(n));return}let i;try{i=s.handler(t,r)}catch(o){n&&(n.error=o,Ha.error.publish(n)),r[ju]=!0,r.send(o);return}i!==void 0&&(i!==null&&typeof i.then=="function"?PH(i,r,n):r.send(i))}finally{n&&Ha.end.publish(n)}}Cm.exports=AH;Cm.exports[Symbol.for("internals")]={handler:Us,preHandlerCallback:Am}});var rO=S((Khe,tO)=>{"use strict";function Ji(){}var CH={fatal:Ji,error:Ji,warn:Ji,info:Ji,debug:Ji,trace:Ji};Object.defineProperty(tO,"exports",{get(){return Object.create(CH)}})});var xm=S((Jhe,iO)=>{"use strict";var Ba=e=>e&&typeof e.message=="string",$m=e=>{if(!e)return;let t=e.cause;if(typeof t=="function"){let r=e.cause();return Ba(r)?r:void 0}else return Ba(t)?t:void 0},nO=(e,t)=>{if(!Ba(e))return"";let r=e.stack||"";if(t.has(e))return r+`
causes have become circular...`;let n=$m(e);return n?(t.add(e),r+`
caused by: `+nO(n,t)):r},NH=e=>nO(e,new Set),sO=(e,t,r)=>{if(!Ba(e))return"";let n=r?"":e.message||"";if(t.has(e))return n+": ...";let s=$m(e);if(s){t.add(e);let i=typeof e.cause=="function";return n+(i?"":": ")+sO(s,t,i)}else return n},$H=e=>sO(e,new Set);iO.exports={isErrorLike:Ba,getErrorCause:$m,stackWithCauses:NH,messageWithCauses:$H}});var km=S((Yhe,aO)=>{"use strict";var xH=Symbol("circular-ref-tag"),Fu=Symbol("pino-raw-err-ref"),oO=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[Fu]},set:function(e){this[Fu]=e}}});Object.defineProperty(oO,Fu,{writable:!0,value:{}});aO.exports={pinoErrProto:oO,pinoErrorSymbols:{seen:xH,rawSymbol:Fu}}});var uO=S((Xhe,cO)=>{"use strict";cO.exports=Dm;var{messageWithCauses:kH,stackWithCauses:LH,isErrorLike:lO}=xm(),{pinoErrProto:DH,pinoErrorSymbols:qH}=km(),{seen:Lm}=qH,{toString:MH}=Object.prototype;function Dm(e){if(!lO(e))return e;e[Lm]=void 0;let t=Object.create(DH);t.type=MH.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=kH(e),t.stack=LH(e),Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(r=>Dm(r)));for(let r in e)if(t[r]===void 0){let n=e[r];lO(n)?r!=="cause"&&!Object.prototype.hasOwnProperty.call(n,Lm)&&(t[r]=Dm(n)):t[r]=n}return delete e[Lm],t.raw=e,t}});var dO=S((Zhe,fO)=>{"use strict";fO.exports=Uu;var{isErrorLike:qm}=xm(),{pinoErrProto:jH,pinoErrorSymbols:FH}=km(),{seen:Vu}=FH,{toString:VH}=Object.prototype;function Uu(e){if(!qm(e))return e;e[Vu]=void 0;let t=Object.create(jH);t.type=VH.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=e.message,t.stack=e.stack,Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(r=>Uu(r))),qm(e.cause)&&!Object.prototype.hasOwnProperty.call(e.cause,Vu)&&(t.cause=Uu(e.cause));for(let r in e)if(t[r]===void 0){let n=e[r];qm(n)?Object.prototype.hasOwnProperty.call(n,Vu)||(t[r]=Uu(n)):t[r]=n}return delete e[Vu],t.raw=e,t}});var gO=S((Qhe,mO)=>{"use strict";mO.exports={mapHttpRequest:UH,reqSerializer:pO};var Mm=Symbol("pino-raw-req-ref"),hO=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[Mm]},set:function(e){this[Mm]=e}}});Object.defineProperty(hO,Mm,{writable:!0,value:{}});function pO(e){let t=e.info||e.socket,r=Object.create(hO);if(r.id=typeof e.id=="function"?e.id():e.id||(e.info?e.info.id:void 0),r.method=e.method,e.originalUrl)r.url=e.originalUrl;else{let n=e.path;r.url=typeof n=="string"?n:e.url?e.url.path||e.url:void 0}return e.query&&(r.query=e.query),e.params&&(r.params=e.params),r.headers=e.headers,r.remoteAddress=t&&t.remoteAddress,r.remotePort=t&&t.remotePort,r.raw=e.raw||e,r}function UH(e){return{req:pO(e)}}});var SO=S((epe,bO)=>{"use strict";bO.exports={mapHttpResponse:HH,resSerializer:_O};var jm=Symbol("pino-raw-res-ref"),yO=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[jm]},set:function(e){this[jm]=e}}});Object.defineProperty(yO,jm,{writable:!0,value:{}});function _O(e){let t=Object.create(yO);return t.statusCode=e.headersSent?e.statusCode:null,t.headers=e.getHeaders?e.getHeaders():e._headers,t.raw=e,t}function HH(e){return{res:_O(e)}}});var Vm=S((tpe,vO)=>{"use strict";var Fm=uO(),BH=dO(),Hu=gO(),Bu=SO();vO.exports={err:Fm,errWithCause:BH,mapHttpRequest:Hu.mapHttpRequest,mapHttpResponse:Bu.mapHttpResponse,req:Hu.reqSerializer,res:Bu.resSerializer,wrapErrorSerializer:function(t){return t===Fm?t:function(n){return t(Fm(n))}},wrapRequestSerializer:function(t){return t===Hu.reqSerializer?t:function(n){return t(Hu.reqSerializer(n))}},wrapResponseSerializer:function(t){return t===Bu.resSerializer?t:function(n){return t(Bu.resSerializer(n))}}}});var Um=S((rpe,EO)=>{"use strict";function zH(e,t){return t}EO.exports=function(){let t=Error.prepareStackTrace;Error.prepareStackTrace=zH;let r=new Error().stack;if(Error.prepareStackTrace=t,!Array.isArray(r))return;let n=r.slice(2),s=[];for(let i of n)i&&s.push(i.getFileName());return s}});var RO=S((npe,wO)=>{"use strict";wO.exports=GH;function GH(e={}){let{ERR_PATHS_MUST_BE_STRINGS:t=()=>"fast-redact - Paths must be (non-empty) strings",ERR_INVALID_PATH:r=n=>`fast-redact \u2013 Invalid path (${n})`}=e;return function({paths:s}){s.forEach(i=>{if(typeof i!="string")throw Error(t());try{if(/〇/.test(i))throw Error();let o=(i[0]==="["?"":".")+i.replace(/^\*/,"\u3007").replace(/\.\*/g,".\u3007").replace(/\[\*\]/g,"[\u3007]");if(/\n|\r|;/.test(o)||/\/\*/.test(o))throw Error();Function(`
            'use strict'
            const o = new Proxy({}, { get: () => o, set: () => { throw Error() } });
            const \u3007 = null;
            o${o}
            if ([o${o}].length !== 1) throw Error()`)()}catch{throw Error(r(i))}})}}});var zu=S((spe,TO)=>{"use strict";TO.exports=/[^.[\]]+|\[((?:.)*?)\]/g});var PO=S((ipe,OO)=>{"use strict";var WH=zu();OO.exports=KH;function KH({paths:e}){let t=[];var r=0;let n=e.reduce(function(s,i,o){var a=i.match(WH).map(u=>u.replace(/'|"|`/g,""));let l=i[0]==="[";a=a.map(u=>u[0]==="["?u.substr(1,u.length-2):u);let c=a.indexOf("*");if(c>-1){let u=a.slice(0,c),f=u.join("."),p=a.slice(c+1,a.length),d=p.length>0;r++,t.push({before:u,beforeStr:f,after:p,nested:d})}else s[i]={path:a,val:void 0,precensored:!1,circle:"",escPath:JSON.stringify(i),leadingBracket:l};return s},{});return{wildcards:t,wcLen:r,secret:n}}});var AO=S((ope,IO)=>{"use strict";var JH=zu();IO.exports=YH;function YH({secret:e,serialize:t,wcLen:r,strict:n,isCensorFct:s,censorFctTakesPath:i},o){let a=Function("o",`
    if (typeof o !== 'object' || o == null) {
      ${e5(n,t)}
    }
    const { censor, secret } = this
    const originalSecret = {}
    const secretKeys = Object.keys(secret)
    for (var i = 0; i < secretKeys.length; i++) {
      originalSecret[secretKeys[i]] = secret[secretKeys[i]]
    }

    ${XH(e,s,i)}
    this.compileRestore()
    ${ZH(r>0,s,i)}
    this.secret = originalSecret
    ${QH(t)}
  `).bind(o);return a.state=o,t===!1&&(a.restore=l=>o.restore(l)),a}function XH(e,t,r){return Object.keys(e).map(n=>{let{escPath:s,leadingBracket:i,path:o}=e[n],a=i?1:0,l=i?"":".",c=[];for(var u;(u=JH.exec(n))!==null;){let[,h]=u,{index:m,input:y}=u;m>a&&c.push(y.substring(0,m-(h?0:1)))}var f=c.map(h=>`o${l}${h}`).join(" && ");f.length===0?f+=`o${l}${n} != null`:f+=` && o${l}${n} != null`;let p=`
      switch (true) {
        ${c.reverse().map(h=>`
          case o${l}${h} === censor:
            secret[${s}].circle = ${JSON.stringify(h)}
            break
        `).join(`
`)}
      }
    `,d=r?`val, ${JSON.stringify(o)}`:"val";return`
      if (${f}) {
        const val = o${l}${n}
        if (val === censor) {
          secret[${s}].precensored = true
        } else {
          secret[${s}].val = val
          o${l}${n} = ${t?`censor(${d})`:"censor"}
          ${p}
        }
      }
    `}).join(`
`)}function ZH(e,t,r){return e===!0?`
    {
      const { wildcards, wcLen, groupRedact, nestedRedact } = this
      for (var i = 0; i < wcLen; i++) {
        const { before, beforeStr, after, nested } = wildcards[i]
        if (nested === true) {
          secret[beforeStr] = secret[beforeStr] || []
          nestedRedact(secret[beforeStr], o, before, after, censor, ${t}, ${r})
        } else secret[beforeStr] = groupRedact(o, before, censor, ${t}, ${r})
      }
    }
  `:""}function QH(e){return e===!1?"return o":`
    var s = this.serialize(o)
    this.restore(o)
    return s
  `}function e5(e,t){return e===!0?"throw Error('fast-redact: primitives cannot be redacted')":t===!1?"return o":"return this.serialize(o)"}});var Bm=S((ape,$O)=>{"use strict";$O.exports={groupRedact:r5,groupRestore:t5,nestedRedact:s5,nestedRestore:n5};function t5({keys:e,values:t,target:r}){if(r==null||typeof r=="string")return;let n=e.length;for(var s=0;s<n;s++){let i=e[s];r[i]=t[s]}}function r5(e,t,r,n,s){let i=CO(e,t);if(i==null||typeof i=="string")return{keys:null,values:null,target:i,flat:!0};let o=Object.keys(i),a=o.length,l=t.length,c=s?[...t]:void 0,u=new Array(a);for(var f=0;f<a;f++){let p=o[f];u[f]=i[p],s?(c[l]=p,i[p]=r(i[p],c)):n?i[p]=r(i[p]):i[p]=r}return{keys:o,values:u,target:i,flat:!0}}function n5(e){for(let t=0;t<e.length;t++){let{target:r,path:n,value:s}=e[t],i=r;for(let o=n.length-1;o>0;o--)i=i[n[o]];i[n[0]]=s}}function s5(e,t,r,n,s,i,o){let a=CO(t,r);if(a==null)return;let l=Object.keys(a),c=l.length;for(var u=0;u<c;u++){let f=l[u];i5(e,a,f,r,n,s,i,o)}return e}function Hm(e,t){return e!=null?"hasOwn"in Object?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t):!1}function i5(e,t,r,n,s,i,o,a){let l=s.length,c=l-1,u=r;var f=-1,p,d,h,m=null,y=null,b,v,_=!1,g=0,T=0,R=o5();if(h=p=t[r],typeof p=="object"){for(;p!=null&&++f<l&&(T+=1,r=s[f],m=h,!(r!=="*"&&!y&&!(typeof p=="object"&&r in p)));)if(!(r==="*"&&(y==="*"&&(_=!0),y=r,f!==c))){if(y){let P=Object.keys(p);for(var w=0;w<P.length;w++){let O=P[w];if(v=p[O],b=r==="*",_)R=yn(R,O,T),g=f,h=NO(v,g-1,r,n,s,i,o,a,u,p,d,h,b,O,f,c,R,e,t[u],T+1);else if(b||typeof v=="object"&&v!==null&&r in v){if(b?h=v:h=v[r],d=f!==c?h:o?a?i(h,[...n,u,...s]):i(h):i,b){let A=za(yn(R,O,T),h,t[u]);e.push(A),p[O]=d}else if(v[r]!==d)if(d===void 0&&i!==void 0||Hm(v,r)&&d===h)R=yn(R,O,T);else{R=yn(R,O,T);let A=za(yn(R,r,T+1),h,t[u]);e.push(A),v[r]=d}}}y=null}else{if(h=p[r],R=yn(R,r,T),d=f!==c?h:o?a?i(h,[...n,u,...s]):i(h):i,!(Hm(p,r)&&d===h||d===void 0&&i!==void 0)){let P=za(R,h,t[u]);e.push(P),p[r]=d}p=p[r]}if(typeof p!="object")break}}}function CO(e,t){for(var r=-1,n=t.length,s=e;s!=null&&++r<n;)s=s[t[r]];return s}function NO(e,t,r,n,s,i,o,a,l,c,u,f,p,d,h,m,y,b,v,_){if(t===0&&(p||typeof e=="object"&&e!==null&&r in e)){if(p?f=e:f=e[r],u=h!==m?f:o?a?i(f,[...n,l,...s]):i(f):i,p){let g=za(y,f,v);b.push(g),c[d]=u}else if(e[r]!==u){if(!(u===void 0&&i!==void 0||Hm(e,r)&&u===f)){let g=za(yn(y,r,_+1),f,v);b.push(g),e[r]=u}}}for(let g in e)typeof e[g]=="object"&&(y=yn(y,g,_),NO(e[g],t-1,r,n,s,i,o,a,l,c,u,f,p,d,h,m,y,b,v,_+1))}function o5(){return{parent:null,key:null,children:[],depth:0}}function yn(e,t,r){if(e.depth===r)return yn(e.parent,t,r);var n={parent:e,key:t,depth:r,children:[]};return e.children.push(n),n}function za(e,t,r){let n=e,s=[];do s.push(n.key),n=n.parent;while(n.parent!=null);return{path:s,value:t,target:r}}});var kO=S((lpe,xO)=>{"use strict";var{groupRestore:a5,nestedRestore:l5}=Bm();xO.exports=c5;function c5(){return function(){if(this.restore){this.restore.state.secret=this.secret;return}let{secret:t,wcLen:r}=this,n=Object.keys(t),s=u5(t,n),i=r>0,o=i?{secret:t,groupRestore:a5,nestedRestore:l5}:{secret:t};this.restore=Function("o",f5(s,n,i)).bind(o),this.restore.state=o}}function u5(e,t){return t.map(r=>{let{circle:n,escPath:s,leadingBracket:i}=e[r],a=n?`o.${n} = secret[${s}].val`:`o${i?"":"."}${r} = secret[${s}].val`,l=`secret[${s}].val = undefined`;return`
      if (secret[${s}].val !== undefined) {
        try { ${a} } catch (e) {}
        ${l}
      }
    `}).join("")}function f5(e,t,r){return`
    const secret = this.secret
    ${r===!0?`
    const keys = Object.keys(secret)
    const len = keys.length
    for (var i = len - 1; i >= ${t.length}; i--) {
      const k = keys[i]
      const o = secret[k]
      if (o) {
        if (o.flat === true) this.groupRestore(o)
        else this.nestedRestore(o)
        secret[k] = null
      }
    }
  `:""}
    ${e}
    return o
  `}});var DO=S((cpe,LO)=>{"use strict";LO.exports=d5;function d5(e){let{secret:t,censor:r,compileRestore:n,serialize:s,groupRedact:i,nestedRedact:o,wildcards:a,wcLen:l}=e,c=[{secret:t,censor:r,compileRestore:n}];return s!==!1&&c.push({serialize:s}),l>0&&c.push({groupRedact:i,nestedRedact:o,wildcards:a,wcLen:l}),Object.assign(...c)}});var jO=S((upe,MO)=>{"use strict";var qO=RO(),h5=PO(),p5=AO(),m5=kO(),{groupRedact:g5,nestedRedact:y5}=Bm(),_5=DO(),b5=zu(),S5=qO(),zm=e=>e;zm.restore=zm;var v5="[REDACTED]";Gm.rx=b5;Gm.validator=qO;MO.exports=Gm;function Gm(e={}){let t=Array.from(new Set(e.paths||[])),r="serialize"in e&&(e.serialize===!1||typeof e.serialize=="function")?e.serialize:JSON.stringify,n=e.remove;if(n===!0&&r!==JSON.stringify)throw Error("fast-redact \u2013 remove option may only be set when serializer is JSON.stringify");let s=n===!0?void 0:"censor"in e?e.censor:v5,i=typeof s=="function",o=i&&s.length>1;if(t.length===0)return r||zm;S5({paths:t,serialize:r,censor:s});let{wildcards:a,wcLen:l,secret:c}=h5({paths:t,censor:s}),u=m5(),f="strict"in e?e.strict:!0;return p5({secret:c,wcLen:l,serialize:r,strict:f,isCensorFct:i,censorFctTakesPath:o},_5({secret:c,censor:s,compileRestore:u,serialize:r,groupRedact:g5,nestedRedact:y5,wildcards:a,wcLen:l}))}});var Yi=S((fpe,FO)=>{"use strict";var E5=Symbol("pino.setLevel"),w5=Symbol("pino.getLevel"),R5=Symbol("pino.levelVal"),T5=Symbol("pino.levelComp"),O5=Symbol("pino.useLevelLabels"),P5=Symbol("pino.useOnlyCustomLevels"),I5=Symbol("pino.mixin"),A5=Symbol("pino.lsCache"),C5=Symbol("pino.chindings"),N5=Symbol("pino.asJson"),$5=Symbol("pino.write"),x5=Symbol("pino.redactFmt"),k5=Symbol("pino.time"),L5=Symbol("pino.timeSliceIndex"),D5=Symbol("pino.stream"),q5=Symbol("pino.stringify"),M5=Symbol("pino.stringifySafe"),j5=Symbol("pino.stringifiers"),F5=Symbol("pino.end"),V5=Symbol("pino.formatOpts"),U5=Symbol("pino.messageKey"),H5=Symbol("pino.errorKey"),B5=Symbol("pino.nestedKey"),z5=Symbol("pino.nestedKeyStr"),G5=Symbol("pino.mixinMergeStrategy"),W5=Symbol("pino.msgPrefix"),K5=Symbol("pino.wildcardFirst"),J5=Symbol.for("pino.serializers"),Y5=Symbol.for("pino.formatters"),X5=Symbol.for("pino.hooks"),Z5=Symbol.for("pino.metadata");FO.exports={setLevelSym:E5,getLevelSym:w5,levelValSym:R5,levelCompSym:T5,useLevelLabelsSym:O5,mixinSym:I5,lsCacheSym:A5,chindingsSym:C5,asJsonSym:N5,writeSym:$5,serializersSym:J5,redactFmtSym:x5,timeSym:k5,timeSliceIndexSym:L5,streamSym:D5,stringifySym:q5,stringifySafeSym:M5,stringifiersSym:j5,endSym:F5,formatOptsSym:V5,messageKeySym:U5,errorKeySym:H5,nestedKeySym:B5,wildcardFirstSym:K5,needsMetadataGsym:Z5,useOnlyCustomLevelsSym:P5,formattersSym:Y5,hooksSym:X5,nestedKeyStrSym:z5,mixinMergeStrategySym:G5,msgPrefixSym:W5}});var Jm=S((dpe,BO)=>{"use strict";var Km=jO(),{redactFmtSym:Q5,wildcardFirstSym:Gu}=Yi(),{rx:Wm,validator:eB}=Km,VO=eB({ERR_PATHS_MUST_BE_STRINGS:()=>"pino \u2013 redacted paths must be strings",ERR_INVALID_PATH:e=>`pino \u2013 redact paths array contains an invalid path (${e})`}),UO="[Redacted]",HO=!1;function tB(e,t){let{paths:r,censor:n}=rB(e),s=r.reduce((a,l)=>{Wm.lastIndex=0;let c=Wm.exec(l),u=Wm.exec(l),f=c[1]!==void 0?c[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):c[0];if(f==="*"&&(f=Gu),u===null)return a[f]=null,a;if(a[f]===null)return a;let{index:p}=u,d=`${l.substr(p,l.length-1)}`;return a[f]=a[f]||[],f!==Gu&&a[f].length===0&&a[f].push(...a[Gu]||[]),f===Gu&&Object.keys(a).forEach(function(h){a[h]&&a[h].push(d)}),a[f].push(d),a},{}),i={[Q5]:Km({paths:r,censor:n,serialize:t,strict:HO})},o=(...a)=>t(typeof n=="function"?n(...a):n);return[...Object.keys(s),...Object.getOwnPropertySymbols(s)].reduce((a,l)=>{if(s[l]===null)a[l]=c=>o(c,[l]);else{let c=typeof n=="function"?(u,f)=>n(u,[l,...f]):n;a[l]=Km({paths:s[l],censor:c,serialize:t,strict:HO})}return a},i)}function rB(e){if(Array.isArray(e))return e={paths:e,censor:UO},VO(e),e;let{paths:t,censor:r=UO,remove:n}=e;if(Array.isArray(t)===!1)throw Error("pino \u2013 redact must contain an array of strings");return n===!0&&(r=void 0),VO({paths:t,censor:r}),{paths:t,censor:r}}BO.exports=tB});var GO=S((hpe,zO)=>{"use strict";var nB=()=>"",sB=()=>`,"time":${Date.now()}`,iB=()=>`,"time":${Math.round(Date.now()/1e3)}`,oB=()=>`,"time":"${new Date(Date.now()).toISOString()}"`;zO.exports={nullTime:nB,epochTime:sB,unixTime:iB,isoTime:oB}});var KO=S((ppe,WO)=>{"use strict";function aB(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}WO.exports=lB;function lB(e,t,r){var n=r&&r.stringify||aB,s=1;if(typeof e=="object"&&e!==null){var i=t.length+s;if(i===1)return e;var o=new Array(i);o[0]=n(e);for(var a=1;a<i;a++)o[a]=n(t[a]);return o.join(" ")}if(typeof e!="string")return e;var l=t.length;if(l===0)return e;for(var c="",u=1-s,f=-1,p=e&&e.length||0,d=0;d<p;){if(e.charCodeAt(d)===37&&d+1<p){switch(f=f>-1?f:0,e.charCodeAt(d+1)){case 100:case 102:if(u>=l||t[u]==null)break;f<d&&(c+=e.slice(f,d)),c+=Number(t[u]),f=d+2,d++;break;case 105:if(u>=l||t[u]==null)break;f<d&&(c+=e.slice(f,d)),c+=Math.floor(Number(t[u])),f=d+2,d++;break;case 79:case 111:case 106:if(u>=l||t[u]===void 0)break;f<d&&(c+=e.slice(f,d));var h=typeof t[u];if(h==="string"){c+="'"+t[u]+"'",f=d+2,d++;break}if(h==="function"){c+=t[u].name||"<anonymous>",f=d+2,d++;break}c+=n(t[u]),f=d+2,d++;break;case 115:if(u>=l)break;f<d&&(c+=e.slice(f,d)),c+=String(t[u]),f=d+2,d++;break;case 37:f<d&&(c+=e.slice(f,d)),c+="%",f=d+2,d++,u--;break}++u}++d}return f===-1?e:(f<p&&(c+=e.slice(f)),c)}});var Xm=S((mpe,Ym)=>{"use strict";if(typeof SharedArrayBuffer<"u"&&typeof Atomics<"u"){let t=function(r){if((r>0&&r<1/0)===!1)throw typeof r!="number"&&typeof r!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");Atomics.wait(e,0,0,Number(r))},e=new Int32Array(new SharedArrayBuffer(4));Ym.exports=t}else{let e=function(t){if((t>0&&t<1/0)===!1)throw typeof t!="number"&&typeof t!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");let n=Date.now()+Number(t);for(;n>Date.now(););};Ym.exports=e}});var r1=S((gpe,t1)=>{"use strict";var Ge=require("fs"),cB=require("events"),uB=require("util").inherits,JO=require("path"),Qm=Xm(),fB=require("assert"),Wu=100,Ku=Buffer.allocUnsafe(0),dB=16*1024,YO="buffer",XO="utf8",[hB,pB]=(process.versions.node||"0.0").split(".").map(Number),mB=hB>=22&&pB>=7;function ZO(e,t){t._opening=!0,t._writing=!0,t._asyncDrainScheduled=!1;function r(i,o){if(i){t._reopening=!1,t._writing=!1,t._opening=!1,t.sync?process.nextTick(()=>{t.listenerCount("error")>0&&t.emit("error",i)}):t.emit("error",i);return}let a=t._reopening;t.fd=o,t.file=e,t._reopening=!1,t._opening=!1,t._writing=!1,t.sync?process.nextTick(()=>t.emit("ready")):t.emit("ready"),!t.destroyed&&(!t._writing&&t._len>t.minLength||t._flushPending?t._actualWrite():a&&process.nextTick(()=>t.emit("drain")))}let n=t.append?"a":"w",s=t.mode;if(t.sync)try{t.mkdir&&Ge.mkdirSync(JO.dirname(e),{recursive:!0});let i=Ge.openSync(e,n,s);r(null,i)}catch(i){throw r(i),i}else t.mkdir?Ge.mkdir(JO.dirname(e),{recursive:!0},i=>{if(i)return r(i);Ge.open(e,n,s,r)}):Ge.open(e,n,s,r)}function Pr(e){if(!(this instanceof Pr))return new Pr(e);let{fd:t,dest:r,minLength:n,maxLength:s,maxWrite:i,periodicFlush:o,sync:a,append:l=!0,mkdir:c,retryEAGAIN:u,fsync:f,contentMode:p,mode:d}=e||{};t=t||r,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(n||0,16387),this.file=null,this.destroyed=!1,this.minLength=n||0,this.maxLength=s||0,this.maxWrite=i||dB,this._periodicFlush=o||0,this._periodicFlushTimer=void 0,this.sync=a||!1,this.writable=!0,this._fsync=f||!1,this.append=l||!1,this.mode=d,this.retryEAGAIN=u||(()=>!0),this.mkdir=c||!1;let h,m;if(p===YO)this._writingBuf=Ku,this.write=_B,this.flush=SB,this.flushSync=EB,this._actualWrite=RB,h=()=>Ge.writeSync(this.fd,this._writingBuf),m=()=>Ge.write(this.fd,this._writingBuf,this.release);else if(p===void 0||p===XO)this._writingBuf="",this.write=yB,this.flush=bB,this.flushSync=vB,this._actualWrite=wB,h=()=>Ge.writeSync(this.fd,this._writingBuf,"utf8"),m=()=>Ge.write(this.fd,this._writingBuf,"utf8",this.release);else throw new Error(`SonicBoom supports "${XO}" and "${YO}", but passed ${p}`);if(typeof t=="number")this.fd=t,process.nextTick(()=>this.emit("ready"));else if(typeof t=="string")ZO(t,this);else throw new Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw new Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(y,b)=>{if(y){if((y.code==="EAGAIN"||y.code==="EBUSY")&&this.retryEAGAIN(y,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{Qm(Wu),this.release(void 0,0)}catch(g){this.release(g)}else setTimeout(m,Wu);else this._writing=!1,this.emit("error",y);return}this.emit("write",b);let v=Zm(this._writingBuf,this._len,b);if(this._len=v.len,this._writingBuf=v.writingBuf,this._writingBuf.length){if(!this.sync){m();return}try{do{let g=h(),T=Zm(this._writingBuf,this._len,g);this._len=T.len,this._writingBuf=T.writingBuf}while(this._writingBuf.length)}catch(g){this.release(g);return}}this._fsync&&Ge.fsyncSync(this.fd);let _=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):_>this.minLength?this._actualWrite():this._ending?_>0?this._actualWrite():(this._writing=!1,Ju(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(gB,this)):this.emit("drain"))},this.on("newListener",function(y){y==="drain"&&(this._asyncDrainScheduled=!1)}),this._periodicFlush!==0&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function Zm(e,t,r){return typeof e=="string"&&Buffer.byteLength(e)!==r&&(r=Buffer.from(e).subarray(0,r).toString().length),t=Math.max(t-r,0),e=e.slice(r),{writingBuf:e,len:t}}function gB(e){e.listenerCount("drain")>0&&(e._asyncDrainScheduled=!1,e.emit("drain"))}uB(Pr,cB);function QO(e,t){return e.length===0?Ku:e.length===1?e[0]:Buffer.concat(e,t)}function yB(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(r.length===0||r[r.length-1].length+e.length>this.maxWrite?r.push(""+e):r[r.length-1]+=e,this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function _B(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs,n=this._lens;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(r.length===0||n[n.length-1]+e.length>this.maxWrite?(r.push([e]),n.push(e.length)):(r[r.length-1].push(e),n[n.length-1]+=e.length),this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function e1(e){this._flushPending=!0;let t=()=>{if(this._fsync)this._flushPending=!1,e();else try{Ge.fsync(this.fd,n=>{this._flushPending=!1,e(n)})}catch(n){e(n)}this.off("error",r)},r=n=>{this._flushPending=!1,e(n),this.off("drain",t)};this.once("drain",t),this.once("error",r)}function bB(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&e1.call(this,e),!this._writing&&(this._bufs.length===0&&this._bufs.push(""),this._actualWrite())}function SB(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&e1.call(this,e),!this._writing&&(this._bufs.length===0&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite())}Pr.prototype.reopen=function(e){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.reopen(e)});return}if(this._ending)return;if(!this.file)throw new Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(e&&(this.file=e),this._reopening=!0,this._writing)return;let t=this.fd;this.once("ready",()=>{t!==this.fd&&Ge.close(t,r=>{if(r)return this.emit("error",r)})}),ZO(this.file,this)};Pr.prototype.end=function(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.end()});return}this._ending||(this._ending=!0,!this._writing&&(this._len>0&&this.fd>=0?this._actualWrite():Ju(this)))};function vB(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let e="";for(;this._bufs.length||e;){e.length<=0&&(e=this._bufs[0]);try{let t=Ge.writeSync(this.fd,e,"utf8"),r=Zm(e,this._len,t);e=r.writingBuf,this._len=r.len,e.length<=0&&this._bufs.shift()}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;Qm(Wu)}}try{Ge.fsyncSync(this.fd)}catch{}}function EB(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=Ku);let e=Ku;for(;this._bufs.length||e.length;){e.length<=0&&(e=QO(this._bufs[0],this._lens[0]));try{let t=Ge.writeSync(this.fd,e);e=e.subarray(t),this._len=Math.max(this._len-t,0),e.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;Qm(Wu)}}}Pr.prototype.destroy=function(){this.destroyed||Ju(this)};function wB(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let t=Ge.writeSync(this.fd,this._writingBuf,"utf8");e(null,t)}catch(t){e(t)}else Ge.write(this.fd,this._writingBuf,"utf8",e)}function RB(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:QO(this._bufs.shift(),this._lens.shift()),this.sync)try{let t=Ge.writeSync(this.fd,this._writingBuf);e(null,t)}catch(t){e(t)}else mB&&(this._writingBuf=Buffer.from(this._writingBuf)),Ge.write(this.fd,this._writingBuf,e)}function Ju(e){if(e.fd===-1){e.once("ready",Ju.bind(null,e));return}e._periodicFlushTimer!==void 0&&clearInterval(e._periodicFlushTimer),e.destroyed=!0,e._bufs=[],e._lens=[],fB(typeof e.fd=="number",`sonic.fd must be a number, got ${typeof e.fd}`);try{Ge.fsync(e.fd,t)}catch{}function t(){e.fd!==1&&e.fd!==2?Ge.close(e.fd,r):r()}function r(n){if(n){e.emit("error",n);return}e._ending&&!e._writing&&e.emit("finish"),e.emit("close")}}Pr.SonicBoom=Pr;Pr.default=Pr;t1.exports=Pr});var eg=S((ype,a1)=>{"use strict";var Ir={exit:[],beforeExit:[]},n1={exit:PB,beforeExit:IB},Xi;function TB(){Xi===void 0&&(Xi=new FinalizationRegistry(AB))}function OB(e){Ir[e].length>0||process.on(e,n1[e])}function s1(e){Ir[e].length>0||(process.removeListener(e,n1[e]),Ir.exit.length===0&&Ir.beforeExit.length===0&&(Xi=void 0))}function PB(){i1("exit")}function IB(){i1("beforeExit")}function i1(e){for(let t of Ir[e]){let r=t.deref(),n=t.fn;r!==void 0&&n(r,e)}Ir[e]=[]}function AB(e){for(let t of["exit","beforeExit"]){let r=Ir[t].indexOf(e);Ir[t].splice(r,r+1),s1(t)}}function o1(e,t,r){if(t===void 0)throw new Error("the object can't be undefined");OB(e);let n=new WeakRef(t);n.fn=r,TB(),Xi.register(t,n),Ir[e].push(n)}function CB(e,t){o1("exit",e,t)}function NB(e,t){o1("beforeExit",e,t)}function $B(e){if(Xi!==void 0){Xi.unregister(e);for(let t of["exit","beforeExit"])Ir[t]=Ir[t].filter(r=>{let n=r.deref();return n&&n!==e}),s1(t)}}a1.exports={register:CB,registerBeforeExit:NB,unregister:$B}});var l1=S((_pe,xB)=>{xB.exports={name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"}});var u1=S((bpe,c1)=>{"use strict";function kB(e,t,r,n,s){let i=Date.now()+n,o=Atomics.load(e,t);if(o===r){s(null,"ok");return}let a=o,l=c=>{Date.now()>i?s(null,"timed-out"):setTimeout(()=>{a=o,o=Atomics.load(e,t),o===a?l(c>=1e3?1e3:c*2):o===r?s(null,"ok"):s(null,"not-equal")},c)};l(1)}function LB(e,t,r,n,s){let i=Date.now()+n,o=Atomics.load(e,t);if(o!==r){s(null,"ok");return}let a=l=>{Date.now()>i?s(null,"timed-out"):setTimeout(()=>{o=Atomics.load(e,t),o!==r?s(null,"ok"):a(l>=1e3?1e3:l*2)},l)};a(1)}c1.exports={wait:kB,waitDiff:LB}});var d1=S((Spe,f1)=>{"use strict";f1.exports={WRITE_INDEX:4,READ_INDEX:8}});var y1=S((vpe,g1)=>{"use strict";var{version:DB}=l1(),{EventEmitter:qB}=require("events"),{Worker:MB}=require("worker_threads"),{join:jB}=require("path"),{pathToFileURL:FB}=require("url"),{wait:VB}=u1(),{WRITE_INDEX:Ut,READ_INDEX:Ur}=d1(),UB=require("buffer"),HB=require("assert"),$=Symbol("kImpl"),BB=UB.constants.MAX_STRING_LENGTH,Ga=class{constructor(t){this._value=t}deref(){return this._value}},Xu=class{register(){}unregister(){}},zB=process.env.NODE_V8_COVERAGE?Xu:global.FinalizationRegistry||Xu,GB=process.env.NODE_V8_COVERAGE?Ga:global.WeakRef||Ga,h1=new zB(e=>{e.exited||e.terminate()});function WB(e,t){let{filename:r,workerData:n}=t,i=("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||jB(__dirname,"lib","worker.js"),o=new MB(i,{...t.workerOpts,trackUnmanagedFds:!1,workerData:{filename:r.indexOf("file://")===0?r:FB(r).href,dataBuf:e[$].dataBuf,stateBuf:e[$].stateBuf,workerData:{$context:{threadStreamVersion:DB},...n}}});return o.stream=new Ga(e),o.on("message",KB),o.on("exit",m1),h1.register(e,o),o}function p1(e){HB(!e[$].sync),e[$].needDrain&&(e[$].needDrain=!1,e.emit("drain"))}function Yu(e){let t=Atomics.load(e[$].state,Ut),r=e[$].data.length-t;if(r>0){if(e[$].buf.length===0){e[$].flushing=!1,e[$].ending?ig(e):e[$].needDrain&&process.nextTick(p1,e);return}let n=e[$].buf.slice(0,r),s=Buffer.byteLength(n);s<=r?(e[$].buf=e[$].buf.slice(r),Zu(e,n,Yu.bind(null,e))):e.flush(()=>{if(!e.destroyed){for(Atomics.store(e[$].state,Ur,0),Atomics.store(e[$].state,Ut,0);s>e[$].data.length;)r=r/2,n=e[$].buf.slice(0,r),s=Buffer.byteLength(n);e[$].buf=e[$].buf.slice(r),Zu(e,n,Yu.bind(null,e))}})}else if(r===0){if(t===0&&e[$].buf.length===0)return;e.flush(()=>{Atomics.store(e[$].state,Ur,0),Atomics.store(e[$].state,Ut,0),Yu(e)})}else Hr(e,new Error("overwritten"))}function KB(e){let t=this.stream.deref();if(t===void 0){this.exited=!0,this.terminate();return}switch(e.code){case"READY":this.stream=new GB(t),t.flush(()=>{t[$].ready=!0,t.emit("ready")});break;case"ERROR":Hr(t,e.err);break;case"EVENT":Array.isArray(e.args)?t.emit(e.name,...e.args):t.emit(e.name,e.args);break;case"WARNING":process.emitWarning(e.err);break;default:Hr(t,new Error("this should not happen: "+e.code))}}function m1(e){let t=this.stream.deref();t!==void 0&&(h1.unregister(t),t.worker.exited=!0,t.worker.off("exit",m1),Hr(t,e!==0?new Error("the worker thread exited"):null))}var rg=class extends qB{constructor(t={}){if(super(),t.bufferSize<4)throw new Error("bufferSize must at least fit a 4-byte utf-8 char");this[$]={},this[$].stateBuf=new SharedArrayBuffer(128),this[$].state=new Int32Array(this[$].stateBuf),this[$].dataBuf=new SharedArrayBuffer(t.bufferSize||4*1024*1024),this[$].data=Buffer.from(this[$].dataBuf),this[$].sync=t.sync||!1,this[$].ending=!1,this[$].ended=!1,this[$].needDrain=!1,this[$].destroyed=!1,this[$].flushing=!1,this[$].ready=!1,this[$].finished=!1,this[$].errored=null,this[$].closed=!1,this[$].buf="",this.worker=WB(this,t),this.on("message",(r,n)=>{this.worker.postMessage(r,n)})}write(t){if(this[$].destroyed)return ng(this,new Error("the worker has exited")),!1;if(this[$].ending)return ng(this,new Error("the worker is ending")),!1;if(this[$].flushing&&this[$].buf.length+t.length>=BB)try{tg(this),this[$].flushing=!0}catch(r){return Hr(this,r),!1}if(this[$].buf+=t,this[$].sync)try{return tg(this),!0}catch(r){return Hr(this,r),!1}return this[$].flushing||(this[$].flushing=!0,setImmediate(Yu,this)),this[$].needDrain=this[$].data.length-this[$].buf.length-Atomics.load(this[$].state,Ut)<=0,!this[$].needDrain}end(){this[$].destroyed||(this[$].ending=!0,ig(this))}flush(t){if(this[$].destroyed){typeof t=="function"&&process.nextTick(t,new Error("the worker has exited"));return}let r=Atomics.load(this[$].state,Ut);VB(this[$].state,Ur,r,1/0,(n,s)=>{if(n){Hr(this,n),process.nextTick(t,n);return}if(s==="not-equal"){this.flush(t);return}process.nextTick(t)})}flushSync(){this[$].destroyed||(tg(this),sg(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[$].ready}get destroyed(){return this[$].destroyed}get closed(){return this[$].closed}get writable(){return!this[$].destroyed&&!this[$].ending}get writableEnded(){return this[$].ending}get writableFinished(){return this[$].finished}get writableNeedDrain(){return this[$].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[$].errored}};function ng(e,t){setImmediate(()=>{e.emit("error",t)})}function Hr(e,t){e[$].destroyed||(e[$].destroyed=!0,t&&(e[$].errored=t,ng(e,t)),e.worker.exited?setImmediate(()=>{e[$].closed=!0,e.emit("close")}):e.worker.terminate().catch(()=>{}).then(()=>{e[$].closed=!0,e.emit("close")}))}function Zu(e,t,r){let n=Atomics.load(e[$].state,Ut),s=Buffer.byteLength(t);return e[$].data.write(t,n),Atomics.store(e[$].state,Ut,n+s),Atomics.notify(e[$].state,Ut),r(),!0}function ig(e){if(!(e[$].ended||!e[$].ending||e[$].flushing)){e[$].ended=!0;try{e.flushSync();let t=Atomics.load(e[$].state,Ur);Atomics.store(e[$].state,Ut,-1),Atomics.notify(e[$].state,Ut);let r=0;for(;t!==-1;){if(Atomics.wait(e[$].state,Ur,t,1e3),t=Atomics.load(e[$].state,Ur),t===-2){Hr(e,new Error("end() failed"));return}if(++r===10){Hr(e,new Error("end() took too long (10s)"));return}}process.nextTick(()=>{e[$].finished=!0,e.emit("finish")})}catch(t){Hr(e,t)}}}function tg(e){let t=()=>{e[$].ending?ig(e):e[$].needDrain&&process.nextTick(p1,e)};for(e[$].flushing=!1;e[$].buf.length!==0;){let r=Atomics.load(e[$].state,Ut),n=e[$].data.length-r;if(n===0){sg(e),Atomics.store(e[$].state,Ur,0),Atomics.store(e[$].state,Ut,0);continue}else if(n<0)throw new Error("overwritten");let s=e[$].buf.slice(0,n),i=Buffer.byteLength(s);if(i<=n)e[$].buf=e[$].buf.slice(n),Zu(e,s,t);else{for(sg(e),Atomics.store(e[$].state,Ur,0),Atomics.store(e[$].state,Ut,0);i>e[$].buf.length;)n=n/2,s=e[$].buf.slice(0,n),i=Buffer.byteLength(s);e[$].buf=e[$].buf.slice(n),Zu(e,s,t)}}}function sg(e){if(e[$].flushing)throw new Error("unable to flush while flushing");let t=Atomics.load(e[$].state,Ut),r=0;for(;;){let n=Atomics.load(e[$].state,Ur);if(n===-2)throw Error("_flushSync failed");if(n!==t)Atomics.wait(e[$].state,Ur,n,1e3);else break;if(++r===10)throw new Error("_flushSync took too long (10s)")}}g1.exports=rg});var lg=S((Epe,_1)=>{"use strict";var{createRequire:JB}=require("module"),YB=Um(),{join:og,isAbsolute:XB,sep:ZB}=require("node:path"),QB=Xm(),ag=eg(),ez=y1();function tz(e){ag.register(e,nz),ag.registerBeforeExit(e,sz),e.on("close",function(){ag.unregister(e)})}function rz(e,t,r,n){let s=new ez({filename:e,workerData:t,workerOpts:r,sync:n});s.on("ready",i),s.on("close",function(){process.removeListener("exit",o)}),process.on("exit",o);function i(){process.removeListener("exit",o),s.unref(),r.autoEnd!==!1&&tz(s)}function o(){s.closed||(s.flushSync(),QB(100),s.end())}return s}function nz(e){e.ref(),e.flushSync(),e.end(),e.once("close",function(){e.unref()})}function sz(e){e.flushSync()}function iz(e){let{pipeline:t,targets:r,levels:n,dedupe:s,worker:i={},caller:o=YB(),sync:a=!1}=e,l={...e.options},c=typeof o=="string"?[o]:o,u="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},f=e.target;if(f&&r)throw new Error("only one of target or targets can be specified");return r?(f=u["pino-worker"]||og(__dirname,"worker.js"),l.targets=r.filter(d=>d.target).map(d=>({...d,target:p(d.target)})),l.pipelines=r.filter(d=>d.pipeline).map(d=>d.pipeline.map(h=>({...h,level:d.level,target:p(h.target)})))):t&&(f=u["pino-worker"]||og(__dirname,"worker.js"),l.pipelines=[t.map(d=>({...d,target:p(d.target)}))]),n&&(l.levels=n),s&&(l.dedupe=s),l.pinoWillSendConfig=!0,rz(p(f),l,i,a);function p(d){if(d=u[d]||d,XB(d)||d.indexOf("file://")===0)return d;if(d==="pino/file")return og(__dirname,"..","file.js");let h;for(let m of c)try{let y=m==="node:repl"?process.cwd()+ZB:m;h=JB(y).resolve(d);break}catch{continue}if(!h)throw new Error(`unable to determine transport target for "${d}"`);return h}}_1.exports=iz});var tf=S((wpe,A1)=>{"use strict";var b1=KO(),{mapHttpRequest:oz,mapHttpResponse:az}=Vm(),ug=r1(),S1=eg(),{lsCacheSym:lz,chindingsSym:w1,writeSym:v1,serializersSym:R1,formatOptsSym:E1,endSym:cz,stringifiersSym:T1,stringifySym:O1,stringifySafeSym:fg,wildcardFirstSym:P1,nestedKeySym:uz,formattersSym:I1,messageKeySym:fz,errorKeySym:dz,nestedKeyStrSym:hz,msgPrefixSym:Qu}=Yi(),{isMainThread:pz}=require("worker_threads"),mz=lg();function Zi(){}function gz(e,t){if(!t)return r;return function(...s){t.call(this,s,r,e)};function r(n,...s){if(typeof n=="object"){let i=n;n!==null&&(n.method&&n.headers&&n.socket?n=oz(n):typeof n.setHeader=="function"&&(n=az(n)));let o;i===null&&s.length===0?o=[null]:(i=s.shift(),o=s),typeof this[Qu]=="string"&&i!==void 0&&i!==null&&(i=this[Qu]+i),this[v1](n,b1(i,o,this[E1]),e)}else{let i=n===void 0?s.shift():n;typeof this[Qu]=="string"&&i!==void 0&&i!==null&&(i=this[Qu]+i),this[v1](null,b1(i,s,this[E1]),e)}}}function cg(e){let t="",r=0,n=!1,s=255,i=e.length;if(i>100)return JSON.stringify(e);for(var o=0;o<i&&s>=32;o++)s=e.charCodeAt(o),(s===34||s===92)&&(t+=e.slice(r,o)+"\\",r=o,n=!0);return n?t+=e.slice(r):t=e,s<32?JSON.stringify(e):'"'+t+'"'}function yz(e,t,r,n){let s=this[O1],i=this[fg],o=this[T1],a=this[cz],l=this[w1],c=this[R1],u=this[I1],f=this[fz],p=this[dz],d=this[lz][r]+n;d=d+l;let h;u.log&&(e=u.log(e));let m=o[P1],y="";for(let v in e)if(h=e[v],Object.prototype.hasOwnProperty.call(e,v)&&h!==void 0){c[v]?h=c[v](h):v===p&&c.err&&(h=c.err(h));let _=o[v]||m;switch(typeof h){case"undefined":case"function":continue;case"number":Number.isFinite(h)===!1&&(h=null);case"boolean":_&&(h=_(h));break;case"string":h=(_||cg)(h);break;default:h=(_||s)(h,i)}if(h===void 0)continue;let g=cg(v);y+=","+g+":"+h}let b="";if(t!==void 0){h=c[f]?c[f](t):t;let v=o[f]||m;switch(typeof h){case"function":break;case"number":Number.isFinite(h)===!1&&(h=null);case"boolean":v&&(h=v(h)),b=',"'+f+'":'+h;break;case"string":h=(v||cg)(h),b=',"'+f+'":'+h;break;default:h=(v||s)(h,i),b=',"'+f+'":'+h}}return this[uz]&&y?d+this[hz]+y.slice(1)+"}"+b+a:d+y+b+a}function _z(e,t){let r,n=e[w1],s=e[O1],i=e[fg],o=e[T1],a=o[P1],l=e[R1],c=e[I1].bindings;t=c(t);for(let u in t)if(r=t[u],(u!=="level"&&u!=="serializers"&&u!=="formatters"&&u!=="customLevels"&&t.hasOwnProperty(u)&&r!==void 0)===!0){if(r=l[u]?l[u](r):r,r=(o[u]||a||s)(r,i),r===void 0)continue;n+=',"'+u+'":'+r}return n}function bz(e){return e.write!==e.constructor.prototype.write}var Sz=process.env.NODE_V8_COVERAGE||process.env.V8_COVERAGE;function ef(e){let t=new ug(e);return t.on("error",r),!Sz&&!e.sync&&pz&&(S1.register(t,vz),t.on("close",function(){S1.unregister(t)})),t;function r(n){if(n.code==="EPIPE"){t.write=Zi,t.end=Zi,t.flushSync=Zi,t.destroy=Zi;return}t.removeListener("error",r),t.emit("error",n)}}function vz(e,t){e.destroyed||(t==="beforeExit"?(e.flush(),e.on("drain",function(){e.end()})):e.flushSync())}function Ez(e){return function(r,n,s={},i){if(typeof s=="string")i=ef({dest:s}),s={};else if(typeof i=="string"){if(s&&s.transport)throw Error("only one of option.transport or stream can be specified");i=ef({dest:i})}else if(s instanceof ug||s.writable||s._writableState)i=s,s={};else if(s.transport){if(s.transport instanceof ug||s.transport.writable||s.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(s.transport.targets&&s.transport.targets.length&&s.formatters&&typeof s.formatters.level=="function")throw Error("option.transport.targets do not allow custom level formatters");let l;s.customLevels&&(l=s.useOnlyCustomLevels?s.customLevels:Object.assign({},s.levels,s.customLevels)),i=mz({caller:n,...s.transport,levels:l})}if(s=Object.assign({},e,s),s.serializers=Object.assign({},e.serializers,s.serializers),s.formatters=Object.assign({},e.formatters,s.formatters),s.prettyPrint)throw new Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:o,onChild:a}=s;return o===!1&&(s.level="silent"),a||(s.onChild=Zi),i||(bz(process.stdout)?i=process.stdout:i=ef({fd:process.stdout.fd||1})),{opts:s,stream:i}}}function wz(e,t){try{return JSON.stringify(e)}catch{try{return(t||this[fg])(e)}catch{return'"[unable to serialize, circular reference is too complex to analyze]"'}}}function Rz(e,t,r){return{level:e,bindings:t,log:r}}function Tz(e){let t=Number(e);return typeof e=="string"&&Number.isFinite(t)?t:e===void 0?1:e}A1.exports={noop:Zi,buildSafeSonicBoom:ef,asChindings:_z,asJson:yz,genLog:gz,createArgsNormalizer:Ez,stringify:wz,buildFormatters:Rz,normalizeDestFileDescriptor:Tz}});var rf=S((Rpe,C1)=>{var Oz={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},Pz={ASC:"ASC",DESC:"DESC"};C1.exports={DEFAULT_LEVELS:Oz,SORTING_ORDER:Pz}});var pg=S((Tpe,k1)=>{"use strict";var{lsCacheSym:Iz,levelValSym:dg,useOnlyCustomLevelsSym:Az,streamSym:Cz,formattersSym:Nz,hooksSym:$z,levelCompSym:N1}=Yi(),{noop:xz,genLog:Hs}=tf(),{DEFAULT_LEVELS:Br,SORTING_ORDER:$1}=rf(),x1={fatal:e=>{let t=Hs(Br.fatal,e);return function(...r){let n=this[Cz];if(t.call(this,...r),typeof n.flushSync=="function")try{n.flushSync()}catch{}}},error:e=>Hs(Br.error,e),warn:e=>Hs(Br.warn,e),info:e=>Hs(Br.info,e),debug:e=>Hs(Br.debug,e),trace:e=>Hs(Br.trace,e)},hg=Object.keys(Br).reduce((e,t)=>(e[Br[t]]=t,e),{}),kz=Object.keys(hg).reduce((e,t)=>(e[t]='{"level":'+Number(t),e),{});function Lz(e){let t=e[Nz].level,{labels:r}=e.levels,n={};for(let s in r){let i=t(r[s],Number(s));n[s]=JSON.stringify(i).slice(0,-1)}return e[Iz]=n,e}function Dz(e,t){if(t)return!1;switch(e){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}function qz(e){let{labels:t,values:r}=this.levels;if(typeof e=="number"){if(t[e]===void 0)throw Error("unknown level value"+e);e=t[e]}if(r[e]===void 0)throw Error("unknown level "+e);let n=this[dg],s=this[dg]=r[e],i=this[Az],o=this[N1],a=this[$z].logMethod;for(let l in r){if(o(r[l],s)===!1){this[l]=xz;continue}this[l]=Dz(l,i)?x1[l](a):Hs(r[l],a)}this.emit("level-change",e,s,t[n],n,this)}function Mz(e){let{levels:t,levelVal:r}=this;return t&&t.labels?t.labels[r]:""}function jz(e){let{values:t}=this.levels,r=t[e];return r!==void 0&&this[N1](r,this[dg])}function Fz(e,t,r){return e===$1.DESC?t<=r:t>=r}function Vz(e){return typeof e=="string"?Fz.bind(null,e):e}function Uz(e=null,t=!1){let r=e?Object.keys(e).reduce((i,o)=>(i[e[o]]=o,i),{}):null,n=Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),t?null:hg,r),s=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),t?null:Br,e);return{labels:n,values:s}}function Hz(e,t,r){if(typeof e=="number"){if(![].concat(Object.keys(t||{}).map(i=>t[i]),r?[]:Object.keys(hg).map(i=>+i),1/0).includes(e))throw Error(`default level:${e} must be included in custom levels`);return}let n=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),r?null:Br,t);if(!(e in n))throw Error(`default level:${e} must be included in custom levels`)}function Bz(e,t){let{labels:r,values:n}=e;for(let s in t){if(s in n)throw Error("levels cannot be overridden");if(t[s]in r)throw Error("pre-existing level values cannot be used for new levels")}}function zz(e){if(typeof e!="function"&&!(typeof e=="string"&&Object.values($1).includes(e)))throw new Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}k1.exports={initialLsCache:kz,genLsCache:Lz,levelMethods:x1,getLevel:Mz,setLevel:qz,isLevelEnabled:jz,mappings:Uz,assertNoLevelCollisions:Bz,assertDefaultLevelFound:Hz,genLevelComparison:Vz,assertLevelComparison:zz}});var mg=S((Ope,L1)=>{"use strict";L1.exports={version:"9.6.0"}});var G1=S((Ipe,z1)=>{"use strict";var{EventEmitter:Gz}=require("node:events"),{lsCacheSym:Wz,levelValSym:Kz,setLevelSym:yg,getLevelSym:D1,chindingsSym:_g,parsedChindingsSym:Jz,mixinSym:Yz,asJsonSym:V1,writeSym:Xz,mixinMergeStrategySym:Zz,timeSym:Qz,timeSliceIndexSym:e9,streamSym:U1,serializersSym:Bs,formattersSym:gg,errorKeySym:t9,messageKeySym:r9,useOnlyCustomLevelsSym:n9,needsMetadataGsym:s9,redactFmtSym:i9,stringifySym:o9,formatOptsSym:a9,stringifiersSym:l9,msgPrefixSym:q1,hooksSym:c9}=Yi(),{getLevel:u9,setLevel:f9,isLevelEnabled:d9,mappings:h9,initialLsCache:p9,genLsCache:m9,assertNoLevelCollisions:g9}=pg(),{asChindings:H1,asJson:y9,buildFormatters:M1,stringify:j1}=tf(),{version:_9}=mg(),b9=Jm(),S9=class{},B1={constructor:S9,child:v9,bindings:E9,setBindings:w9,flush:P9,isLevelEnabled:d9,version:_9,get level(){return this[D1]()},set level(e){this[yg](e)},get levelVal(){return this[Kz]},set levelVal(e){throw Error("levelVal is read-only")},[Wz]:p9,[Xz]:T9,[V1]:y9,[D1]:u9,[yg]:f9};Object.setPrototypeOf(B1,Gz.prototype);z1.exports=function(){return Object.create(B1)};var F1=e=>e;function v9(e,t){if(!e)throw Error("missing bindings for child Pino");t=t||{};let r=this[Bs],n=this[gg],s=Object.create(this);if(t.hasOwnProperty("serializers")===!0){s[Bs]=Object.create(null);for(let u in r)s[Bs][u]=r[u];let l=Object.getOwnPropertySymbols(r);for(var i=0;i<l.length;i++){let u=l[i];s[Bs][u]=r[u]}for(let u in t.serializers)s[Bs][u]=t.serializers[u];let c=Object.getOwnPropertySymbols(t.serializers);for(var o=0;o<c.length;o++){let u=c[o];s[Bs][u]=t.serializers[u]}}else s[Bs]=r;if(t.hasOwnProperty("formatters")){let{level:l,bindings:c,log:u}=t.formatters;s[gg]=M1(l||n.level,c||F1,u||n.log)}else s[gg]=M1(n.level,F1,n.log);if(t.hasOwnProperty("customLevels")===!0&&(g9(this.levels,t.customLevels),s.levels=h9(t.customLevels,s[n9]),m9(s)),typeof t.redact=="object"&&t.redact!==null||Array.isArray(t.redact)){s.redact=t.redact;let l=b9(s.redact,j1),c={stringify:l[i9]};s[o9]=j1,s[l9]=l,s[a9]=c}typeof t.msgPrefix=="string"&&(s[q1]=(this[q1]||"")+t.msgPrefix),s[_g]=H1(s,e);let a=t.level||this.level;return s[yg](a),this.onChild(s),s}function E9(){let t=`{${this[_g].substr(1)}}`,r=JSON.parse(t);return delete r.pid,delete r.hostname,r}function w9(e){let t=H1(this,e);this[_g]=t,delete this[Jz]}function R9(e,t){return Object.assign(t,e)}function T9(e,t,r){let n=this[Qz](),s=this[Yz],i=this[t9],o=this[r9],a=this[Zz]||R9,l,c=this[c9].streamWrite;e==null?l={}:e instanceof Error?(l={[i]:e},t===void 0&&(t=e.message)):(l=e,t===void 0&&e[o]===void 0&&e[i]&&(t=e[i].message)),s&&(l=a(l,s(l,r,this)));let u=this[V1](l,t,r,n),f=this[U1];f[s9]===!0&&(f.lastLevel=r,f.lastObj=l,f.lastMsg=t,f.lastTime=n.slice(this[e9]),f.lastLogger=this),f.write(c?c(u):u)}function O9(){}function P9(e){if(e!=null&&typeof e!="function")throw Error("callback must be a function");let t=this[U1];typeof t.flush=="function"?t.flush(e||O9):e&&e()}});var Y1=S((Eg,J1)=>{"use strict";var{hasOwnProperty:Wa}=Object.prototype,Gs=vg();Gs.configure=vg;Gs.stringify=Gs;Gs.default=Gs;Eg.stringify=Gs;Eg.configure=vg;J1.exports=Gs;var I9=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function Zn(e){return e.length<5e3&&!I9.test(e)?`"${e}"`:JSON.stringify(e)}function bg(e,t){if(e.length>200||t)return e.sort(t);for(let r=1;r<e.length;r++){let n=e[r],s=r;for(;s!==0&&e[s-1]>n;)e[s]=e[s-1],s--;e[s]=n}return e}var A9=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function Sg(e){return A9.call(e)!==void 0&&e.length!==0}function W1(e,t,r){e.length<r&&(r=e.length);let n=t===","?"":" ",s=`"0":${n}${e[0]}`;for(let i=1;i<r;i++)s+=`${t}"${i}":${n}${e[i]}`;return s}function C9(e){if(Wa.call(e,"circularValue")){let t=e.circularValue;if(typeof t=="string")return`"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function N9(e){let t;if(Wa.call(e,"deterministic")&&(t=e.deterministic,typeof t!="boolean"&&typeof t!="function"))throw new TypeError('The "deterministic" argument must be of type boolean or comparator function');return t===void 0?!0:t}function $9(e,t){let r;if(Wa.call(e,t)&&(r=e[t],typeof r!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return r===void 0?!0:r}function K1(e,t){let r;if(Wa.call(e,t)){if(r=e[t],typeof r!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(r))throw new TypeError(`The "${t}" argument must be an integer`);if(r<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return r===void 0?1/0:r}function zs(e){return e===1?"1 item":`${e} items`}function x9(e){let t=new Set;for(let r of e)(typeof r=="string"||typeof r=="number")&&t.add(String(r));return t}function k9(e){if(Wa.call(e,"strict")){let t=e.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return r=>{let n=`Object can not safely be stringified. Received type ${typeof r}`;throw typeof r!="function"&&(n+=` (${r.toString()})`),new Error(n)}}}function vg(e){e={...e};let t=k9(e);t&&(e.bigint===void 0&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));let r=C9(e),n=$9(e,"bigint"),s=N9(e),i=typeof s=="function"?s:void 0,o=K1(e,"maximumDepth"),a=K1(e,"maximumBreadth");function l(d,h,m,y,b,v){let _=h[d];switch(typeof _=="object"&&_!==null&&typeof _.toJSON=="function"&&(_=_.toJSON(d)),_=y.call(h,d,_),typeof _){case"string":return Zn(_);case"object":{if(_===null)return"null";if(m.indexOf(_)!==-1)return r;let g="",T=",",R=v;if(Array.isArray(_)){if(_.length===0)return"[]";if(o<m.length+1)return'"[Array]"';m.push(_),b!==""&&(v+=b,g+=`
${v}`,T=`,
${v}`);let C=Math.min(_.length,a),N=0;for(;N<C-1;N++){let se=l(String(N),_,m,y,b,v);g+=se!==void 0?se:"null",g+=T}let B=l(String(N),_,m,y,b,v);if(g+=B!==void 0?B:"null",_.length-1>a){let se=_.length-a-1;g+=`${T}"... ${zs(se)} not stringified"`}return b!==""&&(g+=`
${R}`),m.pop(),`[${g}]`}let w=Object.keys(_),P=w.length;if(P===0)return"{}";if(o<m.length+1)return'"[Object]"';let O="",A="";b!==""&&(v+=b,T=`,
${v}`,O=" ");let q=Math.min(P,a);s&&!Sg(_)&&(w=bg(w,i)),m.push(_);for(let C=0;C<q;C++){let N=w[C],B=l(N,_,m,y,b,v);B!==void 0&&(g+=`${A}${Zn(N)}:${O}${B}`,A=T)}if(P>a){let C=P-a;g+=`${A}"...":${O}"${zs(C)} not stringified"`,A=T}return b!==""&&A.length>1&&(g=`
${v}${g}
${R}`),m.pop(),`{${g}}`}case"number":return isFinite(_)?String(_):t?t(_):"null";case"boolean":return _===!0?"true":"false";case"undefined":return;case"bigint":if(n)return String(_);default:return t?t(_):void 0}}function c(d,h,m,y,b,v){switch(typeof h=="object"&&h!==null&&typeof h.toJSON=="function"&&(h=h.toJSON(d)),typeof h){case"string":return Zn(h);case"object":{if(h===null)return"null";if(m.indexOf(h)!==-1)return r;let _=v,g="",T=",";if(Array.isArray(h)){if(h.length===0)return"[]";if(o<m.length+1)return'"[Array]"';m.push(h),b!==""&&(v+=b,g+=`
${v}`,T=`,
${v}`);let P=Math.min(h.length,a),O=0;for(;O<P-1;O++){let q=c(String(O),h[O],m,y,b,v);g+=q!==void 0?q:"null",g+=T}let A=c(String(O),h[O],m,y,b,v);if(g+=A!==void 0?A:"null",h.length-1>a){let q=h.length-a-1;g+=`${T}"... ${zs(q)} not stringified"`}return b!==""&&(g+=`
${_}`),m.pop(),`[${g}]`}m.push(h);let R="";b!==""&&(v+=b,T=`,
${v}`,R=" ");let w="";for(let P of y){let O=c(P,h[P],m,y,b,v);O!==void 0&&(g+=`${w}${Zn(P)}:${R}${O}`,w=T)}return b!==""&&w.length>1&&(g=`
${v}${g}
${_}`),m.pop(),`{${g}}`}case"number":return isFinite(h)?String(h):t?t(h):"null";case"boolean":return h===!0?"true":"false";case"undefined":return;case"bigint":if(n)return String(h);default:return t?t(h):void 0}}function u(d,h,m,y,b){switch(typeof h){case"string":return Zn(h);case"object":{if(h===null)return"null";if(typeof h.toJSON=="function"){if(h=h.toJSON(d),typeof h!="object")return u(d,h,m,y,b);if(h===null)return"null"}if(m.indexOf(h)!==-1)return r;let v=b;if(Array.isArray(h)){if(h.length===0)return"[]";if(o<m.length+1)return'"[Array]"';m.push(h),b+=y;let O=`
${b}`,A=`,
${b}`,q=Math.min(h.length,a),C=0;for(;C<q-1;C++){let B=u(String(C),h[C],m,y,b);O+=B!==void 0?B:"null",O+=A}let N=u(String(C),h[C],m,y,b);if(O+=N!==void 0?N:"null",h.length-1>a){let B=h.length-a-1;O+=`${A}"... ${zs(B)} not stringified"`}return O+=`
${v}`,m.pop(),`[${O}]`}let _=Object.keys(h),g=_.length;if(g===0)return"{}";if(o<m.length+1)return'"[Object]"';b+=y;let T=`,
${b}`,R="",w="",P=Math.min(g,a);Sg(h)&&(R+=W1(h,T,a),_=_.slice(h.length),P-=h.length,w=T),s&&(_=bg(_,i)),m.push(h);for(let O=0;O<P;O++){let A=_[O],q=u(A,h[A],m,y,b);q!==void 0&&(R+=`${w}${Zn(A)}: ${q}`,w=T)}if(g>a){let O=g-a;R+=`${w}"...": "${zs(O)} not stringified"`,w=T}return w!==""&&(R=`
${b}${R}
${v}`),m.pop(),`{${R}}`}case"number":return isFinite(h)?String(h):t?t(h):"null";case"boolean":return h===!0?"true":"false";case"undefined":return;case"bigint":if(n)return String(h);default:return t?t(h):void 0}}function f(d,h,m){switch(typeof h){case"string":return Zn(h);case"object":{if(h===null)return"null";if(typeof h.toJSON=="function"){if(h=h.toJSON(d),typeof h!="object")return f(d,h,m);if(h===null)return"null"}if(m.indexOf(h)!==-1)return r;let y="",b=h.length!==void 0;if(b&&Array.isArray(h)){if(h.length===0)return"[]";if(o<m.length+1)return'"[Array]"';m.push(h);let R=Math.min(h.length,a),w=0;for(;w<R-1;w++){let O=f(String(w),h[w],m);y+=O!==void 0?O:"null",y+=","}let P=f(String(w),h[w],m);if(y+=P!==void 0?P:"null",h.length-1>a){let O=h.length-a-1;y+=`,"... ${zs(O)} not stringified"`}return m.pop(),`[${y}]`}let v=Object.keys(h),_=v.length;if(_===0)return"{}";if(o<m.length+1)return'"[Object]"';let g="",T=Math.min(_,a);b&&Sg(h)&&(y+=W1(h,",",a),v=v.slice(h.length),T-=h.length,g=","),s&&(v=bg(v,i)),m.push(h);for(let R=0;R<T;R++){let w=v[R],P=f(w,h[w],m);P!==void 0&&(y+=`${g}${Zn(w)}:${P}`,g=",")}if(_>a){let R=_-a;y+=`${g}"...":"${zs(R)} not stringified"`}return m.pop(),`{${y}}`}case"number":return isFinite(h)?String(h):t?t(h):"null";case"boolean":return h===!0?"true":"false";case"undefined":return;case"bigint":if(n)return String(h);default:return t?t(h):void 0}}function p(d,h,m){if(arguments.length>1){let y="";if(typeof m=="number"?y=" ".repeat(Math.min(m,10)):typeof m=="string"&&(y=m.slice(0,10)),h!=null){if(typeof h=="function")return l("",{"":d},[],h,y,"");if(Array.isArray(h))return c("",d,[],x9(h),y,"")}if(y.length!==0)return u("",d,[],y,"")}return f("",d,[])}return p}});var Q1=S((Ape,Z1)=>{"use strict";var wg=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:X1}=rf(),L9=X1.info;function D9(e,t){let r=0;e=e||[],t=t||{dedupe:!1};let n=Object.create(X1);n.silent=1/0,t.levels&&typeof t.levels=="object"&&Object.keys(t.levels).forEach(f=>{n[f]=t.levels[f]});let s={write:i,add:l,emit:o,flushSync:a,end:c,minLevel:0,streams:[],clone:u,[wg]:!0,streamLevels:n};return Array.isArray(e)?e.forEach(l,s):l.call(s,e),e=null,s;function i(f){let p,d=this.lastLevel,{streams:h}=this,m=0,y;for(let b=M9(h.length,t.dedupe);F9(b,h.length,t.dedupe);b=j9(b,t.dedupe))if(p=h[b],p.level<=d){if(m!==0&&m!==p.level)break;if(y=p.stream,y[wg]){let{lastTime:v,lastMsg:_,lastObj:g,lastLogger:T}=this;y.lastLevel=d,y.lastTime=v,y.lastMsg=_,y.lastObj=g,y.lastLogger=T}y.write(f),t.dedupe&&(m=p.level)}else if(!t.dedupe)break}function o(...f){for(let{stream:p}of this.streams)typeof p.emit=="function"&&p.emit(...f)}function a(){for(let{stream:f}of this.streams)typeof f.flushSync=="function"&&f.flushSync()}function l(f){if(!f)return s;let p=typeof f.write=="function"||f.stream,d=f.write?f:f.stream;if(!p)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:h,streamLevels:m}=this,y;typeof f.levelVal=="number"?y=f.levelVal:typeof f.level=="string"?y=m[f.level]:typeof f.level=="number"?y=f.level:y=L9;let b={stream:d,level:y,levelVal:void 0,id:r++};return h.unshift(b),h.sort(q9),this.minLevel=h[0].level,s}function c(){for(let{stream:f}of this.streams)typeof f.flushSync=="function"&&f.flushSync(),f.end()}function u(f){let p=new Array(this.streams.length);for(let d=0;d<p.length;d++)p[d]={level:f,stream:this.streams[d].stream};return{write:i,add:l,minLevel:f,streams:p,clone:u,emit:o,flushSync:a,[wg]:!0}}}function q9(e,t){return e.level-t.level}function M9(e,t){return t?e-1:0}function j9(e,t){return t?e-1:e+1}function F9(e,t,r){return r?e>=0:e<t}Z1.exports=D9});var hP=S((Cpe,ur)=>{"use strict";var V9=require("node:os"),aP=Vm(),U9=Um(),H9=Jm(),lP=GO(),B9=G1(),cP=Yi(),{configure:z9}=Y1(),{assertDefaultLevelFound:G9,mappings:uP,genLsCache:W9,genLevelComparison:K9,assertLevelComparison:J9}=pg(),{DEFAULT_LEVELS:fP,SORTING_ORDER:Y9}=rf(),{createArgsNormalizer:X9,asChindings:Z9,buildSafeSonicBoom:eP,buildFormatters:Q9,stringify:Rg,normalizeDestFileDescriptor:tP,noop:e8}=tf(),{version:t8}=mg(),{chindingsSym:rP,redactFmtSym:r8,serializersSym:nP,timeSym:n8,timeSliceIndexSym:s8,streamSym:i8,stringifySym:sP,stringifySafeSym:Tg,stringifiersSym:iP,setLevelSym:o8,endSym:a8,formatOptsSym:l8,messageKeySym:c8,errorKeySym:u8,nestedKeySym:f8,mixinSym:d8,levelCompSym:h8,useOnlyCustomLevelsSym:p8,formattersSym:oP,hooksSym:m8,nestedKeyStrSym:g8,mixinMergeStrategySym:y8,msgPrefixSym:_8}=cP,{epochTime:dP,nullTime:b8}=lP,{pid:S8}=process,v8=V9.hostname(),E8=aP.err,w8={level:"info",levelComparison:Y9.ASC,levels:fP,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:S8,hostname:v8},serializers:Object.assign(Object.create(null),{err:E8}),formatters:Object.assign(Object.create(null),{bindings(e){return e},level(e,t){return{level:t}}}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:dP,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100},R8=X9(w8),T8=Object.assign(Object.create(null),aP);function Og(...e){let t={},{opts:r,stream:n}=R8(t,U9(),...e);r.level&&typeof r.level=="string"&&fP[r.level.toLowerCase()]!==void 0&&(r.level=r.level.toLowerCase());let{redact:s,crlf:i,serializers:o,timestamp:a,messageKey:l,errorKey:c,nestedKey:u,base:f,name:p,level:d,customLevels:h,levelComparison:m,mixin:y,mixinMergeStrategy:b,useOnlyCustomLevels:v,formatters:_,hooks:g,depthLimit:T,edgeLimit:R,onChild:w,msgPrefix:P}=r,O=z9({maximumDepth:T,maximumBreadth:R}),A=Q9(_.level,_.bindings,_.log),q=Rg.bind({[Tg]:O}),C=s?H9(s,q):{},N=s?{stringify:C[r8]}:{stringify:q},B="}"+(i?`\r
`:`
`),se=Z9.bind(null,{[rP]:"",[nP]:o,[iP]:C,[sP]:Rg,[Tg]:O,[oP]:A}),D="";f!==null&&(p===void 0?D=se(f):D=se(Object.assign({},f,{name:p})));let K=a instanceof Function?a:a?dP:b8,ut=K().indexOf(":")+1;if(v&&!h)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(y&&typeof y!="function")throw Error(`Unknown mixin type "${typeof y}" - expected "function"`);if(P&&typeof P!="string")throw Error(`Unknown msgPrefix type "${typeof P}" - expected "string"`);G9(d,h,v);let U=uP(h,v);typeof n.emit=="function"&&n.emit("message",{code:"PINO_CONFIG",config:{levels:U,messageKey:l,errorKey:c}}),J9(m);let it=K9(m);return Object.assign(t,{levels:U,[h8]:it,[p8]:v,[i8]:n,[n8]:K,[s8]:ut,[sP]:Rg,[Tg]:O,[iP]:C,[a8]:B,[l8]:N,[c8]:l,[u8]:c,[f8]:u,[g8]:u?`,${JSON.stringify(u)}:{`:"",[nP]:o,[d8]:y,[y8]:b,[rP]:D,[oP]:A,[m8]:g,silent:e8,onChild:w,[_8]:P}),Object.setPrototypeOf(t,B9()),W9(t),t[o8](d),t}ur.exports=Og;ur.exports.destination=(e=process.stdout.fd)=>typeof e=="object"?(e.dest=tP(e.dest||process.stdout.fd),eP(e)):eP({dest:tP(e),minLength:0});ur.exports.transport=lg();ur.exports.multistream=Q1();ur.exports.levels=uP();ur.exports.stdSerializers=T8;ur.exports.stdTimeFunctions=Object.assign({},lP);ur.exports.symbols=cP;ur.exports.version=t8;ur.exports.default=Og;ur.exports.pino=Og});var gP=S((Npe,mP)=>{"use strict";var nf=hP(),{serializersSym:pP}=nf.symbols,{FST_ERR_LOG_INVALID_DESTINATION:O8}=pt();function P8(e){if(e.stream&&e.file)throw new O8;e.file&&(e.stream=nf.destination(e.file),delete e.file);let t=e.logger,r=e.genReqId,n=null;return t?(e.logger=void 0,e.genReqId=void 0,t[pP]&&(e.serializers=Object.assign({},e.serializers,t[pP])),n=t.child({},e),e.logger=t,e.genReqId=r):n=nf(e,e.stream),n}var I8={req:function(t){return{method:t.method,url:t.url,version:t.headers&&t.headers["accept-version"],host:t.host,remoteAddress:t.ip,remotePort:t.socket?t.socket.remotePort:void 0}},err:nf.stdSerializers.err,res:function(t){return{statusCode:t.statusCode}}};mP.exports={serializers:I8,createPinoLogger:P8}});var Ka=S(($pe,_P)=>{"use strict";var{FST_ERR_LOG_LOGGER_AND_LOGGER_INSTANCE_PROVIDED:A8,FST_ERR_LOG_INVALID_LOGGER_CONFIG:C8,FST_ERR_LOG_INVALID_LOGGER_INSTANCE:N8,FST_ERR_LOG_INVALID_LOGGER:$8}=pt();function x8(e,t,r,n,s){let i={[e.requestIdLogLabel]:n},o=e.childLoggerFactory.call(e.server,t,i,s||{},r);return e.childLoggerFactory!==yP&&sf(o,!0),o}function yP(e,t,r){return e.child(t,r)}function sf(e,t){let r=["info","error","debug","fatal","warn","trace","child"],n=e?r.filter(s=>!e[s]||typeof e[s]!="function"):r;if(n.length){if(n.length===r.length&&!t)return!1;throw $8(n.join(","))}else return!0}function k8(e){if(e.logger&&e.loggerInstance)throw new A8;if(!e.loggerInstance&&!e.logger){let o=rO();return o.child=()=>o,{logger:o,hasLogger:!1}}let{createPinoLogger:t,serializers:r}=gP();if(sf(e.loggerInstance))return{logger:t({logger:e.loggerInstance,serializers:Object.assign({},r,e.loggerInstance.serializers)}),hasLogger:!0};if(sf(e.logger))throw C8();if(e.loggerInstance)throw N8();let n={};return Object.prototype.toString.call(e.logger)==="[object Object]"&&Reflect.ownKeys(e.logger).forEach(i=>{Object.defineProperty(n,i,{value:e.logger[i],writable:!0,enumerable:!0,configurable:!0})}),n.level=n.level||"info",n.serializers=Object.assign({},r,n.serializers),e.logger=n,{logger:t(e.logger),hasLogger:!0}}function L8(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}_P.exports={createChildLogger:x8,defaultChildLoggerFactory:yP,createLogger:k8,validateLogger:sf,now:L8}});var of=S((xpe,bP)=>{"use strict";bP.exports=D8;function Qi(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}function D8(e){if(e=e||{},e.circles)return q8(e);let t=new Map;if(t.set(Date,o=>new Date(o)),t.set(Map,(o,a)=>new Map(n(Array.from(o),a))),t.set(Set,(o,a)=>new Set(n(Array.from(o),a))),e.constructorHandlers)for(let o of e.constructorHandlers)t.set(o[0],o[1]);let r=null;return e.proto?i:s;function n(o,a){let l=Object.keys(o),c=new Array(l.length);for(let u=0;u<l.length;u++){let f=l[u],p=o[f];typeof p!="object"||p===null?c[f]=p:p.constructor!==Object&&(r=t.get(p.constructor))?c[f]=r(p,a):ArrayBuffer.isView(p)?c[f]=Qi(p):c[f]=a(p)}return c}function s(o){if(typeof o!="object"||o===null)return o;if(Array.isArray(o))return n(o,s);if(o.constructor!==Object&&(r=t.get(o.constructor)))return r(o,s);let a={};for(let l in o){if(Object.hasOwnProperty.call(o,l)===!1)continue;let c=o[l];typeof c!="object"||c===null?a[l]=c:c.constructor!==Object&&(r=t.get(c.constructor))?a[l]=r(c,s):ArrayBuffer.isView(c)?a[l]=Qi(c):a[l]=s(c)}return a}function i(o){if(typeof o!="object"||o===null)return o;if(Array.isArray(o))return n(o,i);if(o.constructor!==Object&&(r=t.get(o.constructor)))return r(o,i);let a={};for(let l in o){let c=o[l];typeof c!="object"||c===null?a[l]=c:c.constructor!==Object&&(r=t.get(c.constructor))?a[l]=r(c,i):ArrayBuffer.isView(c)?a[l]=Qi(c):a[l]=i(c)}return a}}function q8(e){let t=[],r=[],n=new Map;if(n.set(Date,l=>new Date(l)),n.set(Map,(l,c)=>new Map(i(Array.from(l),c))),n.set(Set,(l,c)=>new Set(i(Array.from(l),c))),e.constructorHandlers)for(let l of e.constructorHandlers)n.set(l[0],l[1]);let s=null;return e.proto?a:o;function i(l,c){let u=Object.keys(l),f=new Array(u.length);for(let p=0;p<u.length;p++){let d=u[p],h=l[d];if(typeof h!="object"||h===null)f[d]=h;else if(h.constructor!==Object&&(s=n.get(h.constructor)))f[d]=s(h,c);else if(ArrayBuffer.isView(h))f[d]=Qi(h);else{let m=t.indexOf(h);m!==-1?f[d]=r[m]:f[d]=c(h)}}return f}function o(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return i(l,o);if(l.constructor!==Object&&(s=n.get(l.constructor)))return s(l,o);let c={};t.push(l),r.push(c);for(let u in l){if(Object.hasOwnProperty.call(l,u)===!1)continue;let f=l[u];if(typeof f!="object"||f===null)c[u]=f;else if(f.constructor!==Object&&(s=n.get(f.constructor)))c[u]=s(f,o);else if(ArrayBuffer.isView(f))c[u]=Qi(f);else{let p=t.indexOf(f);p!==-1?c[u]=r[p]:c[u]=o(f)}}return t.pop(),r.pop(),c}function a(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return i(l,a);if(l.constructor!==Object&&(s=n.get(l.constructor)))return s(l,a);let c={};t.push(l),r.push(c);for(let u in l){let f=l[u];if(typeof f!="object"||f===null)c[u]=f;else if(f.constructor!==Object&&(s=n.get(f.constructor)))c[u]=s(f,a);else if(ArrayBuffer.isView(f))c[u]=Qi(f);else{let p=t.indexOf(f);p!==-1?c[u]=r[p]:c[u]=a(f)}}return t.pop(),r.pop(),c}}});var Ja=S((kpe,RP)=>{"use strict";var M8=of()({circles:!1,proto:!0}),{kSchemaVisited:SP,kSchemaResponse:j8}=at(),Pg=Symbol.for("fluent-schema-object"),{FST_ERR_SCH_MISSING_ID:F8,FST_ERR_SCH_ALREADY_PRESENT:V8,FST_ERR_SCH_DUPLICATE:U8,FST_ERR_SCH_CONTENT_MISSING_SCHEMA:vP}=pt(),wP=["params","body","querystring","query","headers"];function af(e){this.store=e||{}}af.prototype.add=function(e){let t=M8(e.isFluentSchema||e.isFluentJSONSchema||e[Pg]?e.valueOf():e),r=t.$id;if(!r)throw new F8;if(this.store[r])throw new V8(r);this.store[r]=t};af.prototype.getSchemas=function(){return Object.assign({},this.store)};af.prototype.getSchema=function(e){return this.store[e]};function EP(e){return typeof e=="object"&&Object.getPrototypeOf(e)!==Object.prototype}function H8(e,t){if(e[SP])return e;if(e.query){if(e.querystring)throw new U8("querystring");e.querystring=e.query}B8(e);for(let r of wP){let n=e[r];if(n&&!EP(n)&&r==="body"&&n.content){let s=n.content,i=Object.keys(s);for(let o=0;o<i.length;o++){let a=i[o];if(!s[a].schema)throw new vP(a)}continue}}if(e.response){let r=Object.keys(e.response);for(let n of r){if(EP(e.response[n]))continue;let s=e.response[n].content;if(s){let i=Object.keys(s);for(let o=0;o<i.length;o++){let a=i[o];if(!s[a].schema)throw new vP(a)}}}}return e[SP]=!0,e}function B8(e){for(let t of wP)e[t]&&(e[t].isFluentSchema||e[t][Pg])&&(e[t]=e[t].valueOf());if(e.response){let t=Object.keys(e.response);for(let r of t)(e.response[r].isFluentSchema||e.response[r][Pg])&&(e.response[r]=e.response[r].valueOf())}}function z8(e,t,r){let n=e[j8];if(!n)return!1;if(n[t]){if(n[t].constructor===Object&&r){let i=r.split(";",1)[0];return n[t][i]?n[t][i]:n[t]["*/*"]?n[t]["*/*"]:!1}return n[t]}let s=(t+"")[0]+"xx";if(n[s]){if(n[s].constructor===Object&&r){let i=r.split(";",1)[0];return n[s][i]?n[s][i]:n[s]["*/*"]?n[s]["*/*"]:!1}return n[s]}if(n.default){if(n.default.constructor===Object&&r){let i=r.split(";",1)[0];return n.default[i]?n.default[i]:n.default["*/*"]?n.default["*/*"]:!1}return n.default}return!1}RP.exports={buildSchemas(e){return new af(e)},getSchemaSerializer:z8,normalizeSchema:H8}});var lf=S((Lpe,OP)=>{"use strict";var G8=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;OP.exports=class TP{constructor(t){switch(t&&t.rounding){case"floor":this.parseInteger=Math.floor;break;case"ceil":this.parseInteger=Math.ceil;break;case"round":this.parseInteger=Math.round;break;case"trunc":default:this.parseInteger=Math.trunc;break}this._options=t}asInteger(t){if(Number.isInteger(t))return""+t;if(typeof t=="bigint")return t.toString();let r=this.parseInteger(t);if(r===1/0||r===-1/0||r!==r)throw new Error(`The value "${t}" cannot be converted to an integer.`);return""+r}asNumber(t){let r=Number(t);if(r!==r)throw new Error(`The value "${t}" cannot be converted to a number.`);return r===1/0||r===-1/0?"null":""+r}asBoolean(t){return t&&"true"||"false"}asDateTime(t){if(t===null)return'""';if(t instanceof Date)return'"'+t.toISOString()+'"';if(typeof t=="string")return'"'+t+'"';throw new Error(`The value "${t}" cannot be converted to a date-time.`)}asDate(t){if(t===null)return'""';if(t instanceof Date)return'"'+new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)+'"';if(typeof t=="string")return'"'+t+'"';throw new Error(`The value "${t}" cannot be converted to a date.`)}asTime(t){if(t===null)return'""';if(t instanceof Date)return'"'+new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(11,19)+'"';if(typeof t=="string")return'"'+t+'"';throw new Error(`The value "${t}" cannot be converted to a time.`)}asString(t){let r=t.length;if(r<42){let n="",s=-1,i=255;for(let o=0;o<r;o++)if(i=t.charCodeAt(o),i===34||i===92)s===-1&&(s=0),n+=t.slice(s,o)+"\\",s=o;else if(i<32||i>=55296&&i<=57343)return JSON.stringify(t);return s===-1&&'"'+t+'"'||'"'+n+t.slice(s)+'"'}else return r<5e3&&G8.test(t)===!1?'"'+t+'"':JSON.stringify(t)}asUnsafeString(t){return'"'+t+'"'}getState(){return this._options}static restoreFromState(t){return new TP(t)}}});var IP=S((Dpe,PP)=>{"use strict";var W8=lf(),K8={mode:"standalone"},J8=W8.restoreFromState(K8),Y8=null;PP.exports=function(t,r){let n="{",s="}",i="[",o="]",a=",",l=":",c='"',u=n+s,f=i+o,p=c+c,d="null";function h(y){let b=y&&typeof y.toJSON=="function"?y.toJSON():y;if(b===null)return u;let v,_=n,g=!1;return v=b.statusCode,v!==void 0&&(!g&&(g=!0)||(_+=a),_+='"statusCode":',_+=r.asNumber(v)),v=b.code,v!==void 0&&(!g&&(g=!0)||(_+=a),_+='"code":',typeof v!="string"?v===null?_+=p:v instanceof Date?_+=c+v.toISOString()+c:v instanceof RegExp?_+=r.asString(v.source):_+=r.asString(v.toString()):_+=r.asString(v)),v=b.error,v!==void 0&&(!g&&(g=!0)||(_+=a),_+='"error":',typeof v!="string"?v===null?_+=p:v instanceof Date?_+=c+v.toISOString()+c:v instanceof RegExp?_+=r.asString(v.source):_+=r.asString(v.toString()):_+=r.asString(v)),v=b.message,v!==void 0&&(!g&&(g=!0)||(_+=a),_+='"message":',typeof v!="string"?v===null?_+=p:v instanceof Date?_+=c+v.toISOString()+c:v instanceof RegExp?_+=r.asString(v.source):_+=r.asString(v.toString()):_+=r.asString(v)),_+s}return h}(Y8,J8)});var Ya=S((qpe,$P)=>{"use strict";var AP=require("node:http").STATUS_CODES,X8=Pm(),{kReplyHeaders:Ws,kReplyNextErrorHandler:cf,kReplyIsRunningOnErrorHook:Z8,kReplyHasStatusCode:Q8,kRouteContext:NP,kDisableRequestLogging:uf}=at(),{FST_ERR_REP_INVALID_PAYLOAD_TYPE:e6,FST_ERR_FAILED_ERROR_SERIALIZATION:t6}=pt(),{getSchemaSerializer:r6}=Ja(),Ig=IP(),n6={func:i6,toJSON(){return this.func.name.toString()+"()"}};function s6(e,t,r){e[Z8]=!1;let n=e[NP];if(e[cf]===!1){CP(t,e,function(o,a){try{o.raw.writeHead(o.raw.statusCode,o[Ws])}catch(l){o.log[uf]||o.log.warn({req:o.request,res:o,err:l},l&&l.message),o.raw.writeHead(o.raw.statusCode)}o.raw.end(a)});return}let s=e[cf]||n.errorHandler;e[cf]=Object.getPrototypeOf(s),delete e[Ws]["content-type"],delete e[Ws]["content-length"];let i=s.func;if(!i){e[cf]=!1,CP(t,e,r);return}try{let o=i(t,e.request,e);o!==void 0&&(o!==null&&typeof o.then=="function"?X8(o,e):e.send(o))}catch(o){e.send(o)}}function i6(e,t,r){if(a6(e,r),!r[Q8]||r.statusCode===200){let n=e.statusCode||e.status;r.code(n>=400?n:500)}r.statusCode<500?r.log[uf]||r.log.info({res:r,err:e},e&&e.message):r.log[uf]||r.log.error({req:t,res:r,err:e},e&&e.message),r.send(e)}function CP(e,t,r){let n=t.raw,s=t.statusCode;t[Ws]["content-type"]=t[Ws]["content-type"]??"application/json; charset=utf-8";let i;try{let o=r6(t[NP],s,t[Ws]["content-type"]);o===!1?i=Ig({error:AP[s+""],code:e.code,message:e.message,statusCode:s}):i=o(Object.create(e,{error:{value:AP[s+""]},message:{value:e.message},statusCode:{value:s}}))}catch(o){t.log[uf]||t.log.error({err:o,statusCode:n.statusCode},"The serializer for the given status code failed"),t.code(500),i=Ig(new t6(o.message,e.message))}typeof i!="string"&&!Buffer.isBuffer(i)&&(i=Ig(new e6(typeof i))),t[Ws]["content-length"]=""+Buffer.byteLength(i),r(t,i)}function o6(e=n6,t){if(!t)return e;let r=Object.create(e);return r.func=t,r}function a6(e,t){let r=t.raw,n=r.statusCode;n=n>=400?n:500,e!=null&&(e.headers!==void 0&&t.headers(e.headers),e.status>=400?n=e.status:e.statusCode>=400&&(n=e.statusCode)),r.statusCode=n}$P.exports={buildErrorHandler:o6,handleError:s6}});var gf=S((Mpe,mf)=>{"use strict";var $g=require("node:stream").finished,l6=require("node:stream").Readable,{kFourOhFourContext:xP,kReplyErrorHandlerCalled:FP,kReplyHijacked:kg,kReplyStartTime:Xa,kReplyEndTime:Lg,kReplySerializer:_n,kReplySerializerDefault:df,kReplyIsError:hf,kReplyHeaders:Oe,kReplyTrailers:lt,kReplyHasStatusCode:Dg,kReplyIsRunningOnErrorHook:qg,kReplyNextErrorHandler:c6,kDisableRequestLogging:VP,kSchemaResponse:pf,kReplyCacheSerializeFns:Qn,kSchemaController:Ag,kOptions:u6,kRouteContext:oe}=at(),{onSendHookRunner:UP,onResponseHookRunner:f6,preHandlerHookRunner:d6,preSerializationHookRunner:h6}=Yn(),kP=Nm()[Symbol.for("internals")],p6=Ka(),xg=p6.now,{handleError:LP}=Ya(),{getSchemaSerializer:m6}=Ja(),Cg={JSON:"application/json; charset=utf-8",PLAIN:"text/plain; charset=utf-8",OCTET:"application/octet-stream"},{FST_ERR_REP_INVALID_PAYLOAD_TYPE:g6,FST_ERR_REP_RESPONSE_BODY_CONSUMED:y6,FST_ERR_REP_READABLE_STREAM_LOCKED:_6,FST_ERR_REP_ALREADY_SENT:b6,FST_ERR_SEND_INSIDE_ONERR:S6,FST_ERR_BAD_STATUS_CODE:v6,FST_ERR_BAD_TRAILER_NAME:E6,FST_ERR_BAD_TRAILER_VALUE:w6,FST_ERR_MISSING_SERIALIZATION_FN:R6,FST_ERR_MISSING_CONTENTTYPE_SERIALIZATION_FN:T6}=pt(),HP=Object.prototype.toString;function we(e,t,r){this.raw=e,this[_n]=null,this[FP]=!1,this[hf]=!1,this[qg]=!1,this.request=t,this[Oe]={},this[lt]=null,this[Dg]=!1,this[Xa]=void 0,this.log=r}we.props=[];Object.defineProperties(we.prototype,{[oe]:{get(){return this.request[oe]}},elapsedTime:{get(){return this[Xa]===void 0?0:(this[Lg]||xg())-this[Xa]}},server:{get(){return this.request[oe].server}},sent:{enumerable:!0,get(){return(this[kg]||this.raw.writableEnded)===!0}},statusCode:{get(){return this.raw.statusCode},set(e){this.code(e)}},routeOptions:{get(){return this.request.routeOptions}}});we.prototype.writeEarlyHints=function(e,t){return this.raw.writeEarlyHints(e,t),this};we.prototype.hijack=function(){return this[kg]=!0,this};we.prototype.send=function(e){if(this[qg]===!0)throw new S6;if(this.sent)return this.log.warn({err:new b6(this.request.url,this.request.method)}),this;if(e instanceof Error||this[hf]===!0)return this[hf]=!1,Za(this,e,Ks),this;if(e===void 0)return Ks(this,e),this;let t=this.getHeader("content-type"),r=t!==void 0;if(e!==null){if(typeof e.pipe=="function"||typeof e.getReader=="function"||HP.call(e)==="[object Response]")return Ks(this,e),this;if(e?.buffer instanceof ArrayBuffer){r===!1&&(this[Oe]["content-type"]=Cg.OCTET);let n=Buffer.isBuffer(e)?e:Buffer.from(e.buffer,e.byteOffset,e.byteLength);return Ks(this,n),this}if(r===!1&&typeof e=="string")return this[Oe]["content-type"]=Cg.PLAIN,Ks(this,e),this}if(this[_n]!==null){if(typeof e!="string")return DP(this,e),this;e=this[_n](e)}else if(r===!1||t.indexOf("json")>-1){if(r===!1)this[Oe]["content-type"]=Cg.JSON;else if(t.indexOf("charset")===-1){let n=t.trim();n.endsWith(";")?this[Oe]["content-type"]=`${n} charset=utf-8`:this[Oe]["content-type"]=`${n}; charset=utf-8`}if(typeof e!="string")return DP(this,e),this}return Ks(this,e),this};we.prototype.getHeader=function(e){e=e.toLowerCase();let t=this.raw,r=this[Oe][e];return r===void 0&&t.hasHeader(e)&&(r=t.getHeader(e)),r};we.prototype.getHeaders=function(){return{...this.raw.getHeaders(),...this[Oe]}};we.prototype.hasHeader=function(e){return e=e.toLowerCase(),this[Oe][e]!==void 0||this.raw.hasHeader(e)};we.prototype.removeHeader=function(e){return delete this[Oe][e.toLowerCase()],this};we.prototype.header=function(e,t=""){return e=e.toLowerCase(),this[Oe][e]&&e==="set-cookie"?(typeof this[Oe][e]=="string"&&(this[Oe][e]=[this[Oe][e]]),Array.isArray(t)?Array.prototype.push.apply(this[Oe][e],t):this[Oe][e].push(t)):this[Oe][e]=t,this};we.prototype.headers=function(e){let t=Object.keys(e);for(let r=0;r!==t.length;++r){let n=t[r];this.header(n,e[n])}return this};var O6=new Set(["transfer-encoding","content-length","host","cache-control","max-forwards","te","authorization","set-cookie","content-encoding","content-type","content-range","trailer"]);we.prototype.trailer=function(e,t){if(e=e.toLowerCase(),O6.has(e))throw new E6(e);if(typeof t!="function")throw new w6(e,typeof t);return this[lt]===null&&(this[lt]={}),this[lt][e]=t,this};we.prototype.hasTrailer=function(e){return this[lt]?.[e.toLowerCase()]!==void 0};we.prototype.removeTrailer=function(e){return this[lt]===null?this:(this[lt][e.toLowerCase()]=void 0,this)};we.prototype.code=function(e){let t=Number(e);if(isNaN(t)||t<100||t>599)throw new v6(e||String(e));return this.raw.statusCode=t,this[Dg]=!0,this};we.prototype.status=we.prototype.code;we.prototype.getSerializationFunction=function(e,t){let r;return typeof e=="string"||typeof e=="number"?typeof t=="string"?r=this[oe][pf]?.[e]?.[t]:r=this[oe][pf]?.[e]:typeof e=="object"&&(r=this[oe][Qn]?.get(e)),r};we.prototype.compileSerializationSchema=function(e,t=null,r=null){let{request:n}=this,{method:s,url:i}=n;if(this[oe][Qn]?.has(e))return this[oe][Qn].get(e);let a=(this[oe].serializerCompiler||this.server[Ag].serializerCompiler||this.server[Ag].setupSerializer(this.server[u6])||this.server[Ag].serializerCompiler)({schema:e,method:s,url:i,httpStatus:t,contentType:r});return this[oe][Qn]==null&&(this[oe][Qn]=new WeakMap),this[oe][Qn].set(e,a),a};we.prototype.serializeInput=function(e,t,r,n){let s=r,i;if(r=typeof t=="string"||typeof t=="number"?t:r,n=r&&s!==r?s:n,r!=null){if(n!=null?i=this[oe][pf]?.[r]?.[n]:i=this[oe][pf]?.[r],i==null)throw n?new T6(r,n):new R6(r)}else this[oe][Qn]?.has(t)?i=this[oe][Qn].get(t):i=this.compileSerializationSchema(t,r,n);return i(e)};we.prototype.serialize=function(e){return this[_n]!==null?this[_n](e):this[oe]&&this[oe][df]?this[oe][df](e,this.raw.statusCode):GP(this[oe],e,this.raw.statusCode)};we.prototype.serializer=function(e){return this[_n]=e,this};we.prototype.type=function(e){return this[Oe]["content-type"]=e,this};we.prototype.redirect=function(e,t){return t||(t=this[Dg]?this.raw.statusCode:302),this.header("location",e).code(t).send()};we.prototype.callNotFound=function(){return x6(this),this};we.prototype.then=function(e,t){if(this.sent){e();return}$g(this.raw,r=>{r&&r.code!=="ERR_STREAM_PREMATURE_CLOSE"?t?t(r):this.log&&this.log.warn("unhandled rejection on reply.then"):e()})};function DP(e,t){e[oe].preSerialization!==null?h6(e[oe].preSerialization,e.request,e,t,qP):qP(null,e.request,e,t)}function qP(e,t,r,n){if(e!=null){Za(r,e);return}try{r[_n]!==null?n=r[_n](n):r[oe]&&r[oe][df]?n=r[oe][df](n,r.raw.statusCode):n=GP(r[oe],n,r.raw.statusCode,r[Oe]["content-type"])}catch(s){P6(s,r),Za(r,s);return}Ks(r,n)}function P6(e,t){e.serialization=t[oe].config}function Ks(e,t){e[oe].onSend!==null?UP(e[oe].onSend,e.request,e,t,I6):BP(e,t)}function I6(e,t,r,n){e!=null?Za(r,e):BP(r,n)}function Ng(e,t){let r=e.raw;try{r.writeHead(t,e[Oe])}catch(n){throw n.code==="ERR_HTTP_HEADERS_SENT"&&e.log.warn(`Reply was already sent, did you forget to "return reply" in the "${e.request.raw.url}" (${e.request.raw.method}) route?`),n}}function BP(e,t){let r=e.raw,n=e.request;if(e[lt]!==null){let i=Object.keys(e[lt]),o="";for(let a of i)typeof e[lt][a]=="function"&&(o+=" ",o+=a);e.header("Transfer-Encoding","chunked"),e.header("Trailer",o.trim())}if(HP.call(t)==="[object Response]"){if(typeof t.status=="number"&&e.code(t.status),typeof t.headers=="object"&&typeof t.headers.forEach=="function")for(let[i,o]of t.headers)e.header(i,o);if(t.body!==null&&t.bodyUsed)throw new y6;t=t.body}let s=r.statusCode;if(t==null){s>=200&&s!==204&&s!==304&&n.method!=="HEAD"&&e[lt]===null&&(e[Oe]["content-length"]="0"),Ng(e,s),ff(t,r,e);return}if(s>=100&&s<200||s===204){e.removeHeader("content-type"),e.removeHeader("content-length"),Ng(e,s),ff(void 0,r,e),typeof t.resume=="function"&&(t.on("error",WP),t.resume());return}if(typeof t.pipe=="function"){zP(t,r,e);return}if(typeof t.getReader=="function"){A6(t,r,e);return}if(typeof t!="string"&&!Buffer.isBuffer(t))throw new g6(typeof t);if(e[lt]===null){let i=e[Oe]["content-length"];(!i||n.raw.method!=="HEAD"&&Number(i)!==Buffer.byteLength(t))&&(e[Oe]["content-length"]=""+Buffer.byteLength(t))}Ng(e,s),r.write(t),ff(t,r,e)}function MP(e,t,r){t.code==="ERR_STREAM_PREMATURE_CLOSE"?e[VP]||e.info({res:r},"stream closed prematurely"):e.warn({err:t},"response terminated with an error with headers already sent")}function A6(e,t,r){if(e.locked)throw _6();let n=l6.fromWeb(e);zP(n,t,r)}function zP(e,t,r){let n=!0,s=!1;if(C6(e,t,r),$g(e,{readable:!0,writable:!1},function(i){n=!1,i!=null&&(t.headersSent||r.request.raw.aborted===!0?(s||(s=!0,MP(r.log,i,r)),t.destroy()):Za(r,i))}),$g(t,function(i){n&&(i!=null&&t.headersSent&&!s&&(s=!0,MP(r.log,i,t)),typeof e.destroy=="function"?e.destroy():typeof e.close=="function"?e.close(WP):typeof e.abort=="function"?e.abort():r.log.warn("stream payload does not end properly"))}),t.headersSent)r.log.warn("response will send, but you shouldn't use res.writeHead in stream mode");else for(let i in r[Oe])t.setHeader(i,r[Oe][i]);e.pipe(t)}function ff(e,t,r){if(r[lt]===null){t.end(null,null,null);return}let n=Object.keys(r[lt]),s={},i=0,o=!0;function a(){i===0&&(t.addTrailers(s),t.end(null,null,null))}for(let l of n){let c=function(f,p){i++,f?r.log.debug(f):s[l]=p,process.nextTick(a)};if(typeof r[lt][l]!="function")continue;o=!1,i--;let u=r[lt][l](r,e,c);typeof u=="object"&&typeof u.then=="function"&&u.then(f=>c(null,f),c)}o&&t.end(null,null,null)}function C6(e,t,r){r[lt]!==null&&e.on("end",()=>ff(null,t,r))}function Za(e,t,r){e[oe].onError!==null&&!e[c6]?(e[qg]=!0,UP(e[oe].onError,e.request,e,t,()=>LP(e,t,r))):LP(e,t,r)}function N6(e){e[Xa]=xg();let t=r=>{e[Lg]=xg(),e.raw.removeListener("finish",t),e.raw.removeListener("error",t);let n=e[oe];n&&n.onResponse!==null?f6(n.onResponse,e.request,e,jP):jP(r,e.request,e)};e.raw.on("finish",t),e.raw.on("error",t)}function jP(e,t,r){if(r.log[VP])return;let n=r.elapsedTime;if(e!=null){r.log.error({res:r,err:e,responseTime:n},"request errored");return}r.log.info({res:r,responseTime:n},"request completed")}function $6(e){let t=e.props.slice();function r(n,s,i){this.raw=n,this[hf]=!1,this[FP]=!1,this[kg]=!1,this[_n]=null,this.request=s,this[Oe]={},this[lt]=null,this[Xa]=void 0,this[Lg]=void 0,this.log=i;let o;for(let a=0;a<t.length;a++)o=t[a],this[o.key]=o.value}return Object.setPrototypeOf(r.prototype,e.prototype),Object.setPrototypeOf(r,e),r.parent=e,r.props=t,r}function x6(e){if(e[oe][xP]===null){e.log.warn("Trying to send a NotFound error inside a 404 handler. Sending basic 404 response."),e.code(404).send("404 Not Found");return}e.request[oe]=e[oe][xP],e[oe].preHandler!==null?d6(e[oe].preHandler,e.request,e,kP.preHandlerCallback):kP.preHandlerCallback(null,e.request,e)}function GP(e,t,r,n){let s=m6(e,r,n);return s?s(t):JSON.stringify(t)}function WP(){}mf.exports=we;mf.exports.buildReply=$6;mf.exports.setupResponseListeners=N6});var KP=S((jpe,yf)=>{"use strict";function Mg(e){if(!e)throw new TypeError("argument req is required");let t=e.headers["x-forwarded-for"],r=e.socket.remoteAddress;if(!t||typeof t!="string")return[r];if(t.indexOf(",")===-1){let n=t.trim();return n.length?[r,n]:[r]}else return k6(t,r)}function k6(e,t){let r=[t],n=e.length,s=n,i,o;for(o=n-1;o>=0;--o)i=e[o],i===" "?s===n&&(s=n=o):i===","?(s!==n&&r.push(e.slice(s,n)),s=n=o):s=o;return s!==n&&r.push(e.substring(s,n)),r}yf.exports=Mg;yf.exports.default=Mg;yf.exports.forwarded=Mg});var YP=S((JP,_f)=>{(function(e){"use strict";let t="(0?\\d+|0x[a-f0-9]+)",r={fourOctet:new RegExp(`^${t}\\.${t}\\.${t}\\.${t}$`,"i"),threeOctet:new RegExp(`^${t}\\.${t}\\.${t}$`,"i"),twoOctet:new RegExp(`^${t}\\.${t}$`,"i"),longValue:new RegExp(`^${t}$`,"i")},n=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),i="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(i,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${i})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${t}\\.${t}\\.${t}\\.${t}(${i})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${t}\\.${t}\\.${t}\\.${t}(${i})?$`,"i")};function l(d,h){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let m=0,y=-1,b=(d.match(a.zoneIndex)||[])[0],v,_;for(b&&(b=b.substring(1),d=d.replace(/%.+$/,""));(y=d.indexOf(":",y+1))>=0;)m++;if(d.substr(0,2)==="::"&&m--,d.substr(-2,2)==="::"&&m--,m>h)return null;for(_=h-m,v=":";_--;)v+="0:";return d=d.replace("::",v),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),h=function(){let g=d.split(":"),T=[];for(let R=0;R<g.length;R++)T.push(parseInt(g[R],16));return T}(),{parts:h,zoneId:b}}function c(d,h,m,y){if(d.length!==h.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let b=0,v;for(;y>0;){if(v=m-y,v<0&&(v=0),d[b]>>v!==h[b]>>v)return!1;y-=m,b+=1}return!0}function u(d){if(s.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(n.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function f(d,h){for(;d.length<h;)d=`0${d}`;return d}let p={};p.IPv4=function(){function d(h){if(h.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let m,y;for(m=0;m<h.length;m++)if(y=h[m],!(0<=y&&y<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=h}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,18,0,0]),15],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]],as112:[[new d([192,175,48,0]),24],[new d([192,31,196,0]),24]],amt:[[new d([192,52,193,0]),24]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(h,m){let y;if(m===void 0&&(y=h,h=y[0],m=y[1]),h.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return c(this.octets,h.octets,8,m)},d.prototype.prefixLengthFromSubnetMask=function(){let h=0,m=!1,y={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},b,v,_;for(b=3;b>=0;b-=1)if(v=this.octets[b],v in y){if(_=y[v],m&&_!==0)return null;_!==8&&(m=!0),h+=_}else return null;return 32-h},d.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),p.IPv4.broadcastAddressFromCIDR=function(d){try{let h=this.parseCIDR(d),m=h[0].toByteArray(),y=this.subnetMaskFromPrefixLength(h[1]).toByteArray(),b=[],v=0;for(;v<4;)b.push(parseInt(m[v],10)|parseInt(y[v],10)^255),v++;return new this(b)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(d){return this.parser(d)!==null},p.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},p.IPv4.isValidCIDR=function(d){try{return this.parseCIDR(d),!0}catch{return!1}},p.IPv4.isValidFourPartDecimal=function(d){return!!(p.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(d){let h,m,y,b,v;try{for(h=this.parseCIDR(d),y=h[0].toByteArray(),v=this.subnetMaskFromPrefixLength(h[1]).toByteArray(),b=[],m=0;m<4;)b.push(parseInt(y[m],10)&parseInt(v[m],10)),m++;return new this(b)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(d){let h=this.parser(d);if(h===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(h)},p.IPv4.parseCIDR=function(d){let h;if(h=d.match(/^(.+)\/(\d+)$/)){let m=parseInt(h[2]);if(m>=0&&m<=32){let y=[this.parse(h[1]),m];return Object.defineProperty(y,"toString",{value:function(){return this.join("/")}}),y}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(d){let h,m,y;if(h=d.match(r.fourOctet))return function(){let b=h.slice(1,6),v=[];for(let _=0;_<b.length;_++)m=b[_],v.push(u(m));return v}();if(h=d.match(r.longValue)){if(y=u(h[1]),y>4294967295||y<0)throw new Error("ipaddr: address outside defined range");return function(){let b=[],v;for(v=0;v<=24;v+=8)b.push(y>>v&255);return b}().reverse()}else return(h=d.match(r.twoOctet))?function(){let b=h.slice(1,4),v=[];if(y=u(b[1]),y>16777215||y<0)throw new Error("ipaddr: address outside defined range");return v.push(u(b[0])),v.push(y>>16&255),v.push(y>>8&255),v.push(y&255),v}():(h=d.match(r.threeOctet))?function(){let b=h.slice(1,5),v=[];if(y=u(b[2]),y>65535||y<0)throw new Error("ipaddr: address outside defined range");return v.push(u(b[0])),v.push(u(b[1])),v.push(y>>8&255),v.push(y&255),v}():null},p.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");let h=[0,0,0,0],m=0,y=Math.floor(d/8);for(;m<y;)h[m]=255,m++;return y<4&&(h[y]=Math.pow(2,d%8)-1<<8-d%8),new this(h)},p.IPv6=function(){function d(h,m){let y,b;if(h.length===16)for(this.parts=[],y=0;y<=14;y+=2)this.parts.push(h[y]<<8|h[y+1]);else if(h.length===8)this.parts=h;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(y=0;y<this.parts.length;y++)if(b=this.parts[y],!(0<=b&&b<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");m&&(this.zoneId=m)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],discard:[new d([256,0,0,0,0,0,0,0]),64],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],benchmarking:[new d([8193,2,0,0,0,0,0,0]),48],amt:[new d([8193,3,0,0,0,0,0,0]),32],as112v6:[[new d([8193,4,274,0,0,0,0,0]),48],[new d([9760,79,32768,0,0,0,0,0]),48]],deprecated:[new d([8193,16,0,0,0,0,0,0]),28],orchid2:[new d([8193,32,0,0,0,0,0,0]),28],droneRemoteIdProtocolEntityTags:[new d([8193,48,0,0,0,0,0,0]),28],reserved:[[new d([8193,0,0,0,0,0,0,0]),23],[new d([8193,3512,0,0,0,0,0,0]),32]]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(h,m){let y;if(m===void 0&&(y=h,h=y[0],m=y[1]),h.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return c(this.parts,h.parts,16,m)},d.prototype.prefixLengthFromSubnetMask=function(){let h=0,m=!1,y={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},b,v;for(let _=7;_>=0;_-=1)if(b=this.parts[_],b in y){if(v=y[b],m&&v!==0)return null;v!==16&&(m=!0),h+=v}else return null;return 128-h},d.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let h,m=[],y=this.parts;for(let b=0;b<y.length;b++)h=y[b],m.push(h>>8),m.push(h&255);return m},d.prototype.toFixedLengthString=function(){let h=function(){let y=[];for(let b=0;b<this.parts.length;b++)y.push(f(this.parts[b].toString(16),4));return y}.call(this).join(":"),m="";return this.zoneId&&(m=`%${this.zoneId}`),h+m},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let h=this.parts.slice(-2),m=h[0],y=h[1];return new p.IPv4([m>>8,m&255,y>>8,y&255])},d.prototype.toNormalizedString=function(){let h=function(){let y=[];for(let b=0;b<this.parts.length;b++)y.push(this.parts[b].toString(16));return y}.call(this).join(":"),m="";return this.zoneId&&(m=`%${this.zoneId}`),h+m},d.prototype.toRFC5952String=function(){let h=/((^|:)(0(:|$)){2,})/g,m=this.toNormalizedString(),y=0,b=-1,v;for(;v=h.exec(m);)v[0].length>b&&(y=v.index,b=v[0].length);return b<0?m:`${m.substring(0,y)}::${m.substring(y+b)}`},d.prototype.toString=function(){return this.toRFC5952String()},d}(),p.IPv6.broadcastAddressFromCIDR=function(d){try{let h=this.parseCIDR(d),m=h[0].toByteArray(),y=this.subnetMaskFromPrefixLength(h[1]).toByteArray(),b=[],v=0;for(;v<16;)b.push(parseInt(m[v],10)|parseInt(y[v],10)^255),v++;return new this(b)}catch(h){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${h})`)}},p.IPv6.isIPv6=function(d){return this.parser(d)!==null},p.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{let h=this.parser(d);return new this(h.parts,h.zoneId),!0}catch{return!1}},p.IPv6.isValidCIDR=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{return this.parseCIDR(d),!0}catch{return!1}},p.IPv6.networkAddressFromCIDR=function(d){let h,m,y,b,v;try{for(h=this.parseCIDR(d),y=h[0].toByteArray(),v=this.subnetMaskFromPrefixLength(h[1]).toByteArray(),b=[],m=0;m<16;)b.push(parseInt(y[m],10)&parseInt(v[m],10)),m++;return new this(b)}catch(_){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${_})`)}},p.IPv6.parse=function(d){let h=this.parser(d);if(h.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(h.parts,h.zoneId)},p.IPv6.parseCIDR=function(d){let h,m,y;if((m=d.match(/^(.+)\/(\d+)$/))&&(h=parseInt(m[2]),h>=0&&h<=128))return y=[this.parse(m[1]),h],Object.defineProperty(y,"toString",{value:function(){return this.join("/")}}),y;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(d){let h,m,y,b,v,_;if(y=d.match(a.deprecatedTransitional))return this.parser(`::ffff:${y[1]}`);if(a.native.test(d))return l(d,8);if((y=d.match(a.transitional))&&(_=y[6]||"",h=y[1],y[1].endsWith("::")||(h=h.slice(0,-1)),h=l(h+_,6),h.parts)){for(v=[parseInt(y[2]),parseInt(y[3]),parseInt(y[4]),parseInt(y[5])],m=0;m<v.length;m++)if(b=v[m],!(0<=b&&b<=255))return null;return h.parts.push(v[0]<<8|v[1]),h.parts.push(v[2]<<8|v[3]),{parts:h.parts,zoneId:h.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");let h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0,y=Math.floor(d/8);for(;m<y;)h[m]=255,m++;return y<16&&(h[y]=Math.pow(2,d%8)-1<<8-d%8),new this(h)},p.fromByteArray=function(d){let h=d.length;if(h===4)return new p.IPv4(d);if(h===16)return new p.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(d){return p.IPv6.isValid(d)||p.IPv4.isValid(d)},p.isValidCIDR=function(d){return p.IPv6.isValidCIDR(d)||p.IPv4.isValidCIDR(d)},p.parse=function(d){if(p.IPv6.isValid(d))return p.IPv6.parse(d);if(p.IPv4.isValid(d))return p.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(d){try{return p.IPv6.parseCIDR(d)}catch{try{return p.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(d){let h=this.parse(d);return h.kind()==="ipv6"&&h.isIPv4MappedAddress()?h.toIPv4Address():h},p.subnetMatch=function(d,h,m){let y,b,v,_;m==null&&(m="unicast");for(b in h)if(Object.prototype.hasOwnProperty.call(h,b)){for(v=h[b],v[0]&&!(v[0]instanceof Array)&&(v=[v]),y=0;y<v.length;y++)if(_=v[y],d.kind()===_[0].kind()&&d.match.apply(d,_))return b}return m},typeof _f<"u"&&_f.exports?_f.exports=p:e.ipaddr=p})(JP)});var tI=S((Fpe,eo)=>{"use strict";eo.exports=jg;eo.exports.default=jg;eo.exports.proxyaddr=jg;eo.exports.all=QP;eo.exports.compile=eI;var L6=KP(),ZP=YP(),D6=/^\d+$/u,bf=ZP.isValid,Sf=ZP.parse,XP={linklocal:["169.254.0.0/16","fe80::/10"],loopback:["127.0.0.1/8","::1/128"],uniquelocal:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","fc00::/7"]};function QP(e,t){let r=L6(e);if(!t)return r;typeof t!="function"&&(t=eI(t));for(var n=0;n<r.length-1;n++)t(r[n],n)||(r.length=n+1);return r}function eI(e){if(!e)throw new TypeError("argument is required");let t;if(typeof e=="string")t=[e];else if(Array.isArray(e))t=e.slice();else throw new TypeError("unsupported trust argument");for(var r=0;r<t.length;r++)e=t[r],Object.prototype.hasOwnProperty.call(XP,e)&&(e=XP[e],t.splice.apply(t,[r,1].concat(e)),r+=e.length-1);return M6(q6(t))}function q6(e){let t=new Array(e.length);for(var r=0;r<e.length;r++)t[r]=j6(e[r]);return t}function M6(e){let t=e.length;return t===0?V6:t===1?H6(e[0]):U6(e)}function j6(e){let t=e.lastIndexOf("/"),r=t!==-1?e.substring(0,t):e;if(!bf(r))throw new TypeError("invalid IP address: "+r);let n=Sf(r);t===-1&&n.kind()==="ipv6"&&n.isIPv4MappedAddress()&&(n=n.toIPv4Address());let s=n.kind()==="ipv6"?128:32,i=t!==-1?e.substring(t+1,e.length):null;if(i===null?i=s:D6.test(i)?i=parseInt(i,10):n.kind()==="ipv4"&&bf(i)?i=F6(i):i=null,i<=0||i>s)throw new TypeError("invalid range on address: "+e);return[n,i]}function F6(e){let t=Sf(e);return t.kind()==="ipv4"?t.prefixLengthFromSubnetMask():null}function jg(e,t){if(!e)throw new TypeError("req argument is required");if(!t)throw new TypeError("trust argument is required");let r=QP(e,t);return r[r.length-1]}function V6(){return!1}function U6(e){return function(r){if(!bf(r))return!1;let n=Sf(r),s,i=n.kind();for(var o=0;o<e.length;o++){let a=e[o],l=a[0],c=l.kind(),u=a[1],f=n;if(i!==c){if(c==="ipv4"&&!n.isIPv4MappedAddress())continue;s||(s=c==="ipv4"?n.toIPv4Address():n.toIPv4MappedAddress()),f=s}if(f.match(l,u))return!0}return!1}}function H6(e){let t=e[0],r=t.kind(),n=r==="ipv4",s=e[1];return function(o){if(!bf(o))return!1;let a=Sf(o);if(a.kind()!==r){if(n&&!a.isIPv4MappedAddress())return!1;a=n?a.toIPv4Address():a.toIPv4MappedAddress()}return a.match(t,s)}}});var Ef=S((Vpe,Hg)=>{"use strict";var vf=tI(),{kHasBeenDecorated:B6,kSchemaBody:z6,kSchemaHeaders:G6,kSchemaParams:W6,kSchemaQuerystring:rI,kSchemaController:Fg,kOptions:K6,kRequestCacheValidateFns:es,kRouteContext:wt,kRequestOriginalUrl:Vg}=at(),{FST_ERR_REQ_INVALID_VALIDATION_INVOCATION:J6}=pt(),nI={body:z6,headers:G6,params:W6,querystring:rI,query:rI};function Ug(e,t,r,n,s,i){this.id=e,this[wt]=i,this.params=t,this.raw=r,this.query=n,this.log=s,this.body=void 0}Ug.props=[];function Y6(e){if(typeof e=="function")return e;if(e===!0)return null;if(typeof e=="number")return function(t,r){return r<e};if(typeof e=="string"){let t=e.split(",").map(r=>r.trim());return vf.compile(t)}return vf.compile(e)}function X6(e,t){return t?Z6(e,t):iI(e)}function iI(e){let t=e.props.slice();function r(n,s,i,o,a,l){this.id=n,this[wt]=l,this.params=s,this.raw=i,this.query=o,this.log=a,this.body=void 0;let c;for(let u=0;u<t.length;u++)c=t[u],this[c.key]=c.value}return Object.setPrototypeOf(r.prototype,e.prototype),Object.setPrototypeOf(r,e),r.props=t,r.parent=e,r}function sI(e){let t=e.lastIndexOf(",");return t===-1?e.trim():e.slice(t+1).trim()}function Z6(e,t){let r=iI(e),n=Y6(t);return r[B6]=!0,Object.defineProperties(r.prototype,{ip:{get(){let s=vf.all(this.raw,n);return s[s.length-1]}},ips:{get(){return vf.all(this.raw,n)}},host:{get(){return this.ip!==void 0&&this.headers["x-forwarded-host"]?sI(this.headers["x-forwarded-host"]):this.headers.host??this.headers[":authority"]??""}},protocol:{get(){if(this.headers["x-forwarded-proto"])return sI(this.headers["x-forwarded-proto"]);if(this.socket)return this.socket.encrypted?"https":"http"}}}),r}Object.defineProperties(Ug.prototype,{server:{get(){return this[wt].server}},url:{get(){return this.raw.url}},originalUrl:{get(){return this[Vg]||(this[Vg]=this.raw.originalUrl||this.raw.url),this[Vg]}},method:{get(){return this.raw.method}},routeOptions:{get(){let e=this[wt],t=e._parserOptions.limit,r=e.server.initialConfig.bodyLimit,n=e.server.hasConstraintStrategy("version")?this.raw.headers["accept-version"]:void 0,s={method:e.config?.method,url:e.config?.url,bodyLimit:t||r,attachValidation:e.attachValidation,logLevel:e.logLevel,exposeHeadRoute:e.exposeHeadRoute,prefixTrailingSlash:e.prefixTrailingSlash,handler:e.handler,version:n};return Object.defineProperties(s,{config:{get:()=>e.config},schema:{get:()=>e.schema}}),Object.freeze(s)}},is404:{get(){return this[wt].config?.url===void 0}},socket:{get(){return this.raw.socket}},ip:{get(){if(this.socket)return this.socket.remoteAddress}},host:{get(){return this.raw.headers.host??this.raw.headers[":authority"]??""}},hostname:{get(){return this.host.split(":",1)[0]}},port:{get(){let e=parseInt(this.host.split(":").slice(-1)[0]);if(!isNaN(e))return e;let t=this.headers.host??this.headers[":authority"]??"",r=parseInt(t.split(":").slice(-1)[0]);return isNaN(r)?null:r}},protocol:{get(){if(this.socket)return this.socket.encrypted?"https":"http"}},headers:{get(){return this.additionalHeaders?Object.assign({},this.raw.headers,this.additionalHeaders):this.raw.headers},set(e){this.additionalHeaders=e}},getValidationFunction:{value:function(e){if(typeof e=="string"){let t=nI[e];return this[wt][t]}else if(typeof e=="object")return this[wt][es]?.get(e)}},compileValidationSchema:{value:function(e,t=null){let{method:r,url:n}=this;if(this[wt][es]?.has(e))return this[wt][es].get(e);let i=(this[wt].validatorCompiler||this.server[Fg].validatorCompiler||this.server[Fg].setupValidator(this.server[K6])||this.server[Fg].validatorCompiler)({schema:e,method:r,url:n,httpPart:t});return this[wt][es]==null&&(this[wt][es]=new WeakMap),this[wt][es].set(e,i),i}},validateInput:{value:function(e,t,r){r=typeof t=="string"?t:r;let n=r!=null&&typeof r=="string"&&nI[r],s;if(n&&(s=this[wt][n]),s==null&&(t==null||typeof t!="object"||Array.isArray(t)))throw new J6(r);return s==null&&(this[wt][es]?.has(t)?s=this[wt][es].get(t):s=this.compileValidationSchema(t,r)),s(e)}}});Hg.exports=Ug;Hg.exports.buildRequest=X6});var wf=S((Upe,oI)=>{"use strict";var{kFourOhFourContext:Q6,kReplySerializerDefault:e7,kSchemaErrorFormatter:t7,kErrorHandler:r7,kChildLoggerFactory:n7,kOptions:s7,kReply:i7,kRequest:o7,kBodyLimit:a7,kLogLevel:l7,kContentTypeParser:c7,kRouteByFastify:u7,kRequestCacheValidateFns:f7,kReplyCacheSerializeFns:d7}=at();function h7({schema:e,handler:t,config:r,requestIdLogLabel:n,childLoggerFactory:s,errorHandler:i,bodyLimit:o,logLevel:a,logSerializers:l,attachValidation:c,validatorCompiler:u,serializerCompiler:f,replySerializer:p,schemaErrorFormatter:d,exposeHeadRoute:h,prefixTrailingSlash:m,server:y,isFastify:b}){this.schema=e,this.handler=t,this.Reply=y[i7],this.Request=y[o7],this.contentTypeParser=y[c7],this.onRequest=null,this.onSend=null,this.onError=null,this.onTimeout=null,this.preHandler=null,this.onResponse=null,this.preSerialization=null,this.onRequestAbort=null,this.config=r,this.errorHandler=i||y[r7],this.requestIdLogLabel=n||y[s7].requestIdLogLabel,this.childLoggerFactory=s||y[n7],this._middie=null,this._parserOptions={limit:o||y[a7]},this.exposeHeadRoute=h,this.prefixTrailingSlash=m,this.logLevel=a||y[l7],this.logSerializers=l,this[Q6]=null,this.attachValidation=c,this[e7]=p,this.schemaErrorFormatter=d||y[t7]||p7,this[u7]=b,this[f7]=null,this[d7]=null,this.validatorCompiler=u||null,this.serializerCompiler=f||null,this.server=y}function p7(e,t){let r="",n=", ";for(let s=0;s!==e.length;++s){let i=e[s];r+=t+(i.instancePath||"")+" "+i.message+n}return new Error(r.slice(0,-n.length))}oI.exports=h7});var Kg=S((Hpe,uI)=>{"use strict";var{kReply:Bg,kRequest:zg,kState:m7,kHasBeenDecorated:g7}=at(),{FST_ERR_DEC_ALREADY_PRESENT:aI,FST_ERR_DEC_MISSING_DEPENDENCY:y7,FST_ERR_DEC_AFTER_START:_7,FST_ERR_DEC_REFERENCE_TYPE:b7,FST_ERR_DEC_DEPENDENCY_INVALID_TYPE:S7}=pt();function v7(e,t,r,n){if(Object.hasOwn(e,t))throw new aI(t);Gg(e,t,n),r&&(typeof r.getter=="function"||typeof r.setter=="function")?Object.defineProperty(e,t,{get:r.getter,set:r.setter}):e[t]=r}function lI(e,t,r,n){let s=e.prototype;if(Object.hasOwn(s,t)||Tf(e,t))throw new aI(t);e[g7]=!0,Gg(e,t,n),r&&(typeof r.getter=="function"||typeof r.setter=="function")?Object.defineProperty(s,t,{get:r.getter,set:r.setter}):typeof r=="function"?s[t]=r:e.props.push({key:t,value:r})}function cI(e,t){if(typeof t=="object"&&t&&!(typeof t.getter=="function"||typeof t.setter=="function"))throw new b7(e,typeof t)}function E7(e,t,r){return Wg(this,e),v7(this,e,t,r),this}function Rf(e,t){return t?t in e||e.prototype&&t in e.prototype||Tf(e,t):e in this}function Tf(e,t){return e.props?e.props.find(({key:r})=>r===t):!1}function w7(e){return e&&Tf(this[zg],e)?!0:Rf(this[zg].prototype,e)}function R7(e){return e&&Tf(this[Bg],e)?!0:Rf(this[Bg].prototype,e)}function Gg(e,t,r){if(r!=null){if(!Array.isArray(r))throw new S7(t);for(let n=0;n!==r.length;++n)if(!Rf(e,r[n]))throw new y7(r[n])}}function T7(e,t,r){return Wg(this,e),cI(e,t),lI(this[Bg],e,t,r),this}function O7(e,t,r){return Wg(this,e),cI(e,t),lI(this[zg],e,t,r),this}function Wg(e,t){if(e[m7].started)throw new _7(t)}uI.exports={add:E7,exist:Rf,existRequest:w7,existReply:R7,dependencies:Gg,decorateReply:T7,decorateRequest:O7}});var mI=S((Bpe,to)=>{"use strict";var P7=typeof Buffer<"u",fI=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,dI=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function hI(e,t,r){r==null&&t!==null&&typeof t=="object"&&(r=t,t=void 0),P7&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));let n=JSON.parse(e,t);if(n===null||typeof n!="object")return n;let s=r&&r.protoAction||"error",i=r&&r.constructorAction||"error";if(s==="ignore"&&i==="ignore")return n;if(s!=="ignore"&&i!=="ignore"){if(fI.test(e)===!1&&dI.test(e)===!1)return n}else if(s!=="ignore"&&i==="ignore"){if(fI.test(e)===!1)return n}else if(dI.test(e)===!1)return n;return pI(n,{protoAction:s,constructorAction:i,safe:r&&r.safe})}function pI(e,{protoAction:t="error",constructorAction:r="error",safe:n}={}){let s=[e];for(;s.length;){let i=s;s=[];for(let o of i){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(n===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if(r!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(n===!0)return null;if(r==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(let a in o){let l=o[a];l&&typeof l=="object"&&s.push(l)}}}return e}function Jg(e,t,r){let{stackTraceLimit:n}=Error;Error.stackTraceLimit=0;try{return hI(e,t,r)}finally{Error.stackTraceLimit=n}}function I7(e,t){let{stackTraceLimit:r}=Error;Error.stackTraceLimit=0;try{return hI(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=r}}to.exports=Jg;to.exports.default=Jg;to.exports.parse=Jg;to.exports.safeParse=I7;to.exports.scan=pI});var ty=S((zpe,el)=>{"use strict";var{AsyncResource:A7}=require("node:async_hooks"),{FifoMap:yI}=ap(),{parse:C7}=mI(),{kDefaultJsonParse:Qa,kContentTypeParser:ro,kBodyLimit:N7,kRequestPayloadStream:_I,kState:Xg,kTestInternals:$7,kReplyIsError:bI,kRouteContext:x7}=at(),{FST_ERR_CTP_INVALID_TYPE:Zg,FST_ERR_CTP_EMPTY_TYPE:k7,FST_ERR_CTP_ALREADY_PRESENT:L7,FST_ERR_CTP_INVALID_HANDLER:D7,FST_ERR_CTP_INVALID_PARSE_TYPE:q7,FST_ERR_CTP_BODY_TOO_LARGE:gI,FST_ERR_CTP_INVALID_MEDIA_TYPE:M7,FST_ERR_CTP_INVALID_CONTENT_LENGTH:j7,FST_ERR_CTP_EMPTY_JSON_BODY:F7,FST_ERR_CTP_INSTANCE_ALREADY_STARTED:Qg}=pt(),{FSTSEC001:V7}=Nu();function bn(e,t,r){this[Qa]=vI(t,r),this.customParsers=new Map,this.customParsers.set("application/json",new Yg(!0,!1,e,this[Qa])),this.customParsers.set("text/plain",new Yg(!0,!1,e,ey)),this.parserList=["application/json","text/plain"],this.parserRegExpList=[],this.cache=new yI(100)}bn.prototype.add=function(e,t,r){let n=typeof e=="string";if(n){if(e=e.trim().toLowerCase(),e.length===0)throw new k7}else if(!(e instanceof RegExp))throw new Zg;if(typeof r!="function")throw new D7;if(this.existingParser(e))throw new L7(e);if(t.parseAs!==void 0&&t.parseAs!=="string"&&t.parseAs!=="buffer")throw new q7(t.parseAs);let s=new Yg(t.parseAs==="string",t.parseAs==="buffer",t.bodyLimit,r);e==="*"?this.customParsers.set("",s):n?(this.parserList.unshift(e),this.customParsers.set(e,s)):(W7(e),this.parserRegExpList.unshift(e),this.customParsers.set(e.toString(),s))};bn.prototype.hasParser=function(e){if(typeof e=="string")e=e.trim().toLowerCase();else{if(!(e instanceof RegExp))throw new Zg;e=e.toString()}return this.customParsers.has(e)};bn.prototype.existingParser=function(e){return e==="application/json"&&this.customParsers.has(e)?this.customParsers.get(e).fn!==this[Qa]:e==="text/plain"&&this.customParsers.has(e)?this.customParsers.get(e).fn!==ey:this.hasParser(e)};bn.prototype.getParser=function(e){let t=this.customParsers.get(e);if(t!==void 0||(t=this.cache.get(e),t!==void 0))return t;let r=e.toLowerCase();for(let n=0;n!==this.parserList.length;++n){let s=this.parserList[n];if(r.slice(0,s.length)===s&&(r.length===s.length||r.charCodeAt(s.length)===59||r.charCodeAt(s.length)===32))return t=this.customParsers.get(s),this.cache.set(e,t),t}for(let n=0;n!==this.parserRegExpList.length;++n){let s=this.parserRegExpList[n];if(s.test(e))return t=this.customParsers.get(s.toString()),this.cache.set(e,t),t}return this.customParsers.get("")};bn.prototype.removeAll=function(){this.customParsers=new Map,this.parserRegExpList=[],this.parserList=[],this.cache=new yI(100)};bn.prototype.remove=function(e){let t;if(typeof e=="string")e=e.trim().toLowerCase(),t=this.parserList;else{if(!(e instanceof RegExp))throw new Zg;e=e.toString(),t=this.parserRegExpList}let r=this.customParsers.delete(e),n=t.findIndex(s=>s.toString()===e);return n>-1&&t.splice(n,1),r||n>-1};bn.prototype.run=function(e,t,r,n){let s=this.getParser(e);if(s===void 0){r.is404?t(r,n):n.send(new M7(e||void 0));return}let i=new A7("content-type-parser:run",r);if(s.asString===!0||s.asBuffer===!0)SI(r,n,n[x7]._parserOptions,s,o);else{let a=s.fn(r,r[_I],o);a&&typeof a.then=="function"&&a.then(l=>o(null,l),o)}function o(a,l){i.runInAsyncScope(()=>{i.emitDestroy(),a?(n[bI]=!0,n.send(a)):(r.body=l,t(r,n))})}};function SI(e,t,r,n,s){let i=n.asString,o=r.limit===null?n.bodyLimit:r.limit,a=Number(e.headers["content-length"]);if(a>o){t.header("connection","close"),t.send(new gI);return}let l=0,c=i===!0?"":[],u=e[_I]||e.raw;i===!0&&u.setEncoding("utf8"),u.on("data",f),u.on("end",p),u.on("error",p),u.resume();function f(d){l+=d.length;let{receivedEncodedLength:h=0}=u;if(l>o||h>o){u.removeListener("data",f),u.removeListener("end",p),u.removeListener("error",p),t.send(new gI);return}i===!0?c+=d:c.push(d)}function p(d){if(u.removeListener("data",f),u.removeListener("end",p),u.removeListener("error",p),d!==void 0){typeof d.statusCode=="number"&&d.statusCode>=400||(d.statusCode=400),t[bI]=!0,t.code(d.statusCode).send(d);return}if(i===!0&&(l=Buffer.byteLength(c)),!Number.isNaN(a)&&(u.receivedEncodedLength||l)!==a){t.header("connection","close"),t.send(new j7);return}i===!1&&(c=Buffer.concat(c));let h=n.fn(e,c,s);h&&typeof h.then=="function"&&h.then(m=>s(null,m),s)}}function vI(e,t){return r;function r(n,s,i){if(s.length===0){i(new F7,void 0);return}try{i(null,C7(s,{protoAction:e,constructorAction:t}))}catch(o){o.statusCode=400,i(o,void 0)}}}function ey(e,t,r){r(null,t)}function Yg(e,t,r,n){this.asString=e,this.asBuffer=t,this.bodyLimit=r,this.fn=n}function U7(e){let t=new bn;return t[Qa]=e[Qa],t.customParsers=new Map(e.customParsers.entries()),t.parserList=e.parserList.slice(),t.parserRegExpList=e.parserRegExpList.slice(),t}function H7(e,t,r){if(this[Xg].started)throw new Qg("addContentTypeParser");return typeof t=="function"&&(r=t,t={}),t||(t={}),t.bodyLimit||(t.bodyLimit=this[N7]),Array.isArray(e)?e.forEach(n=>this[ro].add(n,t,r)):this[ro].add(e,t,r),this}function B7(e){return this[ro].hasParser(e)}function z7(e){if(this[Xg].started)throw new Qg("removeContentTypeParser");if(Array.isArray(e))for(let t of e)this[ro].remove(t);else this[ro].remove(e)}function G7(){if(this[Xg].started)throw new Qg("removeAllContentTypeParsers");this[ro].removeAll()}function W7(e){e.source[0]!=="^"&&e.source.includes(";?")===!1&&V7(e.source)}el.exports=bn;el.exports.helpers={buildContentTypeParser:U7,addContentTypeParser:H7,hasContentTypeParser:B7,removeContentTypeParser:z7,removeAllContentTypeParsers:G7};el.exports.defaultParsers={getDefaultJsonParser:vI,defaultTextParser:ey};el.exports[$7]={rawBody:SI}});var Of=S(RI=>{var EI=Object.prototype.hasOwnProperty;function wI(e,t,r){for(r of e.keys())if(tl(r,t))return r}function tl(e,t){var r,n,s;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&tl(e[n],t[n]););return n===-1}if(r===Set){if(e.size!==t.size)return!1;for(n of e)if(s=n,s&&typeof s=="object"&&(s=wI(t,s),!s)||!t.has(s))return!1;return!0}if(r===Map){if(e.size!==t.size)return!1;for(n of e)if(s=n[0],s&&typeof s=="object"&&(s=wI(t,s),!s)||!tl(n[1],t.get(s)))return!1;return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return n===-1}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(EI.call(e,r)&&++n&&!EI.call(t,r)||!(r in t)||!tl(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}RI.dequal=tl});var II=S((Wpe,PI)=>{"use strict";var{dequal:TI}=Of(),K7=Symbol.for("json-schema-ref"),ry=class{#e;#t;#n;#s;#i;constructor(t={}){this.#e={},this.#t={},this.#n=t.insertRefSymbol??!1,this.#s=t.allowEqualDuplicates??!0,this.#i=t.cloneSchemaWithoutRefs??!1}addSchema(t,r,n=!0){n&&(t.$id!==void 0&&t.$id.charAt(0)!=="#"?r=t.$id:this.#l(t,r));let s=t.$id;s!==void 0&&typeof s=="string"&&(s.charAt(0)==="#"?this.#u(t,r,s):(this.#l(t,s),r=s));let i=t.$ref;if(i!==void 0&&typeof i=="string"){let{refSchemaId:o,refJsonPointer:a}=this.#o(i,r);this.#e[r].refs.push({schemaId:o,jsonPointer:a})}for(let o in t)typeof t[o]=="object"&&t[o]!==null&&this.addSchema(t[o],r,!1)}getSchema(t,r="#"){let n=this.#e[t];if(n===void 0)throw new Error(`Cannot resolve ref "${t}${r}". Schema with id "${t}" is not found.`);return n.anchors[r]!==void 0?n.anchors[r]:OI(n.schema,r)}hasSchema(t){return this.#e[t]!==void 0}getSchemaRefs(t){let r=this.#e[t];if(r===void 0)throw new Error(`Schema with id "${t}" is not found.`);return r.refs}getSchemaDependencies(t,r={}){let n=this.#e[t];for(let s of n.refs){let i=s.schemaId;i===t||r[i]!==void 0||(r[i]=this.getSchema(i),this.getSchemaDependencies(i,r))}return r}derefSchema(t){if(this.#t[t]!==void 0)return;let r=this.#e[t];if(r===void 0)throw new Error(`Schema with id "${t}" is not found.`);!this.#i&&r.refs.length===0&&(this.#t[t]={schema:r.schema,anchors:r.anchors});let n=[];this.#r(r.schema,t,!0,n);let s=this.getSchemaDependencies(t);for(let i in s){let o=s[i];this.#r(o,i,!0,n)}for(let i of n){let{refSchemaId:o,refJsonPointer:a}=this.#o(i.ref,i.sourceSchemaId),l=this.getDerefSchema(o,a);if(l===null)throw new Error(`Cannot resolve ref "${i.ref}". Ref "${a}" is not found in schema "${o}".`);i.targetSchema=l,i.targetSchemaId=o}for(let i of n)this.#a(i,n)}getDerefSchema(t,r="#"){let n=this.#t[t];return n===void 0&&(this.derefSchema(t),n=this.#t[t]),n.anchors[r]!==void 0?n.anchors[r]:OI(n.schema,r)}#o(t,r){let n=t.indexOf("#");return n===-1?{refSchemaId:t,refJsonPointer:"#"}:n===0?{refSchemaId:r,refJsonPointer:t}:{refSchemaId:t.slice(0,n),refJsonPointer:t.slice(n)}}#r(t,r,n,s=[]){let i=Array.isArray(t)?[...t]:{...t};n&&(t.$id!==void 0&&t.$id.charAt(0)!=="#"?r=t.$id:this.#c(i,r));let o=i.$id;o!==void 0&&typeof o=="string"&&(o.charAt(0)==="#"?this.#f(i,r,o):(this.#c(i,o),r=o)),i.$ref!==void 0&&s.push({ref:i.$ref,sourceSchemaId:r,sourceSchema:i});for(let a in i){let l=i[a];typeof l=="object"&&l!==null&&(i[a]=this.#r(l,r,!1,s))}return i}#a(t,r){let{sourceSchema:n,targetSchema:s}=t;if(n.$ref){if(this.#n&&(n[K7]=n.$ref),delete n.$ref,s.$ref){let i=r.find(o=>o.sourceSchema===s);this.#a(i,r)}for(let i in s)if(i!=="$id"){if(n[i]!==void 0){if(TI(n[i],s[i]))continue;throw new Error(`Cannot resolve ref "${t.ref}". Property "${i}" already exists in schema "${t.sourceSchemaId}".`)}n[i]=s[i]}t.isResolved=!0}}#l(t,r){let n=this.#e[r];if(n!==void 0){if(this.#s&&TI(t,n.schema))return;throw new Error(`There is already another schema with id "${r}".`)}this.#e[r]={schema:t,anchors:{},refs:[]}}#u(t,r,n){let{anchors:s}=this.#e[r];if(s[n]!==void 0)throw new Error(`There is already another anchor "${n}" in schema "${r}".`);s[n]=t}#c(t,r){this.#t[r]===void 0&&(this.#t[r]={schema:t,anchors:{}})}#f(t,r,n){let{anchors:s}=this.#t[r];s[n]=t}};function OI(e,t){let r=t.split("/"),n=e;for(let s of r)if(!(s===""||s==="#")){if(typeof n!="object"||n===null)return null;n=n[s]}return n??null}PI.exports={RefResolver:ry}});var no=S(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.regexpCode=de.getEsmExportName=de.getProperty=de.safeStringify=de.stringify=de.strConcat=de.addCodeArg=de.str=de._=de.nil=de._Code=de.Name=de.IDENTIFIER=de._CodeOrName=void 0;var rl=class{};de._CodeOrName=rl;de.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Js=class extends rl{constructor(t){if(super(),!de.IDENTIFIER.test(t))throw new Error("CodeGen: name must be a valid identifier");this.str=t}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};de.Name=Js;var fr=class extends rl{constructor(t){super(),this._items=typeof t=="string"?[t]:t}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let t=this._items[0];return t===""||t==='""'}get str(){var t;return(t=this._str)!==null&&t!==void 0?t:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var t;return(t=this._names)!==null&&t!==void 0?t:this._names=this._items.reduce((r,n)=>(n instanceof Js&&(r[n.str]=(r[n.str]||0)+1),r),{})}};de._Code=fr;de.nil=new fr("");function AI(e,...t){let r=[e[0]],n=0;for(;n<t.length;)sy(r,t[n]),r.push(e[++n]);return new fr(r)}de._=AI;var ny=new fr("+");function CI(e,...t){let r=[nl(e[0])],n=0;for(;n<t.length;)r.push(ny),sy(r,t[n]),r.push(ny,nl(e[++n]));return J7(r),new fr(r)}de.str=CI;function sy(e,t){t instanceof fr?e.push(...t._items):t instanceof Js?e.push(t):e.push(Z7(t))}de.addCodeArg=sy;function J7(e){let t=1;for(;t<e.length-1;){if(e[t]===ny){let r=Y7(e[t-1],e[t+1]);if(r!==void 0){e.splice(t-1,3,r);continue}e[t++]="+"}t++}}function Y7(e,t){if(t==='""')return e;if(e==='""')return t;if(typeof e=="string")return t instanceof Js||e[e.length-1]!=='"'?void 0:typeof t!="string"?`${e.slice(0,-1)}${t}"`:t[0]==='"'?e.slice(0,-1)+t.slice(1):void 0;if(typeof t=="string"&&t[0]==='"'&&!(e instanceof Js))return`"${e}${t.slice(1)}`}function X7(e,t){return t.emptyStr()?e:e.emptyStr()?t:CI`${e}${t}`}de.strConcat=X7;function Z7(e){return typeof e=="number"||typeof e=="boolean"||e===null?e:nl(Array.isArray(e)?e.join(","):e)}function Q7(e){return new fr(nl(e))}de.stringify=Q7;function nl(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}de.safeStringify=nl;function eG(e){return typeof e=="string"&&de.IDENTIFIER.test(e)?new fr(`.${e}`):AI`[${e}]`}de.getProperty=eG;function tG(e){if(typeof e=="string"&&de.IDENTIFIER.test(e))return new fr(`${e}`);throw new Error(`CodeGen: invalid export name: ${e}, use explicit $id name mapping`)}de.getEsmExportName=tG;function rG(e){return new fr(e.toString())}de.regexpCode=rG});var Cf=S(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.ValueScope=Bt.ValueScopeName=Bt.Scope=Bt.varKinds=Bt.UsedValueState=void 0;var Ht=no(),iy=class extends Error{constructor(t){super(`CodeGen: "code" for ${t} not defined`),this.value=t.value}},Pf;(function(e){e[e.Started=0]="Started",e[e.Completed=1]="Completed"})(Pf||(Bt.UsedValueState=Pf={}));Bt.varKinds={const:new Ht.Name("const"),let:new Ht.Name("let"),var:new Ht.Name("var")};var If=class{constructor({prefixes:t,parent:r}={}){this._names={},this._prefixes=t,this._parent=r}toName(t){return t instanceof Ht.Name?t:this.name(t)}name(t){return new Ht.Name(this._newName(t))}_newName(t){let r=this._names[t]||this._nameGroup(t);return`${t}${r.index++}`}_nameGroup(t){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(t)||this._prefixes&&!this._prefixes.has(t))throw new Error(`CodeGen: prefix "${t}" is not allowed in this scope`);return this._names[t]={prefix:t,index:0}}};Bt.Scope=If;var Af=class extends Ht.Name{constructor(t,r){super(r),this.prefix=t}setValue(t,{property:r,itemIndex:n}){this.value=t,this.scopePath=(0,Ht._)`.${new Ht.Name(r)}[${n}]`}};Bt.ValueScopeName=Af;var nG=(0,Ht._)`\n`,oy=class extends If{constructor(t){super(t),this._values={},this._scope=t.scope,this.opts={...t,_n:t.lines?nG:Ht.nil}}get(){return this._scope}name(t){return new Af(t,this._newName(t))}value(t,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let s=this.toName(t),{prefix:i}=s,o=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[i];if(a){let u=a.get(o);if(u)return u}else a=this._values[i]=new Map;a.set(o,s);let l=this._scope[i]||(this._scope[i]=[]),c=l.length;return l[c]=r.ref,s.setValue(r,{property:i,itemIndex:c}),s}getValue(t,r){let n=this._values[t];if(n)return n.get(r)}scopeRefs(t,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Ht._)`${t}${n.scopePath}`})}scopeCode(t=this._values,r,n){return this._reduceValues(t,s=>{if(s.value===void 0)throw new Error(`CodeGen: name "${s}" has no value`);return s.value.code},r,n)}_reduceValues(t,r,n={},s){let i=Ht.nil;for(let o in t){let a=t[o];if(!a)continue;let l=n[o]=n[o]||new Map;a.forEach(c=>{if(l.has(c))return;l.set(c,Pf.Started);let u=r(c);if(u){let f=this.opts.es5?Bt.varKinds.var:Bt.varKinds.const;i=(0,Ht._)`${i}${f} ${c} = ${u};${this.opts._n}`}else if(u=s?.(c))i=(0,Ht._)`${i}${u}${this.opts._n}`;else throw new iy(c);l.set(c,Pf.Completed)})}return i}};Bt.ValueScope=oy});var W=S(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.or=ee.and=ee.not=ee.CodeGen=ee.operators=ee.varKinds=ee.ValueScopeName=ee.ValueScope=ee.Scope=ee.Name=ee.regexpCode=ee.stringify=ee.getProperty=ee.nil=ee.strConcat=ee.str=ee._=void 0;var ce=no(),Ar=Cf(),ts=no();Object.defineProperty(ee,"_",{enumerable:!0,get:function(){return ts._}});Object.defineProperty(ee,"str",{enumerable:!0,get:function(){return ts.str}});Object.defineProperty(ee,"strConcat",{enumerable:!0,get:function(){return ts.strConcat}});Object.defineProperty(ee,"nil",{enumerable:!0,get:function(){return ts.nil}});Object.defineProperty(ee,"getProperty",{enumerable:!0,get:function(){return ts.getProperty}});Object.defineProperty(ee,"stringify",{enumerable:!0,get:function(){return ts.stringify}});Object.defineProperty(ee,"regexpCode",{enumerable:!0,get:function(){return ts.regexpCode}});Object.defineProperty(ee,"Name",{enumerable:!0,get:function(){return ts.Name}});var kf=Cf();Object.defineProperty(ee,"Scope",{enumerable:!0,get:function(){return kf.Scope}});Object.defineProperty(ee,"ValueScope",{enumerable:!0,get:function(){return kf.ValueScope}});Object.defineProperty(ee,"ValueScopeName",{enumerable:!0,get:function(){return kf.ValueScopeName}});Object.defineProperty(ee,"varKinds",{enumerable:!0,get:function(){return kf.varKinds}});ee.operators={GT:new ce._Code(">"),GTE:new ce._Code(">="),LT:new ce._Code("<"),LTE:new ce._Code("<="),EQ:new ce._Code("==="),NEQ:new ce._Code("!=="),NOT:new ce._Code("!"),OR:new ce._Code("||"),AND:new ce._Code("&&"),ADD:new ce._Code("+")};var Sn=class{optimizeNodes(){return this}optimizeNames(t,r){return this}},ay=class extends Sn{constructor(t,r,n){super(),this.varKind=t,this.name=r,this.rhs=n}render({es5:t,_n:r}){let n=t?Ar.varKinds.var:this.varKind,s=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${s};`+r}optimizeNames(t,r){if(t[this.name.str])return this.rhs&&(this.rhs=io(this.rhs,t,r)),this}get names(){return this.rhs instanceof ce._CodeOrName?this.rhs.names:{}}},Nf=class extends Sn{constructor(t,r,n){super(),this.lhs=t,this.rhs=r,this.sideEffects=n}render({_n:t}){return`${this.lhs} = ${this.rhs};`+t}optimizeNames(t,r){if(!(this.lhs instanceof ce.Name&&!t[this.lhs.str]&&!this.sideEffects))return this.rhs=io(this.rhs,t,r),this}get names(){let t=this.lhs instanceof ce.Name?{}:{...this.lhs.names};return xf(t,this.rhs)}},ly=class extends Nf{constructor(t,r,n,s){super(t,n,s),this.op=r}render({_n:t}){return`${this.lhs} ${this.op}= ${this.rhs};`+t}},cy=class extends Sn{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`${this.label}:`+t}},uy=class extends Sn{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`break${this.label?` ${this.label}`:""};`+t}},fy=class extends Sn{constructor(t){super(),this.error=t}render({_n:t}){return`throw ${this.error};`+t}get names(){return this.error.names}},dy=class extends Sn{constructor(t){super(),this.code=t}render({_n:t}){return`${this.code};`+t}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(t,r){return this.code=io(this.code,t,r),this}get names(){return this.code instanceof ce._CodeOrName?this.code.names:{}}},sl=class extends Sn{constructor(t=[]){super(),this.nodes=t}render(t){return this.nodes.reduce((r,n)=>r+n.render(t),"")}optimizeNodes(){let{nodes:t}=this,r=t.length;for(;r--;){let n=t[r].optimizeNodes();Array.isArray(n)?t.splice(r,1,...n):n?t[r]=n:t.splice(r,1)}return t.length>0?this:void 0}optimizeNames(t,r){let{nodes:n}=this,s=n.length;for(;s--;){let i=n[s];i.optimizeNames(t,r)||(sG(t,i.names),n.splice(s,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((t,r)=>Zs(t,r.names),{})}},vn=class extends sl{render(t){return"{"+t._n+super.render(t)+"}"+t._n}},hy=class extends sl{},so=class extends vn{};so.kind="else";var Ys=class e extends vn{constructor(t,r){super(r),this.condition=t}render(t){let r=`if(${this.condition})`+super.render(t);return this.else&&(r+="else "+this.else.render(t)),r}optimizeNodes(){super.optimizeNodes();let t=this.condition;if(t===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new so(n):n}if(r)return t===!1?r instanceof e?r:r.nodes:this.nodes.length?this:new e(NI(t),r instanceof e?[r]:r.nodes);if(!(t===!1||!this.nodes.length))return this}optimizeNames(t,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(t,r),!!(super.optimizeNames(t,r)||this.else))return this.condition=io(this.condition,t,r),this}get names(){let t=super.names;return xf(t,this.condition),this.else&&Zs(t,this.else.names),t}};Ys.kind="if";var Xs=class extends vn{};Xs.kind="for";var py=class extends Xs{constructor(t){super(),this.iteration=t}render(t){return`for(${this.iteration})`+super.render(t)}optimizeNames(t,r){if(super.optimizeNames(t,r))return this.iteration=io(this.iteration,t,r),this}get names(){return Zs(super.names,this.iteration.names)}},my=class extends Xs{constructor(t,r,n,s){super(),this.varKind=t,this.name=r,this.from=n,this.to=s}render(t){let r=t.es5?Ar.varKinds.var:this.varKind,{name:n,from:s,to:i}=this;return`for(${r} ${n}=${s}; ${n}<${i}; ${n}++)`+super.render(t)}get names(){let t=xf(super.names,this.from);return xf(t,this.to)}},$f=class extends Xs{constructor(t,r,n,s){super(),this.loop=t,this.varKind=r,this.name=n,this.iterable=s}render(t){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(t)}optimizeNames(t,r){if(super.optimizeNames(t,r))return this.iterable=io(this.iterable,t,r),this}get names(){return Zs(super.names,this.iterable.names)}},il=class extends vn{constructor(t,r,n){super(),this.name=t,this.args=r,this.async=n}render(t){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(t)}};il.kind="func";var ol=class extends sl{render(t){return"return "+super.render(t)}};ol.kind="return";var gy=class extends vn{render(t){let r="try"+super.render(t);return this.catch&&(r+=this.catch.render(t)),this.finally&&(r+=this.finally.render(t)),r}optimizeNodes(){var t,r;return super.optimizeNodes(),(t=this.catch)===null||t===void 0||t.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(t,r){var n,s;return super.optimizeNames(t,r),(n=this.catch)===null||n===void 0||n.optimizeNames(t,r),(s=this.finally)===null||s===void 0||s.optimizeNames(t,r),this}get names(){let t=super.names;return this.catch&&Zs(t,this.catch.names),this.finally&&Zs(t,this.finally.names),t}},al=class extends vn{constructor(t){super(),this.error=t}render(t){return`catch(${this.error})`+super.render(t)}};al.kind="catch";var ll=class extends vn{render(t){return"finally"+super.render(t)}};ll.kind="finally";var yy=class{constructor(t,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=t,this._scope=new Ar.Scope({parent:t}),this._nodes=[new hy]}toString(){return this._root.render(this.opts)}name(t){return this._scope.name(t)}scopeName(t){return this._extScope.name(t)}scopeValue(t,r){let n=this._extScope.value(t,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(t,r){return this._extScope.getValue(t,r)}scopeRefs(t){return this._extScope.scopeRefs(t,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(t,r,n,s){let i=this._scope.toName(r);return n!==void 0&&s&&(this._constants[i.str]=n),this._leafNode(new ay(t,i,n)),i}const(t,r,n){return this._def(Ar.varKinds.const,t,r,n)}let(t,r,n){return this._def(Ar.varKinds.let,t,r,n)}var(t,r,n){return this._def(Ar.varKinds.var,t,r,n)}assign(t,r,n){return this._leafNode(new Nf(t,r,n))}add(t,r){return this._leafNode(new ly(t,ee.operators.ADD,r))}code(t){return typeof t=="function"?t():t!==ce.nil&&this._leafNode(new dy(t)),this}object(...t){let r=["{"];for(let[n,s]of t)r.length>1&&r.push(","),r.push(n),(n!==s||this.opts.es5)&&(r.push(":"),(0,ce.addCodeArg)(r,s));return r.push("}"),new ce._Code(r)}if(t,r,n){if(this._blockNode(new Ys(t)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(t){return this._elseNode(new Ys(t))}else(){return this._elseNode(new so)}endIf(){return this._endBlockNode(Ys,so)}_for(t,r){return this._blockNode(t),r&&this.code(r).endFor(),this}for(t,r){return this._for(new py(t),r)}forRange(t,r,n,s,i=this.opts.es5?Ar.varKinds.var:Ar.varKinds.let){let o=this._scope.toName(t);return this._for(new my(i,o,r,n),()=>s(o))}forOf(t,r,n,s=Ar.varKinds.const){let i=this._scope.toName(t);if(this.opts.es5){let o=r instanceof ce.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,ce._)`${o}.length`,a=>{this.var(i,(0,ce._)`${o}[${a}]`),n(i)})}return this._for(new $f("of",s,i,r),()=>n(i))}forIn(t,r,n,s=this.opts.es5?Ar.varKinds.var:Ar.varKinds.const){if(this.opts.ownProperties)return this.forOf(t,(0,ce._)`Object.keys(${r})`,n);let i=this._scope.toName(t);return this._for(new $f("in",s,i,r),()=>n(i))}endFor(){return this._endBlockNode(Xs)}label(t){return this._leafNode(new cy(t))}break(t){return this._leafNode(new uy(t))}return(t){let r=new ol;if(this._blockNode(r),this.code(t),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(ol)}try(t,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let s=new gy;if(this._blockNode(s),this.code(t),r){let i=this.name("e");this._currNode=s.catch=new al(i),r(i)}return n&&(this._currNode=s.finally=new ll,this.code(n)),this._endBlockNode(al,ll)}throw(t){return this._leafNode(new fy(t))}block(t,r){return this._blockStarts.push(this._nodes.length),t&&this.code(t).endBlock(r),this}endBlock(t){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||t!==void 0&&n!==t)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${t} expected`);return this._nodes.length=r,this}func(t,r=ce.nil,n,s){return this._blockNode(new il(t,r,n)),s&&this.code(s).endFunc(),this}endFunc(){return this._endBlockNode(il)}optimize(t=1){for(;t-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(t){return this._currNode.nodes.push(t),this}_blockNode(t){this._currNode.nodes.push(t),this._nodes.push(t)}_endBlockNode(t,r){let n=this._currNode;if(n instanceof t||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${t.kind}/${r.kind}`:t.kind}"`)}_elseNode(t){let r=this._currNode;if(!(r instanceof Ys))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=t,this}get _root(){return this._nodes[0]}get _currNode(){let t=this._nodes;return t[t.length-1]}set _currNode(t){let r=this._nodes;r[r.length-1]=t}};ee.CodeGen=yy;function Zs(e,t){for(let r in t)e[r]=(e[r]||0)+(t[r]||0);return e}function xf(e,t){return t instanceof ce._CodeOrName?Zs(e,t.names):e}function io(e,t,r){if(e instanceof ce.Name)return n(e);if(!s(e))return e;return new ce._Code(e._items.reduce((i,o)=>(o instanceof ce.Name&&(o=n(o)),o instanceof ce._Code?i.push(...o._items):i.push(o),i),[]));function n(i){let o=r[i.str];return o===void 0||t[i.str]!==1?i:(delete t[i.str],o)}function s(i){return i instanceof ce._Code&&i._items.some(o=>o instanceof ce.Name&&t[o.str]===1&&r[o.str]!==void 0)}}function sG(e,t){for(let r in t)e[r]=(e[r]||0)-(t[r]||0)}function NI(e){return typeof e=="boolean"||typeof e=="number"||e===null?!e:(0,ce._)`!${_y(e)}`}ee.not=NI;var iG=$I(ee.operators.AND);function oG(...e){return e.reduce(iG)}ee.and=oG;var aG=$I(ee.operators.OR);function lG(...e){return e.reduce(aG)}ee.or=lG;function $I(e){return(t,r)=>t===ce.nil?r:r===ce.nil?t:(0,ce._)`${_y(t)} ${e} ${_y(r)}`}function _y(e){return e instanceof ce.Name?e:(0,ce._)`(${e})`}});var Z=S(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.checkStrictMode=ne.getErrorPath=ne.Type=ne.useFunc=ne.setEvaluated=ne.evaluatedPropsToName=ne.mergeEvaluated=ne.eachItem=ne.unescapeJsonPointer=ne.escapeJsonPointer=ne.escapeFragment=ne.unescapeFragment=ne.schemaRefOrVal=ne.schemaHasRulesButRef=ne.schemaHasRules=ne.checkUnknownRules=ne.alwaysValidSchema=ne.toHash=void 0;var Re=W(),cG=no();function uG(e){let t={};for(let r of e)t[r]=!0;return t}ne.toHash=uG;function fG(e,t){return typeof t=="boolean"?t:Object.keys(t).length===0?!0:(LI(e,t),!DI(t,e.self.RULES.all))}ne.alwaysValidSchema=fG;function LI(e,t=e.schema){let{opts:r,self:n}=e;if(!r.strictSchema||typeof t=="boolean")return;let s=n.RULES.keywords;for(let i in t)s[i]||jI(e,`unknown keyword: "${i}"`)}ne.checkUnknownRules=LI;function DI(e,t){if(typeof e=="boolean")return!e;for(let r in e)if(t[r])return!0;return!1}ne.schemaHasRules=DI;function dG(e,t){if(typeof e=="boolean")return!e;for(let r in e)if(r!=="$ref"&&t.all[r])return!0;return!1}ne.schemaHasRulesButRef=dG;function hG({topSchemaRef:e,schemaPath:t},r,n,s){if(!s){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,Re._)`${r}`}return(0,Re._)`${e}${t}${(0,Re.getProperty)(n)}`}ne.schemaRefOrVal=hG;function pG(e){return qI(decodeURIComponent(e))}ne.unescapeFragment=pG;function mG(e){return encodeURIComponent(Sy(e))}ne.escapeFragment=mG;function Sy(e){return typeof e=="number"?`${e}`:e.replace(/~/g,"~0").replace(/\//g,"~1")}ne.escapeJsonPointer=Sy;function qI(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}ne.unescapeJsonPointer=qI;function gG(e,t){if(Array.isArray(e))for(let r of e)t(r);else t(e)}ne.eachItem=gG;function xI({mergeNames:e,mergeToName:t,mergeValues:r,resultToName:n}){return(s,i,o,a)=>{let l=o===void 0?i:o instanceof Re.Name?(i instanceof Re.Name?e(s,i,o):t(s,i,o),o):i instanceof Re.Name?(t(s,o,i),i):r(i,o);return a===Re.Name&&!(l instanceof Re.Name)?n(s,l):l}}ne.mergeEvaluated={props:xI({mergeNames:(e,t,r)=>e.if((0,Re._)`${r} !== true && ${t} !== undefined`,()=>{e.if((0,Re._)`${t} === true`,()=>e.assign(r,!0),()=>e.assign(r,(0,Re._)`${r} || {}`).code((0,Re._)`Object.assign(${r}, ${t})`))}),mergeToName:(e,t,r)=>e.if((0,Re._)`${r} !== true`,()=>{t===!0?e.assign(r,!0):(e.assign(r,(0,Re._)`${r} || {}`),vy(e,r,t))}),mergeValues:(e,t)=>e===!0?!0:{...e,...t},resultToName:MI}),items:xI({mergeNames:(e,t,r)=>e.if((0,Re._)`${r} !== true && ${t} !== undefined`,()=>e.assign(r,(0,Re._)`${t} === true ? true : ${r} > ${t} ? ${r} : ${t}`)),mergeToName:(e,t,r)=>e.if((0,Re._)`${r} !== true`,()=>e.assign(r,t===!0?!0:(0,Re._)`${r} > ${t} ? ${r} : ${t}`)),mergeValues:(e,t)=>e===!0?!0:Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})};function MI(e,t){if(t===!0)return e.var("props",!0);let r=e.var("props",(0,Re._)`{}`);return t!==void 0&&vy(e,r,t),r}ne.evaluatedPropsToName=MI;function vy(e,t,r){Object.keys(r).forEach(n=>e.assign((0,Re._)`${t}${(0,Re.getProperty)(n)}`,!0))}ne.setEvaluated=vy;var kI={};function yG(e,t){return e.scopeValue("func",{ref:t,code:kI[t.code]||(kI[t.code]=new cG._Code(t.code))})}ne.useFunc=yG;var by;(function(e){e[e.Num=0]="Num",e[e.Str=1]="Str"})(by||(ne.Type=by={}));function _G(e,t,r){if(e instanceof Re.Name){let n=t===by.Num;return r?n?(0,Re._)`"[" + ${e} + "]"`:(0,Re._)`"['" + ${e} + "']"`:n?(0,Re._)`"/" + ${e}`:(0,Re._)`"/" + ${e}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,Re.getProperty)(e).toString():"/"+Sy(e)}ne.getErrorPath=_G;function jI(e,t,r=e.opts.strictSchema){if(r){if(t=`strict mode: ${t}`,r===!0)throw new Error(t);e.self.logger.warn(t)}}ne.checkStrictMode=jI});var dr=S(Ey=>{"use strict";Object.defineProperty(Ey,"__esModule",{value:!0});var Rt=W(),bG={data:new Rt.Name("data"),valCxt:new Rt.Name("valCxt"),instancePath:new Rt.Name("instancePath"),parentData:new Rt.Name("parentData"),parentDataProperty:new Rt.Name("parentDataProperty"),rootData:new Rt.Name("rootData"),dynamicAnchors:new Rt.Name("dynamicAnchors"),vErrors:new Rt.Name("vErrors"),errors:new Rt.Name("errors"),this:new Rt.Name("this"),self:new Rt.Name("self"),scope:new Rt.Name("scope"),json:new Rt.Name("json"),jsonPos:new Rt.Name("jsonPos"),jsonLen:new Rt.Name("jsonLen"),jsonPart:new Rt.Name("jsonPart")};Ey.default=bG});var cl=S(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.extendErrors=Tt.resetErrorsCount=Tt.reportExtraError=Tt.reportError=Tt.keyword$DataError=Tt.keywordError=void 0;var ue=W(),Lf=Z(),$t=dr();Tt.keywordError={message:({keyword:e})=>(0,ue.str)`must pass "${e}" keyword validation`};Tt.keyword$DataError={message:({keyword:e,schemaType:t})=>t?(0,ue.str)`"${e}" keyword must be ${t} ($data)`:(0,ue.str)`"${e}" keyword is invalid ($data)`};function SG(e,t=Tt.keywordError,r,n){let{it:s}=e,{gen:i,compositeRule:o,allErrors:a}=s,l=UI(e,t,r);n??(o||a)?FI(i,l):VI(s,(0,ue._)`[${l}]`)}Tt.reportError=SG;function vG(e,t=Tt.keywordError,r){let{it:n}=e,{gen:s,compositeRule:i,allErrors:o}=n,a=UI(e,t,r);FI(s,a),i||o||VI(n,$t.default.vErrors)}Tt.reportExtraError=vG;function EG(e,t){e.assign($t.default.errors,t),e.if((0,ue._)`${$t.default.vErrors} !== null`,()=>e.if(t,()=>e.assign((0,ue._)`${$t.default.vErrors}.length`,t),()=>e.assign($t.default.vErrors,null)))}Tt.resetErrorsCount=EG;function wG({gen:e,keyword:t,schemaValue:r,data:n,errsCount:s,it:i}){if(s===void 0)throw new Error("ajv implementation error");let o=e.name("err");e.forRange("i",s,$t.default.errors,a=>{e.const(o,(0,ue._)`${$t.default.vErrors}[${a}]`),e.if((0,ue._)`${o}.instancePath === undefined`,()=>e.assign((0,ue._)`${o}.instancePath`,(0,ue.strConcat)($t.default.instancePath,i.errorPath))),e.assign((0,ue._)`${o}.schemaPath`,(0,ue.str)`${i.errSchemaPath}/${t}`),i.opts.verbose&&(e.assign((0,ue._)`${o}.schema`,r),e.assign((0,ue._)`${o}.data`,n))})}Tt.extendErrors=wG;function FI(e,t){let r=e.const("err",t);e.if((0,ue._)`${$t.default.vErrors} === null`,()=>e.assign($t.default.vErrors,(0,ue._)`[${r}]`),(0,ue._)`${$t.default.vErrors}.push(${r})`),e.code((0,ue._)`${$t.default.errors}++`)}function VI(e,t){let{gen:r,validateName:n,schemaEnv:s}=e;s.$async?r.throw((0,ue._)`new ${e.ValidationError}(${t})`):(r.assign((0,ue._)`${n}.errors`,t),r.return(!1))}var Qs={keyword:new ue.Name("keyword"),schemaPath:new ue.Name("schemaPath"),params:new ue.Name("params"),propertyName:new ue.Name("propertyName"),message:new ue.Name("message"),schema:new ue.Name("schema"),parentSchema:new ue.Name("parentSchema")};function UI(e,t,r){let{createErrors:n}=e.it;return n===!1?(0,ue._)`{}`:RG(e,t,r)}function RG(e,t,r={}){let{gen:n,it:s}=e,i=[TG(s,r),OG(e,r)];return PG(e,t,i),n.object(...i)}function TG({errorPath:e},{instancePath:t}){let r=t?(0,ue.str)`${e}${(0,Lf.getErrorPath)(t,Lf.Type.Str)}`:e;return[$t.default.instancePath,(0,ue.strConcat)($t.default.instancePath,r)]}function OG({keyword:e,it:{errSchemaPath:t}},{schemaPath:r,parentSchema:n}){let s=n?t:(0,ue.str)`${t}/${e}`;return r&&(s=(0,ue.str)`${s}${(0,Lf.getErrorPath)(r,Lf.Type.Str)}`),[Qs.schemaPath,s]}function PG(e,{params:t,message:r},n){let{keyword:s,data:i,schemaValue:o,it:a}=e,{opts:l,propertyName:c,topSchemaRef:u,schemaPath:f}=a;n.push([Qs.keyword,s],[Qs.params,typeof t=="function"?t(e):t||(0,ue._)`{}`]),l.messages&&n.push([Qs.message,typeof r=="function"?r(e):r]),l.verbose&&n.push([Qs.schema,o],[Qs.parentSchema,(0,ue._)`${u}${f}`],[$t.default.data,i]),c&&n.push([Qs.propertyName,c])}});var BI=S(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.boolOrEmptySchema=oo.topBoolOrEmptySchema=void 0;var IG=cl(),AG=W(),CG=dr(),NG={message:"boolean schema is false"};function $G(e){let{gen:t,schema:r,validateName:n}=e;r===!1?HI(e,!1):typeof r=="object"&&r.$async===!0?t.return(CG.default.data):(t.assign((0,AG._)`${n}.errors`,null),t.return(!0))}oo.topBoolOrEmptySchema=$G;function xG(e,t){let{gen:r,schema:n}=e;n===!1?(r.var(t,!1),HI(e)):r.var(t,!0)}oo.boolOrEmptySchema=xG;function HI(e,t){let{gen:r,data:n}=e,s={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,IG.reportError)(s,NG,void 0,t)}});var wy=S(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.getRules=ao.isJSONType=void 0;var kG=["string","number","integer","boolean","null","object","array"],LG=new Set(kG);function DG(e){return typeof e=="string"&&LG.has(e)}ao.isJSONType=DG;function qG(){let e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}ao.getRules=qG});var Ry=S(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.shouldUseRule=rs.shouldUseGroup=rs.schemaHasRulesForType=void 0;function MG({schema:e,self:t},r){let n=t.RULES.types[r];return n&&n!==!0&&zI(e,n)}rs.schemaHasRulesForType=MG;function zI(e,t){return t.rules.some(r=>GI(e,r))}rs.shouldUseGroup=zI;function GI(e,t){var r;return e[t.keyword]!==void 0||((r=t.definition.implements)===null||r===void 0?void 0:r.some(n=>e[n]!==void 0))}rs.shouldUseRule=GI});var ul=S(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.reportTypeError=Ot.checkDataTypes=Ot.checkDataType=Ot.coerceAndCheckDataType=Ot.getJSONTypes=Ot.getSchemaTypes=Ot.DataType=void 0;var jG=wy(),FG=Ry(),VG=cl(),X=W(),WI=Z(),lo;(function(e){e[e.Correct=0]="Correct",e[e.Wrong=1]="Wrong"})(lo||(Ot.DataType=lo={}));function UG(e){let t=KI(e.type);if(t.includes("null")){if(e.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&e.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');e.nullable===!0&&t.push("null")}return t}Ot.getSchemaTypes=UG;function KI(e){let t=Array.isArray(e)?e:e?[e]:[];if(t.every(jG.isJSONType))return t;throw new Error("type must be JSONType or JSONType[]: "+t.join(","))}Ot.getJSONTypes=KI;function HG(e,t){let{gen:r,data:n,opts:s}=e,i=BG(t,s.coerceTypes),o=t.length>0&&!(i.length===0&&t.length===1&&(0,FG.schemaHasRulesForType)(e,t[0]));if(o){let a=Oy(t,n,s.strictNumbers,lo.Wrong);r.if(a,()=>{i.length?zG(e,t,i):Py(e)})}return o}Ot.coerceAndCheckDataType=HG;var JI=new Set(["string","number","integer","boolean","null"]);function BG(e,t){return t?e.filter(r=>JI.has(r)||t==="array"&&r==="array"):[]}function zG(e,t,r){let{gen:n,data:s,opts:i}=e,o=n.let("dataType",(0,X._)`typeof ${s}`),a=n.let("coerced",(0,X._)`undefined`);i.coerceTypes==="array"&&n.if((0,X._)`${o} == 'object' && Array.isArray(${s}) && ${s}.length == 1`,()=>n.assign(s,(0,X._)`${s}[0]`).assign(o,(0,X._)`typeof ${s}`).if(Oy(t,s,i.strictNumbers),()=>n.assign(a,s))),n.if((0,X._)`${a} !== undefined`);for(let c of r)(JI.has(c)||c==="array"&&i.coerceTypes==="array")&&l(c);n.else(),Py(e),n.endIf(),n.if((0,X._)`${a} !== undefined`,()=>{n.assign(s,a),GG(e,a)});function l(c){switch(c){case"string":n.elseIf((0,X._)`${o} == "number" || ${o} == "boolean"`).assign(a,(0,X._)`"" + ${s}`).elseIf((0,X._)`${s} === null`).assign(a,(0,X._)`""`);return;case"number":n.elseIf((0,X._)`${o} == "boolean" || ${s} === null
              || (${o} == "string" && ${s} && ${s} == +${s})`).assign(a,(0,X._)`+${s}`);return;case"integer":n.elseIf((0,X._)`${o} === "boolean" || ${s} === null
              || (${o} === "string" && ${s} && ${s} == +${s} && !(${s} % 1))`).assign(a,(0,X._)`+${s}`);return;case"boolean":n.elseIf((0,X._)`${s} === "false" || ${s} === 0 || ${s} === null`).assign(a,!1).elseIf((0,X._)`${s} === "true" || ${s} === 1`).assign(a,!0);return;case"null":n.elseIf((0,X._)`${s} === "" || ${s} === 0 || ${s} === false`),n.assign(a,null);return;case"array":n.elseIf((0,X._)`${o} === "string" || ${o} === "number"
              || ${o} === "boolean" || ${s} === null`).assign(a,(0,X._)`[${s}]`)}}}function GG({gen:e,parentData:t,parentDataProperty:r},n){e.if((0,X._)`${t} !== undefined`,()=>e.assign((0,X._)`${t}[${r}]`,n))}function Ty(e,t,r,n=lo.Correct){let s=n===lo.Correct?X.operators.EQ:X.operators.NEQ,i;switch(e){case"null":return(0,X._)`${t} ${s} null`;case"array":i=(0,X._)`Array.isArray(${t})`;break;case"object":i=(0,X._)`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":i=o((0,X._)`!(${t} % 1) && !isNaN(${t})`);break;case"number":i=o();break;default:return(0,X._)`typeof ${t} ${s} ${e}`}return n===lo.Correct?i:(0,X.not)(i);function o(a=X.nil){return(0,X.and)((0,X._)`typeof ${t} == "number"`,a,r?(0,X._)`isFinite(${t})`:X.nil)}}Ot.checkDataType=Ty;function Oy(e,t,r,n){if(e.length===1)return Ty(e[0],t,r,n);let s,i=(0,WI.toHash)(e);if(i.array&&i.object){let o=(0,X._)`typeof ${t} != "object"`;s=i.null?o:(0,X._)`!${t} || ${o}`,delete i.null,delete i.array,delete i.object}else s=X.nil;i.number&&delete i.integer;for(let o in i)s=(0,X.and)(s,Ty(o,t,r,n));return s}Ot.checkDataTypes=Oy;var WG={message:({schema:e})=>`must be ${e}`,params:({schema:e,schemaValue:t})=>typeof e=="string"?(0,X._)`{type: ${e}}`:(0,X._)`{type: ${t}}`};function Py(e){let t=KG(e);(0,VG.reportError)(t,WG)}Ot.reportTypeError=Py;function KG(e){let{gen:t,data:r,schema:n}=e,s=(0,WI.schemaRefOrVal)(e,n,"type");return{gen:t,keyword:"type",data:r,schema:n.type,schemaCode:s,schemaValue:s,parentSchema:n,params:{},it:e}}});var XI=S(Df=>{"use strict";Object.defineProperty(Df,"__esModule",{value:!0});Df.assignDefaults=void 0;var co=W(),JG=Z();function YG(e,t){let{properties:r,items:n}=e.schema;if(t==="object"&&r)for(let s in r)YI(e,s,r[s].default);else t==="array"&&Array.isArray(n)&&n.forEach((s,i)=>YI(e,i,s.default))}Df.assignDefaults=YG;function YI(e,t,r){let{gen:n,compositeRule:s,data:i,opts:o}=e;if(r===void 0)return;let a=(0,co._)`${i}${(0,co.getProperty)(t)}`;if(s){(0,JG.checkStrictMode)(e,`default is ignored for: ${a}`);return}let l=(0,co._)`${a} === undefined`;o.useDefaults==="empty"&&(l=(0,co._)`${l} || ${a} === null || ${a} === ""`),n.if(l,(0,co._)`${a} = ${(0,co.stringify)(r)}`)}});var mt=S(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.validateUnion=Ee.validateArray=Ee.usePattern=Ee.callValidateCode=Ee.schemaProperties=Ee.allSchemaProperties=Ee.noPropertyInData=Ee.propertyInData=Ee.isOwnProperty=Ee.hasPropFunc=Ee.reportMissingProp=Ee.checkMissingProp=Ee.checkReportMissingProp=void 0;var Ae=W(),Iy=Z(),ns=dr(),XG=Z();function ZG(e,t){let{gen:r,data:n,it:s}=e;r.if(Cy(r,n,t,s.opts.ownProperties),()=>{e.setParams({missingProperty:(0,Ae._)`${t}`},!0),e.error()})}Ee.checkReportMissingProp=ZG;function QG({gen:e,data:t,it:{opts:r}},n,s){return(0,Ae.or)(...n.map(i=>(0,Ae.and)(Cy(e,t,i,r.ownProperties),(0,Ae._)`${s} = ${i}`)))}Ee.checkMissingProp=QG;function eW(e,t){e.setParams({missingProperty:t},!0),e.error()}Ee.reportMissingProp=eW;function ZI(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Ae._)`Object.prototype.hasOwnProperty`})}Ee.hasPropFunc=ZI;function Ay(e,t,r){return(0,Ae._)`${ZI(e)}.call(${t}, ${r})`}Ee.isOwnProperty=Ay;function tW(e,t,r,n){let s=(0,Ae._)`${t}${(0,Ae.getProperty)(r)} !== undefined`;return n?(0,Ae._)`${s} && ${Ay(e,t,r)}`:s}Ee.propertyInData=tW;function Cy(e,t,r,n){let s=(0,Ae._)`${t}${(0,Ae.getProperty)(r)} === undefined`;return n?(0,Ae.or)(s,(0,Ae.not)(Ay(e,t,r))):s}Ee.noPropertyInData=Cy;function QI(e){return e?Object.keys(e).filter(t=>t!=="__proto__"):[]}Ee.allSchemaProperties=QI;function rW(e,t){return QI(t).filter(r=>!(0,Iy.alwaysValidSchema)(e,t[r]))}Ee.schemaProperties=rW;function nW({schemaCode:e,data:t,it:{gen:r,topSchemaRef:n,schemaPath:s,errorPath:i},it:o},a,l,c){let u=c?(0,Ae._)`${e}, ${t}, ${n}${s}`:t,f=[[ns.default.instancePath,(0,Ae.strConcat)(ns.default.instancePath,i)],[ns.default.parentData,o.parentData],[ns.default.parentDataProperty,o.parentDataProperty],[ns.default.rootData,ns.default.rootData]];o.opts.dynamicRef&&f.push([ns.default.dynamicAnchors,ns.default.dynamicAnchors]);let p=(0,Ae._)`${u}, ${r.object(...f)}`;return l!==Ae.nil?(0,Ae._)`${a}.call(${l}, ${p})`:(0,Ae._)`${a}(${p})`}Ee.callValidateCode=nW;var sW=(0,Ae._)`new RegExp`;function iW({gen:e,it:{opts:t}},r){let n=t.unicodeRegExp?"u":"",{regExp:s}=t.code,i=s(r,n);return e.scopeValue("pattern",{key:i.toString(),ref:i,code:(0,Ae._)`${s.code==="new RegExp"?sW:(0,XG.useFunc)(e,s)}(${r}, ${n})`})}Ee.usePattern=iW;function oW(e){let{gen:t,data:r,keyword:n,it:s}=e,i=t.name("valid");if(s.allErrors){let a=t.let("valid",!0);return o(()=>t.assign(a,!1)),a}return t.var(i,!0),o(()=>t.break()),i;function o(a){let l=t.const("len",(0,Ae._)`${r}.length`);t.forRange("i",0,l,c=>{e.subschema({keyword:n,dataProp:c,dataPropType:Iy.Type.Num},i),t.if((0,Ae.not)(i),a)})}}Ee.validateArray=oW;function aW(e){let{gen:t,schema:r,keyword:n,it:s}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(l=>(0,Iy.alwaysValidSchema)(s,l))&&!s.opts.unevaluated)return;let o=t.let("valid",!1),a=t.name("_valid");t.block(()=>r.forEach((l,c)=>{let u=e.subschema({keyword:n,schemaProp:c,compositeRule:!0},a);t.assign(o,(0,Ae._)`${o} || ${a}`),e.mergeValidEvaluated(u,a)||t.if((0,Ae.not)(o))})),e.result(o,()=>e.reset(),()=>e.error(!0))}Ee.validateUnion=aW});var rA=S(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.validateKeywordUsage=zr.validSchemaType=zr.funcKeywordCode=zr.macroKeywordCode=void 0;var xt=W(),ei=dr(),lW=mt(),cW=cl();function uW(e,t){let{gen:r,keyword:n,schema:s,parentSchema:i,it:o}=e,a=t.macro.call(o.self,s,i,o),l=tA(r,n,a);o.opts.validateSchema!==!1&&o.self.validateSchema(a,!0);let c=r.name("valid");e.subschema({schema:a,schemaPath:xt.nil,errSchemaPath:`${o.errSchemaPath}/${n}`,topSchemaRef:l,compositeRule:!0},c),e.pass(c,()=>e.error(!0))}zr.macroKeywordCode=uW;function fW(e,t){var r;let{gen:n,keyword:s,schema:i,parentSchema:o,$data:a,it:l}=e;hW(l,t);let c=!a&&t.compile?t.compile.call(l.self,i,o,l):t.validate,u=tA(n,s,c),f=n.let("valid");e.block$data(f,p),e.ok((r=t.valid)!==null&&r!==void 0?r:f);function p(){if(t.errors===!1)m(),t.modifying&&eA(e),y(()=>e.error());else{let b=t.async?d():h();t.modifying&&eA(e),y(()=>dW(e,b))}}function d(){let b=n.let("ruleErrs",null);return n.try(()=>m((0,xt._)`await `),v=>n.assign(f,!1).if((0,xt._)`${v} instanceof ${l.ValidationError}`,()=>n.assign(b,(0,xt._)`${v}.errors`),()=>n.throw(v))),b}function h(){let b=(0,xt._)`${u}.errors`;return n.assign(b,null),m(xt.nil),b}function m(b=t.async?(0,xt._)`await `:xt.nil){let v=l.opts.passContext?ei.default.this:ei.default.self,_=!("compile"in t&&!a||t.schema===!1);n.assign(f,(0,xt._)`${b}${(0,lW.callValidateCode)(e,u,v,_)}`,t.modifying)}function y(b){var v;n.if((0,xt.not)((v=t.valid)!==null&&v!==void 0?v:f),b)}}zr.funcKeywordCode=fW;function eA(e){let{gen:t,data:r,it:n}=e;t.if(n.parentData,()=>t.assign(r,(0,xt._)`${n.parentData}[${n.parentDataProperty}]`))}function dW(e,t){let{gen:r}=e;r.if((0,xt._)`Array.isArray(${t})`,()=>{r.assign(ei.default.vErrors,(0,xt._)`${ei.default.vErrors} === null ? ${t} : ${ei.default.vErrors}.concat(${t})`).assign(ei.default.errors,(0,xt._)`${ei.default.vErrors}.length`),(0,cW.extendErrors)(e)},()=>e.error())}function hW({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function tA(e,t,r){if(r===void 0)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,xt.stringify)(r)})}function pW(e,t,r=!1){return!t.length||t.some(n=>n==="array"?Array.isArray(e):n==="object"?e&&typeof e=="object"&&!Array.isArray(e):typeof e==n||r&&typeof e>"u")}zr.validSchemaType=pW;function mW({schema:e,opts:t,self:r,errSchemaPath:n},s,i){if(Array.isArray(s.keyword)?!s.keyword.includes(i):s.keyword!==i)throw new Error("ajv implementation error");let o=s.dependencies;if(o?.some(a=>!Object.prototype.hasOwnProperty.call(e,a)))throw new Error(`parent schema must have dependencies of ${i}: ${o.join(",")}`);if(s.validateSchema&&!s.validateSchema(e[i])){let l=`keyword "${i}" value is invalid at path "${n}": `+r.errorsText(s.validateSchema.errors);if(t.validateSchema==="log")r.logger.error(l);else throw new Error(l)}}zr.validateKeywordUsage=mW});var sA=S(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.extendSubschemaMode=ss.extendSubschemaData=ss.getSubschema=void 0;var Gr=W(),nA=Z();function gW(e,{keyword:t,schemaProp:r,schema:n,schemaPath:s,errSchemaPath:i,topSchemaRef:o}){if(t!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(t!==void 0){let a=e.schema[t];return r===void 0?{schema:a,schemaPath:(0,Gr._)`${e.schemaPath}${(0,Gr.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:a[r],schemaPath:(0,Gr._)`${e.schemaPath}${(0,Gr.getProperty)(t)}${(0,Gr.getProperty)(r)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,nA.escapeFragment)(r)}`}}if(n!==void 0){if(s===void 0||i===void 0||o===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:s,topSchemaRef:o,errSchemaPath:i}}throw new Error('either "keyword" or "schema" must be passed')}ss.getSubschema=gW;function yW(e,t,{dataProp:r,dataPropType:n,data:s,dataTypes:i,propertyName:o}){if(s!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=t;if(r!==void 0){let{errorPath:c,dataPathArr:u,opts:f}=t,p=a.let("data",(0,Gr._)`${t.data}${(0,Gr.getProperty)(r)}`,!0);l(p),e.errorPath=(0,Gr.str)`${c}${(0,nA.getErrorPath)(r,n,f.jsPropertySyntax)}`,e.parentDataProperty=(0,Gr._)`${r}`,e.dataPathArr=[...u,e.parentDataProperty]}if(s!==void 0){let c=s instanceof Gr.Name?s:a.let("data",s,!0);l(c),o!==void 0&&(e.propertyName=o)}i&&(e.dataTypes=i);function l(c){e.data=c,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,c]}}ss.extendSubschemaData=yW;function _W(e,{jtdDiscriminator:t,jtdMetadata:r,compositeRule:n,createErrors:s,allErrors:i}){n!==void 0&&(e.compositeRule=n),s!==void 0&&(e.createErrors=s),i!==void 0&&(e.allErrors=i),e.jtdDiscriminator=t,e.jtdMetadata=r}ss.extendSubschemaMode=_W});var fl=S((lme,iA)=>{"use strict";iA.exports=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,i;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[s]))return!1;for(s=n;s--!==0;){var o=i[s];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r}});var aA=S((cme,oA)=>{"use strict";var is=oA.exports=function(e,t,r){typeof t=="function"&&(r=t,t={}),r=t.cb||r;var n=typeof r=="function"?r:r.pre||function(){},s=r.post||function(){};qf(t,n,s,e,"",e)};is.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};is.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};is.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};is.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function qf(e,t,r,n,s,i,o,a,l,c){if(n&&typeof n=="object"&&!Array.isArray(n)){t(n,s,i,o,a,l,c);for(var u in n){var f=n[u];if(Array.isArray(f)){if(u in is.arrayKeywords)for(var p=0;p<f.length;p++)qf(e,t,r,f[p],s+"/"+u+"/"+p,i,s,u,n,p)}else if(u in is.propsKeywords){if(f&&typeof f=="object")for(var d in f)qf(e,t,r,f[d],s+"/"+u+"/"+bW(d),i,s,u,n,d)}else(u in is.keywords||e.allKeys&&!(u in is.skipKeywords))&&qf(e,t,r,f,s+"/"+u,i,s,u,n)}r(n,s,i,o,a,l,c)}}function bW(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}});var dl=S(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.getSchemaRefs=zt.resolveUrl=zt.normalizeId=zt._getFullPath=zt.getFullPath=zt.inlineRef=void 0;var SW=Z(),vW=fl(),EW=aA(),wW=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function RW(e,t=!0){return typeof e=="boolean"?!0:t===!0?!Ny(e):t?lA(e)<=t:!1}zt.inlineRef=RW;var TW=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Ny(e){for(let t in e){if(TW.has(t))return!0;let r=e[t];if(Array.isArray(r)&&r.some(Ny)||typeof r=="object"&&Ny(r))return!0}return!1}function lA(e){let t=0;for(let r in e){if(r==="$ref")return 1/0;if(t++,!wW.has(r)&&(typeof e[r]=="object"&&(0,SW.eachItem)(e[r],n=>t+=lA(n)),t===1/0))return 1/0}return t}function cA(e,t="",r){r!==!1&&(t=uo(t));let n=e.parse(t);return uA(e,n)}zt.getFullPath=cA;function uA(e,t){return e.serialize(t).split("#")[0]+"#"}zt._getFullPath=uA;var OW=/#\/?$/;function uo(e){return e?e.replace(OW,""):""}zt.normalizeId=uo;function PW(e,t,r){return r=uo(r),e.resolve(t,r)}zt.resolveUrl=PW;var IW=/^[a-z_][-a-z0-9._]*$/i;function AW(e,t){if(typeof e=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,s=uo(e[r]||t),i={"":s},o=cA(n,s,!1),a={},l=new Set;return EW(e,{allKeys:!0},(f,p,d,h)=>{if(h===void 0)return;let m=o+p,y=i[h];typeof f[r]=="string"&&(y=b.call(this,f[r])),v.call(this,f.$anchor),v.call(this,f.$dynamicAnchor),i[p]=y;function b(_){let g=this.opts.uriResolver.resolve;if(_=uo(y?g(y,_):_),l.has(_))throw u(_);l.add(_);let T=this.refs[_];return typeof T=="string"&&(T=this.refs[T]),typeof T=="object"?c(f,T.schema,_):_!==uo(m)&&(_[0]==="#"?(c(f,a[_],_),a[_]=f):this.refs[_]=m),_}function v(_){if(typeof _=="string"){if(!IW.test(_))throw new Error(`invalid anchor "${_}"`);b.call(this,`#${_}`)}}}),a;function c(f,p,d){if(p!==void 0&&!vW(f,p))throw u(d)}function u(f){return new Error(`reference "${f}" resolves to more than one schema`)}}zt.getSchemaRefs=AW});var fo=S(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});os.getData=os.KeywordCxt=os.validateFunctionCode=void 0;var mA=BI(),fA=ul(),xy=Ry(),Mf=ul(),CW=XI(),pl=rA(),$y=sA(),z=W(),J=dr(),NW=dl(),En=Z(),hl=cl();function $W(e){if(_A(e)&&(bA(e),yA(e))){LW(e);return}gA(e,()=>(0,mA.topBoolOrEmptySchema)(e))}os.validateFunctionCode=$W;function gA({gen:e,validateName:t,schema:r,schemaEnv:n,opts:s},i){s.code.es5?e.func(t,(0,z._)`${J.default.data}, ${J.default.valCxt}`,n.$async,()=>{e.code((0,z._)`"use strict"; ${dA(r,s)}`),kW(e,s),e.code(i)}):e.func(t,(0,z._)`${J.default.data}, ${xW(s)}`,n.$async,()=>e.code(dA(r,s)).code(i))}function xW(e){return(0,z._)`{${J.default.instancePath}="", ${J.default.parentData}, ${J.default.parentDataProperty}, ${J.default.rootData}=${J.default.data}${e.dynamicRef?(0,z._)`, ${J.default.dynamicAnchors}={}`:z.nil}}={}`}function kW(e,t){e.if(J.default.valCxt,()=>{e.var(J.default.instancePath,(0,z._)`${J.default.valCxt}.${J.default.instancePath}`),e.var(J.default.parentData,(0,z._)`${J.default.valCxt}.${J.default.parentData}`),e.var(J.default.parentDataProperty,(0,z._)`${J.default.valCxt}.${J.default.parentDataProperty}`),e.var(J.default.rootData,(0,z._)`${J.default.valCxt}.${J.default.rootData}`),t.dynamicRef&&e.var(J.default.dynamicAnchors,(0,z._)`${J.default.valCxt}.${J.default.dynamicAnchors}`)},()=>{e.var(J.default.instancePath,(0,z._)`""`),e.var(J.default.parentData,(0,z._)`undefined`),e.var(J.default.parentDataProperty,(0,z._)`undefined`),e.var(J.default.rootData,J.default.data),t.dynamicRef&&e.var(J.default.dynamicAnchors,(0,z._)`{}`)})}function LW(e){let{schema:t,opts:r,gen:n}=e;gA(e,()=>{r.$comment&&t.$comment&&vA(e),FW(e),n.let(J.default.vErrors,null),n.let(J.default.errors,0),r.unevaluated&&DW(e),SA(e),HW(e)})}function DW(e){let{gen:t,validateName:r}=e;e.evaluated=t.const("evaluated",(0,z._)`${r}.evaluated`),t.if((0,z._)`${e.evaluated}.dynamicProps`,()=>t.assign((0,z._)`${e.evaluated}.props`,(0,z._)`undefined`)),t.if((0,z._)`${e.evaluated}.dynamicItems`,()=>t.assign((0,z._)`${e.evaluated}.items`,(0,z._)`undefined`))}function dA(e,t){let r=typeof e=="object"&&e[t.schemaId];return r&&(t.code.source||t.code.process)?(0,z._)`/*# sourceURL=${r} */`:z.nil}function qW(e,t){if(_A(e)&&(bA(e),yA(e))){MW(e,t);return}(0,mA.boolOrEmptySchema)(e,t)}function yA({schema:e,self:t}){if(typeof e=="boolean")return!e;for(let r in e)if(t.RULES.all[r])return!0;return!1}function _A(e){return typeof e.schema!="boolean"}function MW(e,t){let{schema:r,gen:n,opts:s}=e;s.$comment&&r.$comment&&vA(e),VW(e),UW(e);let i=n.const("_errs",J.default.errors);SA(e,i),n.var(t,(0,z._)`${i} === ${J.default.errors}`)}function bA(e){(0,En.checkUnknownRules)(e),jW(e)}function SA(e,t){if(e.opts.jtd)return hA(e,[],!1,t);let r=(0,fA.getSchemaTypes)(e.schema),n=(0,fA.coerceAndCheckDataType)(e,r);hA(e,r,!n,t)}function jW(e){let{schema:t,errSchemaPath:r,opts:n,self:s}=e;t.$ref&&n.ignoreKeywordsWithRef&&(0,En.schemaHasRulesButRef)(t,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function FW(e){let{schema:t,opts:r}=e;t.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,En.checkStrictMode)(e,"default is ignored in the schema root")}function VW(e){let t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,NW.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function UW(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function vA({gen:e,schemaEnv:t,schema:r,errSchemaPath:n,opts:s}){let i=r.$comment;if(s.$comment===!0)e.code((0,z._)`${J.default.self}.logger.log(${i})`);else if(typeof s.$comment=="function"){let o=(0,z.str)`${n}/$comment`,a=e.scopeValue("root",{ref:t.root});e.code((0,z._)`${J.default.self}.opts.$comment(${i}, ${o}, ${a}.schema)`)}}function HW(e){let{gen:t,schemaEnv:r,validateName:n,ValidationError:s,opts:i}=e;r.$async?t.if((0,z._)`${J.default.errors} === 0`,()=>t.return(J.default.data),()=>t.throw((0,z._)`new ${s}(${J.default.vErrors})`)):(t.assign((0,z._)`${n}.errors`,J.default.vErrors),i.unevaluated&&BW(e),t.return((0,z._)`${J.default.errors} === 0`))}function BW({gen:e,evaluated:t,props:r,items:n}){r instanceof z.Name&&e.assign((0,z._)`${t}.props`,r),n instanceof z.Name&&e.assign((0,z._)`${t}.items`,n)}function hA(e,t,r,n){let{gen:s,schema:i,data:o,allErrors:a,opts:l,self:c}=e,{RULES:u}=c;if(i.$ref&&(l.ignoreKeywordsWithRef||!(0,En.schemaHasRulesButRef)(i,u))){s.block(()=>wA(e,"$ref",u.all.$ref.definition));return}l.jtd||zW(e,t),s.block(()=>{for(let p of u.rules)f(p);f(u.post)});function f(p){(0,xy.shouldUseGroup)(i,p)&&(p.type?(s.if((0,Mf.checkDataType)(p.type,o,l.strictNumbers)),pA(e,p),t.length===1&&t[0]===p.type&&r&&(s.else(),(0,Mf.reportTypeError)(e)),s.endIf()):pA(e,p),a||s.if((0,z._)`${J.default.errors} === ${n||0}`))}}function pA(e,t){let{gen:r,schema:n,opts:{useDefaults:s}}=e;s&&(0,CW.assignDefaults)(e,t.type),r.block(()=>{for(let i of t.rules)(0,xy.shouldUseRule)(n,i)&&wA(e,i.keyword,i.definition,t.type)})}function zW(e,t){e.schemaEnv.meta||!e.opts.strictTypes||(GW(e,t),e.opts.allowUnionTypes||WW(e,t),KW(e,e.dataTypes))}function GW(e,t){if(t.length){if(!e.dataTypes.length){e.dataTypes=t;return}t.forEach(r=>{EA(e.dataTypes,r)||ky(e,`type "${r}" not allowed by context "${e.dataTypes.join(",")}"`)}),YW(e,t)}}function WW(e,t){t.length>1&&!(t.length===2&&t.includes("null"))&&ky(e,"use allowUnionTypes to allow union type keyword")}function KW(e,t){let r=e.self.RULES.all;for(let n in r){let s=r[n];if(typeof s=="object"&&(0,xy.shouldUseRule)(e.schema,s)){let{type:i}=s.definition;i.length&&!i.some(o=>JW(t,o))&&ky(e,`missing type "${i.join(",")}" for keyword "${n}"`)}}}function JW(e,t){return e.includes(t)||t==="number"&&e.includes("integer")}function EA(e,t){return e.includes(t)||t==="integer"&&e.includes("number")}function YW(e,t){let r=[];for(let n of e.dataTypes)EA(t,n)?r.push(n):t.includes("integer")&&n==="number"&&r.push("integer");e.dataTypes=r}function ky(e,t){let r=e.schemaEnv.baseId+e.errSchemaPath;t+=` at "${r}" (strictTypes)`,(0,En.checkStrictMode)(e,t,e.opts.strictTypes)}var jf=class{constructor(t,r,n){if((0,pl.validateKeywordUsage)(t,r,n),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=n,this.data=t.data,this.schema=t.schema[n],this.$data=r.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,En.schemaRefOrVal)(t,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=r,this.$data)this.schemaCode=t.gen.const("vSchema",RA(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,pl.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=t.gen.const("_errs",J.default.errors))}result(t,r,n){this.failResult((0,z.not)(t),r,n)}failResult(t,r,n){this.gen.if(t),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,r){this.failResult((0,z.not)(t),void 0,r)}fail(t){if(t===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);let{schemaCode:r}=this;this.fail((0,z._)`${r} !== undefined && (${(0,z.or)(this.invalid$data(),t)})`)}error(t,r,n){if(r){this.setParams(r),this._error(t,n),this.setParams({});return}this._error(t,n)}_error(t,r){(t?hl.reportExtraError:hl.reportError)(this,this.def.error,r)}$dataError(){(0,hl.reportError)(this,this.def.$dataError||hl.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,hl.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,r){r?Object.assign(this.params,t):this.params=t}block$data(t,r,n=z.nil){this.gen.block(()=>{this.check$data(t,n),r()})}check$data(t=z.nil,r=z.nil){if(!this.$data)return;let{gen:n,schemaCode:s,schemaType:i,def:o}=this;n.if((0,z.or)((0,z._)`${s} === undefined`,r)),t!==z.nil&&n.assign(t,!0),(i.length||o.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),t!==z.nil&&n.assign(t,!1)),n.else()}invalid$data(){let{gen:t,schemaCode:r,schemaType:n,def:s,it:i}=this;return(0,z.or)(o(),a());function o(){if(n.length){if(!(r instanceof z.Name))throw new Error("ajv implementation error");let l=Array.isArray(n)?n:[n];return(0,z._)`${(0,Mf.checkDataTypes)(l,r,i.opts.strictNumbers,Mf.DataType.Wrong)}`}return z.nil}function a(){if(s.validateSchema){let l=t.scopeValue("validate$data",{ref:s.validateSchema});return(0,z._)`!${l}(${r})`}return z.nil}}subschema(t,r){let n=(0,$y.getSubschema)(this.it,t);(0,$y.extendSubschemaData)(n,this.it,t),(0,$y.extendSubschemaMode)(n,t);let s={...this.it,...n,items:void 0,props:void 0};return qW(s,r),s}mergeEvaluated(t,r){let{it:n,gen:s}=this;n.opts.unevaluated&&(n.props!==!0&&t.props!==void 0&&(n.props=En.mergeEvaluated.props(s,t.props,n.props,r)),n.items!==!0&&t.items!==void 0&&(n.items=En.mergeEvaluated.items(s,t.items,n.items,r)))}mergeValidEvaluated(t,r){let{it:n,gen:s}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return s.if(r,()=>this.mergeEvaluated(t,z.Name)),!0}};os.KeywordCxt=jf;function wA(e,t,r,n){let s=new jf(e,r,t);"code"in r?r.code(s,n):s.$data&&r.validate?(0,pl.funcKeywordCode)(s,r):"macro"in r?(0,pl.macroKeywordCode)(s,r):(r.compile||r.validate)&&(0,pl.funcKeywordCode)(s,r)}var XW=/^\/(?:[^~]|~0|~1)*$/,ZW=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function RA(e,{dataLevel:t,dataNames:r,dataPathArr:n}){let s,i;if(e==="")return J.default.rootData;if(e[0]==="/"){if(!XW.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);s=e,i=J.default.rootData}else{let c=ZW.exec(e);if(!c)throw new Error(`Invalid JSON-pointer: ${e}`);let u=+c[1];if(s=c[2],s==="#"){if(u>=t)throw new Error(l("property/index",u));return n[t-u]}if(u>t)throw new Error(l("data",u));if(i=r[t-u],!s)return i}let o=i,a=s.split("/");for(let c of a)c&&(i=(0,z._)`${i}${(0,z.getProperty)((0,En.unescapeJsonPointer)(c))}`,o=(0,z._)`${o} && ${i}`);return o;function l(c,u){return`Cannot access ${c} ${u} levels up, current level is ${t}`}}os.getData=RA});var ml=S(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});var Ly=class extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}};Dy.default=Ly});var wn=S(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});var qy=dl(),My=class extends Error{constructor(t,r,n,s){super(s||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,qy.resolveUrl)(t,r,n),this.missingSchema=(0,qy.normalizeId)((0,qy.getFullPath)(t,this.missingRef))}};jy.default=My});var ri=S(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.resolveSchema=hr.getCompilingSchema=hr.resolveRef=hr.compileSchema=hr.SchemaEnv=void 0;var Cr=W(),QW=ml(),ti=dr(),Nr=dl(),TA=Z(),eK=fo(),ho=class{constructor(t){var r;this.refs={},this.dynamicAnchors={};let n;typeof t.schema=="object"&&(n=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=(r=t.baseId)!==null&&r!==void 0?r:(0,Nr.normalizeId)(n?.[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=n?.$async,this.refs={}}};hr.SchemaEnv=ho;function Vy(e){let t=OA.call(this,e);if(t)return t;let r=(0,Nr.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:n,lines:s}=this.opts.code,{ownProperties:i}=this.opts,o=new Cr.CodeGen(this.scope,{es5:n,lines:s,ownProperties:i}),a;e.$async&&(a=o.scopeValue("Error",{ref:QW.default,code:(0,Cr._)`require("ajv/dist/runtime/validation_error").default`}));let l=o.scopeName("validate");e.validateName=l;let c={gen:o,allErrors:this.opts.allErrors,data:ti.default.data,parentData:ti.default.parentData,parentDataProperty:ti.default.parentDataProperty,dataNames:[ti.default.data],dataPathArr:[Cr.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:o.scopeValue("schema",this.opts.code.source===!0?{ref:e.schema,code:(0,Cr.stringify)(e.schema)}:{ref:e.schema}),validateName:l,ValidationError:a,schema:e.schema,schemaEnv:e,rootId:r,baseId:e.baseId||r,schemaPath:Cr.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Cr._)`""`,opts:this.opts,self:this},u;try{this._compilations.add(e),(0,eK.validateFunctionCode)(c),o.optimize(this.opts.code.optimize);let f=o.toString();u=`${o.scopeRefs(ti.default.scope)}return ${f}`,this.opts.code.process&&(u=this.opts.code.process(u,e));let d=new Function(`${ti.default.self}`,`${ti.default.scope}`,u)(this,this.scope.get());if(this.scope.value(l,{ref:d}),d.errors=null,d.schema=e.schema,d.schemaEnv=e,e.$async&&(d.$async=!0),this.opts.code.source===!0&&(d.source={validateName:l,validateCode:f,scopeValues:o._values}),this.opts.unevaluated){let{props:h,items:m}=c;d.evaluated={props:h instanceof Cr.Name?void 0:h,items:m instanceof Cr.Name?void 0:m,dynamicProps:h instanceof Cr.Name,dynamicItems:m instanceof Cr.Name},d.source&&(d.source.evaluated=(0,Cr.stringify)(d.evaluated))}return e.validate=d,e}catch(f){throw delete e.validate,delete e.validateName,u&&this.logger.error("Error compiling schema, function code:",u),f}finally{this._compilations.delete(e)}}hr.compileSchema=Vy;function tK(e,t,r){var n;r=(0,Nr.resolveUrl)(this.opts.uriResolver,t,r);let s=e.refs[r];if(s)return s;let i=sK.call(this,e,r);if(i===void 0){let o=(n=e.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;o&&(i=new ho({schema:o,schemaId:a,root:e,baseId:t}))}if(i!==void 0)return e.refs[r]=rK.call(this,i)}hr.resolveRef=tK;function rK(e){return(0,Nr.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:Vy.call(this,e)}function OA(e){for(let t of this._compilations)if(nK(t,e))return t}hr.getCompilingSchema=OA;function nK(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function sK(e,t){let r;for(;typeof(r=this.refs[t])=="string";)t=r;return r||this.schemas[t]||Ff.call(this,e,t)}function Ff(e,t){let r=this.opts.uriResolver.parse(t),n=(0,Nr._getFullPath)(this.opts.uriResolver,r),s=(0,Nr.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&n===s)return Fy.call(this,r,e);let i=(0,Nr.normalizeId)(n),o=this.refs[i]||this.schemas[i];if(typeof o=="string"){let a=Ff.call(this,e,o);return typeof a?.schema!="object"?void 0:Fy.call(this,r,a)}if(typeof o?.schema=="object"){if(o.validate||Vy.call(this,o),i===(0,Nr.normalizeId)(t)){let{schema:a}=o,{schemaId:l}=this.opts,c=a[l];return c&&(s=(0,Nr.resolveUrl)(this.opts.uriResolver,s,c)),new ho({schema:a,schemaId:l,root:e,baseId:s})}return Fy.call(this,r,o)}}hr.resolveSchema=Ff;var iK=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Fy(e,{baseId:t,schema:r,root:n}){var s;if(((s=e.fragment)===null||s===void 0?void 0:s[0])!=="/")return;for(let a of e.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let l=r[(0,TA.unescapeFragment)(a)];if(l===void 0)return;r=l;let c=typeof r=="object"&&r[this.opts.schemaId];!iK.has(a)&&c&&(t=(0,Nr.resolveUrl)(this.opts.uriResolver,t,c))}let i;if(typeof r!="boolean"&&r.$ref&&!(0,TA.schemaHasRulesButRef)(r,this.RULES)){let a=(0,Nr.resolveUrl)(this.opts.uriResolver,t,r.$ref);i=Ff.call(this,n,a)}let{schemaId:o}=this.opts;if(i=i||new ho({schema:r,schemaId:o,root:n,baseId:t}),i.schema!==i.root.schema)return i}});var PA=S((mme,oK)=>{oK.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var AA=S((gme,IA)=>{"use strict";var aK={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};IA.exports={HEX:aK}});var qA=S((yme,DA)=>{"use strict";var{HEX:lK}=AA(),cK=/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u;function xA(e){if(LA(e,".")<3)return{host:e,isIPV4:!1};let t=e.match(cK)||[],[r]=t;return r?{host:fK(r,"."),isIPV4:!0}:{host:e,isIPV4:!1}}function Uy(e,t=!1){let r="",n=!0;for(let s of e){if(lK[s]===void 0)return;s!=="0"&&n===!0&&(n=!1),n||(r+=s)}return t&&r.length===0&&(r="0"),r}function uK(e){let t=0,r={error:!1,address:"",zone:""},n=[],s=[],i=!1,o=!1,a=!1;function l(){if(s.length){if(i===!1){let c=Uy(s);if(c!==void 0)n.push(c);else return r.error=!0,!1}s.length=0}return!0}for(let c=0;c<e.length;c++){let u=e[c];if(!(u==="["||u==="]"))if(u===":"){if(o===!0&&(a=!0),!l())break;if(t++,n.push(":"),t>7){r.error=!0;break}c-1>=0&&e[c-1]===":"&&(o=!0);continue}else if(u==="%"){if(!l())break;i=!0}else{s.push(u);continue}}return s.length&&(i?r.zone=s.join(""):a?n.push(s.join("")):n.push(Uy(s))),r.address=n.join(""),r}function kA(e){if(LA(e,":")<2)return{host:e,isIPV6:!1};let t=uK(e);if(t.error)return{host:e,isIPV6:!1};{let r=t.address,n=t.address;return t.zone&&(r+="%"+t.zone,n+="%25"+t.zone),{host:r,escapedHost:n,isIPV6:!0}}}function fK(e,t){let r="",n=!0,s=e.length;for(let i=0;i<s;i++){let o=e[i];o==="0"&&n?(i+1<=s&&e[i+1]===t||i+1===s)&&(r+=o,n=!1):(o===t?n=!0:n=!1,r+=o)}return r}function LA(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]===t&&r++;return r}var CA=/^\.\.?\//u,NA=/^\/\.(?:\/|$)/u,$A=/^\/\.\.(?:\/|$)/u,dK=/^\/?(?:.|\n)*?(?=\/|$)/u;function hK(e){let t=[];for(;e.length;)if(e.match(CA))e=e.replace(CA,"");else if(e.match(NA))e=e.replace(NA,"/");else if(e.match($A))e=e.replace($A,"/"),t.pop();else if(e==="."||e==="..")e="";else{let r=e.match(dK);if(r){let n=r[0];e=e.slice(n.length),t.push(n)}else throw new Error("Unexpected dot segment condition")}return t.join("")}function pK(e,t){let r=t!==!0?escape:unescape;return e.scheme!==void 0&&(e.scheme=r(e.scheme)),e.userinfo!==void 0&&(e.userinfo=r(e.userinfo)),e.host!==void 0&&(e.host=r(e.host)),e.path!==void 0&&(e.path=r(e.path)),e.query!==void 0&&(e.query=r(e.query)),e.fragment!==void 0&&(e.fragment=r(e.fragment)),e}function mK(e){let t=[];if(e.userinfo!==void 0&&(t.push(e.userinfo),t.push("@")),e.host!==void 0){let r=unescape(e.host),n=xA(r);if(n.isIPV4)r=n.host;else{let s=kA(n.host);s.isIPV6===!0?r=`[${s.escapedHost}]`:r=e.host}t.push(r)}return(typeof e.port=="number"||typeof e.port=="string")&&(t.push(":"),t.push(String(e.port))),t.length?t.join(""):void 0}DA.exports={recomposeAuthority:mK,normalizeComponentEncoding:pK,removeDotSegments:hK,normalizeIPv4:xA,normalizeIPv6:kA,stringArrayToHexStripped:Uy}});var HA=S((_me,UA)=>{"use strict";var gK=/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu,yK=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu;function MA(e){return typeof e.secure=="boolean"?e.secure:String(e.scheme).toLowerCase()==="wss"}function jA(e){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e}function FA(e){let t=String(e.scheme).toLowerCase()==="https";return(e.port===(t?443:80)||e.port==="")&&(e.port=void 0),e.path||(e.path="/"),e}function _K(e){return e.secure=MA(e),e.resourceName=(e.path||"/")+(e.query?"?"+e.query:""),e.path=void 0,e.query=void 0,e}function bK(e){if((e.port===(MA(e)?443:80)||e.port==="")&&(e.port=void 0),typeof e.secure=="boolean"&&(e.scheme=e.secure?"wss":"ws",e.secure=void 0),e.resourceName){let[t,r]=e.resourceName.split("?");e.path=t&&t!=="/"?t:void 0,e.query=r,e.resourceName=void 0}return e.fragment=void 0,e}function SK(e,t){if(!e.path)return e.error="URN can not be parsed",e;let r=e.path.match(yK);if(r){let n=t.scheme||e.scheme||"urn";e.nid=r[1].toLowerCase(),e.nss=r[2];let s=`${n}:${t.nid||e.nid}`,i=Hy[s];e.path=void 0,i&&(e=i.parse(e,t))}else e.error=e.error||"URN can not be parsed.";return e}function vK(e,t){let r=t.scheme||e.scheme||"urn",n=e.nid.toLowerCase(),s=`${r}:${t.nid||n}`,i=Hy[s];i&&(e=i.serialize(e,t));let o=e,a=e.nss;return o.path=`${n||t.nid}:${a}`,t.skipEscape=!0,o}function EK(e,t){let r=e;return r.uuid=r.nss,r.nss=void 0,!t.tolerant&&(!r.uuid||!gK.test(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function wK(e){let t=e;return t.nss=(e.uuid||"").toLowerCase(),t}var VA={scheme:"http",domainHost:!0,parse:jA,serialize:FA},RK={scheme:"https",domainHost:VA.domainHost,parse:jA,serialize:FA},Vf={scheme:"ws",domainHost:!0,parse:_K,serialize:bK},TK={scheme:"wss",domainHost:Vf.domainHost,parse:Vf.parse,serialize:Vf.serialize},OK={scheme:"urn",parse:SK,serialize:vK,skipNormalize:!0},PK={scheme:"urn:uuid",parse:EK,serialize:wK,skipNormalize:!0},Hy={http:VA,https:RK,ws:Vf,wss:TK,urn:OK,"urn:uuid":PK};UA.exports=Hy});var Bf=S((bme,Hf)=>{"use strict";var{normalizeIPv6:IK,normalizeIPv4:AK,removeDotSegments:gl,recomposeAuthority:CK,normalizeComponentEncoding:Uf}=qA(),By=HA();function NK(e,t){return typeof e=="string"?e=Wr(Rn(e,t),t):typeof e=="object"&&(e=Rn(Wr(e,t),t)),e}function $K(e,t,r){let n=Object.assign({scheme:"null"},r),s=BA(Rn(e,n),Rn(t,n),n,!0);return Wr(s,{...n,skipEscape:!0})}function BA(e,t,r,n){let s={};return n||(e=Rn(Wr(e,r),r),t=Rn(Wr(t,r),r)),r=r||{},!r.tolerant&&t.scheme?(s.scheme=t.scheme,s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=gl(t.path||""),s.query=t.query):(t.userinfo!==void 0||t.host!==void 0||t.port!==void 0?(s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=gl(t.path||""),s.query=t.query):(t.path?(t.path.charAt(0)==="/"?s.path=gl(t.path):((e.userinfo!==void 0||e.host!==void 0||e.port!==void 0)&&!e.path?s.path="/"+t.path:e.path?s.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:s.path=t.path,s.path=gl(s.path)),s.query=t.query):(s.path=e.path,t.query!==void 0?s.query=t.query:s.query=e.query),s.userinfo=e.userinfo,s.host=e.host,s.port=e.port),s.scheme=e.scheme),s.fragment=t.fragment,s}function xK(e,t,r){return typeof e=="string"?(e=unescape(e),e=Wr(Uf(Rn(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Wr(Uf(e,!0),{...r,skipEscape:!0})),typeof t=="string"?(t=unescape(t),t=Wr(Uf(Rn(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Wr(Uf(t,!0),{...r,skipEscape:!0})),e.toLowerCase()===t.toLowerCase()}function Wr(e,t){let r={host:e.host,scheme:e.scheme,userinfo:e.userinfo,port:e.port,path:e.path,query:e.query,nid:e.nid,nss:e.nss,uuid:e.uuid,fragment:e.fragment,reference:e.reference,resourceName:e.resourceName,secure:e.secure,error:""},n=Object.assign({},t),s=[],i=By[(n.scheme||r.scheme||"").toLowerCase()];i&&i.serialize&&i.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&s.push(r.scheme,":");let o=CK(r);if(o!==void 0&&(n.reference!=="suffix"&&s.push("//"),s.push(o),r.path&&r.path.charAt(0)!=="/"&&s.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!i||!i.absolutePath)&&(a=gl(a)),o===void 0&&(a=a.replace(/^\/\//u,"/%2F")),s.push(a)}return r.query!==void 0&&s.push("?",r.query),r.fragment!==void 0&&s.push("#",r.fragment),s.join("")}var kK=Array.from({length:127},(e,t)=>/[^!"$&'()*+,\-.;=_`a-z{}~]/u.test(String.fromCharCode(t)));function LK(e){let t=0;for(let r=0,n=e.length;r<n;++r)if(t=e.charCodeAt(r),t>126||kK[t])return!0;return!1}var DK=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Rn(e,t){let r=Object.assign({},t),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},s=e.indexOf("%")!==-1,i=!1;r.reference==="suffix"&&(e=(r.scheme?r.scheme+":":"")+"//"+e);let o=e.match(DK);if(o){if(n.scheme=o[1],n.userinfo=o[3],n.host=o[4],n.port=parseInt(o[5],10),n.path=o[6]||"",n.query=o[7],n.fragment=o[8],isNaN(n.port)&&(n.port=o[5]),n.host){let l=AK(n.host);if(l.isIPV4===!1){let c=IK(l.host);n.host=c.host.toLowerCase(),i=c.isIPV6}else n.host=l.host,i=!0}n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let a=By[(r.scheme||n.scheme||"").toLowerCase()];if(!r.unicodeSupport&&(!a||!a.unicodeSupport)&&n.host&&(r.domainHost||a&&a.domainHost)&&i===!1&&LK(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(l){n.error=n.error||"Host's domain name can not be converted to ASCII: "+l}(!a||a&&!a.skipNormalize)&&(s&&n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),s&&n.host!==void 0&&(n.host=unescape(n.host)),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),a&&a.parse&&a.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var zy={SCHEMES:By,normalize:NK,resolve:$K,resolveComponents:BA,equal:xK,serialize:Wr,parse:Rn};Hf.exports=zy;Hf.exports.default=zy;Hf.exports.fastUri=zy});var GA=S(Gy=>{"use strict";Object.defineProperty(Gy,"__esModule",{value:!0});var zA=Bf();zA.code='require("ajv/dist/runtime/uri").default';Gy.default=zA});var Jy=S(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.CodeGen=gt.Name=gt.nil=gt.stringify=gt.str=gt._=gt.KeywordCxt=void 0;var qK=fo();Object.defineProperty(gt,"KeywordCxt",{enumerable:!0,get:function(){return qK.KeywordCxt}});var po=W();Object.defineProperty(gt,"_",{enumerable:!0,get:function(){return po._}});Object.defineProperty(gt,"str",{enumerable:!0,get:function(){return po.str}});Object.defineProperty(gt,"stringify",{enumerable:!0,get:function(){return po.stringify}});Object.defineProperty(gt,"nil",{enumerable:!0,get:function(){return po.nil}});Object.defineProperty(gt,"Name",{enumerable:!0,get:function(){return po.Name}});Object.defineProperty(gt,"CodeGen",{enumerable:!0,get:function(){return po.CodeGen}});var MK=ml(),XA=wn(),jK=wy(),yl=ri(),FK=W(),_l=dl(),zf=ul(),Ky=Z(),WA=PA(),VK=GA(),ZA=(e,t)=>new RegExp(e,t);ZA.code="new RegExp";var UK=["removeAdditional","useDefaults","coerceTypes"],HK=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),BK={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},zK={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},KA=200;function GK(e){var t,r,n,s,i,o,a,l,c,u,f,p,d,h,m,y,b,v,_,g,T,R,w,P,O;let A=e.strict,q=(t=e.code)===null||t===void 0?void 0:t.optimize,C=q===!0||q===void 0?1:q||0,N=(n=(r=e.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:ZA,B=(s=e.uriResolver)!==null&&s!==void 0?s:VK.default;return{strictSchema:(o=(i=e.strictSchema)!==null&&i!==void 0?i:A)!==null&&o!==void 0?o:!0,strictNumbers:(l=(a=e.strictNumbers)!==null&&a!==void 0?a:A)!==null&&l!==void 0?l:!0,strictTypes:(u=(c=e.strictTypes)!==null&&c!==void 0?c:A)!==null&&u!==void 0?u:"log",strictTuples:(p=(f=e.strictTuples)!==null&&f!==void 0?f:A)!==null&&p!==void 0?p:"log",strictRequired:(h=(d=e.strictRequired)!==null&&d!==void 0?d:A)!==null&&h!==void 0?h:!1,code:e.code?{...e.code,optimize:C,regExp:N}:{optimize:C,regExp:N},loopRequired:(m=e.loopRequired)!==null&&m!==void 0?m:KA,loopEnum:(y=e.loopEnum)!==null&&y!==void 0?y:KA,meta:(b=e.meta)!==null&&b!==void 0?b:!0,messages:(v=e.messages)!==null&&v!==void 0?v:!0,inlineRefs:(_=e.inlineRefs)!==null&&_!==void 0?_:!0,schemaId:(g=e.schemaId)!==null&&g!==void 0?g:"$id",addUsedSchema:(T=e.addUsedSchema)!==null&&T!==void 0?T:!0,validateSchema:(R=e.validateSchema)!==null&&R!==void 0?R:!0,validateFormats:(w=e.validateFormats)!==null&&w!==void 0?w:!0,unicodeRegExp:(P=e.unicodeRegExp)!==null&&P!==void 0?P:!0,int32range:(O=e.int32range)!==null&&O!==void 0?O:!0,uriResolver:B}}var bl=class{constructor(t={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,t=this.opts={...t,...GK(t)};let{es5:r,lines:n}=this.opts.code;this.scope=new FK.ValueScope({scope:{},prefixes:HK,es5:r,lines:n}),this.logger=ZK(t.logger);let s=t.validateFormats;t.validateFormats=!1,this.RULES=(0,jK.getRules)(),JA.call(this,BK,t,"NOT SUPPORTED"),JA.call(this,zK,t,"DEPRECATED","warn"),this._metaOpts=YK.call(this),t.formats&&KK.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),t.keywords&&JK.call(this,t.keywords),typeof t.meta=="object"&&this.addMetaSchema(t.meta),WK.call(this),t.validateFormats=s}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:t,meta:r,schemaId:n}=this.opts,s=WA;n==="id"&&(s={...WA},s.id=s.$id,delete s.$id),r&&t&&this.addMetaSchema(s,s[n],!1)}defaultMeta(){let{meta:t,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof t=="object"?t[r]||t:void 0}validate(t,r){let n;if(typeof t=="string"){if(n=this.getSchema(t),!n)throw new Error(`no schema with key or ref "${t}"`)}else n=this.compile(t);let s=n(r);return"$async"in n||(this.errors=n.errors),s}compile(t,r){let n=this._addSchema(t,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(t,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return s.call(this,t,r);async function s(u,f){await i.call(this,u.$schema);let p=this._addSchema(u,f);return p.validate||o.call(this,p)}async function i(u){u&&!this.getSchema(u)&&await s.call(this,{$ref:u},!0)}async function o(u){try{return this._compileSchemaEnv(u)}catch(f){if(!(f instanceof XA.default))throw f;return a.call(this,f),await l.call(this,f.missingSchema),o.call(this,u)}}function a({missingSchema:u,missingRef:f}){if(this.refs[u])throw new Error(`AnySchema ${u} is loaded but ${f} cannot be resolved`)}async function l(u){let f=await c.call(this,u);this.refs[u]||await i.call(this,f.$schema),this.refs[u]||this.addSchema(f,u,r)}async function c(u){let f=this._loading[u];if(f)return f;try{return await(this._loading[u]=n(u))}finally{delete this._loading[u]}}}addSchema(t,r,n,s=this.opts.validateSchema){if(Array.isArray(t)){for(let o of t)this.addSchema(o,void 0,n,s);return this}let i;if(typeof t=="object"){let{schemaId:o}=this.opts;if(i=t[o],i!==void 0&&typeof i!="string")throw new Error(`schema ${o} must be string`)}return r=(0,_l.normalizeId)(r||i),this._checkUnique(r),this.schemas[r]=this._addSchema(t,n,r,s,!0),this}addMetaSchema(t,r,n=this.opts.validateSchema){return this.addSchema(t,r,!0,n),this}validateSchema(t,r){if(typeof t=="boolean")return!0;let n;if(n=t.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let s=this.validate(n,t);if(!s&&r){let i="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(i);else throw new Error(i)}return s}getSchema(t){let r;for(;typeof(r=YA.call(this,t))=="string";)t=r;if(r===void 0){let{schemaId:n}=this.opts,s=new yl.SchemaEnv({schema:{},schemaId:n});if(r=yl.resolveSchema.call(this,s,t),!r)return;this.refs[t]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(t){if(t instanceof RegExp)return this._removeAllSchemas(this.schemas,t),this._removeAllSchemas(this.refs,t),this;switch(typeof t){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=YA.call(this,t);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[t],delete this.refs[t],this}case"object":{let r=t;this._cache.delete(r);let n=t[this.opts.schemaId];return n&&(n=(0,_l.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(t){for(let r of t)this.addKeyword(r);return this}addKeyword(t,r){let n;if(typeof t=="string")n=t,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof t=="object"&&r===void 0){if(r=t,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(eJ.call(this,n,r),!r)return(0,Ky.eachItem)(n,i=>Wy.call(this,i)),this;rJ.call(this,r);let s={...r,type:(0,zf.getJSONTypes)(r.type),schemaType:(0,zf.getJSONTypes)(r.schemaType)};return(0,Ky.eachItem)(n,s.type.length===0?i=>Wy.call(this,i,s):i=>s.type.forEach(o=>Wy.call(this,i,s,o))),this}getKeyword(t){let r=this.RULES.all[t];return typeof r=="object"?r.definition:!!r}removeKeyword(t){let{RULES:r}=this;delete r.keywords[t],delete r.all[t];for(let n of r.rules){let s=n.rules.findIndex(i=>i.keyword===t);s>=0&&n.rules.splice(s,1)}return this}addFormat(t,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[t]=r,this}errorsText(t=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!t||t.length===0?"No errors":t.map(s=>`${n}${s.instancePath} ${s.message}`).reduce((s,i)=>s+r+i)}$dataMetaSchema(t,r){let n=this.RULES.all;t=JSON.parse(JSON.stringify(t));for(let s of r){let i=s.split("/").slice(1),o=t;for(let a of i)o=o[a];for(let a in n){let l=n[a];if(typeof l!="object")continue;let{$data:c}=l.definition,u=o[a];c&&u&&(o[a]=QA(u))}}return t}_removeAllSchemas(t,r){for(let n in t){let s=t[n];(!r||r.test(n))&&(typeof s=="string"?delete t[n]:s&&!s.meta&&(this._cache.delete(s.schema),delete t[n]))}}_addSchema(t,r,n,s=this.opts.validateSchema,i=this.opts.addUsedSchema){let o,{schemaId:a}=this.opts;if(typeof t=="object")o=t[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof t!="boolean")throw new Error("schema must be object or boolean")}let l=this._cache.get(t);if(l!==void 0)return l;n=(0,_l.normalizeId)(o||n);let c=_l.getSchemaRefs.call(this,t,n);return l=new yl.SchemaEnv({schema:t,schemaId:a,meta:r,baseId:n,localRefs:c}),this._cache.set(l.schema,l),i&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=l),s&&this.validateSchema(t,!0),l}_checkUnique(t){if(this.schemas[t]||this.refs[t])throw new Error(`schema with key or id "${t}" already exists`)}_compileSchemaEnv(t){if(t.meta?this._compileMetaSchema(t):yl.compileSchema.call(this,t),!t.validate)throw new Error("ajv implementation error");return t.validate}_compileMetaSchema(t){let r=this.opts;this.opts=this._metaOpts;try{yl.compileSchema.call(this,t)}finally{this.opts=r}}};bl.ValidationError=MK.default;bl.MissingRefError=XA.default;gt.default=bl;function JA(e,t,r,n="error"){for(let s in e){let i=s;i in t&&this.logger[n](`${r}: option ${s}. ${e[i]}`)}}function YA(e){return e=(0,_l.normalizeId)(e),this.schemas[e]||this.refs[e]}function WK(){let e=this.opts.schemas;if(e)if(Array.isArray(e))this.addSchema(e);else for(let t in e)this.addSchema(e[t],t)}function KK(){for(let e in this.opts.formats){let t=this.opts.formats[e];t&&this.addFormat(e,t)}}function JK(e){if(Array.isArray(e)){this.addVocabulary(e);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let t in e){let r=e[t];r.keyword||(r.keyword=t),this.addKeyword(r)}}function YK(){let e={...this.opts};for(let t of UK)delete e[t];return e}var XK={log(){},warn(){},error(){}};function ZK(e){if(e===!1)return XK;if(e===void 0)return console;if(e.log&&e.warn&&e.error)return e;throw new Error("logger must implement log, warn and error methods")}var QK=/^[a-z_$][a-z0-9_$:-]*$/i;function eJ(e,t){let{RULES:r}=this;if((0,Ky.eachItem)(e,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!QK.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!t&&t.$data&&!("code"in t||"validate"in t))throw new Error('$data keyword must have "code" or "validate" function')}function Wy(e,t,r){var n;let s=t?.post;if(r&&s)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:i}=this,o=s?i.post:i.rules.find(({type:l})=>l===r);if(o||(o={type:r,rules:[]},i.rules.push(o)),i.keywords[e]=!0,!t)return;let a={keyword:e,definition:{...t,type:(0,zf.getJSONTypes)(t.type),schemaType:(0,zf.getJSONTypes)(t.schemaType)}};t.before?tJ.call(this,o,a,t.before):o.rules.push(a),i.all[e]=a,(n=t.implements)===null||n===void 0||n.forEach(l=>this.addKeyword(l))}function tJ(e,t,r){let n=e.rules.findIndex(s=>s.keyword===r);n>=0?e.rules.splice(n,0,t):(e.rules.push(t),this.logger.warn(`rule ${r} is not defined`))}function rJ(e){let{metaSchema:t}=e;t!==void 0&&(e.$data&&this.opts.$data&&(t=QA(t)),e.validateSchema=this.compile(t,!0))}var nJ={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function QA(e){return{anyOf:[e,nJ]}}});var eC=S(Yy=>{"use strict";Object.defineProperty(Yy,"__esModule",{value:!0});var sJ={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Yy.default=sJ});var Xy=S(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.callRef=ni.getValidate=void 0;var iJ=wn(),tC=mt(),Gt=W(),mo=dr(),rC=ri(),Gf=Z(),oJ={keyword:"$ref",schemaType:"string",code(e){let{gen:t,schema:r,it:n}=e,{baseId:s,schemaEnv:i,validateName:o,opts:a,self:l}=n,{root:c}=i;if((r==="#"||r==="#/")&&s===c.baseId)return f();let u=rC.resolveRef.call(l,c,s,r);if(u===void 0)throw new iJ.default(n.opts.uriResolver,s,r);if(u instanceof rC.SchemaEnv)return p(u);return d(u);function f(){if(i===c)return Wf(e,o,i,i.$async);let h=t.scopeValue("root",{ref:c});return Wf(e,(0,Gt._)`${h}.validate`,c,c.$async)}function p(h){let m=nC(e,h);Wf(e,m,h,h.$async)}function d(h){let m=t.scopeValue("schema",a.code.source===!0?{ref:h,code:(0,Gt.stringify)(h)}:{ref:h}),y=t.name("valid"),b=e.subschema({schema:h,dataTypes:[],schemaPath:Gt.nil,topSchemaRef:m,errSchemaPath:r},y);e.mergeEvaluated(b),e.ok(y)}}};function nC(e,t){let{gen:r}=e;return t.validate?r.scopeValue("validate",{ref:t.validate}):(0,Gt._)`${r.scopeValue("wrapper",{ref:t})}.validate`}ni.getValidate=nC;function Wf(e,t,r,n){let{gen:s,it:i}=e,{allErrors:o,schemaEnv:a,opts:l}=i,c=l.passContext?mo.default.this:Gt.nil;n?u():f();function u(){if(!a.$async)throw new Error("async schema referenced by sync schema");let h=s.let("valid");s.try(()=>{s.code((0,Gt._)`await ${(0,tC.callValidateCode)(e,t,c)}`),d(t),o||s.assign(h,!0)},m=>{s.if((0,Gt._)`!(${m} instanceof ${i.ValidationError})`,()=>s.throw(m)),p(m),o||s.assign(h,!1)}),e.ok(h)}function f(){e.result((0,tC.callValidateCode)(e,t,c),()=>d(t),()=>p(t))}function p(h){let m=(0,Gt._)`${h}.errors`;s.assign(mo.default.vErrors,(0,Gt._)`${mo.default.vErrors} === null ? ${m} : ${mo.default.vErrors}.concat(${m})`),s.assign(mo.default.errors,(0,Gt._)`${mo.default.vErrors}.length`)}function d(h){var m;if(!i.opts.unevaluated)return;let y=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(i.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(i.props=Gf.mergeEvaluated.props(s,y.props,i.props));else{let b=s.var("props",(0,Gt._)`${h}.evaluated.props`);i.props=Gf.mergeEvaluated.props(s,b,i.props,Gt.Name)}if(i.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(i.items=Gf.mergeEvaluated.items(s,y.items,i.items));else{let b=s.var("items",(0,Gt._)`${h}.evaluated.items`);i.items=Gf.mergeEvaluated.items(s,b,i.items,Gt.Name)}}}ni.callRef=Wf;ni.default=oJ});var sC=S(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var aJ=eC(),lJ=Xy(),cJ=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",aJ.default,lJ.default];Zy.default=cJ});var iC=S(Qy=>{"use strict";Object.defineProperty(Qy,"__esModule",{value:!0});var Kf=W(),as=Kf.operators,Jf={maximum:{okStr:"<=",ok:as.LTE,fail:as.GT},minimum:{okStr:">=",ok:as.GTE,fail:as.LT},exclusiveMaximum:{okStr:"<",ok:as.LT,fail:as.GTE},exclusiveMinimum:{okStr:">",ok:as.GT,fail:as.LTE}},uJ={message:({keyword:e,schemaCode:t})=>(0,Kf.str)`must be ${Jf[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>(0,Kf._)`{comparison: ${Jf[e].okStr}, limit: ${t}}`},fJ={keyword:Object.keys(Jf),type:"number",schemaType:"number",$data:!0,error:uJ,code(e){let{keyword:t,data:r,schemaCode:n}=e;e.fail$data((0,Kf._)`${r} ${Jf[t].fail} ${n} || isNaN(${r})`)}};Qy.default=fJ});var oC=S(e_=>{"use strict";Object.defineProperty(e_,"__esModule",{value:!0});var Sl=W(),dJ={message:({schemaCode:e})=>(0,Sl.str)`must be multiple of ${e}`,params:({schemaCode:e})=>(0,Sl._)`{multipleOf: ${e}}`},hJ={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:dJ,code(e){let{gen:t,data:r,schemaCode:n,it:s}=e,i=s.opts.multipleOfPrecision,o=t.let("res"),a=i?(0,Sl._)`Math.abs(Math.round(${o}) - ${o}) > 1e-${i}`:(0,Sl._)`${o} !== parseInt(${o})`;e.fail$data((0,Sl._)`(${n} === 0 || (${o} = ${r}/${n}, ${a}))`)}};e_.default=hJ});var lC=S(t_=>{"use strict";Object.defineProperty(t_,"__esModule",{value:!0});function aC(e){let t=e.length,r=0,n=0,s;for(;n<t;)r++,s=e.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=e.charCodeAt(n),(s&64512)===56320&&n++);return r}t_.default=aC;aC.code='require("ajv/dist/runtime/ucs2length").default'});var cC=S(r_=>{"use strict";Object.defineProperty(r_,"__esModule",{value:!0});var si=W(),pJ=Z(),mJ=lC(),gJ={message({keyword:e,schemaCode:t}){let r=e==="maxLength"?"more":"fewer";return(0,si.str)`must NOT have ${r} than ${t} characters`},params:({schemaCode:e})=>(0,si._)`{limit: ${e}}`},yJ={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:gJ,code(e){let{keyword:t,data:r,schemaCode:n,it:s}=e,i=t==="maxLength"?si.operators.GT:si.operators.LT,o=s.opts.unicode===!1?(0,si._)`${r}.length`:(0,si._)`${(0,pJ.useFunc)(e.gen,mJ.default)}(${r})`;e.fail$data((0,si._)`${o} ${i} ${n}`)}};r_.default=yJ});var uC=S(n_=>{"use strict";Object.defineProperty(n_,"__esModule",{value:!0});var _J=mt(),Yf=W(),bJ={message:({schemaCode:e})=>(0,Yf.str)`must match pattern "${e}"`,params:({schemaCode:e})=>(0,Yf._)`{pattern: ${e}}`},SJ={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:bJ,code(e){let{data:t,$data:r,schema:n,schemaCode:s,it:i}=e,o=i.opts.unicodeRegExp?"u":"",a=r?(0,Yf._)`(new RegExp(${s}, ${o}))`:(0,_J.usePattern)(e,n);e.fail$data((0,Yf._)`!${a}.test(${t})`)}};n_.default=SJ});var fC=S(s_=>{"use strict";Object.defineProperty(s_,"__esModule",{value:!0});var vl=W(),vJ={message({keyword:e,schemaCode:t}){let r=e==="maxProperties"?"more":"fewer";return(0,vl.str)`must NOT have ${r} than ${t} properties`},params:({schemaCode:e})=>(0,vl._)`{limit: ${e}}`},EJ={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:vJ,code(e){let{keyword:t,data:r,schemaCode:n}=e,s=t==="maxProperties"?vl.operators.GT:vl.operators.LT;e.fail$data((0,vl._)`Object.keys(${r}).length ${s} ${n}`)}};s_.default=EJ});var dC=S(i_=>{"use strict";Object.defineProperty(i_,"__esModule",{value:!0});var El=mt(),wl=W(),wJ=Z(),RJ={message:({params:{missingProperty:e}})=>(0,wl.str)`must have required property '${e}'`,params:({params:{missingProperty:e}})=>(0,wl._)`{missingProperty: ${e}}`},TJ={keyword:"required",type:"object",schemaType:"array",$data:!0,error:RJ,code(e){let{gen:t,schema:r,schemaCode:n,data:s,$data:i,it:o}=e,{opts:a}=o;if(!i&&r.length===0)return;let l=r.length>=a.loopRequired;if(o.allErrors?c():u(),a.strictRequired){let d=e.parentSchema.properties,{definedProperties:h}=e.it;for(let m of r)if(d?.[m]===void 0&&!h.has(m)){let y=o.schemaEnv.baseId+o.errSchemaPath,b=`required property "${m}" is not defined at "${y}" (strictRequired)`;(0,wJ.checkStrictMode)(o,b,o.opts.strictRequired)}}function c(){if(l||i)e.block$data(wl.nil,f);else for(let d of r)(0,El.checkReportMissingProp)(e,d)}function u(){let d=t.let("missing");if(l||i){let h=t.let("valid",!0);e.block$data(h,()=>p(d,h)),e.ok(h)}else t.if((0,El.checkMissingProp)(e,r,d)),(0,El.reportMissingProp)(e,d),t.else()}function f(){t.forOf("prop",n,d=>{e.setParams({missingProperty:d}),t.if((0,El.noPropertyInData)(t,s,d,a.ownProperties),()=>e.error())})}function p(d,h){e.setParams({missingProperty:d}),t.forOf(d,n,()=>{t.assign(h,(0,El.propertyInData)(t,s,d,a.ownProperties)),t.if((0,wl.not)(h),()=>{e.error(),t.break()})},wl.nil)}}};i_.default=TJ});var hC=S(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});var Rl=W(),OJ={message({keyword:e,schemaCode:t}){let r=e==="maxItems"?"more":"fewer";return(0,Rl.str)`must NOT have ${r} than ${t} items`},params:({schemaCode:e})=>(0,Rl._)`{limit: ${e}}`},PJ={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:OJ,code(e){let{keyword:t,data:r,schemaCode:n}=e,s=t==="maxItems"?Rl.operators.GT:Rl.operators.LT;e.fail$data((0,Rl._)`${r}.length ${s} ${n}`)}};o_.default=PJ});var Tl=S(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});var pC=fl();pC.code='require("ajv/dist/runtime/equal").default';a_.default=pC});var mC=S(c_=>{"use strict";Object.defineProperty(c_,"__esModule",{value:!0});var l_=ul(),yt=W(),IJ=Z(),AJ=Tl(),CJ={message:({params:{i:e,j:t}})=>(0,yt.str)`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>(0,yt._)`{i: ${e}, j: ${t}}`},NJ={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:CJ,code(e){let{gen:t,data:r,$data:n,schema:s,parentSchema:i,schemaCode:o,it:a}=e;if(!n&&!s)return;let l=t.let("valid"),c=i.items?(0,l_.getSchemaTypes)(i.items):[];e.block$data(l,u,(0,yt._)`${o} === false`),e.ok(l);function u(){let h=t.let("i",(0,yt._)`${r}.length`),m=t.let("j");e.setParams({i:h,j:m}),t.assign(l,!0),t.if((0,yt._)`${h} > 1`,()=>(f()?p:d)(h,m))}function f(){return c.length>0&&!c.some(h=>h==="object"||h==="array")}function p(h,m){let y=t.name("item"),b=(0,l_.checkDataTypes)(c,y,a.opts.strictNumbers,l_.DataType.Wrong),v=t.const("indices",(0,yt._)`{}`);t.for((0,yt._)`;${h}--;`,()=>{t.let(y,(0,yt._)`${r}[${h}]`),t.if(b,(0,yt._)`continue`),c.length>1&&t.if((0,yt._)`typeof ${y} == "string"`,(0,yt._)`${y} += "_"`),t.if((0,yt._)`typeof ${v}[${y}] == "number"`,()=>{t.assign(m,(0,yt._)`${v}[${y}]`),e.error(),t.assign(l,!1).break()}).code((0,yt._)`${v}[${y}] = ${h}`)})}function d(h,m){let y=(0,IJ.useFunc)(t,AJ.default),b=t.name("outer");t.label(b).for((0,yt._)`;${h}--;`,()=>t.for((0,yt._)`${m} = ${h}; ${m}--;`,()=>t.if((0,yt._)`${y}(${r}[${h}], ${r}[${m}])`,()=>{e.error(),t.assign(l,!1).break(b)})))}}};c_.default=NJ});var gC=S(f_=>{"use strict";Object.defineProperty(f_,"__esModule",{value:!0});var u_=W(),$J=Z(),xJ=Tl(),kJ={message:"must be equal to constant",params:({schemaCode:e})=>(0,u_._)`{allowedValue: ${e}}`},LJ={keyword:"const",$data:!0,error:kJ,code(e){let{gen:t,data:r,$data:n,schemaCode:s,schema:i}=e;n||i&&typeof i=="object"?e.fail$data((0,u_._)`!${(0,$J.useFunc)(t,xJ.default)}(${r}, ${s})`):e.fail((0,u_._)`${i} !== ${r}`)}};f_.default=LJ});var yC=S(d_=>{"use strict";Object.defineProperty(d_,"__esModule",{value:!0});var Ol=W(),DJ=Z(),qJ=Tl(),MJ={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>(0,Ol._)`{allowedValues: ${e}}`},jJ={keyword:"enum",schemaType:"array",$data:!0,error:MJ,code(e){let{gen:t,data:r,$data:n,schema:s,schemaCode:i,it:o}=e;if(!n&&s.length===0)throw new Error("enum must have non-empty array");let a=s.length>=o.opts.loopEnum,l,c=()=>l??(l=(0,DJ.useFunc)(t,qJ.default)),u;if(a||n)u=t.let("valid"),e.block$data(u,f);else{if(!Array.isArray(s))throw new Error("ajv implementation error");let d=t.const("vSchema",i);u=(0,Ol.or)(...s.map((h,m)=>p(d,m)))}e.pass(u);function f(){t.assign(u,!1),t.forOf("v",i,d=>t.if((0,Ol._)`${c()}(${r}, ${d})`,()=>t.assign(u,!0).break()))}function p(d,h){let m=s[h];return typeof m=="object"&&m!==null?(0,Ol._)`${c()}(${r}, ${d}[${h}])`:(0,Ol._)`${r} === ${m}`}}};d_.default=jJ});var _C=S(h_=>{"use strict";Object.defineProperty(h_,"__esModule",{value:!0});var FJ=iC(),VJ=oC(),UJ=cC(),HJ=uC(),BJ=fC(),zJ=dC(),GJ=hC(),WJ=mC(),KJ=gC(),JJ=yC(),YJ=[FJ.default,VJ.default,UJ.default,HJ.default,BJ.default,zJ.default,GJ.default,WJ.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},KJ.default,JJ.default];h_.default=YJ});var m_=S(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.validateAdditionalItems=void 0;var ii=W(),p_=Z(),XJ={message:({params:{len:e}})=>(0,ii.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,ii._)`{limit: ${e}}`},ZJ={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:XJ,code(e){let{parentSchema:t,it:r}=e,{items:n}=t;if(!Array.isArray(n)){(0,p_.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}bC(e,n)}};function bC(e,t){let{gen:r,schema:n,data:s,keyword:i,it:o}=e;o.items=!0;let a=r.const("len",(0,ii._)`${s}.length`);if(n===!1)e.setParams({len:t.length}),e.pass((0,ii._)`${a} <= ${t.length}`);else if(typeof n=="object"&&!(0,p_.alwaysValidSchema)(o,n)){let c=r.var("valid",(0,ii._)`${a} <= ${t.length}`);r.if((0,ii.not)(c),()=>l(c)),e.ok(c)}function l(c){r.forRange("i",t.length,a,u=>{e.subschema({keyword:i,dataProp:u,dataPropType:p_.Type.Num},c),o.allErrors||r.if((0,ii.not)(c),()=>r.break())})}}Pl.validateAdditionalItems=bC;Pl.default=ZJ});var g_=S(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});Il.validateTuple=void 0;var SC=W(),Xf=Z(),QJ=mt(),eY={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){let{schema:t,it:r}=e;if(Array.isArray(t))return vC(e,"additionalItems",t);r.items=!0,!(0,Xf.alwaysValidSchema)(r,t)&&e.ok((0,QJ.validateArray)(e))}};function vC(e,t,r=e.schema){let{gen:n,parentSchema:s,data:i,keyword:o,it:a}=e;u(s),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Xf.mergeEvaluated.items(n,r.length,a.items));let l=n.name("valid"),c=n.const("len",(0,SC._)`${i}.length`);r.forEach((f,p)=>{(0,Xf.alwaysValidSchema)(a,f)||(n.if((0,SC._)`${c} > ${p}`,()=>e.subschema({keyword:o,schemaProp:p,dataProp:p},l)),e.ok(l))});function u(f){let{opts:p,errSchemaPath:d}=a,h=r.length,m=h===f.minItems&&(h===f.maxItems||f[t]===!1);if(p.strictTuples&&!m){let y=`"${o}" is ${h}-tuple, but minItems or maxItems/${t} are not specified or different at path "${d}"`;(0,Xf.checkStrictMode)(a,y,p.strictTuples)}}}Il.validateTuple=vC;Il.default=eY});var EC=S(y_=>{"use strict";Object.defineProperty(y_,"__esModule",{value:!0});var tY=g_(),rY={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,tY.validateTuple)(e,"items")};y_.default=rY});var RC=S(__=>{"use strict";Object.defineProperty(__,"__esModule",{value:!0});var wC=W(),nY=Z(),sY=mt(),iY=m_(),oY={message:({params:{len:e}})=>(0,wC.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,wC._)`{limit: ${e}}`},aY={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:oY,code(e){let{schema:t,parentSchema:r,it:n}=e,{prefixItems:s}=r;n.items=!0,!(0,nY.alwaysValidSchema)(n,t)&&(s?(0,iY.validateAdditionalItems)(e,s):e.ok((0,sY.validateArray)(e)))}};__.default=aY});var TC=S(b_=>{"use strict";Object.defineProperty(b_,"__esModule",{value:!0});var pr=W(),Zf=Z(),lY={message:({params:{min:e,max:t}})=>t===void 0?(0,pr.str)`must contain at least ${e} valid item(s)`:(0,pr.str)`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>t===void 0?(0,pr._)`{minContains: ${e}}`:(0,pr._)`{minContains: ${e}, maxContains: ${t}}`},cY={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:lY,code(e){let{gen:t,schema:r,parentSchema:n,data:s,it:i}=e,o,a,{minContains:l,maxContains:c}=n;i.opts.next?(o=l===void 0?1:l,a=c):o=1;let u=t.const("len",(0,pr._)`${s}.length`);if(e.setParams({min:o,max:a}),a===void 0&&o===0){(0,Zf.checkStrictMode)(i,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&o>a){(0,Zf.checkStrictMode)(i,'"minContains" > "maxContains" is always invalid'),e.fail();return}if((0,Zf.alwaysValidSchema)(i,r)){let m=(0,pr._)`${u} >= ${o}`;a!==void 0&&(m=(0,pr._)`${m} && ${u} <= ${a}`),e.pass(m);return}i.items=!0;let f=t.name("valid");a===void 0&&o===1?d(f,()=>t.if(f,()=>t.break())):o===0?(t.let(f,!0),a!==void 0&&t.if((0,pr._)`${s}.length > 0`,p)):(t.let(f,!1),p()),e.result(f,()=>e.reset());function p(){let m=t.name("_valid"),y=t.let("count",0);d(m,()=>t.if(m,()=>h(y)))}function d(m,y){t.forRange("i",0,u,b=>{e.subschema({keyword:"contains",dataProp:b,dataPropType:Zf.Type.Num,compositeRule:!0},m),y()})}function h(m){t.code((0,pr._)`${m}++`),a===void 0?t.if((0,pr._)`${m} >= ${o}`,()=>t.assign(f,!0).break()):(t.if((0,pr._)`${m} > ${a}`,()=>t.assign(f,!1).break()),o===1?t.assign(f,!0):t.if((0,pr._)`${m} >= ${o}`,()=>t.assign(f,!0)))}}};b_.default=cY});var IC=S(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.validateSchemaDeps=Kr.validatePropertyDeps=Kr.error=void 0;var S_=W(),uY=Z(),Al=mt();Kr.error={message:({params:{property:e,depsCount:t,deps:r}})=>{let n=t===1?"property":"properties";return(0,S_.str)`must have ${n} ${r} when property ${e} is present`},params:({params:{property:e,depsCount:t,deps:r,missingProperty:n}})=>(0,S_._)`{property: ${e},
    missingProperty: ${n},
    depsCount: ${t},
    deps: ${r}}`};var fY={keyword:"dependencies",type:"object",schemaType:"object",error:Kr.error,code(e){let[t,r]=dY(e);OC(e,t),PC(e,r)}};function dY({schema:e}){let t={},r={};for(let n in e){if(n==="__proto__")continue;let s=Array.isArray(e[n])?t:r;s[n]=e[n]}return[t,r]}function OC(e,t=e.schema){let{gen:r,data:n,it:s}=e;if(Object.keys(t).length===0)return;let i=r.let("missing");for(let o in t){let a=t[o];if(a.length===0)continue;let l=(0,Al.propertyInData)(r,n,o,s.opts.ownProperties);e.setParams({property:o,depsCount:a.length,deps:a.join(", ")}),s.allErrors?r.if(l,()=>{for(let c of a)(0,Al.checkReportMissingProp)(e,c)}):(r.if((0,S_._)`${l} && (${(0,Al.checkMissingProp)(e,a,i)})`),(0,Al.reportMissingProp)(e,i),r.else())}}Kr.validatePropertyDeps=OC;function PC(e,t=e.schema){let{gen:r,data:n,keyword:s,it:i}=e,o=r.name("valid");for(let a in t)(0,uY.alwaysValidSchema)(i,t[a])||(r.if((0,Al.propertyInData)(r,n,a,i.opts.ownProperties),()=>{let l=e.subschema({keyword:s,schemaProp:a},o);e.mergeValidEvaluated(l,o)},()=>r.var(o,!0)),e.ok(o))}Kr.validateSchemaDeps=PC;Kr.default=fY});var CC=S(v_=>{"use strict";Object.defineProperty(v_,"__esModule",{value:!0});var AC=W(),hY=Z(),pY={message:"property name must be valid",params:({params:e})=>(0,AC._)`{propertyName: ${e.propertyName}}`},mY={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:pY,code(e){let{gen:t,schema:r,data:n,it:s}=e;if((0,hY.alwaysValidSchema)(s,r))return;let i=t.name("valid");t.forIn("key",n,o=>{e.setParams({propertyName:o}),e.subschema({keyword:"propertyNames",data:o,dataTypes:["string"],propertyName:o,compositeRule:!0},i),t.if((0,AC.not)(i),()=>{e.error(!0),s.allErrors||t.break()})}),e.ok(i)}};v_.default=mY});var w_=S(E_=>{"use strict";Object.defineProperty(E_,"__esModule",{value:!0});var Qf=mt(),$r=W(),gY=dr(),ed=Z(),yY={message:"must NOT have additional properties",params:({params:e})=>(0,$r._)`{additionalProperty: ${e.additionalProperty}}`},_Y={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:yY,code(e){let{gen:t,schema:r,parentSchema:n,data:s,errsCount:i,it:o}=e;if(!i)throw new Error("ajv implementation error");let{allErrors:a,opts:l}=o;if(o.props=!0,l.removeAdditional!=="all"&&(0,ed.alwaysValidSchema)(o,r))return;let c=(0,Qf.allSchemaProperties)(n.properties),u=(0,Qf.allSchemaProperties)(n.patternProperties);f(),e.ok((0,$r._)`${i} === ${gY.default.errors}`);function f(){t.forIn("key",s,y=>{!c.length&&!u.length?h(y):t.if(p(y),()=>h(y))})}function p(y){let b;if(c.length>8){let v=(0,ed.schemaRefOrVal)(o,n.properties,"properties");b=(0,Qf.isOwnProperty)(t,v,y)}else c.length?b=(0,$r.or)(...c.map(v=>(0,$r._)`${y} === ${v}`)):b=$r.nil;return u.length&&(b=(0,$r.or)(b,...u.map(v=>(0,$r._)`${(0,Qf.usePattern)(e,v)}.test(${y})`))),(0,$r.not)(b)}function d(y){t.code((0,$r._)`delete ${s}[${y}]`)}function h(y){if(l.removeAdditional==="all"||l.removeAdditional&&r===!1){d(y);return}if(r===!1){e.setParams({additionalProperty:y}),e.error(),a||t.break();return}if(typeof r=="object"&&!(0,ed.alwaysValidSchema)(o,r)){let b=t.name("valid");l.removeAdditional==="failing"?(m(y,b,!1),t.if((0,$r.not)(b),()=>{e.reset(),d(y)})):(m(y,b),a||t.if((0,$r.not)(b),()=>t.break()))}}function m(y,b,v){let _={keyword:"additionalProperties",dataProp:y,dataPropType:ed.Type.Str};v===!1&&Object.assign(_,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(_,b)}}};E_.default=_Y});var xC=S(T_=>{"use strict";Object.defineProperty(T_,"__esModule",{value:!0});var bY=fo(),NC=mt(),R_=Z(),$C=w_(),SY={keyword:"properties",type:"object",schemaType:"object",code(e){let{gen:t,schema:r,parentSchema:n,data:s,it:i}=e;i.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&$C.default.code(new bY.KeywordCxt(i,$C.default,"additionalProperties"));let o=(0,NC.allSchemaProperties)(r);for(let f of o)i.definedProperties.add(f);i.opts.unevaluated&&o.length&&i.props!==!0&&(i.props=R_.mergeEvaluated.props(t,(0,R_.toHash)(o),i.props));let a=o.filter(f=>!(0,R_.alwaysValidSchema)(i,r[f]));if(a.length===0)return;let l=t.name("valid");for(let f of a)c(f)?u(f):(t.if((0,NC.propertyInData)(t,s,f,i.opts.ownProperties)),u(f),i.allErrors||t.else().var(l,!0),t.endIf()),e.it.definedProperties.add(f),e.ok(l);function c(f){return i.opts.useDefaults&&!i.compositeRule&&r[f].default!==void 0}function u(f){e.subschema({keyword:"properties",schemaProp:f,dataProp:f},l)}}};T_.default=SY});var qC=S(O_=>{"use strict";Object.defineProperty(O_,"__esModule",{value:!0});var kC=mt(),td=W(),LC=Z(),DC=Z(),vY={keyword:"patternProperties",type:"object",schemaType:"object",code(e){let{gen:t,schema:r,data:n,parentSchema:s,it:i}=e,{opts:o}=i,a=(0,kC.allSchemaProperties)(r),l=a.filter(m=>(0,LC.alwaysValidSchema)(i,r[m]));if(a.length===0||l.length===a.length&&(!i.opts.unevaluated||i.props===!0))return;let c=o.strictSchema&&!o.allowMatchingProperties&&s.properties,u=t.name("valid");i.props!==!0&&!(i.props instanceof td.Name)&&(i.props=(0,DC.evaluatedPropsToName)(t,i.props));let{props:f}=i;p();function p(){for(let m of a)c&&d(m),i.allErrors?h(m):(t.var(u,!0),h(m),t.if(u))}function d(m){for(let y in c)new RegExp(m).test(y)&&(0,LC.checkStrictMode)(i,`property ${y} matches pattern ${m} (use allowMatchingProperties)`)}function h(m){t.forIn("key",n,y=>{t.if((0,td._)`${(0,kC.usePattern)(e,m)}.test(${y})`,()=>{let b=l.includes(m);b||e.subschema({keyword:"patternProperties",schemaProp:m,dataProp:y,dataPropType:DC.Type.Str},u),i.opts.unevaluated&&f!==!0?t.assign((0,td._)`${f}[${y}]`,!0):!b&&!i.allErrors&&t.if((0,td.not)(u),()=>t.break())})})}}};O_.default=vY});var MC=S(P_=>{"use strict";Object.defineProperty(P_,"__esModule",{value:!0});var EY=Z(),wY={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){let{gen:t,schema:r,it:n}=e;if((0,EY.alwaysValidSchema)(n,r)){e.fail();return}let s=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},s),e.failResult(s,()=>e.reset(),()=>e.error())},error:{message:"must NOT be valid"}};P_.default=wY});var jC=S(I_=>{"use strict";Object.defineProperty(I_,"__esModule",{value:!0});var RY=mt(),TY={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:RY.validateUnion,error:{message:"must match a schema in anyOf"}};I_.default=TY});var FC=S(A_=>{"use strict";Object.defineProperty(A_,"__esModule",{value:!0});var rd=W(),OY=Z(),PY={message:"must match exactly one schema in oneOf",params:({params:e})=>(0,rd._)`{passingSchemas: ${e.passing}}`},IY={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:PY,code(e){let{gen:t,schema:r,parentSchema:n,it:s}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(s.opts.discriminator&&n.discriminator)return;let i=r,o=t.let("valid",!1),a=t.let("passing",null),l=t.name("_valid");e.setParams({passing:a}),t.block(c),e.result(o,()=>e.reset(),()=>e.error(!0));function c(){i.forEach((u,f)=>{let p;(0,OY.alwaysValidSchema)(s,u)?t.var(l,!0):p=e.subschema({keyword:"oneOf",schemaProp:f,compositeRule:!0},l),f>0&&t.if((0,rd._)`${l} && ${o}`).assign(o,!1).assign(a,(0,rd._)`[${a}, ${f}]`).else(),t.if(l,()=>{t.assign(o,!0),t.assign(a,f),p&&e.mergeEvaluated(p,rd.Name)})})}}};A_.default=IY});var VC=S(C_=>{"use strict";Object.defineProperty(C_,"__esModule",{value:!0});var AY=Z(),CY={keyword:"allOf",schemaType:"array",code(e){let{gen:t,schema:r,it:n}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");let s=t.name("valid");r.forEach((i,o)=>{if((0,AY.alwaysValidSchema)(n,i))return;let a=e.subschema({keyword:"allOf",schemaProp:o},s);e.ok(s),e.mergeEvaluated(a)})}};C_.default=CY});var BC=S(N_=>{"use strict";Object.defineProperty(N_,"__esModule",{value:!0});var nd=W(),HC=Z(),NY={message:({params:e})=>(0,nd.str)`must match "${e.ifClause}" schema`,params:({params:e})=>(0,nd._)`{failingKeyword: ${e.ifClause}}`},$Y={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:NY,code(e){let{gen:t,parentSchema:r,it:n}=e;r.then===void 0&&r.else===void 0&&(0,HC.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let s=UC(n,"then"),i=UC(n,"else");if(!s&&!i)return;let o=t.let("valid",!0),a=t.name("_valid");if(l(),e.reset(),s&&i){let u=t.let("ifClause");e.setParams({ifClause:u}),t.if(a,c("then",u),c("else",u))}else s?t.if(a,c("then")):t.if((0,nd.not)(a),c("else"));e.pass(o,()=>e.error(!0));function l(){let u=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);e.mergeEvaluated(u)}function c(u,f){return()=>{let p=e.subschema({keyword:u},a);t.assign(o,a),e.mergeValidEvaluated(p,o),f?t.assign(f,(0,nd._)`${u}`):e.setParams({ifClause:u})}}}};function UC(e,t){let r=e.schema[t];return r!==void 0&&!(0,HC.alwaysValidSchema)(e,r)}N_.default=$Y});var zC=S($_=>{"use strict";Object.defineProperty($_,"__esModule",{value:!0});var xY=Z(),kY={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:r}){t.if===void 0&&(0,xY.checkStrictMode)(r,`"${e}" without "if" is ignored`)}};$_.default=kY});var GC=S(x_=>{"use strict";Object.defineProperty(x_,"__esModule",{value:!0});var LY=m_(),DY=EC(),qY=g_(),MY=RC(),jY=TC(),FY=IC(),VY=CC(),UY=w_(),HY=xC(),BY=qC(),zY=MC(),GY=jC(),WY=FC(),KY=VC(),JY=BC(),YY=zC();function XY(e=!1){let t=[zY.default,GY.default,WY.default,KY.default,JY.default,YY.default,VY.default,UY.default,FY.default,HY.default,BY.default];return e?t.push(DY.default,MY.default):t.push(LY.default,qY.default),t.push(jY.default),t}x_.default=XY});var WC=S(k_=>{"use strict";Object.defineProperty(k_,"__esModule",{value:!0});var We=W(),ZY={message:({schemaCode:e})=>(0,We.str)`must match format "${e}"`,params:({schemaCode:e})=>(0,We._)`{format: ${e}}`},QY={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:ZY,code(e,t){let{gen:r,data:n,$data:s,schema:i,schemaCode:o,it:a}=e,{opts:l,errSchemaPath:c,schemaEnv:u,self:f}=a;if(!l.validateFormats)return;s?p():d();function p(){let h=r.scopeValue("formats",{ref:f.formats,code:l.code.formats}),m=r.const("fDef",(0,We._)`${h}[${o}]`),y=r.let("fType"),b=r.let("format");r.if((0,We._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(y,(0,We._)`${m}.type || "string"`).assign(b,(0,We._)`${m}.validate`),()=>r.assign(y,(0,We._)`"string"`).assign(b,m)),e.fail$data((0,We.or)(v(),_()));function v(){return l.strictSchema===!1?We.nil:(0,We._)`${o} && !${b}`}function _(){let g=u.$async?(0,We._)`(${m}.async ? await ${b}(${n}) : ${b}(${n}))`:(0,We._)`${b}(${n})`,T=(0,We._)`(typeof ${b} == "function" ? ${g} : ${b}.test(${n}))`;return(0,We._)`${b} && ${b} !== true && ${y} === ${t} && !${T}`}}function d(){let h=f.formats[i];if(!h){v();return}if(h===!0)return;let[m,y,b]=_(h);m===t&&e.pass(g());function v(){if(l.strictSchema===!1){f.logger.warn(T());return}throw new Error(T());function T(){return`unknown format "${i}" ignored in schema at path "${c}"`}}function _(T){let R=T instanceof RegExp?(0,We.regexpCode)(T):l.code.formats?(0,We._)`${l.code.formats}${(0,We.getProperty)(i)}`:void 0,w=r.scopeValue("formats",{key:i,ref:T,code:R});return typeof T=="object"&&!(T instanceof RegExp)?[T.type||"string",T.validate,(0,We._)`${w}.validate`]:["string",T,w]}function g(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!u.$async)throw new Error("async format in sync schema");return(0,We._)`await ${b}(${n})`}return typeof y=="function"?(0,We._)`${b}(${n})`:(0,We._)`${b}.test(${n})`}}}};k_.default=QY});var KC=S(L_=>{"use strict";Object.defineProperty(L_,"__esModule",{value:!0});var eX=WC(),tX=[eX.default];L_.default=tX});var JC=S(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.contentVocabulary=go.metadataVocabulary=void 0;go.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];go.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var XC=S(D_=>{"use strict";Object.defineProperty(D_,"__esModule",{value:!0});var rX=sC(),nX=_C(),sX=GC(),iX=KC(),YC=JC(),oX=[rX.default,nX.default,(0,sX.default)(),iX.default,YC.metadataVocabulary,YC.contentVocabulary];D_.default=oX});var q_=S(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.DiscrError=void 0;var ZC;(function(e){e.Tag="tag",e.Mapping="mapping"})(ZC||(sd.DiscrError=ZC={}))});var eN=S(j_=>{"use strict";Object.defineProperty(j_,"__esModule",{value:!0});var yo=W(),M_=q_(),QC=ri(),aX=wn(),lX=Z(),cX={message:({params:{discrError:e,tagName:t}})=>e===M_.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:r}})=>(0,yo._)`{error: ${e}, tag: ${r}, tagValue: ${t}}`},uX={keyword:"discriminator",type:"object",schemaType:"object",error:cX,code(e){let{gen:t,data:r,schema:n,parentSchema:s,it:i}=e,{oneOf:o}=s;if(!i.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!o)throw new Error("discriminator: requires oneOf keyword");let l=t.let("valid",!1),c=t.const("tag",(0,yo._)`${r}${(0,yo.getProperty)(a)}`);t.if((0,yo._)`typeof ${c} == "string"`,()=>u(),()=>e.error(!1,{discrError:M_.DiscrError.Tag,tag:c,tagName:a})),e.ok(l);function u(){let d=p();t.if(!1);for(let h in d)t.elseIf((0,yo._)`${c} === ${h}`),t.assign(l,f(d[h]));t.else(),e.error(!1,{discrError:M_.DiscrError.Mapping,tag:c,tagName:a}),t.endIf()}function f(d){let h=t.name("valid"),m=e.subschema({keyword:"oneOf",schemaProp:d},h);return e.mergeEvaluated(m,yo.Name),h}function p(){var d;let h={},m=b(s),y=!0;for(let g=0;g<o.length;g++){let T=o[g];if(T?.$ref&&!(0,lX.schemaHasRulesButRef)(T,i.self.RULES)){let w=T.$ref;if(T=QC.resolveRef.call(i.self,i.schemaEnv.root,i.baseId,w),T instanceof QC.SchemaEnv&&(T=T.schema),T===void 0)throw new aX.default(i.opts.uriResolver,i.baseId,w)}let R=(d=T?.properties)===null||d===void 0?void 0:d[a];if(typeof R!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);y=y&&(m||b(T)),v(R,g)}if(!y)throw new Error(`discriminator: "${a}" must be required`);return h;function b({required:g}){return Array.isArray(g)&&g.includes(a)}function v(g,T){if(g.const)_(g.const,T);else if(g.enum)for(let R of g.enum)_(R,T);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function _(g,T){if(typeof g!="string"||g in h)throw new Error(`discriminator: "${a}" values must be unique strings`);h[g]=T}}}};j_.default=uX});var tN=S((age,fX)=>{fX.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var od=S((Ce,F_)=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.MissingRefError=Ce.ValidationError=Ce.CodeGen=Ce.Name=Ce.nil=Ce.stringify=Ce.str=Ce._=Ce.KeywordCxt=Ce.Ajv=void 0;var dX=Jy(),hX=XC(),pX=eN(),rN=tN(),mX=["/properties"],id="http://json-schema.org/draft-07/schema",_o=class extends dX.default{_addVocabularies(){super._addVocabularies(),hX.default.forEach(t=>this.addVocabulary(t)),this.opts.discriminator&&this.addKeyword(pX.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let t=this.opts.$data?this.$dataMetaSchema(rN,mX):rN;this.addMetaSchema(t,id,!1),this.refs["http://json-schema.org/schema"]=id}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(id)?id:void 0)}};Ce.Ajv=_o;F_.exports=Ce=_o;F_.exports.Ajv=_o;Object.defineProperty(Ce,"__esModule",{value:!0});Ce.default=_o;var gX=fo();Object.defineProperty(Ce,"KeywordCxt",{enumerable:!0,get:function(){return gX.KeywordCxt}});var bo=W();Object.defineProperty(Ce,"_",{enumerable:!0,get:function(){return bo._}});Object.defineProperty(Ce,"str",{enumerable:!0,get:function(){return bo.str}});Object.defineProperty(Ce,"stringify",{enumerable:!0,get:function(){return bo.stringify}});Object.defineProperty(Ce,"nil",{enumerable:!0,get:function(){return bo.nil}});Object.defineProperty(Ce,"Name",{enumerable:!0,get:function(){return bo.Name}});Object.defineProperty(Ce,"CodeGen",{enumerable:!0,get:function(){return bo.CodeGen}});var yX=ml();Object.defineProperty(Ce,"ValidationError",{enumerable:!0,get:function(){return yX.default}});var _X=wn();Object.defineProperty(Ce,"MissingRefError",{enumerable:!0,get:function(){return _X.default}})});var ad=S(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.formatNames=Yr.fastFormats=Yr.fullFormats=void 0;function Jr(e,t){return{validate:e,compare:t}}Yr.fullFormats={date:Jr(oN,B_),time:Jr(U_(!0),z_),"date-time":Jr(nN(!0),lN),"iso-time":Jr(U_(),aN),"iso-date-time":Jr(nN(),cN),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:RX,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:NX,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:TX,int32:{type:"number",validate:IX},int64:{type:"number",validate:AX},float:{type:"number",validate:iN},double:{type:"number",validate:iN},password:!0,binary:!0};Yr.fastFormats={...Yr.fullFormats,date:Jr(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,B_),time:Jr(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,z_),"date-time":Jr(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,lN),"iso-time":Jr(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,aN),"iso-date-time":Jr(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,cN),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Yr.formatNames=Object.keys(Yr.fullFormats);function bX(e){return e%4===0&&(e%100!==0||e%400===0)}var SX=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,vX=[0,31,28,31,30,31,30,31,31,30,31,30,31];function oN(e){let t=SX.exec(e);if(!t)return!1;let r=+t[1],n=+t[2],s=+t[3];return n>=1&&n<=12&&s>=1&&s<=(n===2&&bX(r)?29:vX[n])}function B_(e,t){if(e&&t)return e>t?1:e<t?-1:0}var V_=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function U_(e){return function(r){let n=V_.exec(r);if(!n)return!1;let s=+n[1],i=+n[2],o=+n[3],a=n[4],l=n[5]==="-"?-1:1,c=+(n[6]||0),u=+(n[7]||0);if(c>23||u>59||e&&!a)return!1;if(s<=23&&i<=59&&o<60)return!0;let f=i-u*l,p=s-c*l-(f<0?1:0);return(p===23||p===-1)&&(f===59||f===-1)&&o<61}}function z_(e,t){if(!(e&&t))return;let r=new Date("2020-01-01T"+e).valueOf(),n=new Date("2020-01-01T"+t).valueOf();if(r&&n)return r-n}function aN(e,t){if(!(e&&t))return;let r=V_.exec(e),n=V_.exec(t);if(r&&n)return e=r[1]+r[2]+r[3],t=n[1]+n[2]+n[3],e>t?1:e<t?-1:0}var H_=/t|\s/i;function nN(e){let t=U_(e);return function(n){let s=n.split(H_);return s.length===2&&oN(s[0])&&t(s[1])}}function lN(e,t){if(!(e&&t))return;let r=new Date(e).valueOf(),n=new Date(t).valueOf();if(r&&n)return r-n}function cN(e,t){if(!(e&&t))return;let[r,n]=e.split(H_),[s,i]=t.split(H_),o=B_(r,s);if(o!==void 0)return o||z_(n,i)}var EX=/\/|:/,wX=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function RX(e){return EX.test(e)&&wX.test(e)}var sN=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function TX(e){return sN.lastIndex=0,sN.test(e)}var OX=-(2**31),PX=2**31-1;function IX(e){return Number.isInteger(e)&&e<=PX&&e>=OX}function AX(e){return Number.isInteger(e)}function iN(){return!0}var CX=/[^\\]\\Z/;function NX(e){if(CX.test(e))return!1;try{return new RegExp(e),!0}catch{return!1}}});var uN=S(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.formatLimitDefinition=void 0;var $X=od(),xr=W(),ls=xr.operators,ld={formatMaximum:{okStr:"<=",ok:ls.LTE,fail:ls.GT},formatMinimum:{okStr:">=",ok:ls.GTE,fail:ls.LT},formatExclusiveMaximum:{okStr:"<",ok:ls.LT,fail:ls.GTE},formatExclusiveMinimum:{okStr:">",ok:ls.GT,fail:ls.LTE}},xX={message:({keyword:e,schemaCode:t})=>(0,xr.str)`should be ${ld[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>(0,xr._)`{comparison: ${ld[e].okStr}, limit: ${t}}`};So.formatLimitDefinition={keyword:Object.keys(ld),type:"string",schemaType:"string",$data:!0,error:xX,code(e){let{gen:t,data:r,schemaCode:n,keyword:s,it:i}=e,{opts:o,self:a}=i;if(!o.validateFormats)return;let l=new $X.KeywordCxt(i,a.RULES.all.format.definition,"format");l.$data?c():u();function c(){let p=t.scopeValue("formats",{ref:a.formats,code:o.code.formats}),d=t.const("fmt",(0,xr._)`${p}[${l.schemaCode}]`);e.fail$data((0,xr.or)((0,xr._)`typeof ${d} != "object"`,(0,xr._)`${d} instanceof RegExp`,(0,xr._)`typeof ${d}.compare != "function"`,f(d)))}function u(){let p=l.schema,d=a.formats[p];if(!d||d===!0)return;if(typeof d!="object"||d instanceof RegExp||typeof d.compare!="function")throw new Error(`"${s}": format "${p}" does not define "compare" function`);let h=t.scopeValue("formats",{key:p,ref:d,code:o.code.formats?(0,xr._)`${o.code.formats}${(0,xr.getProperty)(p)}`:void 0});e.fail$data(f(h))}function f(p){return(0,xr._)`${p}.compare(${r}, ${n}) ${ld[s].fail} 0`}},dependencies:["format"]};var kX=e=>(e.addKeyword(So.formatLimitDefinition),e);So.default=kX});var K_=S((Cl,hN)=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});var vo=ad(),LX=uN(),G_=W(),fN=new G_.Name("fullFormats"),DX=new G_.Name("fastFormats"),W_=(e,t={keywords:!0})=>{if(Array.isArray(t))return dN(e,t,vo.fullFormats,fN),e;let[r,n]=t.mode==="fast"?[vo.fastFormats,DX]:[vo.fullFormats,fN],s=t.formats||vo.formatNames;return dN(e,s,r,n),t.keywords&&(0,LX.default)(e),e};W_.get=(e,t="full")=>{let n=(t==="fast"?vo.fastFormats:vo.fullFormats)[e];if(!n)throw new Error(`Unknown format "${e}"`);return n};function dN(e,t,r,n){var s,i;(s=(i=e.opts.code).formats)!==null&&s!==void 0||(i.formats=(0,G_._)`require("ajv-formats/dist/formats").${n}`);for(let o of t)e.addFormat(o,r[o])}hN.exports=Cl=W_;Object.defineProperty(Cl,"__esModule",{value:!0});Cl.default=W_});var Y_=S((uge,pN)=>{"use strict";var qX=od(),MX=Bf(),jX=K_(),FX=of()({proto:!0}),J_=class e{constructor(t){this.ajv=new qX({...t,strictSchema:!1,validateSchema:!1,allowUnionTypes:!0,uriResolver:MX}),jX(this.ajv),this.ajv.addKeyword({keyword:"fjs_type",type:"object",errors:!1,validate:(r,n)=>n instanceof Date}),this._ajvSchemas={},this._ajvOptions=t||{}}addSchema(t,r){let n=t.$id||r;if(t.$id!==void 0&&t.$id[0]==="#"&&(n=r+t.$id),this.ajv.refs[n]===void 0&&this.ajv.schemas[n]===void 0){let s=FX(t);this.convertSchemaToAjvFormat(s),this.ajv.addSchema(s,n),this._ajvSchemas[n]=t}}validate(t,r){return this.ajv.validate(t,r)}convertSchemaToAjvFormat(t){if(t!==null){t.type==="string"?(t.fjs_type="string",t.type=["string","object"]):Array.isArray(t.type)&&t.type.includes("string")&&!t.type.includes("object")&&(t.fjs_type="string",t.type.push("object"));for(let r in t)typeof t[r]=="object"&&this.convertSchemaToAjvFormat(t[r])}}getState(){return{ajvOptions:this._ajvOptions,ajvSchemas:this._ajvSchemas}}static restoreFromState(t){let r=new e(t.ajvOptions);for(let[n,s]of Object.entries(t.ajvSchemas))r.ajv.addSchema(s,n);return r}};pN.exports=J_});var gN=S((fge,mN)=>{"use strict";var X_=class e{constructor(t,r,n="#"){this.schema=t,this.schemaId=r,this.jsonPointer=n}getPropertyLocation(t){return new e(this.schema[t],this.schemaId,this.jsonPointer+"/"+t)}getSchemaRef(){return this.schemaId+this.jsonPointer}};mN.exports=X_});var vN=S((dge,Q_)=>{"use strict";Q_.exports=k;Q_.exports.default=k;var VX={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0},yN={enum:["array","boolean","integer","null","number","object","string"]},_N=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,UX=ad().fullFormats.uri,bN=ad().fullFormats.regex;function mr(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:s=e}={}){let i=null,o=0,a=o;return typeof e=="number"&&!(e%1)&&!isNaN(e)&&isFinite(e)?o===a&&typeof e=="number"&&isFinite(e)&&(e<0||isNaN(e))?(mr.errors=[{instancePath:t,schemaPath:"#/definitions/nonNegativeInteger/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1):(mr.errors=i,o===0):(mr.errors=[{instancePath:t,schemaPath:"#/definitions/nonNegativeInteger/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1)}var Z_={validate:k};function kt(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:s=e}={}){let i=null,o=0;if(o===0)if(Array.isArray(e)){if(e.length<1)return kt.errors=[{instancePath:t,schemaPath:"#/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var a=!0;let l=e.length;for(let c=0;c<l;c++){let u=o;Z_.validate(e[c],{instancePath:t+"/"+c,parentData:e,parentDataProperty:c,rootData:s})||(i=i===null?Z_.validate.errors:i.concat(Z_.validate.errors),o=i.length);var a=u===o;if(!a)break}}}else return kt.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;return kt.errors=i,o===0}var SN=Tl().default;function k(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:s=e}={}){let i=null,o=0;if(!(e&&typeof e=="object"&&!Array.isArray(e))&&typeof e!="boolean")return k.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:VX.type},message:"must be object,boolean"}],!1;if(o===0&&e&&typeof e=="object"&&!Array.isArray(e)){if(e.$id!==void 0){let _=e.$id,g=o;if(o===g&&o===g)if(typeof _=="string"){if(!_N.test(_))return k.errors=[{instancePath:t+"/$id",schemaPath:"#/properties/%24id/format",keyword:"format",params:{format:"uri-reference"},message:'must match format "uri-reference"'}],!1}else return k.errors=[{instancePath:t+"/$id",schemaPath:"#/properties/%24id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=g===o}else var a=!0;if(a){if(e.$schema!==void 0){let _=e.$schema,g=o;if(o===g&&o===g)if(typeof _=="string"){if(!UX(_))return k.errors=[{instancePath:t+"/$schema",schemaPath:"#/properties/%24schema/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1}else return k.errors=[{instancePath:t+"/$schema",schemaPath:"#/properties/%24schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=g===o}else var a=!0;if(a){if(e.$ref!==void 0){let _=e.$ref,g=o;if(o===g&&o===g)if(typeof _=="string"){if(!_N.test(_))return k.errors=[{instancePath:t+"/$ref",schemaPath:"#/properties/%24ref/format",keyword:"format",params:{format:"uri-reference"},message:'must match format "uri-reference"'}],!1}else return k.errors=[{instancePath:t+"/$ref",schemaPath:"#/properties/%24ref/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=g===o}else var a=!0;if(a){if(e.$comment!==void 0){let _=o;if(typeof e.$comment!="string")return k.errors=[{instancePath:t+"/$comment",schemaPath:"#/properties/%24comment/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.title!==void 0){let _=o;if(typeof e.title!="string")return k.errors=[{instancePath:t+"/title",schemaPath:"#/properties/title/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.description!==void 0){let _=o;if(typeof e.description!="string")return k.errors=[{instancePath:t+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.readOnly!==void 0){let _=o;if(typeof e.readOnly!="boolean")return k.errors=[{instancePath:t+"/readOnly",schemaPath:"#/properties/readOnly/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var a=_===o}else var a=!0;if(a){if(e.examples!==void 0){let _=o;if(o===_&&!Array.isArray(e.examples))return k.errors=[{instancePath:t+"/examples",schemaPath:"#/properties/examples/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var a=_===o}else var a=!0;if(a){if(e.multipleOf!==void 0){let _=e.multipleOf,g=o;if(o===g)if(typeof _=="number"&&isFinite(_)){if(_<=0||isNaN(_))return k.errors=[{instancePath:t+"/multipleOf",schemaPath:"#/properties/multipleOf/exclusiveMinimum",keyword:"exclusiveMinimum",params:{comparison:">",limit:0},message:"must be > 0"}],!1}else return k.errors=[{instancePath:t+"/multipleOf",schemaPath:"#/properties/multipleOf/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var a=g===o}else var a=!0;if(a){if(e.maximum!==void 0){let _=e.maximum,g=o;if(!(typeof _=="number"&&isFinite(_)))return k.errors=[{instancePath:t+"/maximum",schemaPath:"#/properties/maximum/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var a=g===o}else var a=!0;if(a){if(e.exclusiveMaximum!==void 0){let _=e.exclusiveMaximum,g=o;if(!(typeof _=="number"&&isFinite(_)))return k.errors=[{instancePath:t+"/exclusiveMaximum",schemaPath:"#/properties/exclusiveMaximum/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var a=g===o}else var a=!0;if(a){if(e.minimum!==void 0){let _=e.minimum,g=o;if(!(typeof _=="number"&&isFinite(_)))return k.errors=[{instancePath:t+"/minimum",schemaPath:"#/properties/minimum/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var a=g===o}else var a=!0;if(a){if(e.exclusiveMinimum!==void 0){let _=e.exclusiveMinimum,g=o;if(!(typeof _=="number"&&isFinite(_)))return k.errors=[{instancePath:t+"/exclusiveMinimum",schemaPath:"#/properties/exclusiveMinimum/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var a=g===o}else var a=!0;if(a){if(e.maxLength!==void 0){let _=e.maxLength,g=o,T=o;if(!(typeof _=="number"&&!(_%1)&&!isNaN(_)&&isFinite(_)))return k.errors=[{instancePath:t+"/maxLength",schemaPath:"#/definitions/nonNegativeInteger/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;if(o===T&&typeof _=="number"&&isFinite(_)&&(_<0||isNaN(_)))return k.errors=[{instancePath:t+"/maxLength",schemaPath:"#/definitions/nonNegativeInteger/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1;var a=g===o}else var a=!0;if(a){if(e.minLength!==void 0){let _=o;mr(e.minLength,{instancePath:t+"/minLength",parentData:e,parentDataProperty:"minLength",rootData:s})||(i=i===null?mr.errors:i.concat(mr.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.pattern!==void 0){let _=e.pattern,g=o;if(o===g&&o===g)if(typeof _=="string"){if(!bN(_))return k.errors=[{instancePath:t+"/pattern",schemaPath:"#/properties/pattern/format",keyword:"format",params:{format:"regex"},message:'must match format "regex"'}],!1}else return k.errors=[{instancePath:t+"/pattern",schemaPath:"#/properties/pattern/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=g===o}else var a=!0;if(a){if(e.additionalItems!==void 0){let _=o;k(e.additionalItems,{instancePath:t+"/additionalItems",parentData:e,parentDataProperty:"additionalItems",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.items!==void 0){let _=e.items,g=o,T=o,R=!1,w=o;k(_,{instancePath:t+"/items",parentData:e,parentDataProperty:"items",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var l=w===o;if(R=R||l,!R){let O=o;kt(_,{instancePath:t+"/items",parentData:e,parentDataProperty:"items",rootData:s})||(i=i===null?kt.errors:i.concat(kt.errors),o=i.length);var l=O===o;R=R||l}if(R)o=T,i!==null&&(T?i.length=T:i=null);else{let O={instancePath:t+"/items",schemaPath:"#/properties/items/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return i===null?i=[O]:i.push(O),o++,k.errors=i,!1}var a=g===o}else var a=!0;if(a){if(e.maxItems!==void 0){let _=e.maxItems,g=o,T=o;if(!(typeof _=="number"&&!(_%1)&&!isNaN(_)&&isFinite(_)))return k.errors=[{instancePath:t+"/maxItems",schemaPath:"#/definitions/nonNegativeInteger/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;if(o===T&&typeof _=="number"&&isFinite(_)&&(_<0||isNaN(_)))return k.errors=[{instancePath:t+"/maxItems",schemaPath:"#/definitions/nonNegativeInteger/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1;var a=g===o}else var a=!0;if(a){if(e.minItems!==void 0){let _=o;mr(e.minItems,{instancePath:t+"/minItems",parentData:e,parentDataProperty:"minItems",rootData:s})||(i=i===null?mr.errors:i.concat(mr.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.uniqueItems!==void 0){let _=o;if(typeof e.uniqueItems!="boolean")return k.errors=[{instancePath:t+"/uniqueItems",schemaPath:"#/properties/uniqueItems/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var a=_===o}else var a=!0;if(a){if(e.contains!==void 0){let _=o;k(e.contains,{instancePath:t+"/contains",parentData:e,parentDataProperty:"contains",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.maxProperties!==void 0){let _=e.maxProperties,g=o,T=o;if(!(typeof _=="number"&&!(_%1)&&!isNaN(_)&&isFinite(_)))return k.errors=[{instancePath:t+"/maxProperties",schemaPath:"#/definitions/nonNegativeInteger/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;if(o===T&&typeof _=="number"&&isFinite(_)&&(_<0||isNaN(_)))return k.errors=[{instancePath:t+"/maxProperties",schemaPath:"#/definitions/nonNegativeInteger/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1;var a=g===o}else var a=!0;if(a){if(e.minProperties!==void 0){let _=o;mr(e.minProperties,{instancePath:t+"/minProperties",parentData:e,parentDataProperty:"minProperties",rootData:s})||(i=i===null?mr.errors:i.concat(mr.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.required!==void 0){let _=e.required,g=o;if(o===o)if(Array.isArray(_)){var c=!0;let w=_.length;for(let P=0;P<w;P++){let O=o;if(typeof _[P]!="string")return k.errors=[{instancePath:t+"/required/"+P,schemaPath:"#/definitions/stringArray/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=O===o;if(!c)break}if(c){let P=_.length,O;if(P>1){let A={};for(;P--;){let q=_[P];if(typeof q=="string"){if(typeof A[q]=="number"){return O=A[q],k.errors=[{instancePath:t+"/required",schemaPath:"#/definitions/stringArray/uniqueItems",keyword:"uniqueItems",params:{i:P,j:O},message:"must NOT have duplicate items (items ## "+O+" and "+P+" are identical)"}],!1;break}A[q]=P}}}}}else return k.errors=[{instancePath:t+"/required",schemaPath:"#/definitions/stringArray/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var a=g===o}else var a=!0;if(a){if(e.additionalProperties!==void 0){let _=o;k(e.additionalProperties,{instancePath:t+"/additionalProperties",parentData:e,parentDataProperty:"additionalProperties",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.definitions!==void 0){let _=e.definitions,g=o;if(o===g)if(_&&typeof _=="object"&&!Array.isArray(_))for(let R in _){let w=o;k(_[R],{instancePath:t+"/definitions/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:_,parentDataProperty:R,rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var u=w===o;if(!u)break}else return k.errors=[{instancePath:t+"/definitions",schemaPath:"#/properties/definitions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var a=g===o}else var a=!0;if(a){if(e.properties!==void 0){let _=e.properties,g=o;if(o===g)if(_&&typeof _=="object"&&!Array.isArray(_))for(let R in _){let w=o;k(_[R],{instancePath:t+"/properties/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:_,parentDataProperty:R,rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var f=w===o;if(!f)break}else return k.errors=[{instancePath:t+"/properties",schemaPath:"#/properties/properties/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var a=g===o}else var a=!0;if(a){if(e.patternProperties!==void 0){let _=e.patternProperties,g=o;if(o===g)if(_&&typeof _=="object"&&!Array.isArray(_)){for(let R in _){let w=o;if(o===w&&typeof R=="string"&&!bN(R)){let P={instancePath:t+"/patternProperties",schemaPath:"#/properties/patternProperties/propertyNames/format",keyword:"format",params:{format:"regex"},message:'must match format "regex"',propertyName:R};i===null?i=[P]:i.push(P),o++}var p=w===o;if(!p){let P={instancePath:t+"/patternProperties",schemaPath:"#/properties/patternProperties/propertyNames",keyword:"propertyNames",params:{propertyName:R},message:"property name must be valid"};return i===null?i=[P]:i.push(P),o++,k.errors=i,!1;break}}if(p)for(let R in _){let w=o;k(_[R],{instancePath:t+"/patternProperties/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:_,parentDataProperty:R,rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var d=w===o;if(!d)break}}else return k.errors=[{instancePath:t+"/patternProperties",schemaPath:"#/properties/patternProperties/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var a=g===o}else var a=!0;if(a){if(e.dependencies!==void 0){let _=e.dependencies,g=o;if(o===g)if(_&&typeof _=="object"&&!Array.isArray(_))for(let R in _){let w=_[R],P=o,O=o,A=!1,q=o;k(w,{instancePath:t+"/dependencies/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:_,parentDataProperty:R,rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var h=q===o;if(A=A||h,!A){let C=o;if(o===o)if(Array.isArray(w)){var m=!0;let se=w.length;for(let D=0;D<se;D++){let K=o;if(typeof w[D]!="string"){let U={instancePath:t+"/dependencies/"+R.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+D,schemaPath:"#/definitions/stringArray/items/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[U]:i.push(U),o++}var m=K===o;if(!m)break}if(m){let D=w.length,K;if(D>1){let ut={};for(;D--;){let U=w[D];if(typeof U=="string"){if(typeof ut[U]=="number"){K=ut[U];let it={instancePath:t+"/dependencies/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/stringArray/uniqueItems",keyword:"uniqueItems",params:{i:D,j:K},message:"must NOT have duplicate items (items ## "+K+" and "+D+" are identical)"};i===null?i=[it]:i.push(it),o++;break}ut[U]=D}}}}}else{let se={instancePath:t+"/dependencies/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/stringArray/type",keyword:"type",params:{type:"array"},message:"must be array"};i===null?i=[se]:i.push(se),o++}var h=C===o;A=A||h}if(A)o=O,i!==null&&(O?i.length=O:i=null);else{let C={instancePath:t+"/dependencies/"+R.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/dependencies/additionalProperties/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return i===null?i=[C]:i.push(C),o++,k.errors=i,!1}var y=P===o;if(!y)break}else return k.errors=[{instancePath:t+"/dependencies",schemaPath:"#/properties/dependencies/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var a=g===o}else var a=!0;if(a){if(e.propertyNames!==void 0){let _=o;k(e.propertyNames,{instancePath:t+"/propertyNames",parentData:e,parentDataProperty:"propertyNames",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.enum!==void 0){let _=e.enum,g=o;if(o===g)if(Array.isArray(_)){if(_.length<1)return k.errors=[{instancePath:t+"/enum",schemaPath:"#/properties/enum/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{let R=_.length,w;if(R>1){e:for(;R--;)for(w=R;w--;)if(SN(_[R],_[w])){return k.errors=[{instancePath:t+"/enum",schemaPath:"#/properties/enum/uniqueItems",keyword:"uniqueItems",params:{i:R,j:w},message:"must NOT have duplicate items (items ## "+w+" and "+R+" are identical)"}],!1;break e}}}}else return k.errors=[{instancePath:t+"/enum",schemaPath:"#/properties/enum/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var a=g===o}else var a=!0;if(a){if(e.type!==void 0){let _=e.type,g=o,T=o,R=!1,w=o;if(!(_==="array"||_==="boolean"||_==="integer"||_==="null"||_==="number"||_==="object"||_==="string")){let O={instancePath:t+"/type",schemaPath:"#/definitions/simpleTypes/enum",keyword:"enum",params:{allowedValues:yN.enum},message:"must be equal to one of the allowed values"};i===null?i=[O]:i.push(O),o++}var b=w===o;if(R=R||b,!R){let O=o;if(o===O)if(Array.isArray(_))if(_.length<1){let q={instancePath:t+"/type",schemaPath:"#/properties/type/anyOf/1/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};i===null?i=[q]:i.push(q),o++}else{var v=!0;let q=_.length;for(let C=0;C<q;C++){let N=_[C],B=o;if(!(N==="array"||N==="boolean"||N==="integer"||N==="null"||N==="number"||N==="object"||N==="string")){let D={instancePath:t+"/type/"+C,schemaPath:"#/definitions/simpleTypes/enum",keyword:"enum",params:{allowedValues:yN.enum},message:"must be equal to one of the allowed values"};i===null?i=[D]:i.push(D),o++}var v=B===o;if(!v)break}if(v){let C=_.length,N;if(C>1){e:for(;C--;)for(N=C;N--;)if(SN(_[C],_[N])){let B={instancePath:t+"/type",schemaPath:"#/properties/type/anyOf/1/uniqueItems",keyword:"uniqueItems",params:{i:C,j:N},message:"must NOT have duplicate items (items ## "+N+" and "+C+" are identical)"};i===null?i=[B]:i.push(B),o++;break e}}}}else{let q={instancePath:t+"/type",schemaPath:"#/properties/type/anyOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};i===null?i=[q]:i.push(q),o++}var b=O===o;R=R||b}if(R)o=T,i!==null&&(T?i.length=T:i=null);else{let O={instancePath:t+"/type",schemaPath:"#/properties/type/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return i===null?i=[O]:i.push(O),o++,k.errors=i,!1}var a=g===o}else var a=!0;if(a){if(e.format!==void 0){let _=o;if(typeof e.format!="string")return k.errors=[{instancePath:t+"/format",schemaPath:"#/properties/format/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.contentMediaType!==void 0){let _=o;if(typeof e.contentMediaType!="string")return k.errors=[{instancePath:t+"/contentMediaType",schemaPath:"#/properties/contentMediaType/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.contentEncoding!==void 0){let _=o;if(typeof e.contentEncoding!="string")return k.errors=[{instancePath:t+"/contentEncoding",schemaPath:"#/properties/contentEncoding/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var a=_===o}else var a=!0;if(a){if(e.if!==void 0){let _=o;k(e.if,{instancePath:t+"/if",parentData:e,parentDataProperty:"if",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.then!==void 0){let _=o;k(e.then,{instancePath:t+"/then",parentData:e,parentDataProperty:"then",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.else!==void 0){let _=o;k(e.else,{instancePath:t+"/else",parentData:e,parentDataProperty:"else",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.allOf!==void 0){let _=o;kt(e.allOf,{instancePath:t+"/allOf",parentData:e,parentDataProperty:"allOf",rootData:s})||(i=i===null?kt.errors:i.concat(kt.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.anyOf!==void 0){let _=o;kt(e.anyOf,{instancePath:t+"/anyOf",parentData:e,parentDataProperty:"anyOf",rootData:s})||(i=i===null?kt.errors:i.concat(kt.errors),o=i.length);var a=_===o}else var a=!0;if(a){if(e.oneOf!==void 0){let _=o;kt(e.oneOf,{instancePath:t+"/oneOf",parentData:e,parentDataProperty:"oneOf",rootData:s})||(i=i===null?kt.errors:i.concat(kt.errors),o=i.length);var a=_===o}else var a=!0;if(a)if(e.not!==void 0){let _=o;k(e.not,{instancePath:t+"/not",parentData:e,parentDataProperty:"not",rootData:s})||(i=i===null?k.errors:i.concat(k.errors),o=i.length);var a=_===o}else var a=!0}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return k.errors=i,o===0}});var n0=S((hge,EN)=>{"use strict";var e0=class extends Error{constructor(t,r){super(),this.name="JsonSchemaMergeError",this.code="JSON_SCHEMA_MERGE_ERROR",this.message=`Failed to merge "${t}" keyword schemas.`,this.schemas=r}},t0=class extends Error{constructor(t,r){super(),this.name="JsonSchemaMergeError",this.code="JSON_SCHEMA_MERGE_ERROR",this.message=`Resolver for "${t}" keyword not found.`,this.schemas=r}},r0=class extends Error{constructor(t){super(),this.name="JsonSchemaMergeError",this.code="JSON_SCHEMA_MERGE_ERROR",this.message=`Invalid "onConflict" option: "${t}".`}};EN.exports={MergeError:e0,ResolverNotFoundError:t0,InvalidOnConflictOptionError:r0}});var TN=S((pge,RN)=>{"use strict";var{dequal:HX}=Of(),{MergeError:s0}=n0();function wN(e){let t=e[0];for(let r=1;r<e.length;r++)t=t.filter(n=>e[r].includes(n));return t}function BX(e,t,r){let n=wN(t);if(n.length===0)throw new s0(e,t);r[e]=n}function zX(e,t,r){for(let s=0;s<t.length;s++)Array.isArray(t[s])||(t[s]=[t[s]]);let n=wN(t);if(n.length===0)throw new s0(e,t);n.length===1?r[e]=n[0]:r[e]=n}function GX(e,t,r){let n=[];for(let s of t)for(let i of s)n.includes(i)||n.push(i);r[e]=n}function WX(e,t,r){r[e]=Math.min(...t)}function KX(e,t,r){r[e]=Math.max(...t)}function JX(e,t,r){let n=(a,l)=>l?n(l,a%l):a,s=(a,l)=>a*l/n(a,l),i=1;for(let a of t)for(;a*i%1!==0;)i*=10;let o=t[0]*i;for(let a of t)o=s(o,a*i);r[e]=o/i}function YX(e,t,r){let n=t[0];for(let s=1;s<t.length;s++)if(!HX(t[s],n))throw new s0(e,t);r[e]=n}function XX(){}function ZX(e,t,r){for(let n of t)if(n===!1){r[e]=!1;return}r[e]=!0}function QX(e,t,r){for(let n of t)if(n===!0){r[e]=!0;return}r[e]=!1}RN.exports={arraysIntersection:BX,hybridArraysIntersection:zX,arraysUnion:GX,minNumber:WX,maxNumber:KX,commonMultiple:JX,allEqual:YX,booleanAnd:ZX,booleanOr:QX,skip:XX}});var NN=S((mge,CN)=>{"use strict";var{dequal:eZ}=Of(),De=TN(),fd=n0(),IN={$id:De.skip,type:De.hybridArraysIntersection,enum:De.arraysIntersection,minLength:De.maxNumber,maxLength:De.minNumber,minimum:De.maxNumber,maximum:De.minNumber,multipleOf:De.commonMultiple,exclusiveMinimum:De.maxNumber,exclusiveMaximum:De.minNumber,minItems:De.maxNumber,maxItems:De.minNumber,maxProperties:De.minNumber,minProperties:De.maxNumber,const:De.allEqual,default:De.allEqual,format:De.allEqual,required:De.arraysUnion,properties:oZ,patternProperties:ud,additionalProperties:cd,items:nZ,additionalItems:sZ,definitions:ud,$defs:ud,nullable:De.booleanAnd,oneOf:ON,anyOf:ON,allOf:De.arraysUnion,not:cd,if:aZ,then:De.skip,else:De.skip,dependencies:PN,dependentRequired:PN,dependentSchemas:ud,propertyNames:cd,uniqueItems:De.booleanOr,contains:cd};function cd(e,t,r,n,s){r[e]=kr(t,s)}function tZ(e){let t=[[]];for(let r of e){let n=[];for(let s of t)for(let i of r)n.push([...s,i]);t=n}return t}function ON(e,t,r,n,s){if(t.length===1){r[e]=t[0];return}let i=tZ(t),o=[];for(let a of i)try{let l=kr(a,s);l!==void 0&&o.push(l)}catch(l){if(l instanceof fd.MergeError)continue;throw l}r[e]=o}function rZ(e,t){let{items:r,additionalItems:n}=e;return Array.isArray(r)?t<r.length?r[t]:n:r!==void 0?r:n}function nZ(e,t,r,n,s){let i=0;for(let a of t)Array.isArray(a)&&(i=Math.max(i,a.length));if(i===0){r[e]=kr(t,s);return}let o=[];for(let a=0;a<i;a++){let l=[];for(let c of n){let u=rZ(c,a);u!==void 0&&l.push(u)}o[a]=kr(l,s)}r[e]=o}function sZ(e,t,r,n,s){let i=!1;for(let a of n)if(Array.isArray(a.items)){i=!0;break}if(!i){r[e]=kr(t,s);return}let o=[];for(let a of n){let l=a.additionalItems;l===void 0&&!Array.isArray(a.items)&&(l=a.items),l!==void 0&&o.push(l)}r[e]=kr(o,s)}function iZ(e,t){let{properties:r,patternProperties:n,additionalProperties:s}=e;if(r?.[t]!==void 0)return r[t];for(let i of Object.keys(n??{}))if(new RegExp(i).test(t))return n[i];return s}function oZ(e,t,r,n,s){let i={};for(let a of n){let l=a.properties??{};for(let c of Object.keys(l)){if(i[c]!==void 0)continue;let u=l[c];i[c]=[u];for(let f of n){if(a===f)continue;let p=iZ(f,c);p!==void 0&&i[c].push(p)}}}let o={};for(let a of Object.keys(i)){let l=i[a];o[a]=kr(l,s)}r[e]=o}function ud(e,t,r,n,s){let i={};for(let a of t)for(let l of Object.keys(a))i[l]===void 0&&(i[l]=[]),i[l].push(a[l]);let o={};for(let a of Object.keys(i)){let l=i[a],c=kr(l,s);o[a]=c}r[e]=o}function aZ(e,t,r,n,s){for(let i=0;i<n.length;i++){let o={if:n[i].if,then:n[i].then,else:n[i].else};if(o.if!==void 0){if(r.if===void 0){r.if=o.if,o.then!==void 0&&(r.then=o.then),o.else!==void 0&&(r.else=o.else);continue}r.then!==void 0&&(r.then=kr([r.then,o],s)),r.else!==void 0&&(r.else=kr([r.else,o],s))}}}function PN(e,t,r){let n={};for(let s of t)for(let i of Object.keys(s)){n[i]===void 0&&(n[i]=[]);let o=n[i];for(let a of s[i])o.includes(a)||o.push(a)}r[e]=n}function kr(e,t){if(e.length===0)return{};if(e.length===1)return e[0];let r={},n={},s=!0;for(let i of e){if(i===!1)return!1;if(i!==!0){s=!1;for(let o of Object.keys(i))n[o]===void 0&&(n[o]=[]),n[o].push(i[o])}}if(s)return!0;for(let i of Object.keys(n)){let o=n[i];(t.resolvers[i]??t.defaultResolver)(i,o,r,e,t)}return r}function AN(e,t,r,n,s){let i=s.onConflict??"throw";if(t.length===1||i==="first"){r[e]=t[0];return}let o=!0;for(let a=1;a<t.length;a++)if(!eZ(t[a],t[0])){o=!1;break}if(o){r[e]=t[0];return}if(i==="throw")throw new fd.ResolverNotFoundError(e,t);if(i!=="skip")throw new fd.InvalidOnConflictOptionError(i)}function lZ(e,t={}){return t.defaultResolver===void 0&&(t.defaultResolver=AN),t.resolvers={...IN,...t.resolvers},kr(e,t)}CN.exports={mergeSchemas:lZ,keywordsResolvers:IN,defaultResolver:AN,...fd}});var xN=S((gge,$N)=>{"use strict";var{mergeSchemas:cZ}=NN();function uZ(e){return cZ(e,{onConflict:"skip"})}$N.exports=uZ});var kN=S((yge,i0)=>{"use strict";function fZ(e,t,r,n){let s="";t.validatorSchemasIds.size>0?(s+=`const Validator = require('fast-json-stringify/lib/validator')
`,s+=`const validatorState = ${JSON.stringify(n.getState())}
`,s+=`const validator = Validator.restoreFromState(validatorState)
`):s+=`const validator = null
`;let{schema:i,...o}=r.getState();return`
  'use strict'

  const Serializer = require('fast-json-stringify/lib/serializer')
  const serializerState = ${JSON.stringify(o)}
  const serializer = Serializer.restoreFromState(serializerState)

  ${s}

  module.exports = ${e.toString()}(validator, serializer)`}i0.exports=fZ;i0.exports.dependencies={Serializer:lf(),Validator:Y_()}});var HN=S((_ge,Eo)=>{"use strict";var{RefResolver:dZ}=II(),hZ=lf(),pZ=Y_(),oi=gN(),LN=vN(),mZ=xN(),gZ=/'/g,dd=2e4,qN="default",yZ=["floor","ceil","round","trunc"],MN=["default","json-stringify"],Nl=0;function o0(e,t){if(!LN(e)){t?t=`"${t}" `:t="";let r=LN.errors[0],n=new Error(`${t}schema is invalid: data${r.instancePath} ${r.message}`);throw n.errors=o0.errors,n}}function $l(e,t){let r=t.schema.$ref,n=r.indexOf("#");n===-1&&(n=r.length);let s=r.slice(0,n)||t.schemaId,i=r.slice(n)||"#",o=e.refResolver.getSchema(s,i);if(o===null)throw new Error(`Cannot find reference "${r}"`);let a=new oi(o,s,i);return o.$ref!==void 0?$l(e,a):a}function hd(e,t){let r=e.refResolver.getSchema(t,"#");return new oi(r,t,"#")}function DN(e,t){return e.$id&&e.$id.charAt(0)!=="#"?e.$id:t}function a0(e,t){o0(e),t=t||{};let r={functions:[],functionsCounter:0,functionsNamesBySchema:new Map,options:t,refResolver:new dZ,rootSchemaId:e.$id||`__fjs_root_${Nl++}`,validatorSchemasIds:new Set,mergedSchemasIds:new Map},n=DN(e,r.rootSchemaId);if(r.refResolver.hasSchema(n)||r.refResolver.addSchema(e,r.rootSchemaId),t.schema)for(let u in t.schema){let f=t.schema[u],p=DN(f,u);r.refResolver.hasSchema(p)||(o0(f,u),r.refResolver.addSchema(f,u))}if(t.rounding&&!yZ.includes(t.rounding))throw new Error(`Unsupported integer rounding method ${t.rounding}`);if(t.largeArrayMechanism)if(MN.includes(t.largeArrayMechanism))qN=t.largeArrayMechanism;else throw new Error(`Unsupported large array mechanism ${t.largeArrayMechanism}`);if(t.largeArraySize)if(typeof t.largeArraySize=="string"&&Number.isFinite(Number.parseInt(t.largeArraySize,10)))dd=Number.parseInt(t.largeArraySize,10);else if(typeof t.largeArraySize=="number"&&Number.isInteger(t.largeArraySize))dd=t.largeArraySize;else if(typeof t.largeArraySize=="bigint")dd=Number(t.largeArraySize);else throw new Error(`Unsupported large array size. Expected integer-like, got ${typeof t.largeArraySize} with value ${t.largeArraySize}`);let s=new oi(e,r.rootSchemaId),i=Xt(r,s,"input"),o=`
    const JSON_STR_BEGIN_OBJECT = '{'
    const JSON_STR_END_OBJECT = '}'
    const JSON_STR_BEGIN_ARRAY = '['
    const JSON_STR_END_ARRAY = ']'
    const JSON_STR_COMMA = ','
    const JSON_STR_COLONS = ':'
    const JSON_STR_QUOTE = '"'
    const JSON_STR_EMPTY_OBJECT = JSON_STR_BEGIN_OBJECT + JSON_STR_END_OBJECT
    const JSON_STR_EMPTY_ARRAY = JSON_STR_BEGIN_ARRAY + JSON_STR_END_ARRAY
    const JSON_STR_EMPTY_STRING = JSON_STR_QUOTE + JSON_STR_QUOTE
    const JSON_STR_NULL = 'null'
  `;i==="json += anonymous0(input)"?o+=`
    ${r.functions.join(`
`)}
    const main = anonymous0
    return main
    `:o+=`
    function main (input) {
      let json = ''
      ${i}
      return json
    }
    ${r.functions.join(`
`)}
    return main
    `;let a=new hZ(t),l=new pZ(t.ajv);for(let u of r.validatorSchemasIds){let f=r.refResolver.getSchema(u);l.addSchema(f,u);let p=r.refResolver.getSchemaDependencies(u);for(let[d,h]of Object.entries(p))l.addSchema(h,d)}if(t.debugMode&&(t.mode="debug"),t.mode==="debug")return{validator:l,serializer:a,code:`validator
serializer
${o}`,ajv:l.ajv};let c=new Function("validator","serializer",o);return t.mode==="standalone"?kN()(c,r,a,l):c(l,a)}var _Z=["properties","required","additionalProperties","patternProperties","maxProperties","minProperties","dependencies"],bZ=["items","additionalItems","maxItems","minItems","uniqueItems","contains"],SZ=["maxLength","minLength","pattern"],vZ=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum"];function EZ(e){for(let t of _Z)if(t in e)return"object";for(let t of bZ)if(t in e)return"array";for(let t of SZ)if(t in e)return"string";for(let t of vZ)if(t in e)return"number";return e.type}function wZ(e,t,r){let n=t.schema,s=Object.keys(n.properties||{}),i=`
    const propertiesKeys = ${JSON.stringify(s)}
    for (const [key, value] of Object.entries(obj)) {
      if (
        propertiesKeys.includes(key) ||
        value === undefined ||
        typeof value === 'function' ||
        typeof value === 'symbol'
      ) continue
  `,o=t.getPropertyLocation("patternProperties"),a=o.schema;if(a!==void 0)for(let u in a){let f=o.getPropertyLocation(u);i+=`
        if (/${u.replace(/\\*\//g,"\\/")}/.test(key)) {
          ${r}
          json += serializer.asString(key) + JSON_STR_COLONS
          ${Xt(e,f,"value")}
          continue
        }
      `}let c=t.getPropertyLocation("additionalProperties").schema;if(c!==void 0)if(c===!0)i+=`
        ${r}
        json += serializer.asString(key) + JSON_STR_COLONS + JSON.stringify(value)
      `;else{let u=t.getPropertyLocation("additionalProperties");i+=`
        ${r}
        json += serializer.asString(key) + JSON_STR_COLONS
        ${Xt(e,u,"value")}
      `}return i+=`
    }
  `,i}function RZ(e,t){let r=t.schema,n=t.getPropertyLocation("properties"),s=r.required||[],i=Object.keys(r.properties||{}).sort((c,u)=>{let f=s.includes(c),p=s.includes(u);return f===p?0:f?-1:1}),o=s.includes(i[0]),a=`let value
`;for(let c of s)if(!i.includes(c)){let u=JSON.stringify(c);a+=`if (obj[${u}] === undefined) throw new Error('${u.replace(/'/g,"\\'")} is required!')
`}a+=`let json = JSON_STR_BEGIN_OBJECT
`;let l="";o||(a+=`let addComma = false
`,l="!addComma && (addComma = true) || (json += JSON_STR_COMMA)");for(let c of i){let u=n.getPropertyLocation(c);u.schema.$ref&&(u=$l(e,u));let f=JSON.stringify(c),p=u.schema.default,d=s.includes(c);a+=`
      value = obj[${f}]
      if (value !== undefined) {
        ${l}
        json += ${JSON.stringify(f+":")}
        ${Xt(e,u,"value")}
      }`,p!==void 0?a+=` else {
        ${l}
        json += ${JSON.stringify(f+":"+JSON.stringify(p))}
      }
      `:d?a+=` else {
        throw new Error('${f.replace(/'/g,"\\'")} is required!')
      }
      `:a+=`
`,o&&(l="json += ','")}return(r.patternProperties||r.additionalProperties)&&(a+=wZ(e,t,l)),a+=`
    return json + JSON_STR_END_OBJECT
  `,a}function pd(e,t,r){for(let o=0;o<r.length;o++){let a=r[o];a.schema.$ref&&(r[o]=$l(e,a))}let n=[];for(let o of r){let a=jN(e,o.schema,o.schemaId);delete a.$id,n.push(a)}let s=mZ(n),i=new oi(s,t);return e.refResolver.addSchema(s,t),i}function jN(e,t,r){let n=Array.isArray(t)?[]:{};t.$id!==void 0&&t.$id.charAt(0)!=="#"&&(r=t.$id);let s=e.mergedSchemasIds.get(t);s&&e.mergedSchemasIds.set(n,s);for(let i in t){let o=t[i];i==="$ref"&&typeof o=="string"&&o.charAt(0)==="#"&&(o=r+o),typeof o=="object"&&o!==null&&(o=jN(e,o,r)),n[i]=o}return n}function TZ(e){return`(${e} && typeof ${e}.toJSON === 'function')
    ? ${e}.toJSON()
    : ${e}
  `}function OZ(e,t){let r=t.schema;if(e.functionsNamesBySchema.has(r))return e.functionsNamesBySchema.get(r);let n=VN(e);e.functionsNamesBySchema.set(r,n);let s=t.getSchemaRef();s.startsWith(e.rootSchemaId)&&(s=s.replace(e.rootSchemaId,""));let i=`
  `,o=r.nullable===!0;return i+=`
    // ${s}
    function ${n} (input) {
      const obj = ${TZ("input")}
      ${o?"":"if (obj === null) return JSON_STR_EMPTY_OBJECT"}

      ${RZ(e,t)}
    }
  `,e.functions.push(i),n}function PZ(e,t){let r=t.schema,n=t.getPropertyLocation("items");n.schema=n.schema||{},n.schema.$ref&&(n=$l(e,n));let s=n.schema;if(e.functionsNamesBySchema.has(r))return e.functionsNamesBySchema.get(r);let i=VN(e);e.functionsNamesBySchema.set(r,i);let o=t.getSchemaRef();o.startsWith(e.rootSchemaId)&&(o=o.replace(e.rootSchemaId,""));let a=`
    function ${i} (obj) {
      // ${o}
  `,l=r.nullable===!0;if(a+=`
    ${l?"":"if (obj === null) return JSON_STR_EMPTY_ARRAY"}
    if (!Array.isArray(obj)) {
      throw new TypeError(\`The value of '${o}' does not match schema definition.\`)
    }
    const arrayLength = obj.length
  `,!r.additionalItems&&Array.isArray(s)&&(a+=`
      if (arrayLength > ${s.length}) {
        throw new Error(\`Item at ${s.length} does not match schema definition.\`)
      }
    `),qN==="json-stringify"&&(a+=`if (arrayLength >= ${dd}) return JSON.stringify(obj)
`),a+=`
    const arrayEnd = arrayLength - 1
    let value
    let json = ''
  `,Array.isArray(s)){for(let c=0;c<s.length;c++){let u=s[c];a+=`value = obj[${c}]`;let f=Xt(e,n.getPropertyLocation(c),"value");a+=`
        if (${c} < arrayLength) {
          if (${FN(u.type,`[${c}]`)}) {
            ${f}
            if (${c} < arrayEnd) {
              json += JSON_STR_COMMA
            }
          } else {
            throw new Error(\`Item at ${c} does not match schema definition.\`)
          }
        }
        `}r.additionalItems&&(a+=`
        for (let i = ${s.length}; i < arrayLength; i++) {
          json += JSON.stringify(obj[i])
          if (i < arrayEnd) {
            json += JSON_STR_COMMA
          }
        }`)}else{let c=Xt(e,n,"obj[i]");a+=`
      for (let i = 0; i < arrayLength; i++) {
        ${c}
        if (i < arrayEnd) {
          json += JSON_STR_COMMA
        }
      }`}return a+=`
    return JSON_STR_BEGIN_ARRAY + json + JSON_STR_END_ARRAY
  }`,e.functions.push(a),i}function FN(e,t){let r;switch(e){case"null":r="value === null";break;case"string":r=`typeof value === 'string' ||
      value === null ||
      value instanceof Date ||
      value instanceof RegExp ||
      (
        typeof value === "object" &&
        typeof value.toString === "function" &&
        value.toString !== Object.prototype.toString
      )`;break;case"integer":r="Number.isInteger(value)";break;case"number":r="Number.isFinite(value)";break;case"boolean":r="typeof value === 'boolean'";break;case"object":r="value && typeof value === 'object' && value.constructor === Object";break;case"array":r="Array.isArray(value)";break;default:Array.isArray(e)&&(r=`(${e.map(s=>FN(s,t)).join(" || ")})`)}return r}function VN(e){return"anonymous"+e.functionsCounter++}function IZ(e,t,r){let s=t.schema.type.sort(a=>a==="null"?-1:1),i="";s.forEach((a,l)=>{t.schema={...t.schema,type:a};let c=UN(e,t,r),u=l===0?"if":"else if";switch(a){case"null":i+=`
          ${u} (${r} === null)
            ${c}
          `;break;case"string":{i+=`
          ${u}(
            typeof ${r} === "string" ||
            ${r} === null ||
            ${r} instanceof Date ||
            ${r} instanceof RegExp ||
            (
              typeof ${r} === "object" &&
              typeof ${r}.toString === "function" &&
              ${r}.toString !== Object.prototype.toString
            )
          )
            ${c}
        `;break}case"array":{i+=`
          ${u}(Array.isArray(${r}))
            ${c}
        `;break}case"integer":{i+=`
          ${u}(Number.isInteger(${r}) || ${r} === null)
            ${c}
        `;break}default:{i+=`
          ${u}(typeof ${r} === "${a}" || ${r} === null)
            ${c}
        `;break}}});let o=t.getSchemaRef();return o.startsWith(e.rootSchemaId)&&(o=o.replace(e.rootSchemaId,"")),i+=`
    else throw new TypeError(\`The value of '${o}' does not match schema definition.\`)
  `,i}function UN(e,t,r){let n=t.schema;switch(n.type){case"null":return"json += JSON_STR_NULL";case"string":return n.format==="date-time"?`json += serializer.asDateTime(${r})`:n.format==="date"?`json += serializer.asDate(${r})`:n.format==="time"?`json += serializer.asTime(${r})`:n.format==="unsafe"?`json += serializer.asUnsafeString(${r})`:`
        if (typeof ${r} !== 'string') {
          if (${r} === null) {
            json += JSON_STR_EMPTY_STRING
          } else if (${r} instanceof Date) {
            json += JSON_STR_QUOTE + ${r}.toISOString() + JSON_STR_QUOTE
          } else if (${r} instanceof RegExp) {
            json += serializer.asString(${r}.source)
          } else {
            json += serializer.asString(${r}.toString())
          }
        } else {
          json += serializer.asString(${r})
        }
        `;case"integer":return`json += serializer.asInteger(${r})`;case"number":return`json += serializer.asNumber(${r})`;case"boolean":return`json += serializer.asBoolean(${r})`;case"object":return`json += ${OZ(e,t)}(${r})`;case"array":return`json += ${PZ(e,t)}(${r})`;case void 0:return`json += JSON.stringify(${r})`;default:throw new Error(`${n.type} unsupported`)}}function AZ(e,t){let r=e.schema,n=r.type,s=Array.isArray(n)&&n.includes("null"),i="";return s&&(i+=`
      if (${t} === null) {
        json += JSON_STR_NULL
      } else {
    `),i+=`json += '${JSON.stringify(r.const).replace(gZ,"\\'")}'`,s&&(i+=`
      }
    `),i}function CZ(e,t,r){let n=t.schema,s=e.mergedSchemasIds.get(n);if(s){let u=hd(e,s);return Xt(e,u,r)}s=`__fjs_merged_${Nl++}`,e.mergedSchemasIds.set(n,s);let{allOf:i,...o}=t.schema,a=[new oi(o,t.schemaId,t.jsonPointer)],l=t.getPropertyLocation("allOf");for(let u=0;u<i.length;u++)a.push(l.getPropertyLocation(u));let c=pd(e,s,a);return Xt(e,c,r)}function NZ(e,t,r){e.validatorSchemasIds.add(t.schemaId);let s=t.schema.anyOf?"anyOf":"oneOf",{[s]:i,...o}=t.schema,a=new oi(o,t.schemaId,t.jsonPointer),l=t.getPropertyLocation(s),c="";for(let f=0;f<i.length;f++){let p=l.getPropertyLocation(f),d=p.schema,h=e.mergedSchemasIds.get(d),m=null;h?m=hd(e,h):(h=`__fjs_merged_${Nl++}`,e.mergedSchemasIds.set(d,h),m=pd(e,h,[a,p]));let y=Xt(e,m,r),b=p.getSchemaRef();c+=`
      ${f===0?"if":"else if"}(validator.validate("${b}", ${r}))
        ${y}
    `}let u=t.getSchemaRef();return u.startsWith(e.rootSchemaId)&&(u=u.replace(e.rootSchemaId,"")),c+=`
    else throw new TypeError(\`The value of '${u}' does not match schema definition.\`)
  `,c}function $Z(e,t,r){e.validatorSchemasIds.add(t.schemaId);let{if:n,then:s,else:i,...o}=t.schema,a=new oi(o,t.schemaId,t.jsonPointer),c=t.getPropertyLocation("if").getSchemaRef(),u=t.getPropertyLocation("then"),f=e.mergedSchemasIds.get(s),p=null;if(f?p=hd(e,f):(f=`__fjs_merged_${Nl++}`,e.mergedSchemasIds.set(s,f),p=pd(e,f,[a,u])),!i)return`
      if (validator.validate("${c}", ${r})) {
        ${Xt(e,p,r)}
      } else {
        ${Xt(e,a,r)}
      }
    `;let d=t.getPropertyLocation("else"),h=e.mergedSchemasIds.get(i),m=null;return h?m=hd(e,h):(h=`__fjs_merged_${Nl++}`,e.mergedSchemasIds.set(i,h),m=pd(e,h,[a,d])),`
    if (validator.validate("${c}", ${r})) {
      ${Xt(e,p,r)}
    } else {
      ${Xt(e,m,r)}
    }
  `}function Xt(e,t,r){let n=t.schema;if(typeof n=="boolean")return`json += JSON.stringify(${r})`;if(n.$ref&&(t=$l(e,t),n=t.schema),n.allOf)return CZ(e,t,r);if(n.anyOf||n.oneOf)return NZ(e,t,r);if(n.if&&n.then)return $Z(e,t,r);if(n.type===void 0){let a=EZ(n);a&&(n.type=a)}let s="",i=n.type,o=n.nullable===!0;return o&&(s+=`
      if (${r} === null) {
        json += JSON_STR_NULL
      } else {
    `),n.const!==void 0?s+=AZ(t,r):Array.isArray(i)?s+=IZ(e,t,r):s+=UN(e,t,r),o&&(s+=`
      }
    `),s}Eo.exports=a0;Eo.exports.default=a0;Eo.exports.build=a0;Eo.exports.validLargeArrayMechanisms=MN;Eo.exports.restore=function({code:e,validator:t,serializer:r}){return Function.apply(null,["validator","serializer",e]).apply(null,[t,r])}});var zN=S((bge,l0)=>{"use strict";var xZ=c0();function BN(e={readMode:!0}){if(e.readMode===!0&&typeof e.restoreFunction!="function")throw new Error("You must provide a function for the restoreFunction-option when readMode ON");if(e.readMode!==!0&&typeof e.storeFunction!="function")throw new Error("You must provide a function for the storeFunction-option when readMode OFF");if(e.readMode===!0)return function(){return function(n){return e.restoreFunction(n)}};let t=xZ();return function(n,s={}){s.mode="standalone";let i=t(n,s);return function(o){let a=i(o);return e.storeFunction(o,a),new Function(a)}}}l0.exports=BN;l0.exports.default=BN});var c0=S((Sge,xl)=>{"use strict";var kZ=HN();function u0(){return function(t,r){let n=Object.assign({},r,{schema:t});return LZ.bind(null,n)}}function LZ(e,{schema:t}){return e.schema&&t.$id&&e.schema[t.$id]&&(e.schema={...e.schema},delete e.schema[t.$id]),kZ(t,e)}xl.exports=u0;xl.exports.default=u0;xl.exports.SerializerSelector=u0;xl.exports.StandaloneSerializer=zN()});var Tn=S(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});kl.checkMetadata=void 0;var DZ=Z(),qZ={keyword:"metadata",schemaType:"object",code(e){GN(e);let{gen:t,schema:r,it:n}=e;if((0,DZ.alwaysValidSchema)(n,r))return;let s=t.name("valid");e.subschema({keyword:"metadata",jtdMetadata:!0},s),e.ok(s)}};function GN({it:e,keyword:t},r){if(e.jtdMetadata!==r)throw new Error(`JTD: "${t}" cannot be used in this schema location`)}kl.checkMetadata=GN;kl.default=qZ});var md=S(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.hasRef=void 0;var WN=ri(),Ll=W(),MZ=wn(),KN=dr(),JN=Xy(),jZ=Tn(),FZ={keyword:"ref",schemaType:"string",code(e){(0,jZ.checkMetadata)(e);let{gen:t,data:r,schema:n,parentSchema:s,it:i}=e,{schemaEnv:{root:o}}=i,a=t.name("valid");s.nullable?(t.var(a,(0,Ll._)`${r} === null`),t.if((0,Ll.not)(a),l)):(t.var(a,!1),l()),e.ok(a);function l(){var f;let p=(f=o.schema.definitions)===null||f===void 0?void 0:f[n];if(!p)throw new MZ.default(i.opts.uriResolver,"",n,`No definition ${n}`);f0(p)||!i.opts.inlineRefs?c(p):u(p)}function c(f){let p=WN.compileSchema.call(i.self,new WN.SchemaEnv({schema:f,root:o,schemaPath:`/definitions/${n}`})),d=(0,JN.getValidate)(e,p),h=t.const("_errs",KN.default.errors);(0,JN.callRef)(e,d,p,p.$async),t.assign(a,(0,Ll._)`${h} === ${KN.default.errors}`)}function u(f){let p=t.scopeValue("schema",i.opts.code.source===!0?{ref:f,code:(0,Ll.stringify)(f)}:{ref:f});e.subschema({schema:f,dataTypes:[],schemaPath:Ll.nil,topSchemaRef:p,errSchemaPath:`/definitions/${n}`},a)}}};function f0(e){for(let t in e){let r;if(t==="ref"||typeof(r=e[t])=="object"&&f0(r))return!0}return!1}Dl.hasRef=f0;Dl.default=FZ});var h0=S(d0=>{"use strict";Object.defineProperty(d0,"__esModule",{value:!0});var VZ=/t|\s/i,UZ=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,HZ=/^(\d\d):(\d\d):(\d\d)(?:\.\d+)?(?:z|([+-]\d\d)(?::?(\d\d))?)$/i,BZ=[0,31,28,31,30,31,30,31,31,30,31,30,31];function XN(e,t){let r=e.split(VZ);return r.length===2&&YN(r[0])&&zZ(r[1])||t&&r.length===1&&YN(r[0])}d0.default=XN;function YN(e){let t=UZ.exec(e);if(!t)return!1;let r=+t[1],n=+t[2],s=+t[3];return n>=1&&n<=12&&s>=1&&(s<=BZ[n]||n===2&&s===29&&(r%100===0?r%400===0:r%4===0))}function zZ(e){let t=HZ.exec(e);if(!t)return!1;let r=+t[1],n=+t[2],s=+t[3],i=+(t[4]||0),o=+(t[5]||0);return r<=23&&n<=59&&s<=59||r-i===23&&n-o===59&&s===60}XN.code='require("ajv/dist/runtime/timestamp").default'});var wo=S(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.typeErrorParams=cs.typeErrorMessage=cs.typeError=void 0;var GZ=W();function WZ(e){return{message:t=>ZN(t,e),params:t=>QN(t,e)}}cs.typeError=WZ;function ZN({parentSchema:e},t){return e?.nullable?`must be ${t} or null`:`must be ${t}`}cs.typeErrorMessage=ZN;function QN({parentSchema:e},t){return(0,GZ._)`{type: ${t}, nullable: ${!!e?.nullable}}`}cs.typeErrorParams=QN});var p0=S(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.intRange=void 0;var Zt=W(),KZ=h0(),JZ=Z(),YZ=Tn(),e$=wo();Ro.intRange={int8:[-128,127,3],uint8:[0,255,3],int16:[-32768,32767,5],uint16:[0,65535,5],int32:[-2147483648,2147483647,10],uint32:[0,4294967295,10]};var XZ={message:e=>(0,e$.typeErrorMessage)(e,e.schema),params:e=>(0,e$.typeErrorParams)(e,e.schema)};function ZZ(e){let{gen:t,data:r,it:n}=e,{timestamp:s,allowDate:i}=n.opts;if(s==="date")return(0,Zt._)`${r} instanceof Date `;let o=(0,JZ.useFunc)(t,KZ.default),a=i?(0,Zt._)`, true`:Zt.nil,l=(0,Zt._)`typeof ${r} == "string" && ${o}(${r}${a})`;return s==="string"?l:(0,Zt.or)((0,Zt._)`${r} instanceof Date`,l)}var QZ={keyword:"type",schemaType:"string",error:XZ,code(e){(0,YZ.checkMetadata)(e);let{data:t,schema:r,parentSchema:n,it:s}=e,i;switch(r){case"boolean":case"string":i=(0,Zt._)`typeof ${t} == ${r}`;break;case"timestamp":{i=ZZ(e);break}case"float32":case"float64":i=(0,Zt._)`typeof ${t} == "number"`;break;default:{let o=r;if(i=(0,Zt._)`typeof ${t} == "number" && isFinite(${t}) && !(${t} % 1)`,!s.opts.int32range&&(o==="int32"||o==="uint32"))o==="uint32"&&(i=(0,Zt._)`${i} && ${t} >= 0`);else{let[a,l]=Ro.intRange[o];i=(0,Zt._)`${i} && ${t} >= ${a} && ${t} <= ${l}`}}}e.pass(n.nullable?(0,Zt.or)((0,Zt._)`${t} === null`,i):i)}};Ro.default=QZ});var Oo=S(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.checkNullableObject=To.checkNullable=void 0;var gd=W();function t$({gen:e,data:t,parentSchema:r},n=gd.nil){let s=e.name("valid");return r.nullable?(e.let(s,(0,gd._)`${t} === null`),n=(0,gd.not)(s)):e.let(s,!1),[s,n]}To.checkNullable=t$;function eQ(e,t){let[r,n]=t$(e,t);return[r,(0,gd._)`${n} && typeof ${e.data} == "object" && !Array.isArray(${e.data})`]}To.checkNullableObject=eQ});var r$=S(m0=>{"use strict";Object.defineProperty(m0,"__esModule",{value:!0});var us=W(),tQ=Tn(),rQ=Oo(),nQ={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>(0,us._)`{allowedValues: ${e}}`},sQ={keyword:"enum",schemaType:"array",error:nQ,code(e){(0,tQ.checkMetadata)(e);let{gen:t,data:r,schema:n,schemaValue:s,parentSchema:i,it:o}=e;if(n.length===0)throw new Error("enum must have non-empty array");if(n.length!==new Set(n).size)throw new Error("enum items must be unique");let a,l=(0,us._)`typeof ${r} == "string"`;if(n.length>=o.opts.loopEnum){let u;[a,u]=(0,rQ.checkNullable)(e,l),t.if(u,c)}else{if(!Array.isArray(n))throw new Error("ajv implementation error");a=(0,us.and)(l,(0,us.or)(...n.map(u=>(0,us._)`${r} === ${u}`))),i.nullable&&(a=(0,us.or)((0,us._)`${r} === null`,a))}e.pass(a);function c(){t.forOf("v",s,u=>t.if((0,us._)`${a} = ${r} === ${u}`,()=>t.break()))}}};m0.default=sQ});var s$=S(g0=>{"use strict";Object.defineProperty(g0,"__esModule",{value:!0});var iQ=Z(),oQ=mt(),n$=W(),aQ=Tn(),lQ=Oo(),cQ=wo(),uQ={keyword:"elements",schemaType:"object",error:(0,cQ.typeError)("array"),code(e){(0,aQ.checkMetadata)(e);let{gen:t,data:r,schema:n,it:s}=e;if((0,iQ.alwaysValidSchema)(s,n))return;let[i]=(0,lQ.checkNullable)(e);t.if((0,n$.not)(i),()=>t.if((0,n$._)`Array.isArray(${r})`,()=>t.assign(i,(0,oQ.validateArray)(e)),()=>e.error())),e.ok(i)}};g0.default=uQ});var _0=S(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.validateProperties=fs.error=void 0;var y0=mt(),i$=Z(),On=W(),fQ=Tn(),dQ=Oo(),o$=wo(),Po;(function(e){e.Additional="additional",e.Missing="missing"})(Po||(Po={}));fs.error={message:e=>{let{params:t}=e;return t.propError?t.propError===Po.Additional?"must NOT have additional properties":`must have property '${t.missingProperty}'`:(0,o$.typeErrorMessage)(e,"object")},params:e=>{let{params:t}=e;return t.propError?t.propError===Po.Additional?(0,On._)`{error: ${t.propError}, additionalProperty: ${t.additionalProperty}}`:(0,On._)`{error: ${t.propError}, missingProperty: ${t.missingProperty}}`:(0,o$.typeErrorParams)(e,"object")}};var hQ={keyword:"properties",schemaType:"object",error:fs.error,code:a$};function a$(e){(0,fQ.checkMetadata)(e);let{gen:t,data:r,parentSchema:n,it:s}=e,{additionalProperties:i,nullable:o}=n;if(s.jtdDiscriminator&&o)throw new Error("JTD: nullable inside discriminator mapping");if(d())throw new Error("JTD: properties and optionalProperties have common members");let[a,l]=h("properties"),[c,u]=h("optionalProperties");if(l.length===0&&u.length===0&&i)return;let[f,p]=s.jtdDiscriminator===void 0?(0,dQ.checkNullableObject)(e,r):[t.let("valid",!1),!0];t.if(p,()=>t.assign(f,!0).block(()=>{m(l,"properties",!0),m(u,"optionalProperties"),i||b()})),e.pass(f);function d(){let _=n.properties,g=n.optionalProperties;if(!(_&&g))return!1;for(let T in _)if(Object.prototype.hasOwnProperty.call(g,T))return!0;return!1}function h(_){let g=n[_],T=g?(0,y0.allSchemaProperties)(g):[];if(s.jtdDiscriminator&&T.some(w=>w===s.jtdDiscriminator))throw new Error(`JTD: discriminator tag used in ${_}`);let R=T.filter(w=>!(0,i$.alwaysValidSchema)(s,g[w]));return[T,R]}function m(_,g,T){let R=t.var("valid");for(let P of _)t.if((0,y0.propertyInData)(t,r,P,s.opts.ownProperties),()=>y(P,g,R),()=>w(P)),e.ok(R);function w(P){T?(t.assign(R,!1),e.error(!1,{propError:Po.Missing,missingProperty:P},{schemaPath:P})):t.assign(R,!0)}}function y(_,g,T){e.subschema({keyword:g,schemaProp:_,dataProp:_},T)}function b(){t.forIn("key",r,_=>{let g=v(_,a,"properties",s.jtdDiscriminator),T=v(_,c,"optionalProperties"),R=g===!0?T:T===!0?g:(0,On.and)(g,T);t.if(R,()=>{s.opts.removeAdditional?t.code((0,On._)`delete ${r}[${_}]`):(e.error(!1,{propError:Po.Additional,additionalProperty:_},{instancePath:_,parentSchema:!0}),s.opts.allErrors||t.break())})})}function v(_,g,T,R){let w;if(g.length>8){let P=(0,i$.schemaRefOrVal)(s,n[T],T);w=(0,On.not)((0,y0.isOwnProperty)(t,P,_)),R!==void 0&&(w=(0,On.and)(w,(0,On._)`${_} !== ${R}`))}else if(g.length||R!==void 0){let P=R===void 0?g:[R].concat(g);w=(0,On.and)(...P.map(O=>(0,On._)`${_} !== ${O}`))}else w=!0;return w}}fs.validateProperties=a$;fs.default=hQ});var c$=S(b0=>{"use strict";Object.defineProperty(b0,"__esModule",{value:!0});var l$=_0(),pQ={keyword:"optionalProperties",schemaType:"object",error:l$.error,code(e){e.parentSchema.properties||(0,l$.validateProperties)(e)}};b0.default=pQ});var f$=S(S0=>{"use strict";Object.defineProperty(S0,"__esModule",{value:!0});var ai=W(),mQ=Tn(),gQ=Oo(),u$=wo(),yd=q_(),yQ={message:e=>{let{schema:t,params:r}=e;return r.discrError?r.discrError===yd.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in mapping`:(0,u$.typeErrorMessage)(e,"object")},params:e=>{let{schema:t,params:r}=e;return r.discrError?(0,ai._)`{error: ${r.discrError}, tag: ${t}, tagValue: ${r.tag}}`:(0,u$.typeErrorParams)(e,"object")}},_Q={keyword:"discriminator",schemaType:"string",implements:["mapping"],error:yQ,code(e){(0,mQ.checkMetadata)(e);let{gen:t,data:r,schema:n,parentSchema:s}=e,[i,o]=(0,gQ.checkNullableObject)(e,r);t.if(o),a(),t.elseIf((0,ai.not)(i)),e.error(),t.endIf(),e.ok(i);function a(){let u=t.const("tag",(0,ai._)`${r}${(0,ai.getProperty)(n)}`);t.if((0,ai._)`${u} === undefined`),e.error(!1,{discrError:yd.DiscrError.Tag,tag:u}),t.elseIf((0,ai._)`typeof ${u} == "string"`),l(u),t.else(),e.error(!1,{discrError:yd.DiscrError.Tag,tag:u},{instancePath:n}),t.endIf()}function l(u){t.if(!1);for(let f in s.mapping)t.elseIf((0,ai._)`${u} === ${f}`),t.assign(i,c(f));t.else(),e.error(!1,{discrError:yd.DiscrError.Mapping,tag:u},{instancePath:n,schemaPath:"mapping",parentSchema:!0}),t.endIf()}function c(u){let f=t.name("valid");return e.subschema({keyword:"mapping",schemaProp:u,jtdDiscriminator:n},f),f}}};S0.default=_Q});var h$=S(v0=>{"use strict";Object.defineProperty(v0,"__esModule",{value:!0});var d$=Z(),_d=W(),bQ=Tn(),SQ=Oo(),vQ=wo(),EQ={keyword:"values",schemaType:"object",error:(0,vQ.typeError)("object"),code(e){(0,bQ.checkMetadata)(e);let{gen:t,data:r,schema:n,it:s}=e,[i,o]=(0,SQ.checkNullableObject)(e,r);(0,d$.alwaysValidSchema)(s,n)?t.if((0,_d.not)((0,_d.or)(o,i)),()=>e.error()):(t.if(o),t.assign(i,a()),t.elseIf((0,_d.not)(i)),e.error(),t.endIf()),e.ok(i);function a(){let l=t.name("valid");if(s.allErrors){let u=t.let("valid",!0);return c(()=>t.assign(u,!1)),u}return t.var(l,!0),c(()=>t.break()),l;function c(u){t.forIn("key",r,f=>{e.subschema({keyword:"values",dataProp:f,dataPropType:d$.Type.Str},l),t.if((0,_d.not)(l),u)})}}}};v0.default=EQ});var p$=S(E0=>{"use strict";Object.defineProperty(E0,"__esModule",{value:!0});var wQ=mt(),RQ={keyword:"union",schemaType:"array",trackErrors:!0,code:wQ.validateUnion,error:{message:"must match a schema in union"}};E0.default=RQ});var m$=S(w0=>{"use strict";Object.defineProperty(w0,"__esModule",{value:!0});var TQ=md(),OQ=p0(),PQ=r$(),IQ=s$(),AQ=_0(),CQ=c$(),NQ=f$(),$Q=h$(),xQ=p$(),kQ=Tn(),LQ=["definitions",TQ.default,OQ.default,PQ.default,IQ.default,AQ.default,CQ.default,NQ.default,$Q.default,xQ.default,kQ.default,{keyword:"additionalProperties",schemaType:"boolean"},{keyword:"nullable",schemaType:"boolean"}];w0.default=LQ});var b$=S(R0=>{"use strict";Object.defineProperty(R0,"__esModule",{value:!0});var Pn=e=>{let t={nullable:{type:"boolean"},metadata:{optionalProperties:{union:{elements:{ref:"schema"}}},additionalProperties:!0}};return e&&(t.definitions={values:{ref:"schema"}}),t},DQ=e=>({optionalProperties:Pn(e)}),qQ=e=>({properties:{ref:{type:"string"}},optionalProperties:Pn(e)}),MQ=e=>({properties:{type:{enum:["boolean","timestamp","string","float32","float64","int8","uint8","int16","uint16","int32","uint32"]}},optionalProperties:Pn(e)}),jQ=e=>({properties:{enum:{elements:{type:"string"}}},optionalProperties:Pn(e)}),FQ=e=>({properties:{elements:{ref:"schema"}},optionalProperties:Pn(e)}),y$=e=>({properties:{properties:{values:{ref:"schema"}}},optionalProperties:{optionalProperties:{values:{ref:"schema"}},additionalProperties:{type:"boolean"},...Pn(e)}}),_$=e=>({properties:{optionalProperties:{values:{ref:"schema"}}},optionalProperties:{additionalProperties:{type:"boolean"},...Pn(e)}}),VQ=e=>({properties:{discriminator:{type:"string"},mapping:{values:{metadata:{union:[y$(!1),_$(!1)]}}}},optionalProperties:Pn(e)}),UQ=e=>({properties:{values:{ref:"schema"}},optionalProperties:Pn(e)}),g$=e=>({metadata:{union:[DQ,qQ,MQ,jQ,FQ,y$,_$,VQ,UQ].map(t=>t(e))}}),HQ={definitions:{schema:g$(!1)},...g$(!0)};R0.default=HQ});var T0=S(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});bd.jtdForms=void 0;bd.jtdForms=["elements","values","discriminator","properties","optionalProperties","enum","type","ref"]});var v$=S(P0=>{"use strict";Object.defineProperty(P0,"__esModule",{value:!0});var O0=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,BQ={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function S$(e){return O0.lastIndex=0,'"'+(O0.test(e)?e.replace(O0,t=>{let r=BQ[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):e)+'"'}P0.default=S$;S$.code='require("ajv/dist/runtime/quote").default'});var P$=S(A0=>{"use strict";Object.defineProperty(A0,"__esModule",{value:!0});var zQ=T0(),w$=ri(),le=W(),GQ=wn(),Pe=dr(),WQ=mt(),KQ=md(),JQ=Z(),YQ=v$(),XQ={elements:QQ,values:eee,discriminator:tee,properties:E$,optionalProperties:E$,enum:ql,type:ree,ref:see};function R$(e,t){let r=w$.getCompilingSchema.call(this,e);if(r)return r;let{es5:n,lines:s}=this.opts.code,{ownProperties:i}=this.opts,o=new le.CodeGen(this.scope,{es5:n,lines:s,ownProperties:i}),a=o.scopeName("serialize"),l={self:this,gen:o,schema:e.schema,schemaEnv:e,definitions:t,data:Pe.default.data},c;try{this._compilations.add(e),e.serializeName=a,o.func(a,Pe.default.data,!1,()=>{o.let(Pe.default.json,(0,le.str)``),Ml(l),o.return(Pe.default.json)}),o.optimize(this.opts.code.optimize);let u=o.toString();c=`${o.scopeRefs(Pe.default.scope)}return ${u}`;let p=new Function(`${Pe.default.scope}`,c)(this.scope.get());this.scope.value(a,{ref:p}),e.serialize=p}catch(u){throw c&&this.logger.error("Error compiling serializer, function code:",c),delete e.serialize,delete e.serializeName,u}finally{this._compilations.delete(e)}return e}A0.default=R$;function Ml(e){let t;for(let r of zQ.jtdForms)if(r in e.schema){t=r;break}ZQ(e,t?XQ[t]:oee)}function ZQ(e,t){let{gen:r,schema:n,data:s}=e;if(!n.nullable)return t(e);r.if((0,le._)`${s} === undefined || ${s} === null`,()=>r.add(Pe.default.json,(0,le._)`"null"`),()=>t(e))}function QQ(e){let{gen:t,schema:r,data:n}=e;t.add(Pe.default.json,(0,le.str)`[`);let s=t.let("first",!0);t.forOf("el",n,i=>{I0(e,s),Ml({...e,schema:r.elements,data:i})}),t.add(Pe.default.json,(0,le.str)`]`)}function eee(e){let{gen:t,schema:r,data:n}=e;t.add(Pe.default.json,(0,le.str)`{`);let s=t.let("first",!0);t.forIn("key",n,i=>T$(e,i,r.values,s)),t.add(Pe.default.json,(0,le.str)`}`)}function T$(e,t,r,n){let{gen:s,data:i}=e;I0(e,n),ql({...e,data:t}),s.add(Pe.default.json,(0,le.str)`:`);let o=s.const("value",(0,le._)`${i}${(0,le.getProperty)(t)}`);Ml({...e,schema:r,data:o})}function tee(e){let{gen:t,schema:r,data:n}=e,{discriminator:s}=r;t.add(Pe.default.json,(0,le.str)`{${JSON.stringify(s)}:`);let i=t.const("tag",(0,le._)`${n}${(0,le.getProperty)(s)}`);ql({...e,data:i}),t.if(!1);for(let o in r.mapping){t.elseIf((0,le._)`${i} === ${o}`);let a=r.mapping[o];O$({...e,schema:a},s)}t.endIf(),t.add(Pe.default.json,(0,le.str)`}`)}function E$(e){let{gen:t}=e;t.add(Pe.default.json,(0,le.str)`{`),O$(e),t.add(Pe.default.json,(0,le.str)`}`)}function O$(e,t){let{gen:r,schema:n,data:s}=e,{properties:i,optionalProperties:o}=n,a=p(i),l=p(o),c=d(a.concat(l)),u=!t,f;for(let b of a)u?u=!1:r.add(Pe.default.json,(0,le.str)`,`),m(b,i[b],h(b));u&&(f=r.let("first",!0));for(let b of l){let v=h(b);r.if((0,le.and)((0,le._)`${v} !== undefined`,(0,WQ.isOwnProperty)(r,s,b)),()=>{I0(e,f),m(b,o[b],v)})}n.additionalProperties&&r.forIn("key",s,b=>r.if(y(b,c),()=>T$(e,b,{},f)));function p(b){return b?Object.keys(b):[]}function d(b){if(t&&b.push(t),new Set(b).size!==b.length)throw new Error("JTD: properties/optionalProperties/disciminator overlap");return b}function h(b){return r.const("value",(0,le._)`${s}${(0,le.getProperty)(b)}`)}function m(b,v,_){r.add(Pe.default.json,(0,le.str)`${JSON.stringify(b)}:`),Ml({...e,schema:v,data:_})}function y(b,v){return v.length?(0,le.and)(...v.map(_=>(0,le._)`${b} !== ${_}`)):!0}}function ree(e){let{gen:t,schema:r,data:n}=e;switch(r.type){case"boolean":t.add(Pe.default.json,(0,le._)`${n} ? "true" : "false"`);break;case"string":ql(e);break;case"timestamp":t.if((0,le._)`${n} instanceof Date`,()=>t.add(Pe.default.json,(0,le._)`'"' + ${n}.toISOString() + '"'`),()=>ql(e));break;default:nee(e)}}function ql({gen:e,data:t}){e.add(Pe.default.json,(0,le._)`${(0,JQ.useFunc)(e,YQ.default)}(${t})`)}function nee({gen:e,data:t}){e.add(Pe.default.json,(0,le._)`"" + ${t}`)}function see(e){let{gen:t,self:r,data:n,definitions:s,schema:i,schemaEnv:o}=e,{ref:a}=i,l=s[a];if(!l)throw new GQ.default(r.opts.uriResolver,"",a,`No definition ${a}`);if(!(0,KQ.hasRef)(l))return Ml({...e,schema:l});let{root:c}=o,u=R$.call(r,new w$.SchemaEnv({schema:l,root:c}),s);t.add(Pe.default.json,(0,le._)`${iee(t,u)}(${n})`)}function iee(e,t){return t.serialize?e.scopeValue("serialize",{ref:t.serialize}):(0,le._)`${e.scopeValue("wrapper",{ref:t})}.serialize`}function oee({gen:e,data:t}){e.add(Pe.default.json,(0,le._)`JSON.stringify(${t})`)}function I0({gen:e},t){t?e.if(t,()=>e.assign(t,!1),()=>e.add(Pe.default.json,(0,le.str)`,`)):e.add(Pe.default.json,(0,le.str)`,`)}});var A$=S(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.parseJsonString=hs.parseJsonNumber=hs.parseJson=void 0;var aee=/position\s(\d+)(?: \(line \d+ column \d+\))?$/;function In(e,t){let r;In.message=void 0;let n;t&&(e=e.slice(t));try{return In.position=t+e.length,JSON.parse(e)}catch(s){if(n=aee.exec(s.message),!n){In.message="unexpected end";return}r=+n[1];let i=e[r];e=e.slice(0,r),In.position=t+r;try{return JSON.parse(e)}catch{In.message=`unexpected token ${i}`;return}}}hs.parseJson=In;In.message=void 0;In.position=0;In.code='require("ajv/dist/runtime/parseJson").parseJson';function An(e,t,r){let n="",s;if(An.message=void 0,e[t]==="-"&&(n+="-",t++),e[t]==="0")n+="0",t++;else if(!i(r)){o();return}if(r)return An.position=t,+n;if(e[t]==="."&&(n+=".",t++,!i())){o();return}if(s=e[t],(s==="e"||s==="E")&&(n+="e",t++,s=e[t],(s==="+"||s==="-")&&(n+=s,t++),!i())){o();return}return An.position=t,+n;function i(a){let l=!1;for(;s=e[t],s>="0"&&s<="9"&&(a===void 0||a-- >0);)l=!0,n+=s,t++;return l}function o(){An.position=t,An.message=t<e.length?`unexpected token ${e[t]}`:"unexpected end"}}hs.parseJsonNumber=An;An.message=void 0;An.position=0;An.code='require("ajv/dist/runtime/parseJson").parseJsonNumber';var I$={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"/":"/","\\":"\\"},lee=97,cee=48;function ds(e,t){let r="",n;for(ds.message=void 0;n=e[t++],n!=='"';)if(n==="\\")if(n=e[t],n in I$)r+=I$[n],t++;else if(n==="u"){t++;let i=4,o=0;for(;i--;){if(o<<=4,n=e[t],n===void 0){s("unexpected end");return}if(n=n.toLowerCase(),n>="a"&&n<="f")o+=n.charCodeAt(0)-lee+10;else if(n>="0"&&n<="9")o+=n.charCodeAt(0)-cee;else{s(`unexpected token ${n}`);return}t++}r+=String.fromCharCode(o)}else{s(`unexpected token ${n}`);return}else if(n===void 0){s("unexpected end");return}else if(n.charCodeAt(0)>=32)r+=n;else{s(`unexpected token ${n}`);return}return ds.position=t,r;function s(i){ds.position=t,ds.message=i}}hs.parseJsonString=ds;ds.message=void 0;ds.position=0;ds.code='require("ajv/dist/runtime/parseJson").parseJsonString'});var F$=S(q0=>{"use strict";Object.defineProperty(q0,"__esModule",{value:!0});var uee=T0(),x$=ri(),G=W(),fee=wn(),ae=dr(),dee=mt(),hee=md(),pee=p0(),$0=A$(),k$=Z(),mee=h0(),gee={elements:See,values:vee,discriminator:wee,properties:C$,optionalProperties:C$,enum:Tee,type:Ree,ref:Oee};function L$(e,t){let r=x$.getCompilingSchema.call(this,e);if(r)return r;let{es5:n,lines:s}=this.opts.code,{ownProperties:i}=this.opts,o=new G.CodeGen(this.scope,{es5:n,lines:s,ownProperties:i}),a=o.scopeName("parse"),l={self:this,gen:o,schema:e.schema,schemaEnv:e,definitions:t,data:ae.default.data,parseName:a,char:o.name("c")},c;try{this._compilations.add(e),e.parseName=a,yee(l),o.optimize(this.opts.code.optimize);let u=o.toString();c=`${o.scopeRefs(ae.default.scope)}return ${u}`;let p=new Function(`${ae.default.scope}`,c)(this.scope.get());this.scope.value(a,{ref:p}),e.parse=p}catch(u){throw c&&this.logger.error("Error compiling parser, function code:",c),delete e.parse,delete e.parseName,u}finally{this._compilations.delete(e)}return e}q0.default=L$;var N0=(0,G._)`undefined`;function yee(e){let{gen:t,parseName:r,char:n}=e;t.func(r,(0,G._)`${ae.default.json}, ${ae.default.jsonPos}, ${ae.default.jsonPart}`,!1,()=>{t.let(ae.default.data),t.let(n),t.assign((0,G._)`${r}.message`,N0),t.assign((0,G._)`${r}.position`,N0),t.assign(ae.default.jsonPos,(0,G._)`${ae.default.jsonPos} || 0`),t.const(ae.default.jsonLen,(0,G._)`${ae.default.json}.length`),Sd(e),D0(e),t.if(ae.default.jsonPart,()=>{t.assign((0,G._)`${r}.position`,ae.default.jsonPos),t.return(ae.default.data)}),t.if((0,G._)`${ae.default.jsonPos} === ${ae.default.jsonLen}`,()=>t.return(ae.default.data)),Io(e)})}function Sd(e){let t;for(let r of uee.jtdForms)if(r in e.schema){t=r;break}t?bee(e,gee[t]):k0(e)}var _ee=$$(!0,$$(!1,Io));function bee(e,t){let{gen:r,schema:n,data:s}=e;if(!n.nullable)return t(e);jl(e,"null",t,()=>r.assign(s,null))}function See(e){let{gen:t,schema:r,data:n}=e;Xr(e,"[");let s=t.let("i",0);t.assign(n,(0,G._)`[]`),x0(e,"]",()=>{let i=t.let("el");Sd({...e,schema:r.elements,data:i}),t.assign((0,G._)`${n}[${s}++]`,i)})}function vee(e){let{gen:t,schema:r,data:n}=e;Xr(e,"{"),t.assign(n,(0,G._)`{}`),x0(e,"}",()=>Eee(e,r.values))}function x0(e,t,r){D$(e,t,r),Xr(e,t)}function D$(e,t,r){let{gen:n}=e;n.for((0,G._)`;${ae.default.jsonPos}<${ae.default.jsonLen} && ${vd(1)}!==${t};`,()=>{r(),jl(e,",",()=>n.break(),s)});function s(){jl(e,t,()=>{},Io)}}function Eee(e,t){let{gen:r}=e,n=r.let("key");li({...e,data:n}),Xr(e,":"),M$(e,n,t)}function wee(e){let{gen:t,data:r,schema:n}=e,{discriminator:s,mapping:i}=n;Xr(e,"{"),t.assign(r,(0,G._)`{}`);let o=t.const("pos",ae.default.jsonPos),a=t.let("value"),l=t.let("tag");D$(e,"}",()=>{let c=t.let("key");li({...e,data:c}),Xr(e,":"),t.if((0,G._)`${c} === ${s}`,()=>{li({...e,data:l}),t.assign((0,G._)`${r}[${c}]`,l),t.break()},()=>k0({...e,data:a}))}),t.assign(ae.default.jsonPos,o),t.if((0,G._)`${l} === undefined`),Cn(e,(0,G.str)`discriminator tag not found`);for(let c in i)t.elseIf((0,G._)`${l} === ${c}`),q$({...e,schema:i[c]},s);t.else(),Cn(e,(0,G.str)`discriminator value not in schema`),t.endIf()}function C$(e){let{gen:t,data:r}=e;Xr(e,"{"),t.assign(r,(0,G._)`{}`),q$(e)}function q$(e,t){let{gen:r,schema:n,data:s}=e,{properties:i,optionalProperties:o,additionalProperties:a}=n;if(x0(e,"}",()=>{let l=r.let("key");if(li({...e,data:l}),Xr(e,":"),r.if(!1),N$(e,l,i),N$(e,l,o),t){r.elseIf((0,G._)`${l} === ${t}`);let c=r.let("tag");li({...e,data:c})}r.else(),a?k0({...e,data:(0,G._)`${s}[${l}]`}):Cn(e,(0,G.str)`property ${l} not allowed`),r.endIf()}),i){let l=(0,dee.hasPropFunc)(r),c=(0,G.and)(...Object.keys(i).map(u=>(0,G._)`${l}.call(${s}, ${u})`));r.if((0,G.not)(c),()=>Cn(e,(0,G.str)`missing required properties`))}}function N$(e,t,r={}){let{gen:n}=e;for(let s in r)n.elseIf((0,G._)`${t} === ${s}`),M$(e,t,r[s])}function M$(e,t,r){Sd({...e,schema:r,data:(0,G._)`${e.data}[${t}]`})}function Ree(e){let{gen:t,schema:r,data:n,self:s}=e;switch(r.type){case"boolean":_ee(e);break;case"string":li(e);break;case"timestamp":{li(e);let i=(0,k$.useFunc)(t,mee.default),{allowDate:o,parseDate:a}=s.opts,l=o?(0,G._)`!${i}(${n}, true)`:(0,G._)`!${i}(${n})`,c=a?(0,G.or)(l,(0,G._)`(${n} = new Date(${n}), false)`,(0,G._)`isNaN(${n}.valueOf())`):l;t.if(c,()=>Cn(e,(0,G.str)`invalid timestamp`));break}case"float32":case"float64":C0(e);break;default:{let i=r.type;if(!s.opts.int32range&&(i==="int32"||i==="uint32"))C0(e,16),i==="uint32"&&t.if((0,G._)`${n} < 0`,()=>Cn(e,(0,G.str)`integer out of range`));else{let[o,a,l]=pee.intRange[i];C0(e,l),t.if((0,G._)`${n} < ${o} || ${n} > ${a}`,()=>Cn(e,(0,G.str)`integer out of range`))}}}}function li(e){Xr(e,'"'),L0(e,$0.parseJsonString)}function Tee(e){let{gen:t,data:r,schema:n}=e,s=n.enum;Xr(e,'"'),t.if(!1);for(let i of s){let o=JSON.stringify(i).slice(1);t.elseIf((0,G._)`${vd(o.length)} === ${o}`),t.assign(r,(0,G.str)`${i}`),t.add(ae.default.jsonPos,o.length)}t.else(),Io(e),t.endIf()}function C0(e,t){let{gen:r}=e;D0(e),r.if((0,G._)`"-0123456789".indexOf(${vd(1)}) < 0`,()=>Io(e),()=>L0(e,$0.parseJsonNumber,t))}function $$(e,t){return r=>{let{gen:n,data:s}=r;jl(r,`${e}`,()=>t(r),()=>n.assign(s,e))}}function Oee(e){let{gen:t,self:r,definitions:n,schema:s,schemaEnv:i}=e,{ref:o}=s,a=n[o];if(!a)throw new fee.default(r.opts.uriResolver,"",o,`No definition ${o}`);if(!(0,hee.hasRef)(a))return Sd({...e,schema:a});let{root:l}=i,c=L$.call(r,new x$.SchemaEnv({schema:a,root:l}),n);j$(e,Pee(t,c),!0)}function Pee(e,t){return t.parse?e.scopeValue("parse",{ref:t.parse}):(0,G._)`${e.scopeValue("wrapper",{ref:t})}.parse`}function k0(e){L0(e,$0.parseJson)}function L0(e,t,r){j$(e,(0,k$.useFunc)(e.gen,t),r)}function j$(e,t,r){let{gen:n,data:s}=e;n.assign(s,(0,G._)`${t}(${ae.default.json}, ${ae.default.jsonPos}${r?(0,G._)`, ${r}`:G.nil})`),n.assign(ae.default.jsonPos,(0,G._)`${t}.position`),n.if((0,G._)`${s} === undefined`,()=>Cn(e,(0,G._)`${t}.message`))}function Xr(e,t){jl(e,t,Io)}function jl(e,t,r,n){let{gen:s}=e,i=t.length;D0(e),s.if((0,G._)`${vd(i)} === ${t}`,()=>{s.add(ae.default.jsonPos,i),n?.(e)},()=>r(e))}function D0({gen:e,char:t}){e.code((0,G._)`while((${t}=${ae.default.json}[${ae.default.jsonPos}],${t}===" "||${t}==="\\n"||${t}==="\\r"||${t}==="\\t"))${ae.default.jsonPos}++;`)}function vd(e){return e===1?(0,G._)`${ae.default.json}[${ae.default.jsonPos}]`:(0,G._)`${ae.default.json}.slice(${ae.default.jsonPos}, ${ae.default.jsonPos}+${e})`}function Io(e){Cn(e,(0,G._)`"unexpected token " + ${ae.default.json}[${ae.default.jsonPos}]`)}function Cn({gen:e,parseName:t},r){e.assign((0,G._)`${t}.message`,r),e.assign((0,G._)`${t}.position`,ae.default.jsonPos),e.return(N0)}});var F0=S((Ne,j0)=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.MissingRefError=Ne.ValidationError=Ne.CodeGen=Ne.Name=Ne.nil=Ne.stringify=Ne.str=Ne._=Ne.KeywordCxt=Ne.Ajv=void 0;var Iee=Jy(),Aee=m$(),Cee=b$(),Nee=P$(),$ee=F$(),M0="JTD-meta-schema",Ao=class extends Iee.default{constructor(t={}){super({...t,jtd:!0})}_addVocabularies(){super._addVocabularies(),this.addVocabulary(Aee.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema(),this.opts.meta&&this.addMetaSchema(Cee.default,M0,!1)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(M0)?M0:void 0)}compileSerializer(t){let r=this._addSchema(t);return r.serialize||this._compileSerializer(r)}compileParser(t){let r=this._addSchema(t);return r.parse||this._compileParser(r)}_compileSerializer(t){if(Nee.default.call(this,t,t.schema.definitions||{}),!t.serialize)throw new Error("ajv implementation error");return t.serialize}_compileParser(t){if($ee.default.call(this,t,t.schema.definitions||{}),!t.parse)throw new Error("ajv implementation error");return t.parse}};Ne.Ajv=Ao;j0.exports=Ne=Ao;j0.exports.Ajv=Ao;Object.defineProperty(Ne,"__esModule",{value:!0});Ne.default=Ao;var xee=fo();Object.defineProperty(Ne,"KeywordCxt",{enumerable:!0,get:function(){return xee.KeywordCxt}});var Co=W();Object.defineProperty(Ne,"_",{enumerable:!0,get:function(){return Co._}});Object.defineProperty(Ne,"str",{enumerable:!0,get:function(){return Co.str}});Object.defineProperty(Ne,"stringify",{enumerable:!0,get:function(){return Co.stringify}});Object.defineProperty(Ne,"nil",{enumerable:!0,get:function(){return Co.nil}});Object.defineProperty(Ne,"Name",{enumerable:!0,get:function(){return Co.Name}});Object.defineProperty(Ne,"CodeGen",{enumerable:!0,get:function(){return Co.CodeGen}});var kee=ml();Object.defineProperty(Ne,"ValidationError",{enumerable:!0,get:function(){return kee.default}});var Lee=wn();Object.defineProperty(Ne,"MissingRefError",{enumerable:!0,get:function(){return Lee.default}})});var V0=S((Vge,V$)=>{"use strict";var Dee=Bf();V$.exports=Object.freeze({coerceTypes:"array",useDefaults:!0,removeAdditional:!0,uriResolver:Dee,addUsedSchema:!1,allErrors:!1})});var B$=S((Uge,H$)=>{"use strict";var qee=od().default,Mee=F0(),U$=V0(),U0=class{constructor(t,r){r.mode==="JTD"?this.ajv=new Mee(Object.assign({},U$,r.customOptions)):this.ajv=new qee(Object.assign({},U$,r.customOptions));let n=!0;if(r.plugins&&r.plugins.length>0)for(let i of r.plugins)Array.isArray(i)?(n=n&&i[0].name!=="formatsPlugin",i[0](this.ajv,i[1])):(n=n&&i.name!=="formatsPlugin",i(this.ajv));n&&K_()(this.ajv),r.onCreate?.(this.ajv);let s=Object.values(t);for(let i of s)this.ajv.addSchema(i)}buildValidatorFunction({schema:t}){if(t.$id){let r=this.ajv.getSchema(t.$id);if(r)return r}return this.ajv.compile(t)}};H$.exports=U0});var G$=S((Hge,z$)=>{"use strict";var jee=F0(),Fee=V0(),H0=class{constructor(t,r){this.ajv=new jee(Object.assign({},Fee,r))}buildSerializerFunction({schema:t}){return this.ajv.compileSerializer(t)}};z$.exports=H0});var J$=S((Vl,K$)=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var Fl=Cf(),Lr=no();function W$(e,t){if(!e.opts.code.source)throw new Error("moduleCode: ajv instance must have code.source option");let{_n:r}=e.scope.opts;return typeof t=="function"?s(t.source):t!==void 0?i(t,n):i(e.schemas,a=>a.meta?void 0:e.compile(a.schema));function n(a){let l=e.getSchema(a);if(!l)throw new Error(`moduleCode: no schema with id ${a}`);return l}function s(a){let l={},c=a?.validateName,u=o(l,a);return e.opts.code.esm?`"use strict";${r}export const validate = ${c};${r}export default ${c};${r}${u}`:`"use strict";${r}module.exports = ${c};${r}module.exports.default = ${c};${r}${u}`}function i(a,l){var c;let u={},f=(0,Lr._)`"use strict";`;for(let p in a){let d=l(a[p]);if(d){let h=o(u,d.source),m=e.opts.code.esm?(0,Lr._)`export const ${(0,Lr.getEsmExportName)(p)}`:(0,Lr._)`exports${(0,Lr.getProperty)(p)}`;f=(0,Lr._)`${f}${r}${m} = ${(c=d.source)===null||c===void 0?void 0:c.validateName};${r}${h}`}}return`${f}`}function o(a,l){if(!l)throw new Error('moduleCode: function does not have "source" property');if(p(l.validateName)===Fl.UsedValueState.Completed)return Lr.nil;d(l.validateName,Fl.UsedValueState.Started);let c=e.scope.scopeCode(l.scopeValues,a,f),u=new Lr._Code(`${c}${r}${l.validateCode}`);return l.evaluated?(0,Lr._)`${u}${l.validateName}.evaluated = ${l.evaluated};${r}`:u;function f(h){var m;let y=(m=h.value)===null||m===void 0?void 0:m.ref;if(h.prefix==="validate"&&typeof y=="function")return o(a,y.source);if((h.prefix==="root"||h.prefix==="wrapper")&&typeof y=="object"){let{validate:b,validateName:v}=y;if(!v)throw new Error("ajv internal error");let _=e.opts.code.es5?Fl.varKinds.var:Fl.varKinds.const,g=(0,Lr._)`${_} ${h} = {validate: ${v}};`;if(p(v)===Fl.UsedValueState.Started)return g;let T=o(a,b?.source);return(0,Lr._)`${g}${r}${T}`}}function p(h){var m;return(m=a[h.prefix])===null||m===void 0?void 0:m.get(h)}function d(h,m){let{prefix:y}=h;(a[y]=a[y]||new Map).set(h,m)}}}K$.exports=Vl=W$;Object.defineProperty(Vl,"__esModule",{value:!0});Vl.default=W$});var Z$=S((Bge,X$)=>{"use strict";var Y$=B0(),Vee=J$().default;function Uee(e={readMode:!0}){if(e.readMode===!0&&!e.restoreFunction)throw new Error("You must provide a restoreFunction options when readMode ON");if(e.readMode!==!0&&!e.storeFunction)throw new Error("You must provide a storeFunction options when readMode OFF");if(e.readMode===!0)return function(){return function(n){return e.restoreFunction(n)}};let t=Y$();return function(n,s={}){(!s.customOptions||!s.customOptions.code)&&(s.customOptions=Object.assign({},s.customOptions,{code:{source:!0}}));let i=t(n,s);return function(o){let a=i(o),l=Vee(i[Y$.AjvReference].ajv,a);return e.storeFunction(o,l),a}}}X$.exports=Uee});var B0=S((zge,No)=>{"use strict";var ex=Symbol.for("fastify.ajv-compiler.reference"),Hee=B$(),Bee=G$();function z0(e){let t=new Map,r=new Map;return e&&e.jtdSerializer===!0?function(s,i){let o=Q$({},i);if(r.has(o))return r.get(o);let a=new Bee(s,i),l=a.buildSerializerFunction.bind(a);return r.set(o,l),l}:function(s,i){let o=Q$(s,i.customOptions);if(t.has(o))return t.get(o);let a=new Hee(s,i),l=a.buildValidatorFunction.bind(a);return t.set(o,l),i.customOptions.code!==void 0&&(l[ex]=a),l}}function Q$(e,t){let r=JSON.stringify(e),n=JSON.stringify(t);return`${r}${n}`}No.exports=z0;No.exports.default=z0;No.exports.AjvCompiler=z0;No.exports.AjvReference=ex;No.exports.StandaloneValidator=Z$()});var G0=S((Gge,tx)=>{"use strict";var{buildSchemas:zee}=Ja(),Gee=c0(),Wee=B0();function Kee(e,t){if(e)return new $o(e,t);let r=Object.assign({buildValidator:null,buildSerializer:null},t?.compilersFactory);r.buildValidator||(r.buildValidator=Wee()),r.buildSerializer||(r.buildSerializer=Gee());let n={bucket:t&&t.bucket||zee,compilersFactory:r,isCustomValidatorCompiler:typeof t?.compilersFactory?.buildValidator=="function",isCustomSerializerCompiler:typeof t?.compilersFactory?.buildValidator=="function"};return new $o(void 0,n)}var $o=class{constructor(t,r){this.opts=r||t?.opts,this.addedSchemas=!1,this.compilersFactory=this.opts.compilersFactory,t?(this.schemaBucket=this.opts.bucket(t.getSchemas()),this.validatorCompiler=t.getValidatorCompiler(),this.serializerCompiler=t.getSerializerCompiler(),this.isCustomValidatorCompiler=t.isCustomValidatorCompiler,this.isCustomSerializerCompiler=t.isCustomSerializerCompiler,this.parent=t):(this.schemaBucket=this.opts.bucket(),this.isCustomValidatorCompiler=this.opts.isCustomValidatorCompiler||!1,this.isCustomSerializerCompiler=this.opts.isCustomSerializerCompiler||!1)}add(t){return this.addedSchemas=!0,this.schemaBucket.add(t)}getSchema(t){return this.schemaBucket.getSchema(t)}getSchemas(){return this.schemaBucket.getSchemas()}setValidatorCompiler(t){this.compilersFactory=Object.assign({},this.compilersFactory,{buildValidator:()=>t}),this.validatorCompiler=t,this.isCustomValidatorCompiler=!0}setSerializerCompiler(t){this.compilersFactory=Object.assign({},this.compilersFactory,{buildSerializer:()=>t}),this.serializerCompiler=t,this.isCustomSerializerCompiler=!0}getValidatorCompiler(){return this.validatorCompiler||this.parent&&this.parent.getValidatorCompiler()}getSerializerCompiler(){return this.serializerCompiler||this.parent&&this.parent.getSerializerCompiler()}getSerializerBuilder(){return this.compilersFactory.buildSerializer||this.parent&&this.parent.getSerializerBuilder()}getValidatorBuilder(){return this.compilersFactory.buildValidator||this.parent&&this.parent.getValidatorBuilder()}setupValidator(t){this.validatorCompiler!==void 0&&!this.addedSchemas||(this.validatorCompiler=this.getValidatorBuilder()(this.schemaBucket.getSchemas(),t.ajv))}setupSerializer(t){this.serializerCompiler!==void 0&&!this.addedSchemas||(this.serializerCompiler=this.getSerializerBuilder()(this.schemaBucket.getSchemas(),t.serializerOpts))}};$o.buildSchemaController=Kee;tx.exports=$o});var Ul=S((Wge,rx)=>{var Jee="2.0.0",Yee=Number.MAX_SAFE_INTEGER||9007199254740991,Xee=16,Zee=250,Qee=["major","premajor","minor","preminor","patch","prepatch","prerelease"];rx.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Xee,MAX_SAFE_BUILD_LENGTH:Zee,MAX_SAFE_INTEGER:Yee,RELEASE_TYPES:Qee,SEMVER_SPEC_VERSION:Jee,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Hl=S((Kge,nx)=>{var ete=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};nx.exports=ete});var xo=S((Zr,sx)=>{var{MAX_SAFE_COMPONENT_LENGTH:W0,MAX_SAFE_BUILD_LENGTH:tte,MAX_LENGTH:rte}=Ul(),nte=Hl();Zr=sx.exports={};var ste=Zr.re=[],ite=Zr.safeRe=[],j=Zr.src=[],ote=Zr.safeSrc=[],F=Zr.t={},ate=0,K0="[a-zA-Z0-9-]",lte=[["\\s",1],["\\d",rte],[K0,tte]],cte=e=>{for(let[t,r]of lte)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},Y=(e,t,r)=>{let n=cte(t),s=ate++;nte(e,s,t),F[e]=s,j[s]=t,ote[s]=n,ste[s]=new RegExp(t,r?"g":void 0),ite[s]=new RegExp(n,r?"g":void 0)};Y("NUMERICIDENTIFIER","0|[1-9]\\d*");Y("NUMERICIDENTIFIERLOOSE","\\d+");Y("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${K0}*`);Y("MAINVERSION",`(${j[F.NUMERICIDENTIFIER]})\\.(${j[F.NUMERICIDENTIFIER]})\\.(${j[F.NUMERICIDENTIFIER]})`);Y("MAINVERSIONLOOSE",`(${j[F.NUMERICIDENTIFIERLOOSE]})\\.(${j[F.NUMERICIDENTIFIERLOOSE]})\\.(${j[F.NUMERICIDENTIFIERLOOSE]})`);Y("PRERELEASEIDENTIFIER",`(?:${j[F.NUMERICIDENTIFIER]}|${j[F.NONNUMERICIDENTIFIER]})`);Y("PRERELEASEIDENTIFIERLOOSE",`(?:${j[F.NUMERICIDENTIFIERLOOSE]}|${j[F.NONNUMERICIDENTIFIER]})`);Y("PRERELEASE",`(?:-(${j[F.PRERELEASEIDENTIFIER]}(?:\\.${j[F.PRERELEASEIDENTIFIER]})*))`);Y("PRERELEASELOOSE",`(?:-?(${j[F.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${j[F.PRERELEASEIDENTIFIERLOOSE]})*))`);Y("BUILDIDENTIFIER",`${K0}+`);Y("BUILD",`(?:\\+(${j[F.BUILDIDENTIFIER]}(?:\\.${j[F.BUILDIDENTIFIER]})*))`);Y("FULLPLAIN",`v?${j[F.MAINVERSION]}${j[F.PRERELEASE]}?${j[F.BUILD]}?`);Y("FULL",`^${j[F.FULLPLAIN]}$`);Y("LOOSEPLAIN",`[v=\\s]*${j[F.MAINVERSIONLOOSE]}${j[F.PRERELEASELOOSE]}?${j[F.BUILD]}?`);Y("LOOSE",`^${j[F.LOOSEPLAIN]}$`);Y("GTLT","((?:<|>)?=?)");Y("XRANGEIDENTIFIERLOOSE",`${j[F.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);Y("XRANGEIDENTIFIER",`${j[F.NUMERICIDENTIFIER]}|x|X|\\*`);Y("XRANGEPLAIN",`[v=\\s]*(${j[F.XRANGEIDENTIFIER]})(?:\\.(${j[F.XRANGEIDENTIFIER]})(?:\\.(${j[F.XRANGEIDENTIFIER]})(?:${j[F.PRERELEASE]})?${j[F.BUILD]}?)?)?`);Y("XRANGEPLAINLOOSE",`[v=\\s]*(${j[F.XRANGEIDENTIFIERLOOSE]})(?:\\.(${j[F.XRANGEIDENTIFIERLOOSE]})(?:\\.(${j[F.XRANGEIDENTIFIERLOOSE]})(?:${j[F.PRERELEASELOOSE]})?${j[F.BUILD]}?)?)?`);Y("XRANGE",`^${j[F.GTLT]}\\s*${j[F.XRANGEPLAIN]}$`);Y("XRANGELOOSE",`^${j[F.GTLT]}\\s*${j[F.XRANGEPLAINLOOSE]}$`);Y("COERCEPLAIN",`(^|[^\\d])(\\d{1,${W0}})(?:\\.(\\d{1,${W0}}))?(?:\\.(\\d{1,${W0}}))?`);Y("COERCE",`${j[F.COERCEPLAIN]}(?:$|[^\\d])`);Y("COERCEFULL",j[F.COERCEPLAIN]+`(?:${j[F.PRERELEASE]})?(?:${j[F.BUILD]})?(?:$|[^\\d])`);Y("COERCERTL",j[F.COERCE],!0);Y("COERCERTLFULL",j[F.COERCEFULL],!0);Y("LONETILDE","(?:~>?)");Y("TILDETRIM",`(\\s*)${j[F.LONETILDE]}\\s+`,!0);Zr.tildeTrimReplace="$1~";Y("TILDE",`^${j[F.LONETILDE]}${j[F.XRANGEPLAIN]}$`);Y("TILDELOOSE",`^${j[F.LONETILDE]}${j[F.XRANGEPLAINLOOSE]}$`);Y("LONECARET","(?:\\^)");Y("CARETTRIM",`(\\s*)${j[F.LONECARET]}\\s+`,!0);Zr.caretTrimReplace="$1^";Y("CARET",`^${j[F.LONECARET]}${j[F.XRANGEPLAIN]}$`);Y("CARETLOOSE",`^${j[F.LONECARET]}${j[F.XRANGEPLAINLOOSE]}$`);Y("COMPARATORLOOSE",`^${j[F.GTLT]}\\s*(${j[F.LOOSEPLAIN]})$|^$`);Y("COMPARATOR",`^${j[F.GTLT]}\\s*(${j[F.FULLPLAIN]})$|^$`);Y("COMPARATORTRIM",`(\\s*)${j[F.GTLT]}\\s*(${j[F.LOOSEPLAIN]}|${j[F.XRANGEPLAIN]})`,!0);Zr.comparatorTrimReplace="$1$2$3";Y("HYPHENRANGE",`^\\s*(${j[F.XRANGEPLAIN]})\\s+-\\s+(${j[F.XRANGEPLAIN]})\\s*$`);Y("HYPHENRANGELOOSE",`^\\s*(${j[F.XRANGEPLAINLOOSE]})\\s+-\\s+(${j[F.XRANGEPLAINLOOSE]})\\s*$`);Y("STAR","(<|>)?=?\\s*\\*");Y("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");Y("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Ed=S((Jge,ix)=>{var ute=Object.freeze({loose:!0}),fte=Object.freeze({}),dte=e=>e?typeof e!="object"?ute:e:fte;ix.exports=dte});var J0=S((Yge,lx)=>{var ox=/^[0-9]+$/,ax=(e,t)=>{let r=ox.test(e),n=ox.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1},hte=(e,t)=>ax(t,e);lx.exports={compareIdentifiers:ax,rcompareIdentifiers:hte}});var Pt=S((Xge,dx)=>{var wd=Hl(),{MAX_LENGTH:cx,MAX_SAFE_INTEGER:Rd}=Ul(),{safeRe:ux,safeSrc:fx,t:Td}=xo(),pte=Ed(),{compareIdentifiers:ko}=J0(),Y0=class e{constructor(t,r){if(r=pte(r),t instanceof e){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>cx)throw new TypeError(`version is longer than ${cx} characters`);wd("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=t.trim().match(r.loose?ux[Td.LOOSE]:ux[Td.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Rd||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Rd||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Rd||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Rd)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(wd("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if(typeof t=="string"&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),ko(this.major,t.major)||ko(this.minor,t.minor)||ko(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],s=t.prerelease[r];if(wd("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return ko(n,s)}while(++r)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let r=0;do{let n=this.build[r],s=t.build[r];if(wd("build compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return ko(n,s)}while(++r)}inc(t,r,n){if(t.startsWith("pre")){if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(r){let s=new RegExp(`^${this.options.loose?fx[Td.PRERELEASELOOSE]:fx[Td.PRERELEASE]}$`),i=`-${r}`.match(s);if(!i||i[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let i=[r,s];n===!1&&(i=[r]),ko(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};dx.exports=Y0});var ci=S((Zge,px)=>{var hx=Pt(),mte=(e,t,r=!1)=>{if(e instanceof hx)return e;try{return new hx(e,t)}catch(n){if(!r)return null;throw n}};px.exports=mte});var gx=S((Qge,mx)=>{var gte=ci(),yte=(e,t)=>{let r=gte(e,t);return r?r.version:null};mx.exports=yte});var _x=S((eye,yx)=>{var _te=ci(),bte=(e,t)=>{let r=_te(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};yx.exports=bte});var vx=S((tye,Sx)=>{var bx=Pt(),Ste=(e,t,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new bx(e instanceof bx?e.version:e,r).inc(t,n,s).version}catch{return null}};Sx.exports=Ste});var Rx=S((rye,wx)=>{var Ex=ci(),vte=(e,t)=>{let r=Ex(e,null,!0),n=Ex(t,null,!0),s=r.compare(n);if(s===0)return null;let i=s>0,o=i?r:n,a=i?n:r,l=!!o.prerelease.length;if(!!a.prerelease.length&&!l){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let u=l?"pre":"";return r.major!==n.major?u+"major":r.minor!==n.minor?u+"minor":r.patch!==n.patch?u+"patch":"prerelease"};wx.exports=vte});var Ox=S((nye,Tx)=>{var Ete=Pt(),wte=(e,t)=>new Ete(e,t).major;Tx.exports=wte});var Ix=S((sye,Px)=>{var Rte=Pt(),Tte=(e,t)=>new Rte(e,t).minor;Px.exports=Tte});var Cx=S((iye,Ax)=>{var Ote=Pt(),Pte=(e,t)=>new Ote(e,t).patch;Ax.exports=Pte});var $x=S((oye,Nx)=>{var Ite=ci(),Ate=(e,t)=>{let r=Ite(e,t);return r&&r.prerelease.length?r.prerelease:null};Nx.exports=Ate});var gr=S((aye,kx)=>{var xx=Pt(),Cte=(e,t,r)=>new xx(e,r).compare(new xx(t,r));kx.exports=Cte});var Dx=S((lye,Lx)=>{var Nte=gr(),$te=(e,t,r)=>Nte(t,e,r);Lx.exports=$te});var Mx=S((cye,qx)=>{var xte=gr(),kte=(e,t)=>xte(e,t,!0);qx.exports=kte});var Od=S((uye,Fx)=>{var jx=Pt(),Lte=(e,t,r)=>{let n=new jx(e,r),s=new jx(t,r);return n.compare(s)||n.compareBuild(s)};Fx.exports=Lte});var Ux=S((fye,Vx)=>{var Dte=Od(),qte=(e,t)=>e.sort((r,n)=>Dte(r,n,t));Vx.exports=qte});var Bx=S((dye,Hx)=>{var Mte=Od(),jte=(e,t)=>e.sort((r,n)=>Mte(n,r,t));Hx.exports=jte});var Bl=S((hye,zx)=>{var Fte=gr(),Vte=(e,t,r)=>Fte(e,t,r)>0;zx.exports=Vte});var Pd=S((pye,Gx)=>{var Ute=gr(),Hte=(e,t,r)=>Ute(e,t,r)<0;Gx.exports=Hte});var X0=S((mye,Wx)=>{var Bte=gr(),zte=(e,t,r)=>Bte(e,t,r)===0;Wx.exports=zte});var Z0=S((gye,Kx)=>{var Gte=gr(),Wte=(e,t,r)=>Gte(e,t,r)!==0;Kx.exports=Wte});var Id=S((yye,Jx)=>{var Kte=gr(),Jte=(e,t,r)=>Kte(e,t,r)>=0;Jx.exports=Jte});var Ad=S((_ye,Yx)=>{var Yte=gr(),Xte=(e,t,r)=>Yte(e,t,r)<=0;Yx.exports=Xte});var Q0=S((bye,Xx)=>{var Zte=X0(),Qte=Z0(),ere=Bl(),tre=Id(),rre=Pd(),nre=Ad(),sre=(e,t,r,n)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return Zte(e,r,n);case"!=":return Qte(e,r,n);case">":return ere(e,r,n);case">=":return tre(e,r,n);case"<":return rre(e,r,n);case"<=":return nre(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}};Xx.exports=sre});var Qx=S((Sye,Zx)=>{var ire=Pt(),ore=ci(),{safeRe:Cd,t:Nd}=xo(),are=(e,t)=>{if(e instanceof ire)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let r=null;if(!t.rtl)r=e.match(t.includePrerelease?Cd[Nd.COERCEFULL]:Cd[Nd.COERCE]);else{let l=t.includePrerelease?Cd[Nd.COERCERTLFULL]:Cd[Nd.COERCERTL],c;for(;(c=l.exec(e))&&(!r||r.index+r[0].length!==e.length);)(!r||c.index+c[0].length!==r.index+r[0].length)&&(r=c),l.lastIndex=c.index+c[1].length+c[2].length;l.lastIndex=-1}if(r===null)return null;let n=r[2],s=r[3]||"0",i=r[4]||"0",o=t.includePrerelease&&r[5]?`-${r[5]}`:"",a=t.includePrerelease&&r[6]?`+${r[6]}`:"";return ore(`${n}.${s}.${i}${o}${a}`,t)};Zx.exports=are});var tk=S((vye,ek)=>{var eb=class{constructor(){this.max=1e3,this.map=new Map}get(t){let r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(t,r)}return this}};ek.exports=eb});var yr=S((Eye,ik)=>{var lre=/\s+/g,tb=class e{constructor(t,r){if(r=ure(r),t instanceof e)return t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease?t:new e(t.raw,r);if(t instanceof rb)return this.raw=t.value,this.set=[[t]],this.formatted=void 0,this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=t.trim().replace(lre," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!nk(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&yre(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let t=0;t<this.set.length;t++){t>0&&(this.formatted+="||");let r=this.set[t];for(let n=0;n<r.length;n++)n>0&&(this.formatted+=" "),this.formatted+=r[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(t){let n=((this.options.includePrerelease&&mre)|(this.options.loose&&gre))+":"+t,s=rk.get(n);if(s)return s;let i=this.options.loose,o=i?Wt[Lt.HYPHENRANGELOOSE]:Wt[Lt.HYPHENRANGE];t=t.replace(o,Pre(this.options.includePrerelease)),$e("hyphen replace",t),t=t.replace(Wt[Lt.COMPARATORTRIM],dre),$e("comparator trim",t),t=t.replace(Wt[Lt.TILDETRIM],hre),$e("tilde trim",t),t=t.replace(Wt[Lt.CARETTRIM],pre),$e("caret trim",t);let a=t.split(" ").map(f=>_re(f,this.options)).join(" ").split(/\s+/).map(f=>Ore(f,this.options));i&&(a=a.filter(f=>($e("loose invalid filter",f,this.options),!!f.match(Wt[Lt.COMPARATORLOOSE])))),$e("range list",a);let l=new Map,c=a.map(f=>new rb(f,this.options));for(let f of c){if(nk(f))return[f];l.set(f.value,f)}l.size>1&&l.has("")&&l.delete("");let u=[...l.values()];return rk.set(n,u),u}intersects(t,r){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some(n=>sk(n,r)&&t.set.some(s=>sk(s,r)&&n.every(i=>s.every(o=>i.intersects(o,r)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new fre(t,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(Ire(this.set[r],t,this.options))return!0;return!1}};ik.exports=tb;var cre=tk(),rk=new cre,ure=Ed(),rb=zl(),$e=Hl(),fre=Pt(),{safeRe:Wt,t:Lt,comparatorTrimReplace:dre,tildeTrimReplace:hre,caretTrimReplace:pre}=xo(),{FLAG_INCLUDE_PRERELEASE:mre,FLAG_LOOSE:gre}=Ul(),nk=e=>e.value==="<0.0.0-0",yre=e=>e.value==="",sk=(e,t)=>{let r=!0,n=e.slice(),s=n.pop();for(;r&&n.length;)r=n.every(i=>s.intersects(i,t)),s=n.pop();return r},_re=(e,t)=>($e("comp",e,t),e=vre(e,t),$e("caret",e),e=bre(e,t),$e("tildes",e),e=wre(e,t),$e("xrange",e),e=Tre(e,t),$e("stars",e),e),Dt=e=>!e||e.toLowerCase()==="x"||e==="*",bre=(e,t)=>e.trim().split(/\s+/).map(r=>Sre(r,t)).join(" "),Sre=(e,t)=>{let r=t.loose?Wt[Lt.TILDELOOSE]:Wt[Lt.TILDE];return e.replace(r,(n,s,i,o,a)=>{$e("tilde",e,n,s,i,o,a);let l;return Dt(s)?l="":Dt(i)?l=`>=${s}.0.0 <${+s+1}.0.0-0`:Dt(o)?l=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:a?($e("replaceTilde pr",a),l=`>=${s}.${i}.${o}-${a} <${s}.${+i+1}.0-0`):l=`>=${s}.${i}.${o} <${s}.${+i+1}.0-0`,$e("tilde return",l),l})},vre=(e,t)=>e.trim().split(/\s+/).map(r=>Ere(r,t)).join(" "),Ere=(e,t)=>{$e("caret",e,t);let r=t.loose?Wt[Lt.CARETLOOSE]:Wt[Lt.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(s,i,o,a,l)=>{$e("caret",e,s,i,o,a,l);let c;return Dt(i)?c="":Dt(o)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:Dt(a)?i==="0"?c=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${n} <${+i+1}.0.0-0`:l?($e("replaceCaret pr",l),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${l} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${l} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${l} <${+i+1}.0.0-0`):($e("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${n} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),$e("caret return",c),c})},wre=(e,t)=>($e("replaceXRanges",e,t),e.split(/\s+/).map(r=>Rre(r,t)).join(" ")),Rre=(e,t)=>{e=e.trim();let r=t.loose?Wt[Lt.XRANGELOOSE]:Wt[Lt.XRANGE];return e.replace(r,(n,s,i,o,a,l)=>{$e("xRange",e,n,s,i,o,a,l);let c=Dt(i),u=c||Dt(o),f=u||Dt(a),p=f;return s==="="&&p&&(s=""),l=t.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&p?(u&&(o=0),a=0,s===">"?(s=">=",u?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):s==="<="&&(s="<",u?i=+i+1:o=+o+1),s==="<"&&(l="-0"),n=`${s+i}.${o}.${a}${l}`):u?n=`>=${i}.0.0${l} <${+i+1}.0.0-0`:f&&(n=`>=${i}.${o}.0${l} <${i}.${+o+1}.0-0`),$e("xRange return",n),n})},Tre=(e,t)=>($e("replaceStars",e,t),e.trim().replace(Wt[Lt.STAR],"")),Ore=(e,t)=>($e("replaceGTE0",e,t),e.trim().replace(Wt[t.includePrerelease?Lt.GTE0PRE:Lt.GTE0],"")),Pre=e=>(t,r,n,s,i,o,a,l,c,u,f,p)=>(Dt(n)?r="":Dt(s)?r=`>=${n}.0.0${e?"-0":""}`:Dt(i)?r=`>=${n}.${s}.0${e?"-0":""}`:o?r=`>=${r}`:r=`>=${r}${e?"-0":""}`,Dt(c)?l="":Dt(u)?l=`<${+c+1}.0.0-0`:Dt(f)?l=`<${c}.${+u+1}.0-0`:p?l=`<=${c}.${u}.${f}-${p}`:e?l=`<${c}.${u}.${+f+1}-0`:l=`<=${l}`,`${r} ${l}`.trim()),Ire=(e,t,r)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let n=0;n<e.length;n++)if($e(e[n].semver),e[n].semver!==rb.ANY&&e[n].semver.prerelease.length>0){let s=e[n].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0}});var zl=S((wye,fk)=>{var Gl=Symbol("SemVer ANY"),ib=class e{static get ANY(){return Gl}constructor(t,r){if(r=ok(r),t instanceof e){if(t.loose===!!r.loose)return t;t=t.value}t=t.trim().split(/\s+/).join(" "),sb("comparator",t,r),this.options=r,this.loose=!!r.loose,this.parse(t),this.semver===Gl?this.value="":this.value=this.operator+this.semver.version,sb("comp",this)}parse(t){let r=this.options.loose?ak[lk.COMPARATORLOOSE]:ak[lk.COMPARATOR],n=t.match(r);if(!n)throw new TypeError(`Invalid comparator: ${t}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new ck(n[2],this.options.loose):this.semver=Gl}toString(){return this.value}test(t){if(sb("Comparator.test",t,this.options.loose),this.semver===Gl||t===Gl)return!0;if(typeof t=="string")try{t=new ck(t,this.options)}catch{return!1}return nb(t,this.operator,this.semver,this.options)}intersects(t,r){if(!(t instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new uk(t.value,r).test(this.value):t.operator===""?t.value===""?!0:new uk(this.value,r).test(t.semver):(r=ok(r),r.includePrerelease&&(this.value==="<0.0.0-0"||t.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&t.operator.startsWith(">")||this.operator.startsWith("<")&&t.operator.startsWith("<")||this.semver.version===t.semver.version&&this.operator.includes("=")&&t.operator.includes("=")||nb(this.semver,"<",t.semver,r)&&this.operator.startsWith(">")&&t.operator.startsWith("<")||nb(this.semver,">",t.semver,r)&&this.operator.startsWith("<")&&t.operator.startsWith(">")))}};fk.exports=ib;var ok=Ed(),{safeRe:ak,t:lk}=xo(),nb=Q0(),sb=Hl(),ck=Pt(),uk=yr()});var Wl=S((Rye,dk)=>{var Are=yr(),Cre=(e,t,r)=>{try{t=new Are(t,r)}catch{return!1}return t.test(e)};dk.exports=Cre});var pk=S((Tye,hk)=>{var Nre=yr(),$re=(e,t)=>new Nre(e,t).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));hk.exports=$re});var gk=S((Oye,mk)=>{var xre=Pt(),kre=yr(),Lre=(e,t,r)=>{let n=null,s=null,i=null;try{i=new kre(t,r)}catch{return null}return e.forEach(o=>{i.test(o)&&(!n||s.compare(o)===-1)&&(n=o,s=new xre(n,r))}),n};mk.exports=Lre});var _k=S((Pye,yk)=>{var Dre=Pt(),qre=yr(),Mre=(e,t,r)=>{let n=null,s=null,i=null;try{i=new qre(t,r)}catch{return null}return e.forEach(o=>{i.test(o)&&(!n||s.compare(o)===1)&&(n=o,s=new Dre(n,r))}),n};yk.exports=Mre});var vk=S((Iye,Sk)=>{var ob=Pt(),jre=yr(),bk=Bl(),Fre=(e,t)=>{e=new jre(e,t);let r=new ob("0.0.0");if(e.test(r)||(r=new ob("0.0.0-0"),e.test(r)))return r;r=null;for(let n=0;n<e.set.length;++n){let s=e.set[n],i=null;s.forEach(o=>{let a=new ob(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||bk(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!r||bk(r,i))&&(r=i)}return r&&e.test(r)?r:null};Sk.exports=Fre});var wk=S((Aye,Ek)=>{var Vre=yr(),Ure=(e,t)=>{try{return new Vre(e,t).range||"*"}catch{return null}};Ek.exports=Ure});var $d=S((Cye,Pk)=>{var Hre=Pt(),Ok=zl(),{ANY:Bre}=Ok,zre=yr(),Gre=Wl(),Rk=Bl(),Tk=Pd(),Wre=Ad(),Kre=Id(),Jre=(e,t,r,n)=>{e=new Hre(e,n),t=new zre(t,n);let s,i,o,a,l;switch(r){case">":s=Rk,i=Wre,o=Tk,a=">",l=">=";break;case"<":s=Tk,i=Kre,o=Rk,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Gre(e,t,n))return!1;for(let c=0;c<t.set.length;++c){let u=t.set[c],f=null,p=null;if(u.forEach(d=>{d.semver===Bre&&(d=new Ok(">=0.0.0")),f=f||d,p=p||d,s(d.semver,f.semver,n)?f=d:o(d.semver,p.semver,n)&&(p=d)}),f.operator===a||f.operator===l||(!p.operator||p.operator===a)&&i(e,p.semver))return!1;if(p.operator===l&&o(e,p.semver))return!1}return!0};Pk.exports=Jre});var Ak=S((Nye,Ik)=>{var Yre=$d(),Xre=(e,t,r)=>Yre(e,t,">",r);Ik.exports=Xre});var Nk=S(($ye,Ck)=>{var Zre=$d(),Qre=(e,t,r)=>Zre(e,t,"<",r);Ck.exports=Qre});var kk=S((xye,xk)=>{var $k=yr(),ene=(e,t,r)=>(e=new $k(e,r),t=new $k(t,r),e.intersects(t,r));xk.exports=ene});var Dk=S((kye,Lk)=>{var tne=Wl(),rne=gr();Lk.exports=(e,t,r)=>{let n=[],s=null,i=null,o=e.sort((u,f)=>rne(u,f,r));for(let u of o)tne(u,t,r)?(i=u,s||(s=u)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let a=[];for(let[u,f]of n)u===f?a.push(u):!f&&u===o[0]?a.push("*"):f?u===o[0]?a.push(`<=${f}`):a.push(`${u} - ${f}`):a.push(`>=${u}`);let l=a.join(" || "),c=typeof t.raw=="string"?t.raw:String(t);return l.length<c.length?l:t}});var Uk=S((Lye,Vk)=>{var qk=yr(),lb=zl(),{ANY:ab}=lb,Kl=Wl(),cb=gr(),nne=(e,t,r={})=>{if(e===t)return!0;e=new qk(e,r),t=new qk(t,r);let n=!1;e:for(let s of e.set){for(let i of t.set){let o=ine(s,i,r);if(n=n||o!==null,o)continue e}if(n)return!1}return!0},sne=[new lb(">=0.0.0-0")],Mk=[new lb(">=0.0.0")],ine=(e,t,r)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===ab){if(t.length===1&&t[0].semver===ab)return!0;r.includePrerelease?e=sne:e=Mk}if(t.length===1&&t[0].semver===ab){if(r.includePrerelease)return!0;t=Mk}let n=new Set,s,i;for(let d of e)d.operator===">"||d.operator===">="?s=jk(s,d,r):d.operator==="<"||d.operator==="<="?i=Fk(i,d,r):n.add(d.semver);if(n.size>1)return null;let o;if(s&&i){if(o=cb(s.semver,i.semver,r),o>0)return null;if(o===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let d of n){if(s&&!Kl(d,String(s),r)||i&&!Kl(d,String(i),r))return null;for(let h of t)if(!Kl(d,String(h),r))return!1;return!0}let a,l,c,u,f=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,p=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&i.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let d of t){if(u=u||d.operator===">"||d.operator===">=",c=c||d.operator==="<"||d.operator==="<=",s){if(p&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===p.major&&d.semver.minor===p.minor&&d.semver.patch===p.patch&&(p=!1),d.operator===">"||d.operator===">="){if(a=jk(s,d,r),a===d&&a!==s)return!1}else if(s.operator===">="&&!Kl(s.semver,String(d),r))return!1}if(i){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(l=Fk(i,d,r),l===d&&l!==i)return!1}else if(i.operator==="<="&&!Kl(i.semver,String(d),r))return!1}if(!d.operator&&(i||s)&&o!==0)return!1}return!(s&&c&&!i&&o!==0||i&&u&&!s&&o!==0||p||f)},jk=(e,t,r)=>{if(!e)return t;let n=cb(e.semver,t.semver,r);return n>0?e:n<0||t.operator===">"&&e.operator===">="?t:e},Fk=(e,t,r)=>{if(!e)return t;let n=cb(e.semver,t.semver,r);return n<0?e:n>0||t.operator==="<"&&e.operator==="<="?t:e};Vk.exports=nne});var Gk=S((Dye,zk)=>{var ub=xo(),Hk=Ul(),one=Pt(),Bk=J0(),ane=ci(),lne=gx(),cne=_x(),une=vx(),fne=Rx(),dne=Ox(),hne=Ix(),pne=Cx(),mne=$x(),gne=gr(),yne=Dx(),_ne=Mx(),bne=Od(),Sne=Ux(),vne=Bx(),Ene=Bl(),wne=Pd(),Rne=X0(),Tne=Z0(),One=Id(),Pne=Ad(),Ine=Q0(),Ane=Qx(),Cne=zl(),Nne=yr(),$ne=Wl(),xne=pk(),kne=gk(),Lne=_k(),Dne=vk(),qne=wk(),Mne=$d(),jne=Ak(),Fne=Nk(),Vne=kk(),Une=Dk(),Hne=Uk();zk.exports={parse:ane,valid:lne,clean:cne,inc:une,diff:fne,major:dne,minor:hne,patch:pne,prerelease:mne,compare:gne,rcompare:yne,compareLoose:_ne,compareBuild:bne,sort:Sne,rsort:vne,gt:Ene,lt:wne,eq:Rne,neq:Tne,gte:One,lte:Pne,cmp:Ine,coerce:Ane,Comparator:Cne,Range:Nne,satisfies:$ne,toComparators:xne,maxSatisfying:kne,minSatisfying:Lne,minVersion:Dne,validRange:qne,outside:Mne,gtr:jne,ltr:Fne,intersects:Vne,simplifyRange:Une,subset:Hne,SemVer:one,re:ub.re,src:ub.src,tokens:ub.t,SEMVER_SPEC_VERSION:Hk.SEMVER_SPEC_VERSION,RELEASE_TYPES:Hk.RELEASE_TYPES,compareIdentifiers:Bk.compareIdentifiers,rcompareIdentifiers:Bk.rcompareIdentifiers}});var gb=S((qye,mb)=>{"use strict";var fb=Gk(),hb=require("node:assert"),pb=Symbol.for("registered-plugin"),{kTestInternals:Bne}=at(),{exist:zne,existReply:Gne,existRequest:Wne}=Kg(),{FST_ERR_PLUGIN_VERSION_MISMATCH:Kne,FST_ERR_PLUGIN_NOT_PRESENT_IN_INSTANCE:Jne,FST_ERR_PLUGIN_INVALID_ASYNC_HANDLER:Yne}=pt(),Xne=/-(?:rc|pre|alpha).+$/u;function Jl(e){return e[Symbol.for("plugin-meta")]}function Wk(e){let t=Kk(e);if(t)return t;let r=require.cache;if(r){let n=Object.keys(r);for(let s=0;s<n.length;s++){let i=n[s];if(r[i].exports===e)return i}}return e.name?e.name:null}function Zne(e){return e.toString().split(`
`,2).map(t=>t.trim()).join(" -- ")}function Kk(e){return e[Symbol.for("fastify.display-name")]}function Jk(e){return!!e[Symbol.for("skip-override")]}function Yk(e){let t=Jl(e);if(!t)return;let r=t.dependencies;r&&(hb(Array.isArray(r),"The dependencies should be an array of strings"),r.forEach(n=>{hb(this[pb].indexOf(n)>-1,`The dependency '${n}' of plugin '${t.name}' is not registered`)}))}function Xk(e){let t=Jl(e);if(!t)return;let{decorators:r,name:n}=t;r&&(r.fastify&&db(this,"Fastify",r.fastify,n),r.reply&&db(this,"Reply",r.reply,n),r.request&&db(this,"Request",r.request,n))}var Qne={Fastify:zne,Request:Wne,Reply:Gne};function db(e,t,r,n){hb(Array.isArray(r),"The decorators should be an array of strings"),r.forEach(s=>{let i=typeof n=="string"?` required by '${n}'`:"";if(!Qne[t].call(e,s))throw new Jne(s,i,t)})}function ese(e){let t=Jl(e);if(t?.fastify==null)return;let r=t.fastify,n=Xne.test(this.version);if(!(n===!0&&fb.gt(this.version,fb.coerce(r))===!0)&&r&&fb.satisfies(this.version,r,{includePrerelease:n})===!1)throw new Kne(t.name,r,this.version)}function tse(e){let t=Jl(e);if(!t)return;let r=t.name;if(r)return this[pb].push(r),r}function rse(e,t){if(e.constructor.name==="AsyncFunction"&&e.length===3)throw new Yne(t)}function nse(e){let t=tse.call(this,e)||Wk(e);return rse.call(this,e,t),ese.call(this,e),Xk.call(this,e),Yk.call(this,e),Jk(e)}mb.exports={getPluginName:Wk,getFuncPreview:Zne,kRegisteredPlugins:pb,getDisplayName:Kk,registerPlugin:nse};mb.exports[Bne]={shouldSkipOverride:Jk,getMeta:Jl,checkDecorators:Xk,checkDependencies:Yk}});var xd=S((Mye,Zk)=>{"use strict";function sse(e,t){let r=t||ose();return e?ase(e,r):r}function ise(e,t){return e.genReqId(t)}function ose(){let t=0;return function(){return t=t+1&2147483647,`req-${t.toString(36)}`}}function ase(e,t){return function(r){return r.headers[e]||t(r)}}Zk.exports={getGenReqId:ise,reqIdGenFactory:sse}});var rL=S((jye,tL)=>{"use strict";var Qk=12,lse=0,yb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7];function cse(e){var t=e.indexOf("%");if(t===-1)return e;for(var r=e.length,n="",s=0,i=0,o=t,a=Qk;t>-1&&t<r;){var l=eL(e[t+1],4),c=eL(e[t+2],0),u=l|c,f=yb[u];if(a=yb[256+a+f],i=i<<6|u&yb[364+f],a===Qk)n+=e.slice(s,o),n+=i<=65535?String.fromCharCode(i):String.fromCharCode(55232+(i>>10),56320+(i&1023)),i=0,s=t+3,t=o=e.indexOf("%",s);else{if(a===lse)return null;if(t+=3,t<r&&e.charCodeAt(t)===37)continue;return null}}return n+e.slice(s)}var use={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};function eL(e,t){var r=use[e];return r===void 0?255:r<<t}tL.exports=cse});var aL=S((Fye,oL)=>{"use strict";var nL=rL(),sL=/\+/g,iL=function(){};iL.prototype=Object.create(null);function fse(e){let t=new iL;if(typeof e!="string")return t;let r=e.length,n="",s="",i=-1,o=-1,a=!1,l=!1,c=!1,u=!1,f=!1,p=0;for(let d=0;d<r+1;d++)if(p=d!==r?e.charCodeAt(d):38,p===38){if(f=o>i,f||(o=d),n=e.slice(i+1,o),f||n.length>0){c&&(n=n.replace(sL," ")),a&&(n=nL(n)||n),f&&(s=e.slice(o+1,d),u&&(s=s.replace(sL," ")),l&&(s=nL(s)||s));let h=t[n];h===void 0?t[n]=s:h.pop?h.push(s):t[n]=[h,s]}s="",i=d,o=d,a=!1,l=!1,c=!1,u=!1}else p===61?o<=i?o=d:l=!0:p===43?o>i?u=!0:c=!0:p===37&&(o>i?l=!0:a=!0);return t}oL.exports=fse});var cL=S((Vye,lL)=>{var Qr=Array.from({length:256},(e,t)=>"%"+((t<16?"0":"")+t.toString(16)).toUpperCase()),dse=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);function hse(e){let t=e.length;if(t===0)return"";let r="",n=0,s=0;e:for(;s<t;s++){let i=e.charCodeAt(s);for(;i<128;){if(dse[i]!==1&&(n<s&&(r+=e.slice(n,s)),n=s+1,r+=Qr[i]),++s===t)break e;i=e.charCodeAt(s)}if(n<s&&(r+=e.slice(n,s)),i<2048){n=s+1,r+=Qr[192|i>>6]+Qr[128|i&63];continue}if(i<55296||i>=57344){n=s+1,r+=Qr[224|i>>12]+Qr[128|i>>6&63]+Qr[128|i&63];continue}if(++s,s>=t)throw new Error("URI malformed");let o=e.charCodeAt(s)&1023;n=s+1,i=65536+((i&1023)<<10|o),r+=Qr[240|i>>18]+Qr[128|i>>12&63]+Qr[128|i>>6&63]+Qr[128|i&63]}return n===0?e:n<t?r+e.slice(n):r}lL.exports={encodeString:hse}});var dL=S((Uye,fL)=>{"use strict";var{encodeString:_b}=cL();function uL(e){let t=typeof e;return t==="string"?_b(e):t==="bigint"?e.toString():t==="boolean"?e?"true":"false":t==="number"&&Number.isFinite(e)?e<1e21?""+e:_b(""+e):""}function pse(e){let t="";if(e===null||typeof e!="object")return t;let r="&",n=Object.keys(e),s=n.length,i=0;for(let o=0;o<s;o++){let a=n[o],l=e[a],c=_b(a)+"=";if(o&&(t+=r),Array.isArray(l)){i=l.length;for(let u=0;u<i;u++)u&&(t+=r),t+=c,t+=uL(l[u])}else t+=c,t+=uL(l)}return t}fL.exports=pse});var gL=S((Hye,Yl)=>{"use strict";var hL=aL(),pL=dL(),mL={parse:hL,stringify:pL};Yl.exports=mL;Yl.exports.default=mL;Yl.exports.parse=hL;Yl.exports.stringify=pL});var _L=S(yL=>{"use strict";Object.defineProperty(yL,"__esModule",{value:!0})});var bL=S(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});Xl.types=void 0;var mse;(function(e){e[e.ROOT=0]="ROOT",e[e.GROUP=1]="GROUP",e[e.POSITION=2]="POSITION",e[e.SET=3]="SET",e[e.RANGE=4]="RANGE",e[e.REPETITION=5]="REPETITION",e[e.REFERENCE=6]="REFERENCE",e[e.CHAR=7]="CHAR"})(mse=Xl.types||(Xl.types={}))});var vL=S(SL=>{"use strict";Object.defineProperty(SL,"__esModule",{value:!0})});var $n=S(Nn=>{"use strict";var gse=Nn&&Nn.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),bb=Nn&&Nn.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&gse(t,e,r)};Object.defineProperty(Nn,"__esModule",{value:!0});bb(_L(),Nn);bb(bL(),Nn);bb(vL(),Nn)});var kd=S(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.anyChar=It.notWhitespace=It.whitespace=It.notInts=It.ints=It.notWords=It.words=void 0;var he=$n(),EL=()=>[{type:he.types.RANGE,from:48,to:57}],wL=()=>[{type:he.types.CHAR,value:95},{type:he.types.RANGE,from:97,to:122},{type:he.types.RANGE,from:65,to:90},{type:he.types.RANGE,from:48,to:57}],RL=()=>[{type:he.types.CHAR,value:9},{type:he.types.CHAR,value:10},{type:he.types.CHAR,value:11},{type:he.types.CHAR,value:12},{type:he.types.CHAR,value:13},{type:he.types.CHAR,value:32},{type:he.types.CHAR,value:160},{type:he.types.CHAR,value:5760},{type:he.types.RANGE,from:8192,to:8202},{type:he.types.CHAR,value:8232},{type:he.types.CHAR,value:8233},{type:he.types.CHAR,value:8239},{type:he.types.CHAR,value:8287},{type:he.types.CHAR,value:12288},{type:he.types.CHAR,value:65279}],yse=()=>[{type:he.types.CHAR,value:10},{type:he.types.CHAR,value:13},{type:he.types.CHAR,value:8232},{type:he.types.CHAR,value:8233}];It.words=()=>({type:he.types.SET,set:wL(),not:!1});It.notWords=()=>({type:he.types.SET,set:wL(),not:!0});It.ints=()=>({type:he.types.SET,set:EL(),not:!1});It.notInts=()=>({type:he.types.SET,set:EL(),not:!0});It.whitespace=()=>({type:he.types.SET,set:RL(),not:!1});It.notWhitespace=()=>({type:he.types.SET,set:RL(),not:!0});It.anyChar=()=>({type:he.types.SET,set:yse(),not:!0})});var OL=S(_r=>{"use strict";var _se=_r&&_r.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),bse=_r&&_r.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Sse=_r&&_r.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&_se(t,e,r);return bse(t,e),t};Object.defineProperty(_r,"__esModule",{value:!0});_r.tokenizeClass=_r.strToChars=void 0;var TL=$n(),Lo=Sse(kd()),vse="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?";_r.strToChars=e=>{let t=/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g;return e.replace(t,(r,n,s,i,o,a,l)=>{if(s)return r;let c=n?8:i?parseInt(i,16):o?parseInt(o,16):a?vse.indexOf(a):{0:0,t:9,n:10,v:11,f:12,r:13}[l],u=String.fromCharCode(c);return/[[\]{}^$.|?*+()]/.test(u)?`\\${u}`:u})};_r.tokenizeClass=(e,t)=>{var r,n,s,i,o,a,l;let c=[],u,f,p=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;(u=p.exec(e))!==null;){let d=(l=(a=(o=(i=(s=(n=(r=u[1]&&Lo.words())!==null&&r!==void 0?r:u[2]&&Lo.ints())!==null&&n!==void 0?n:u[3]&&Lo.whitespace())!==null&&s!==void 0?s:u[4]&&Lo.notWords())!==null&&i!==void 0?i:u[5]&&Lo.notInts())!==null&&o!==void 0?o:u[6]&&Lo.notWhitespace())!==null&&a!==void 0?a:u[7]&&{type:TL.types.RANGE,from:(u[8]||u[9]).charCodeAt(0),to:(f=u[10]).charCodeAt(f.length-1)})!==null&&l!==void 0?l:(f=u[16])&&{type:TL.types.CHAR,value:f.charCodeAt(0)};if(d)c.push(d);else return[c,p.lastIndex]}throw new SyntaxError(`Invalid regular expression: /${t}/: Unterminated character class`)}});var Sb=S(en=>{"use strict";var Ese=en&&en.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),wse=en&&en.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),AL=en&&en.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Ese(t,e,r);return wse(t,e),t};Object.defineProperty(en,"__esModule",{value:!0});en.tokenizer=void 0;var PL=AL(OL()),_t=$n(),ui=AL(kd()),Rse=/^[a-zA-Z_$]$/i,Tse=/^[a-zA-Z0-9_$]$/i,IL=/\d/;en.tokenizer=e=>{let t=0,r,n={type:_t.types.ROOT,stack:[]},s=n,i=n.stack,o=[],a=[],l=0,c=f=>{throw new SyntaxError(`Invalid regular expression: /${e}/: Nothing to repeat at column ${f-1}`)},u=PL.strToChars(e);for(;t<u.length;)switch(r=u[t++]){case"\\":if(t===u.length)throw new SyntaxError(`Invalid regular expression: /${e}/: \\ at end of pattern`);switch(r=u[t++]){case"b":i.push({type:_t.types.POSITION,value:"b"});break;case"B":i.push({type:_t.types.POSITION,value:"B"});break;case"w":i.push(ui.words());break;case"W":i.push(ui.notWords());break;case"d":i.push(ui.ints());break;case"D":i.push(ui.notInts());break;case"s":i.push(ui.whitespace());break;case"S":i.push(ui.notWhitespace());break;default:if(IL.test(r)){let f=r;for(;t<u.length&&IL.test(u[t]);)f+=u[t++];let p=parseInt(f,10),d={type:_t.types.REFERENCE,value:p};i.push(d),a.push({reference:d,stack:i,index:i.length-1})}else i.push({type:_t.types.CHAR,value:r.charCodeAt(0)})}break;case"^":i.push({type:_t.types.POSITION,value:"^"});break;case"$":i.push({type:_t.types.POSITION,value:"$"});break;case"[":{let f;u[t]==="^"?(f=!0,t++):f=!1;let p=PL.tokenizeClass(u.slice(t),e);t+=p[1],i.push({type:_t.types.SET,set:p[0],not:f});break}case".":i.push(ui.anyChar());break;case"(":{let f={type:_t.types.GROUP,stack:[],remember:!0};if(u[t]==="?")if(r=u[t+1],t+=2,r==="=")f.followedBy=!0,f.remember=!1;else if(r==="!")f.notFollowedBy=!0,f.remember=!1;else if(r==="<"){let p="";if(Rse.test(u[t]))p+=u[t],t++;else throw new SyntaxError(`Invalid regular expression: /${e}/: Invalid capture group name, character '${u[t]}' after '<' at column ${t+1}`);for(;t<u.length&&Tse.test(u[t]);)p+=u[t],t++;if(!p)throw new SyntaxError(`Invalid regular expression: /${e}/: Invalid capture group name, character '${u[t]}' after '<' at column ${t+1}`);if(u[t]!==">")throw new SyntaxError(`Invalid regular expression: /${e}/: Unclosed capture group name, expected '>', found '${u[t]}' at column ${t+1}`);f.name=p,t++}else if(r===":")f.remember=!1;else throw new SyntaxError(`Invalid regular expression: /${e}/: Invalid group, character '${r}' after '?' at column ${t-1}`);else l+=1;i.push(f),o.push(s),s=f,i=f.stack;break}case")":if(o.length===0)throw new SyntaxError(`Invalid regular expression: /${e}/: Unmatched ) at column ${t-1}`);s=o.pop(),i=s.options?s.options[s.options.length-1]:s.stack;break;case"|":{s.options||(s.options=[s.stack],delete s.stack);let f=[];s.options.push(f),i=f;break}case"{":{let f=/^(\d+)(,(\d+)?)?\}/.exec(u.slice(t)),p,d;f!==null?(i.length===0&&c(t),p=parseInt(f[1],10),d=f[2]?f[3]?parseInt(f[3],10):1/0:p,t+=f[0].length,i.push({type:_t.types.REPETITION,min:p,max:d,value:i.pop()})):i.push({type:_t.types.CHAR,value:123});break}case"?":i.length===0&&c(t),i.push({type:_t.types.REPETITION,min:0,max:1,value:i.pop()});break;case"+":i.length===0&&c(t),i.push({type:_t.types.REPETITION,min:1,max:1/0,value:i.pop()});break;case"*":i.length===0&&c(t),i.push({type:_t.types.REPETITION,min:0,max:1/0,value:i.pop()});break;default:i.push({type:_t.types.CHAR,value:r.charCodeAt(0)})}if(o.length!==0)throw new SyntaxError(`Invalid regular expression: /${e}/: Unterminated group`);return Ose(a,l),n};function Ose(e,t){for(let r of e.reverse())if(t<r.reference.value){r.reference.type=_t.types.CHAR;let n=r.reference.value.toString();if(r.reference.value=parseInt(n,8),!/^[0-7]+$/.test(n)){let s=0;for(;n[s]!=="8"&&n[s]!=="9";)s+=1;if(s===0?(r.reference.value=n.charCodeAt(0),s+=1):r.reference.value=parseInt(n.slice(0,s),8),n.length>s){let i=r.stack.splice(r.index+1);for(let o of n.slice(s))r.stack.push({type:_t.types.CHAR,value:o.charCodeAt(0)});r.stack.push(...i)}}}}});var NL=S(At=>{"use strict";var Pse=At&&At.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ise=At&&At.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ase=At&&At.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Pse(t,e,r);return Ise(t,e),t};Object.defineProperty(At,"__esModule",{value:!0});At.NOTANYCHAR=At.WHITESPACE=At.WORDS=At.INTS=void 0;var Ld=Ase(kd()),CL=$n();function Dd(e){let t={},r=0;for(let n of e)n.type===CL.types.CHAR&&(t[n.value]=!0),n.type===CL.types.RANGE&&(t[`${n.from}-${n.to}`]=!0),r+=1;return{lookup:()=>Object.assign({},t),len:r}}At.INTS=Dd(Ld.ints().set);At.WORDS=Dd(Ld.words().set);At.WHITESPACE=Dd(Ld.whitespace().set);At.NOTANYCHAR=Dd(Ld.anyChar().set)});var xL=S(br=>{"use strict";var Cse=br&&br.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Nse=br&&br.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),$se=br&&br.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Cse(t,e,r);return Nse(t,e),t};Object.defineProperty(br,"__esModule",{value:!0});br.writeSetTokens=br.setChar=void 0;var Fd=$n(),qd=$se(NL());function jd(e){return e===94?"\\^":e===92?"\\\\":e===93?"\\]":e===45?"\\-":String.fromCharCode(e)}br.setChar=jd;function Md(e,{lookup:t,len:r}){if(r!==e.length)return!1;let n=t();for(let s of e){if(s.type===Fd.types.SET)return!1;let i=s.type===Fd.types.CHAR?s.value:`${s.from}-${s.to}`;if(n[i])n[i]=!1;else return!1}return!0}function $L(e,t=!1){if(Md(e.set,qd.INTS))return e.not?"\\D":"\\d";if(Md(e.set,qd.WORDS))return e.not?"\\W":"\\w";if(e.not&&Md(e.set,qd.NOTANYCHAR))return".";if(Md(e.set,qd.WHITESPACE))return e.not?"\\S":"\\s";let r="";for(let s=0;s<e.set.length;s++){let i=e.set[s];r+=xse(i)}let n=`${e.not?"^":""}${r}`;return t?n:`[${n}]`}br.writeSetTokens=$L;function xse(e){return e.type===Fd.types.CHAR?jd(e.value):e.type===Fd.types.RANGE?`${jd(e.from)}-${jd(e.to)}`:$L(e,!0)}});var Eb=S(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.reconstruct=void 0;var ps=$n(),vb=xL(),kL=e=>e.map(Do.reconstruct).join(""),LL=e=>{if("options"in e)return e.options.map(kL).join("|");if("stack"in e)return kL(e.stack);throw new Error("options or stack must be Root or Group token")};Do.reconstruct=e=>{switch(e.type){case ps.types.ROOT:return LL(e);case ps.types.CHAR:{let t=String.fromCharCode(e.value);return(/[[\\{}$^.|?*+()]/.test(t)?"\\":"")+t}case ps.types.POSITION:return e.value==="^"||e.value==="$"?e.value:`\\${e.value}`;case ps.types.REFERENCE:return`\\${e.value}`;case ps.types.SET:return vb.writeSetTokens(e);case ps.types.GROUP:return`(${e.name?`?<${e.name}>`:e.remember?"":e.followedBy?"?=":e.notFollowedBy?"?!":"?:"}${LL(e)})`;case ps.types.REPETITION:{let{min:t,max:r}=e,n;return t===0&&r===1?n="?":t===1&&r===1/0?n="+":t===0&&r===1/0?n="*":r===1/0?n=`{${t},}`:t===r?n=`{${t}}`:n=`{${t},${r}}`,`${Do.reconstruct(e.value)}${n}`}case ps.types.RANGE:return`${vb.setChar(e.from)}-${vb.setChar(e.to)}`;default:throw new Error(`Invalid token type ${e}`)}}});var ML=S((Sr,Vd)=>{"use strict";var kse=Sr&&Sr.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),wb=Sr&&Sr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&kse(t,e,r)};Object.defineProperty(Sr,"__esModule",{value:!0});Sr.types=void 0;var DL=$n();Object.defineProperty(Sr,"types",{enumerable:!0,get:function(){return DL.types}});wb(Sb(),Sr);wb(Eb(),Sr);var qL=Sb(),Lse=Eb();wb($n(),Sr);Sr.default=qL.tokenizer;Vd.exports=qL.tokenizer;Vd.exports.types=DL.types;Vd.exports.reconstruct=Lse.reconstruct});var FL=S((e_e,Ud)=>{"use strict";var jL=ML(),Dse=jL.types;function Rb(e,t){t||(t={});let r=t.limit===void 0?25:t.limit;qse(e)?e=e.source:typeof e!="string"&&(e=String(e));try{e=jL(e)}catch{return!1}let n=0;return function s(i,o){let a,l,c;if(i.type===Dse.REPETITION&&(o++,n++,o>1||n>r))return!1;if(i.options){for(a=0,c=i.options.length;a<c;a++)if(l=s({stack:i.options[a]},o),!l)return!1}let u=i.stack||i.value?.stack;if(!u)return!0;for(a=0;a<u.length;a++)if(l=s(u[a],o),!l)return!1;return!0}(e,0)}function qse(e){return{}.toString.call(e)==="[object RegExp]"}Ud.exports=Rb;Ud.exports.default=Rb;Ud.exports.safeRegex=Rb});var Hd=S((t_e,VL)=>{"use strict";VL.exports={name:"__fmw_internal_strategy_merged_tree_http_method__",storage:function(){let e=new Map;return{get:t=>e.get(t)||null,set:(t,r)=>{e.set(t,r)}}},deriveConstraint:e=>e.method,mustMatchWhenDerived:!0}});var KL=S((r_e,WL)=>{"use strict";var UL=fl(),HL=Hd(),BL=Symbol("treeData");function zL(e,t=""){let r="",n=Object.keys(e);for(let s=0;s<n.length;s++){let i=n[s],o=e[i],a=s===n.length-1,l=a?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ",c=a?"    ":"\u2502   ",f=(o[BL]||"").replaceAll(`
`,`
`+t+c);r+=t+l+i+f+`
`,r+=zL(o,t+c)}return r}function Mse(e){let t=e.name||"";return t=t.replace("bound","").trim(),t=(t||"anonymous")+"()",t}function GL(e){return Array.isArray(e)?e.map(t=>GL(t)):typeof e=="symbol"?e.toString():typeof e=="function"?Mse(e):e}function jse(e,t){if(!t.includeMeta)return{};let r=t.buildPrettyMeta(e),n={},s=t.includeMeta;Array.isArray(s)||(s=Reflect.ownKeys(r));for(let i of s){if(!Object.prototype.hasOwnProperty.call(r,i))continue;let o=i.toString(),a=r[i];if(a!=null){let l=JSON.stringify(GL(a));n[o]=l}}return n}function Fse(e){let t="";for(let[r,n]of Object.entries(e))t+=`
\u2022 (${r}) ${n}`;return t}function Vse(e){let t={...e.opts.constraints},r=t[HL.name];return delete t[HL.name],{...e,method:r,opts:{constraints:t}}}function Use(e){let t=` (${e.method})`,r=e.opts.constraints||{};return Object.keys(r).length!==0&&(t+=" "+JSON.stringify(r)),t+=Fse(e.metaData),t}function Hse(e){return e.reduce((t,r)=>{for(let n of t)if(UL(r.opts.constraints,n.opts.constraints)&&UL(r.metaData,n.metaData))return n.method+=", "+r.method,t;return t.push(r),t},[])}function Bse(e,t,r){let n=e.routes;return r.method===void 0&&(n=n.map(Vse)),n=n.map(s=>(s.metaData=jse(s,r),s)),r.method===void 0&&(n=Hse(n)),n.map(Use).join(`
${t}`)}function Bd(e,t,r,n){if((e.isLeafNode||n.commonPrefix!==!1)&&(r=r||"(empty root node)",t=t[r]={},e.isLeafNode&&(t[BL]=Bse(e,r,n)),r=""),e.staticChildren)for(let s of Object.values(e.staticChildren))Bd(s,t,r+s.prefix,n);if(e.parametricChildren)for(let s of Object.values(e.parametricChildren)){let i=Array.from(s.nodePaths).join("|");Bd(s,t,r+i,n)}e.wildcardChild&&Bd(e.wildcardChild,t,"*",n)}function zse(e,t){let r={};return Bd(e,r,e.prefix,t),zL(r)}WL.exports={prettyPrintTree:zse}});var XL=S((n_e,YL)=>{"use strict";var JL=function(){};JL.prototype=Object.create(null);YL.exports={NullObject:JL}});var QL=S((s_e,ZL)=>{"use strict";var{NullObject:Gse}=XL(),Wse=Hd(),Tb=class{constructor(){this.unconstrainedHandler=null,this.constraints=[],this.handlers=[],this.constrainedHandlerStores=null}getMatchingHandler(t){return t===void 0?this.unconstrainedHandler:this._getHandlerMatchingConstraints(t)}addHandler(t,r){let n=r.params,s=r.opts.constraints||{},i={params:n,constraints:s,handler:r.handler,store:r.store||null,_createParamsObject:this._compileCreateParamsObject(n)},o=Object.keys(s);o.length===0&&(this.unconstrainedHandler=i);for(let l of o)this.constraints.includes(l)||(l==="version"?this.constraints.unshift(l):this.constraints.push(l));let a=o.includes(Wse.name);if(!a&&this.handlers.length>=31)throw new Error("find-my-way supports a maximum of 31 route handlers per node when there are constraints, limit reached");this.handlers.push(i),this.handlers.sort((l,c)=>Object.keys(l.constraints).length-Object.keys(c.constraints).length),a||this._compileGetHandlerMatchingConstraints(t,s)}_compileCreateParamsObject(t){let r=[];r.push("const fn = function _createParamsObject (paramsArray) {"),r.push("const params = new NullObject()");for(let n=0;n<t.length;n++)r.push(`params['${t[n]}'] = paramsArray[${n}]`);return r.push("return params"),r.push("}"),r.push("return fn"),new Function("NullObject",r.join(`
`))(Gse)}_getHandlerMatchingConstraints(){return null}_buildConstraintStore(t,r){for(let n=0;n<this.handlers.length;n++){let i=this.handlers[n].constraints[r];if(i!==void 0){let o=t.get(i)||0;o|=1<<n,t.set(i,o)}}}_constrainedIndexBitmask(t){let r=0;for(let n=0;n<this.handlers.length;n++)this.handlers[n].constraints[t]!==void 0&&(r|=1<<n);return~r}_compileGetHandlerMatchingConstraints(t){this.constrainedHandlerStores={};for(let n of this.constraints){let s=t.newStoreForConstraint(n);this.constrainedHandlerStores[n]=s,this._buildConstraintStore(s,n)}let r=[];r.push(`
    let candidates = ${(1<<this.handlers.length)-1}
    let mask, matches
    `);for(let n of this.constraints){r.push(`
      mask = ${this._constrainedIndexBitmask(n)}
      value = derivedConstraints.${n}
      `);let i=t.strategies[n].mustMatchWhenDerived?"matches":"(matches | mask)";r.push(`
      if (value === undefined) {
        candidates &= mask
      } else {
        matches = this.constrainedHandlerStores.${n}.get(value) || 0
        candidates &= ${i}
      }
      if (candidates === 0) return null;
      `)}for(let n in t.strategies)t.strategies[n].mustMatchWhenDerived&&!this.constraints.includes(n)&&r.push(`if (derivedConstraints.${n} !== undefined) return null`);r.push("return this.handlers[Math.floor(Math.log2(candidates))]"),this._getHandlerMatchingConstraints=new Function("derivedConstraints",r.join(`
`))}};ZL.exports=Tb});var tD=S((i_e,eD)=>{"use strict";var Kse=QL(),Yd={STATIC:0,PARAMETRIC:1,WILDCARD:2},zd=class{constructor(){this.isLeafNode=!1,this.routes=null,this.handlerStorage=null}addRoute(t,r){this.routes===null&&(this.routes=[]),this.handlerStorage===null&&(this.handlerStorage=new Kse),this.isLeafNode=!0,this.routes.push(t),this.handlerStorage.addHandler(r,t)}},Gd=class extends zd{constructor(){super(),this.staticChildren={}}findStaticMatchingChild(t,r){let n=this.staticChildren[t.charAt(r)];return n===void 0||!n.matchPrefix(t,r)?null:n}getStaticChild(t,r=0){if(t.length===r)return this;let n=this.findStaticMatchingChild(t,r);return n?n.getStaticChild(t,r+n.prefix.length):null}createStaticChild(t){if(t.length===0)return this;let r=this.staticChildren[t.charAt(0)];if(r){let s=1;for(;s<r.prefix.length;s++)if(t.charCodeAt(s)!==r.prefix.charCodeAt(s)){r=r.split(this,s);break}return r.createStaticChild(t.slice(s))}let n=t.charAt(0);return this.staticChildren[n]=new Wd(t),this.staticChildren[n]}},Wd=class e extends Gd{constructor(t){super(),this.prefix=t,this.wildcardChild=null,this.parametricChildren=[],this.kind=Yd.STATIC,this._compilePrefixMatch()}getParametricChild(t){let r=t&&t.source,n=this.parametricChildren.find(s=>(s.regex&&s.regex.source)===r);return n||null}createParametricChild(t,r,n){let s=this.getParametricChild(t);return s?(s.nodePaths.add(n),s):(s=new Kd(t,r,n),this.parametricChildren.push(s),this.parametricChildren.sort((i,o)=>i.isRegex?o.isRegex?i.staticSuffix===null?1:o.staticSuffix===null?-1:o.staticSuffix.endsWith(i.staticSuffix)?1:i.staticSuffix.endsWith(o.staticSuffix)?-1:0:-1:1),s)}getWildcardChild(){return this.wildcardChild}createWildcardChild(){return this.wildcardChild=this.getWildcardChild()||new Jd,this.wildcardChild}split(t,r){let n=this.prefix.slice(0,r),s=this.prefix.slice(r);this.prefix=s,this._compilePrefixMatch();let i=new e(n);return i.staticChildren[s.charAt(0)]=this,t.staticChildren[n.charAt(0)]=i,i}getNextNode(t,r,n,s){let i=this.findStaticMatchingChild(t,r),o=0;if(i===null){if(this.parametricChildren.length===0)return this.wildcardChild;i=this.parametricChildren[0],o=1}this.wildcardChild!==null&&n.push({paramsCount:s,brotherPathIndex:r,brotherNode:this.wildcardChild});for(let a=this.parametricChildren.length-1;a>=o;a--)n.push({paramsCount:s,brotherPathIndex:r,brotherNode:this.parametricChildren[a]});return i}_compilePrefixMatch(){if(this.prefix.length===1){this.matchPrefix=()=>!0;return}let t=[];for(let r=1;r<this.prefix.length;r++){let n=this.prefix.charCodeAt(r);t.push(`path.charCodeAt(i + ${r}) === ${n}`)}this.matchPrefix=new Function("path","i",`return ${t.join(" && ")}`)}},Kd=class extends Gd{constructor(t,r,n){super(),this.isRegex=!!t,this.regex=t||null,this.staticSuffix=r||null,this.kind=Yd.PARAMETRIC,this.nodePaths=new Set([n])}getNextNode(t,r){return this.findStaticMatchingChild(t,r)}},Jd=class extends zd{constructor(){super(),this.kind=Yd.WILDCARD}getNextNode(){return null}};eD.exports={StaticNode:Wd,ParametricNode:Kd,WildcardNode:Jd,NODE_TYPES:Yd}});var nD=S((o_e,rD)=>{"use strict";var Jse=require("node:assert");function Zl(){if(!(this instanceof Zl))return new Zl;this.store=new Map,this.maxMajor=0,this.maxMinors={},this.maxPatches={}}Zl.prototype.set=function(e,t){if(typeof e!="string")throw new TypeError("Version should be a string");let[r,n,s]=e.split(".",3);if(isNaN(r))throw new TypeError("Major version must be a numeric value");return r=Number(r),n=Number(n)||0,s=Number(s)||0,r>=this.maxMajor&&(this.maxMajor=r,this.store.set("x",t),this.store.set("*",t),this.store.set("x.x",t),this.store.set("x.x.x",t)),n>=(this.maxMinors[r]||0)&&(this.maxMinors[r]=n,this.store.set(`${r}.x`,t),this.store.set(`${r}.x.x`,t)),s>=(this.maxPatches[`${r}.${n}`]||0)&&(this.maxPatches[`${r}.${n}`]=s,this.store.set(`${r}.${n}.x`,t)),this.store.set(`${r}.${n}.${s}`,t),this};Zl.prototype.get=function(e){return this.store.get(e)};rD.exports={name:"version",mustMatchWhenDerived:!0,storage:Zl,validate(e){Jse(typeof e=="string","Version should be a string")}}});var iD=S((a_e,sD)=>{"use strict";var Yse=require("node:assert");function Xse(){let e=new Map,t=[];return{get:r=>{let n=e.get(r);if(n)return n;for(let s of t)if(s.host.test(r))return s.value},set:(r,n)=>{r instanceof RegExp?t.push({host:r,value:n}):e.set(r,n)}}}sD.exports={name:"host",mustMatchWhenDerived:!1,storage:Xse,validate(e){Yse(typeof e=="string"||Object.prototype.toString.call(e)==="[object RegExp]","Host should be a string or a RegExp")}}});var aD=S((l_e,oD)=>{"use strict";var Zse=nD(),Qse=iD(),Ob=require("node:assert"),Pb=class{constructor(t){if(this.strategies={version:Zse,host:Qse},this.strategiesInUse=new Set,this.asyncStrategiesInUse=new Set,t)for(let r of Object.values(t))this.addConstraintStrategy(r)}isStrategyUsed(t){return this.strategiesInUse.has(t)||this.asyncStrategiesInUse.has(t)}hasConstraintStrategy(t){let r=this.strategies[t];return r!==void 0?r.isCustom||this.isStrategyUsed(t):!1}addConstraintStrategy(t){if(Ob(typeof t.name=="string"&&t.name!=="","strategy.name is required."),Ob(t.storage&&typeof t.storage=="function","strategy.storage function is required."),Ob(t.deriveConstraint&&typeof t.deriveConstraint=="function","strategy.deriveConstraint function is required."),this.strategies[t.name]&&this.strategies[t.name].isCustom)throw new Error(`There already exists a custom constraint with the name ${t.name}.`);if(this.isStrategyUsed(t.name))throw new Error(`There already exists a route with ${t.name} constraint.`);t.isCustom=!0,t.isAsync=t.deriveConstraint.length===3,this.strategies[t.name]=t,t.mustMatchWhenDerived&&this.noteUsage({[t.name]:t})}deriveConstraints(t,r,n){let s=this.deriveSyncConstraints(t,r);if(n===void 0)return s;this.deriveAsyncConstraints(s,t,r,n)}deriveSyncConstraints(t,r){}noteUsage(t){if(t){let r=this.strategiesInUse.size;for(let n in t)this.strategies[n].isAsync?this.asyncStrategiesInUse.add(n):this.strategiesInUse.add(n);r!==this.strategiesInUse.size&&this._buildDeriveConstraints()}}newStoreForConstraint(t){if(!this.strategies[t])throw new Error(`No strategy registered for constraint key ${t}`);return this.strategies[t].storage()}validateConstraints(t){for(let r in t){let n=t[r];if(typeof n>"u")throw new Error("Can't pass an undefined constraint value, must pass null or no key at all");let s=this.strategies[r];if(!s)throw new Error(`No strategy registered for constraint key ${r}`);s.validate&&s.validate(n)}}deriveAsyncConstraints(t,r,n,s){let i=this.asyncStrategiesInUse.size;if(i===0){s(null,t);return}t=t||{};for(let o of this.asyncStrategiesInUse)this.strategies[o].deriveConstraint(r,n,(l,c)=>{if(l!==null){s(l);return}t[o]=c,--i===0&&s(null,t)})}_buildDeriveConstraints(){if(this.strategiesInUse.size===0)return;let t=["return {"];for(let r of this.strategiesInUse){let n=this.strategies[r];n.isCustom?t.push(`  ${n.name}: this.strategies.${r}.deriveConstraint(req, ctx),`):r==="version"?t.push("   version: req.headers['accept-version'],"):t.push("   host: req.headers.host || req.headers[':authority'],")}t.push("}"),this.deriveSyncConstraints=new Function("req","ctx",t.join(`
`)).bind(this)}};oD.exports=Pb});var cD=S((c_e,lD)=>{"use strict";var eie=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","QUERY","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"];lD.exports=eie});var dD=S((u_e,fD)=>{"use strict";function uD(e,t){return e===50?t===53?"%":t===51?"#":t===52?"$":t===54?"&":t===66||t===98?"+":t===67||t===99?",":t===70||t===102?"/":null:e===51?t===65||t===97?":":t===66||t===98?";":t===68||t===100?"=":t===70||t===102?"?":null:e===52&&t===48?"@":null}function tie(e,t){let r=!1,n=!1,s="";for(let o=1;o<e.length;o++){let a=e.charCodeAt(o);if(a===37){let l=e.charCodeAt(o+1),c=e.charCodeAt(o+2);uD(l,c)===null?r=!0:(n=!0,l===50&&c===53&&(r=!0,e=e.slice(0,o+1)+"25"+e.slice(o+1),o+=2),o+=2)}else if(a===63||a===35||a===59&&t){s=e.slice(o+1),e=e.slice(0,o);break}}return{path:r?decodeURI(e):e,querystring:s,shouldDecodeParam:n}}function rie(e){let t=e.indexOf("%");if(t===-1)return e;let r="",n=t;for(let s=t;s<e.length;s++)if(e.charCodeAt(s)===37){let i=e.charCodeAt(s+1),o=e.charCodeAt(s+2),a=uD(i,o);r+=e.slice(n,s)+a,n=s+3}return e.slice(0,t)+r+e.slice(n)}fD.exports={safeDecodeURI:tie,safeDecodeURIComponent:rie}});var $b=S((f_e,ED)=>{"use strict";var Ke=require("node:assert"),nie=gL(),Mo=FL(),Ab=fl(),{prettyPrintTree:sie}=KL(),{StaticNode:hD,NODE_TYPES:pD}=tD(),iie=aD(),qo=cD(),Ib=Hd(),{safeDecodeURI:oie,safeDecodeURIComponent:mD}=dD(),gD=/^https?:\/\/.*?\//,fi=/(\/:[^/()]*?)\?(\/?)/,yD=/[.*+?^${}()|[\]\\]/g,_D=/\/\/+/g;if(!Mo(gD))throw new Error("the FULL_PATH_REGEXP is not safe, update this module");if(!Mo(fi))throw new Error("the OPTIONAL_PARAM_REGEXP is not safe, update this module");if(!Mo(yD))throw new Error("the ESCAPE_REGEXP is not safe, update this module");if(!Mo(_D))throw new Error("the REMOVE_DUPLICATE_SLASHES_REGEXP is not safe, update this module");function Ue(e){if(!(this instanceof Ue))return new Ue(e);e=e||{},this._opts=e,e.defaultRoute?(Ke(typeof e.defaultRoute=="function","The default route must be a function"),this.defaultRoute=e.defaultRoute):this.defaultRoute=null,e.onBadUrl?(Ke(typeof e.onBadUrl=="function","The bad url handler must be a function"),this.onBadUrl=e.onBadUrl):this.onBadUrl=null,e.buildPrettyMeta?(Ke(typeof e.buildPrettyMeta=="function","buildPrettyMeta must be a function"),this.buildPrettyMeta=e.buildPrettyMeta):this.buildPrettyMeta=aie,e.querystringParser?(Ke(typeof e.querystringParser=="function","querystringParser must be a function"),this.querystringParser=e.querystringParser):this.querystringParser=t=>t.length===0?{}:nie.parse(t),this.caseSensitive=e.caseSensitive===void 0?!0:e.caseSensitive,this.ignoreTrailingSlash=e.ignoreTrailingSlash||!1,this.ignoreDuplicateSlashes=e.ignoreDuplicateSlashes||!1,this.maxParamLength=e.maxParamLength||100,this.allowUnsafeRegex=e.allowUnsafeRegex||!1,this.constrainer=new iie(e.constraints),this.useSemicolonDelimiter=e.useSemicolonDelimiter||!1,this.routes=[],this.trees={}}Ue.prototype.on=function(t,r,n,s,i){typeof n=="function"&&(s!==void 0&&(i=s),s=n,n={}),Ke(typeof r=="string","Path should be a string"),Ke(r.length>0,"The path could not be empty"),Ke(r[0]==="/"||r[0]==="*","The first character of a path should be `/` or `*`"),Ke(typeof s=="function","Handler should be a function");let o=r.match(fi);if(o){Ke(r.length===o.index+o[0].length,"Optional Parameter needs to be the last parameter of the path");let c=r.replace(fi,"$1$2"),u=r.replace(fi,"$2")||"/";this.on(t,c,n,s,i),this.on(t,u,n,s,i);return}let a=r;this.ignoreDuplicateSlashes&&(r=Cb(r)),this.ignoreTrailingSlash&&(r=Nb(r));let l=Array.isArray(t)?t:[t];for(let c of l)Ke(typeof c=="string","Method should be a string"),Ke(qo.includes(c),`Method '${c}' is not an http method.`),this._on(c,r,n,s,i,a)};Ue.prototype._on=function(t,r,n,s,i){let o={};n.constraints!==void 0&&(Ke(typeof n.constraints=="object"&&n.constraints!==null,"Constraints should be an object"),Object.keys(n.constraints).length!==0&&(o=n.constraints)),this.constrainer.validateConstraints(o),this.constrainer.noteUsage(o),this.trees[t]===void 0&&(this.trees[t]=new hD("/"));let a=r;if(a==="*"&&this.trees[t].prefix.length!==0){let p=this.trees[t];this.trees[t]=new hD(""),this.trees[t].staticChildren["/"]=p}let l=this.trees[t],c=l.prefix.length,u=[];for(let p=0;p<=a.length;p++){if(a.charCodeAt(p)===58&&a.charCodeAt(p+1)===58){p++;continue}let d=a.charCodeAt(p)===58&&a.charCodeAt(p+1)!==58,h=a.charCodeAt(p)===42;if(d||h||p===a.length&&p!==c){let m=a.slice(c,p);this.caseSensitive||(m=m.toLowerCase()),m=m.replaceAll("::",":"),m=m.replaceAll("%","%25"),l=l.createStaticChild(m)}if(d){let m=!1,y=!0,b="",v=[],_=p+1;for(let g=_;;g++){let T=a.charCodeAt(g),R=T===40,w=T===45||T===46,P=T===47||g===a.length;if(R||w||P){let O=a.slice(_,g);if(u.push(O),m=m||R||w,R){let C=vD(a,g),N=a.slice(g,C+1);this.allowUnsafeRegex||Ke(Mo(new RegExp(N)),`The regex '${N}' is not safe!`),v.push(SD(N)),g=C+1,y=!0}else v.push(y?"(.*?)":`(${b}|(?:(?!${b}).)*)`),y=!1;let A=g;for(;g<a.length;g++){let C=a.charCodeAt(g);if(C===47)break;if(C===58)if(a.charCodeAt(g+1)===58)g++;else break}let q=a.slice(A,g);if(q&&(q=q.replaceAll("::",":"),q=q.replaceAll("%","%25"),v.push(b=bD(q))),_=g+1,P||a.charCodeAt(g)===47||g===a.length){let C=m?"()"+q:q,N=a.slice(p,g);a=a.slice(0,p+1)+C+a.slice(g),p+=C.length;let B=m?new RegExp("^"+v.join("")+"$"):null;l=l.createParametricChild(B,q||null,N),c=p+1;break}}}}else if(h&&(u.push("*"),l=l.createWildcardChild(),c=p+1,p!==a.length-1))throw new Error("Wildcard must be the last character in the route")}this.caseSensitive||(a=a.toLowerCase()),a==="*"&&(a="/*");for(let p of this.routes){let d=p.opts.constraints||{};if(p.method===t&&p.pattern===a&&Ab(d,o))throw new Error(`Method '${t}' already declared for route '${a}' with constraints '${JSON.stringify(o)}'`)}let f={method:t,path:r,pattern:a,params:u,opts:n,handler:s,store:i};this.routes.push(f),l.addRoute(f,this.constrainer)};Ue.prototype.hasRoute=function(t,r,n){return this.findRoute(t,r,n)!==null};Ue.prototype.findRoute=function(t,r,n={}){if(this.trees[t]===void 0)return null;let s=r,i=this.trees[t],o=i.prefix.length,a=[];for(let l=0;l<=s.length;l++){if(s.charCodeAt(l)===58&&s.charCodeAt(l+1)===58){l++;continue}let c=s.charCodeAt(l)===58&&s.charCodeAt(l+1)!==58,u=s.charCodeAt(l)===42;if(c||u||l===s.length&&l!==o){let f=s.slice(o,l);if(this.caseSensitive||(f=f.toLowerCase()),f=f.replaceAll("::",":"),f=f.replaceAll("%","%25"),i=i.getStaticChild(f),i===null)return null}if(c){let f=!1,p=!0,d="",h=[],m=l+1;for(let y=m;;y++){let b=s.charCodeAt(y),v=b===40,_=b===45||b===46,g=b===47||y===s.length;if(v||_||g){let T=s.slice(m,y);if(a.push(T),f=f||v||_,v){let P=vD(s,y),O=s.slice(y,P+1);this.allowUnsafeRegex||Ke(Mo(new RegExp(O)),`The regex '${O}' is not safe!`),h.push(SD(O)),y=P+1,p=!1}else h.push(p?"(.*?)":`(${d}|(?:(?!${d}).)*)`),p=!1;let R=y;for(;y<s.length;y++){let P=s.charCodeAt(y);if(P===47)break;if(P===58)if(s.charCodeAt(y+1)===58)y++;else break}let w=s.slice(R,y);if(w&&(w=w.replaceAll("::",":"),w=w.replaceAll("%","%25"),h.push(d=bD(w))),m=y+1,g||s.charCodeAt(y)===47||y===s.length){let P=f?"()"+w:w,O=s.slice(l,y);s=s.slice(0,l+1)+P+s.slice(y),l+=P.length;let A=f?new RegExp("^"+h.join("")+"$"):null;if(i=i.getParametricChild(A,w||null,O),i===null)return null;o=l+1;break}}}}else if(u&&(a.push("*"),i=i.getWildcardChild(),o=l+1,l!==s.length-1))throw new Error("Wildcard must be the last character in the route")}this.caseSensitive||(s=s.toLowerCase());for(let l of this.routes){let c=l.opts.constraints||{};if(l.method===t&&l.pattern===s&&Ab(c,n))return{handler:l.handler,store:l.store,params:l.params}}return null};Ue.prototype.hasConstraintStrategy=function(e){return this.constrainer.hasConstraintStrategy(e)};Ue.prototype.addConstraintStrategy=function(e){this.constrainer.addConstraintStrategy(e),this._rebuild(this.routes)};Ue.prototype.reset=function(){this.trees={},this.routes=[]};Ue.prototype.off=function(t,r,n){Ke(typeof r=="string","Path should be a string"),Ke(r.length>0,"The path could not be empty"),Ke(r[0]==="/"||r[0]==="*","The first character of a path should be `/` or `*`"),Ke(typeof n>"u"||typeof n=="object"&&!Array.isArray(n)&&n!==null,"Constraints should be an object or undefined.");let s=r.match(fi);if(s){Ke(r.length===s.index+s[0].length,"Optional Parameter needs to be the last parameter of the path");let o=r.replace(fi,"$1$2"),a=r.replace(fi,"$2");this.off(t,o,n),this.off(t,a,n);return}this.ignoreDuplicateSlashes&&(r=Cb(r)),this.ignoreTrailingSlash&&(r=Nb(r));let i=Array.isArray(t)?t:[t];for(let o of i)this._off(o,r,n)};Ue.prototype._off=function(t,r,n){Ke(typeof t=="string","Method should be a string"),Ke(qo.includes(t),`Method '${t}' is not an http method.`);function s(l){return t!==l.method||r!==l.path}function i(l){return s(l)||!Ab(n,l.opts.constraints||{})}let o=n?i:s,a=this.routes.filter(o);this._rebuild(a)};Ue.prototype.lookup=function(t,r,n,s){if(typeof n=="function"&&(s=n,n=void 0),s===void 0){let i=this.constrainer.deriveConstraints(t,n),o=this.find(t.method,t.url,i);return this.callHandler(o,t,r,n)}this.constrainer.deriveConstraints(t,n,(i,o)=>{if(i!==null){s(i);return}try{let a=this.find(t.method,t.url,o),l=this.callHandler(a,t,r,n);s(null,l)}catch(a){s(a)}})};Ue.prototype.callHandler=function(t,r,n,s){return t===null?this._defaultRoute(r,n,s):s===void 0?t.handler(r,n,t.params,t.store,t.searchParams):t.handler.call(s,r,n,t.params,t.store,t.searchParams)};Ue.prototype.find=function(t,r,n){let s=this.trees[t];if(s===void 0)return null;r.charCodeAt(0)!==47&&(r=r.replace(gD,"/")),this.ignoreDuplicateSlashes&&(r=Cb(r));let i,o,a;try{i=oie(r,this.useSemicolonDelimiter),r=i.path,o=i.querystring,a=i.shouldDecodeParam}catch{return this._onBadUrl(r)}this.ignoreTrailingSlash&&(r=Nb(r));let l=r;this.caseSensitive===!1&&(r=r.toLowerCase());let c=this.maxParamLength,u=s.prefix.length,f=[],p=r.length,d=[];for(;;){if(u===p&&s.isLeafNode){let b=s.handlerStorage.getMatchingHandler(n);if(b!==null)return{handler:b.handler,store:b.store,params:b._createParamsObject(f),searchParams:this.querystringParser(o)}}let h=s.getNextNode(r,u,d,f.length);if(h===null){if(d.length===0)return null;let b=d.pop();u=b.brotherPathIndex,f.splice(b.paramsCount),h=b.brotherNode}if(s=h,s.kind===pD.STATIC){u+=s.prefix.length;continue}if(s.kind===pD.WILDCARD){let b=l.slice(u);a&&(b=mD(b)),f.push(b),u=p;continue}let m=l.indexOf("/",u);m===-1&&(m=p);let y=l.slice(u,m);if(a&&(y=mD(y)),s.isRegex){let b=s.regex.exec(y);if(b===null)continue;for(let v=1;v<b.length;v++){let _=b[v];if(_.length>c)return null;f.push(_)}}else{if(y.length>c)return null;f.push(y)}u=m}};Ue.prototype._rebuild=function(e){this.reset();for(let t of e){let{method:r,path:n,opts:s,handler:i,store:o}=t;this._on(r,n,s,i,o)}};Ue.prototype._defaultRoute=function(e,t,r){if(this.defaultRoute!==null)return r===void 0?this.defaultRoute(e,t):this.defaultRoute.call(r,e,t);t.statusCode=404,t.end()};Ue.prototype._onBadUrl=function(e){if(this.onBadUrl===null)return null;let t=this.onBadUrl;return{handler:(r,n,s)=>t(e,r,n),params:{},store:null}};Ue.prototype.prettyPrint=function(e={}){let t=e.method;e.buildPrettyMeta=this.buildPrettyMeta.bind(this);let r=null;if(t===void 0){let{version:n,host:s,...i}=this.constrainer.strategies;i[Ib.name]=Ib;let o=new Ue({...this._opts,constraints:i}),a=this.routes.map(l=>{let c={...l.opts.constraints,[Ib.name]:l.method};return{...l,method:"MERGED",opts:{constraints:c}}});o._rebuild(a),r=o.trees.MERGED}else r=this.trees[t];return r==null?"(empty tree)":sie(r,e)};for(let e in qo){if(!qo.hasOwnProperty(e))continue;let t=qo[e],r=t.toLowerCase();Ue.prototype[r]=function(n,s,i){return this.on(t,n,s,i)}}Ue.prototype.all=function(e,t,r){this.on(qo,e,t,r)};ED.exports=Ue;function bD(e){return e.replace(yD,"\\$&")}function Cb(e){return e.indexOf("//")!==-1?e.replace(_D,"/"):e}function Nb(e){return e.length>1&&e.charCodeAt(e.length-1)===47?e.slice(0,-1):e}function SD(e){return e.charCodeAt(1)===94&&(e=e.slice(0,1)+e.slice(2)),e.charCodeAt(e.length-2)===36&&(e=e.slice(0,e.length-2)+e.slice(e.length-1)),e}function vD(e,t){let r=1;for(;t<e.length;){if(t++,e.charCodeAt(t)===92){t++;continue}if(e.charCodeAt(t)===41?r--:e.charCodeAt(t)===40&&r++,!r)return t}throw new TypeError('Invalid regexp expression in "'+e+'"')}function aie(e){return e?e.store?Object.assign({},e.store):{}:{}}});var RD=S((d_e,wD)=>{"use strict";function xb(e,t,r,n){if(r===void 0){t.header("content-length","0"),n(null,null);return}if(typeof r.resume=="function"){r.on("error",i=>{t.log.error({err:i},"Error on Stream found for HEAD route")}),r.resume(),n(null,null);return}let s=""+Buffer.byteLength(r);t.header("content-length",s),n(null,null)}function lie(e){return e==null?xb:Array.isArray(e)?[...e,xb]:[e,xb]}wD.exports={parseHeadOnSendHandlers:lie}});var FD=S((h_e,jD)=>{"use strict";var cie=$b(),uie=wf(),TD=Nm(),{onRequestAbortHookRunner:fie,lifecycleHooks:OD,preParsingHookRunner:die,onTimeoutHookRunner:hie,onRequestHookRunner:pie}=Yn(),{normalizeSchema:mie}=Ja(),{parseHeadOnSendHandlers:gie}=RD(),{compileSchemasForValidation:yie,compileSchemasForSerialization:_ie}=Om(),{FST_ERR_SCH_VALIDATION_BUILD:bie,FST_ERR_SCH_SERIALIZATION_BUILD:Sie,FST_ERR_DUPLICATED_ROUTE:vie,FST_ERR_INVALID_URL:Eie,FST_ERR_HOOK_INVALID_HANDLER:PD,FST_ERR_ROUTE_OPTIONS_NOT_OBJ:wie,FST_ERR_ROUTE_DUPLICATED_HANDLER:Rie,FST_ERR_ROUTE_HANDLER_NOT_FN:ID,FST_ERR_ROUTE_MISSING_HANDLER:Tie,FST_ERR_ROUTE_METHOD_NOT_SUPPORTED:Oie,FST_ERR_ROUTE_METHOD_INVALID:Pie,FST_ERR_ROUTE_BODY_VALIDATION_SCHEMA_NOT_SUPPORTED:Iie,FST_ERR_ROUTE_BODY_LIMIT_OPTION_NOT_INT:Aie,FST_ERR_HOOK_INVALID_ASYNC_HANDLER:kb}=pt(),{kRoutePrefix:Cie,kSupportedHTTPMethods:qb,kLogLevel:Nie,kLogSerializers:AD,kHooks:CD,kSchemaController:$ie,kOptions:ND,kReplySerializerDefault:Lb,kReplyIsError:xie,kRequestPayloadStream:kie,kDisableRequestLogging:Lie,kSchemaErrorFormatter:Die,kErrorHandler:$D,kHasBeenDecorated:xD,kRequestAcceptVersion:Db,kRouteByFastify:qie,kRouteContext:kD}=at(),{buildErrorHandler:Mie}=Ya(),{createChildLogger:jie}=Ka(),{getGenReqId:Fie}=xd();function Vie(e){let t=cie(e.config),r,n,s,i,o,a,l,c,u,f,p,d,h=!1;return{setup(w,P){r=P.avvio,n=P.fourOhFour,s=P.logger,i=P.hasLogger,o=P.setupResponseListeners,a=P.throwIfAlreadyStarted,p=w.exposeHeadRoutes,l=w.disableRequestLogging,c=w.ignoreTrailingSlash,u=w.ignoreDuplicateSlashes,f=Object.hasOwn(w,"return503OnClosing")?w.return503OnClosing:!0,d=P.keepAliveConnections},routing:t.lookup.bind(t),route:T,hasRoute:_,prepareRoute:v,routeHandler:R,closeRoutes:()=>{h=!0},printRoutes:t.prettyPrint.bind(t),addConstraintStrategy:m,hasConstraintStrategy:y,isAsyncConstraint:b,findRoute:g};function m(w){return a("Cannot add constraint strategy!"),t.addConstraintStrategy(w)}function y(w){return t.hasConstraintStrategy(w)}function b(){return t.constrainer.asyncStrategiesInUse.size>0}function v({method:w,url:P,options:O,handler:A,isFastify:q}){if(typeof P!="string")throw new Eie(typeof P);if(!A&&typeof O=="function")A=O,O={};else if(A&&typeof A=="function"){if(Object.prototype.toString.call(O)!=="[object Object]")throw new wie(w,P);if(O.handler)throw typeof O.handler=="function"?new Rie(w,P):new ID(w,P)}return O=Object.assign({},O,{method:w,url:P,path:P,handler:A||O&&O.handler}),T.call(this,{options:O,isFastify:q})}function _({options:w}){let P=w.method?.toUpperCase()??"";return t.hasRoute(P,w.url||"",w.constraints)}function g(w){let P=t.find(w.method,w.url||"",w.constraints);return P?{handler:P.handler,params:P.params,searchParams:P.searchParams}:null}function T({options:w,isFastify:P}){a("Cannot add route!");let O={...w},A=O.url||O.path||"";if(!O.handler)throw new Tie(O.method,A);if(O.errorHandler!==void 0&&typeof O.errorHandler!="function")throw new ID(O.method,A);MD(O.bodyLimit);let q=O.exposeHeadRoute??p,C=!1,N=!1;if(Array.isArray(O.method))for(let K=0;K<O.method.length;++K)O.method[K]=LD.call(this,O.method[K]),DD.call(this,O.method[K],A,O.schema),C=O.method.includes("GET"),N=O.method.includes("HEAD");else O.method=LD.call(this,O.method),DD.call(this,O.method,A,O.schema),C=O.method==="GET",N=O.method==="HEAD";let B=q&&C?{...w}:null,se=this[Cie];if(A==="/"&&se.length>0&&O.method!=="HEAD")switch(O.prefixTrailingSlash){case"slash":D.call(this,{path:A,isFastify:P});break;case"no-slash":D.call(this,{path:"",isFastify:P});break;case"both":default:D.call(this,{path:"",isFastify:P}),c!==!0&&(u!==!0||!se.endsWith("/"))&&D.call(this,{path:A,prefixing:!0,isFastify:P})}else A[0]==="/"&&se.endsWith("/")?D.call(this,{path:A.slice(1),isFastify:P}):D.call(this,{path:A,isFastify:P});return this;function D({path:K,prefixing:ut=!1,isFastify:U=!1}){let it=se+K;if(O.url=it,O.path=it,O.routePath=K,O.prefix=se,O.logLevel=O.logLevel||this[Nie],(this[AD]||O.logSerializers)&&(O.logSerializers=Object.assign(Object.create(this[AD]),O.logSerializers)),O.attachValidation==null&&(O.attachValidation=!1),ut===!1)for(let me of this[CD].onRoute)me.call(this,O);for(let me of OD)if(O&&me in O){if(Array.isArray(O[me]))for(let je of O[me]){if(typeof je!="function")throw new PD(me,Object.prototype.toString.call(je));if(me==="onSend"||me==="preSerialization"||me==="onError"||me==="preParsing"){if(je.constructor.name==="AsyncFunction"&&je.length===4)throw new kb}else if(me==="onRequestAbort"){if(je.constructor.name==="AsyncFunction"&&je.length!==1)throw new kb}else if(je.constructor.name==="AsyncFunction"&&je.length===3)throw new kb}else if(O[me]!==void 0&&typeof O[me]!="function")throw new PD(me,Object.prototype.toString.call(O[me]))}let Vn=O.constraints||{},ve={...O.config,url:it,method:O.method},pe=new uie({schema:O.schema,handler:O.handler.bind(this),config:ve,errorHandler:O.errorHandler,childLoggerFactory:O.childLoggerFactory,bodyLimit:O.bodyLimit,logLevel:O.logLevel,logSerializers:O.logSerializers,attachValidation:O.attachValidation,schemaErrorFormatter:O.schemaErrorFormatter,replySerializer:this[Lb],validatorCompiler:O.validatorCompiler,serializerCompiler:O.serializerCompiler,exposeHeadRoute:q,prefixTrailingSlash:O.prefixTrailingSlash||"both",server:this,isFastify:U}),Qe=t.findRoute("HEAD",O.url,Vn)!==null;try{t.on(O.method,O.url,{constraints:Vn},R,pe)}catch(me){if(!pe[qie])throw me.message.includes(`Method '${O.method}' already declared for route`)?new vie(O.method,O.url):me}if(this.after((me,je)=>{pe.errorHandler=O.errorHandler?Mie(this[$D],O.errorHandler):this[$D],pe._parserOptions.limit=O.bodyLimit||null,pe.logLevel=O.logLevel,pe.logSerializers=O.logSerializers,pe.attachValidation=O.attachValidation,pe[Lb]=this[Lb],pe.schemaErrorFormatter=O.schemaErrorFormatter||this[Die]||pe.schemaErrorFormatter,r.once("preReady",()=>{for(let Q of OD){let Ft=this[CD][Q].concat(O[Q]||[]).map(pa=>pa.bind(this));pe[Q]=Ft.length?Ft:null}for(;!pe.Request[xD]&&pe.Request.parent;)pe.Request=pe.Request.parent;for(;!pe.Reply[xD]&&pe.Reply.parent;)pe.Reply=pe.Reply.parent;if(n.setContext(this,pe),O.schema){pe.schema=mie(pe.schema,this.initialConfig);let Q=this[$ie];!O.validatorCompiler&&(O.schema.body||O.schema.headers||O.schema.querystring||O.schema.params)&&Q.setupValidator(this[ND]);try{let Ft=typeof O?.validatorCompiler=="function"||Q.isCustomValidatorCompiler;yie(pe,O.validatorCompiler||Q.validatorCompiler,Ft)}catch(Ft){throw new bie(O.method,it,Ft.message)}O.schema.response&&!O.serializerCompiler&&Q.setupSerializer(this[ND]);try{_ie(pe,O.serializerCompiler||Q.serializerCompiler)}catch(Ft){throw new Sie(O.method,it,Ft.message)}}}),je(me)}),q&&C&&!N&&!Qe){let me=gie(B.onSend);v.call(this,{method:"HEAD",url:K,options:{...B,onSend:me},isFastify:!0})}}}function R(w,P,O,A,q){let C=Fie(A.server,w),N={level:A.logLevel};A.logSerializers&&(N.serializers=A.logSerializers);let B=jie(A,s,w,C,N);if(B[Lie]=l,h===!0&&(w.httpVersionMajor!==2&&P.setHeader("Connection","close"),f)){let ut={"Content-Type":"application/json","Content-Length":"80"};P.writeHead(503,ut),P.end('{"error":"Service Unavailable","message":"Service Unavailable","statusCode":503}'),B.info({res:{statusCode:503}},"request aborted - refusing to accept new requests as server is closing");return}String.prototype.toLowerCase.call(w.headers.connection||"")==="keep-alive"&&d.has(w.socket)===!1&&(d.add(w.socket),w.socket.on("close",Bie.bind({keepAliveConnections:d,socket:w.socket}))),w.headers[Db]!==void 0&&(w.headers["accept-version"]=w.headers[Db],w.headers[Db]=void 0);let D=new A.Request(C,O,w,q,B,A),K=new A.Reply(P,D,B);l===!1&&B.info({req:D},"incoming request"),(i===!0||A.onResponse!==null)&&o(K),A.onRequest!==null?pie(A.onRequest,D,K,qD):qD(null,D,K),A.onRequestAbort!==null&&w.on("close",()=>{w.aborted&&fie(A.onRequestAbort,D,Uie.bind(null,K))}),A.onTimeout!==null&&(D.raw.socket._meta||D.raw.socket.on("timeout",Hie),D.raw.socket._meta={context:A,request:D,reply:K})}}function Uie(e,t){t&&e.log.error({err:t},"onRequestAborted hook failed")}function Hie(){let{context:e,request:t,reply:r}=this._meta;hie(e.onTimeout,t,r,zie)}function LD(e){if(typeof e!="string")throw new Pie;if(e=e.toUpperCase(),!this[qb].bodyless.has(e)&&!this[qb].bodywith.has(e))throw new Oie(e);return e}function DD(e,t,r){if(this[qb].bodyless.has(e)&&r?.body)throw new Iie(e,t)}function MD(e){if(e!==void 0&&(!Number.isInteger(e)||e<=0))throw new Aie(e)}function qD(e,t,r){if(r.sent!==!0){if(e!=null){r[xie]=!0,r.send(e);return}t[kie]=t.raw,t[kD].preParsing!==null?die(t[kD].preParsing,t,r,TD.bind(t.server)):TD.call(t.server,null,t,r)}}function Bie(){this.keepAliveConnections.delete(this.socket)}function zie(){}jD.exports={buildRouting:Vie,validateBodyLimitOption:MD}});var WD=S((p_e,GD)=>{"use strict";var Gie=$b(),VD=gf(),UD=Ef(),Wie=wf(),{kRoutePrefix:Kie,kCanSetNotFoundHandler:Ql,kFourOhFourLevelInstance:ec,kFourOhFourContext:tn,kHooks:Jie,kErrorHandler:HD}=at(),{lifecycleHooks:Yie}=Yn(),{buildErrorHandler:Xie}=Ya(),{FST_ERR_NOT_FOUND:Zie}=pt(),{createChildLogger:BD}=Ka(),{getGenReqId:zD}=xd();function Qie(e){let{logger:t,disableRequestLogging:r}=e,n=Gie({onBadUrl:a(),defaultRoute:f}),s=null;return{router:n,setNotFoundHandler:c,setContext:l,arrange404:i};function i(p){p[ec]=p,p[Ql]=!0,n.onBadUrl=n.onBadUrl.bind(p),n.defaultRoute=n.defaultRoute.bind(p)}function o(p,d){let{url:h,method:m}=p.raw,y=`Route ${m}:${h} not found`;r||p.log.info(y),d.code(404).send({message:y,error:"Not Found",statusCode:404})}function a(){return function(d,h,m){let y=this[ec][tn],b=zD(y.server,h),v=BD(y,t,h,b),_=new UD(b,null,h,null,v,y),g=new VD(m,_,v);s(_,g)}}function l(p,d){let h=Object.assign({},p[tn]);h.onSend=d.onSend,d[tn]=h}function c(p,d,h,m){this[Ql]===void 0&&(this[Ql]=!0),this[tn]===void 0&&(this[tn]=null);let y=this,b=this[Kie]||"/";if(this[Ql]===!1)throw new Error(`Not found handler already set for Fastify instance with prefix: '${b}'`);typeof p=="object"&&(p.preHandler&&(Array.isArray(p.preHandler)?p.preHandler=p.preHandler.map(v=>v.bind(y)):p.preHandler=p.preHandler.bind(y)),p.preValidation&&(Array.isArray(p.preValidation)?p.preValidation=p.preValidation.map(v=>v.bind(y)):p.preValidation=p.preValidation.bind(y))),typeof p=="function"&&(d=p,p=void 0),p=p||{},d?(this[ec][Ql]=!1,d=d.bind(this),s=d):(d=o,s=o),this.after((v,_)=>{u.call(this,b,p,d,h,m),_(v)})}function u(p,d,h,m,y){let b=new Wie({schema:d.schema,handler:h,config:d.config||{},server:this});if(m.once("preReady",()=>{let v=this[tn];for(let _ of Yie){let g=this[Jie][_].concat(d[_]||[]).map(T=>T.bind(this));v[_]=g.length?g:null}v.errorHandler=d.errorHandler?Xie(this[HD],d.errorHandler):this[HD]}),this[tn]!==null&&p==="/"){Object.assign(this[tn],b);return}this[ec][tn]=b,n.all(p+(p.endsWith("/")?"*":"/*"),y,b),n.all(p,y,b)}function f(p,d){let h=this[ec][tn],m=zD(h.server,p),y=BD(h,t,p,m);y.info({req:p},"incoming request");let b=new UD(m,null,p,null,y,h),v=new VD(d,b,y);b.log.warn("the default handler for 404 did not catch this, this is likely a fastify bug, please report it"),b.log.warn(n.prettyPrint()),v.code(404).send(new Zie)}}GD.exports=Qie});var KD=S((m_e,Xd)=>{"use strict";Xd.exports=ge;Xd.exports.default=ge;var eoe={type:"object",additionalProperties:!1,properties:{connectionTimeout:{type:"integer",default:0},keepAliveTimeout:{type:"integer",default:72e3},forceCloseConnections:{oneOf:[{type:"string",pattern:"idle"},{type:"boolean"}]},maxRequestsPerSocket:{type:"integer",default:0,nullable:!0},requestTimeout:{type:"integer",default:0},bodyLimit:{type:"integer",default:1048576},caseSensitive:{type:"boolean",default:!0},allowUnsafeRegex:{type:"boolean",default:!1},http2:{type:"boolean"},https:{if:{not:{oneOf:[{type:"boolean"},{type:"null"},{type:"object",additionalProperties:!1,required:["allowHTTP1"],properties:{allowHTTP1:{type:"boolean"}}}]}},then:{setDefaultValue:!0}},ignoreTrailingSlash:{type:"boolean",default:!1},ignoreDuplicateSlashes:{type:"boolean",default:!1},disableRequestLogging:{type:"boolean",default:!1},maxParamLength:{type:"integer",default:100},onProtoPoisoning:{type:"string",default:"error"},onConstructorPoisoning:{type:"string",default:"error"},pluginTimeout:{type:"integer",default:1e4},requestIdHeader:{anyOf:[{type:"boolean"},{type:"string"}],default:!1},requestIdLogLabel:{type:"string",default:"reqId"},http2SessionTimeout:{type:"integer",default:72e3},exposeHeadRoutes:{type:"boolean",default:!0},useSemicolonDelimiter:{type:"boolean",default:!1},constraints:{type:"object",additionalProperties:{type:"object",required:["name","storage","validate","deriveConstraint"],additionalProperties:!0,properties:{name:{type:"string"},storage:{},validate:{},deriveConstraint:{}}}}}},toe=Object.prototype.hasOwnProperty,roe=new RegExp("idle","u");function ge(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:s=e}={}){let i=null,o=0;if(o===0)if(e&&typeof e=="object"&&!Array.isArray(e)){e.connectionTimeout===void 0&&(e.connectionTimeout=0),e.keepAliveTimeout===void 0&&(e.keepAliveTimeout=72e3),e.maxRequestsPerSocket===void 0&&(e.maxRequestsPerSocket=0),e.requestTimeout===void 0&&(e.requestTimeout=0),e.bodyLimit===void 0&&(e.bodyLimit=1048576),e.caseSensitive===void 0&&(e.caseSensitive=!0),e.allowUnsafeRegex===void 0&&(e.allowUnsafeRegex=!1),e.ignoreTrailingSlash===void 0&&(e.ignoreTrailingSlash=!1),e.ignoreDuplicateSlashes===void 0&&(e.ignoreDuplicateSlashes=!1),e.disableRequestLogging===void 0&&(e.disableRequestLogging=!1),e.maxParamLength===void 0&&(e.maxParamLength=100),e.onProtoPoisoning===void 0&&(e.onProtoPoisoning="error"),e.onConstructorPoisoning===void 0&&(e.onConstructorPoisoning="error"),e.pluginTimeout===void 0&&(e.pluginTimeout=1e4),e.requestIdHeader===void 0&&(e.requestIdHeader=!1),e.requestIdLogLabel===void 0&&(e.requestIdLogLabel="reqId"),e.http2SessionTimeout===void 0&&(e.http2SessionTimeout=72e3),e.exposeHeadRoutes===void 0&&(e.exposeHeadRoutes=!0),e.useSemicolonDelimiter===void 0&&(e.useSemicolonDelimiter=!1);let h=o;for(let m in e)toe.call(eoe.properties,m)||delete e[m];if(h===o){let m=e.connectionTimeout,y=o;if(!(typeof m=="number"&&!(m%1)&&!isNaN(m)&&isFinite(m))){let b=typeof m,v;if(v===void 0)if(b==="boolean"||m===null||b==="string"&&m&&m==+m&&!(m%1))v=+m;else return ge.errors=[{instancePath:t+"/connectionTimeout",schemaPath:"#/properties/connectionTimeout/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;v!==void 0&&(m=v,e!==void 0&&(e.connectionTimeout=v))}var a=y===o;if(a){let b=e.keepAliveTimeout,v=o;if(!(typeof b=="number"&&!(b%1)&&!isNaN(b)&&isFinite(b))){let g=typeof b,T;if(T===void 0)if(g==="boolean"||b===null||g==="string"&&b&&b==+b&&!(b%1))T=+b;else return ge.errors=[{instancePath:t+"/keepAliveTimeout",schemaPath:"#/properties/keepAliveTimeout/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;T!==void 0&&(b=T,e!==void 0&&(e.keepAliveTimeout=T))}var a=v===o;if(a){if(e.forceCloseConnections!==void 0){let g=e.forceCloseConnections,T=o,R=o,w=!1,P=null,O=o;if(typeof g!="string"){let C=typeof g,N;if(N===void 0)if(C=="number"||C=="boolean")N=""+g;else if(g===null)N="";else{let B={instancePath:t+"/forceCloseConnections",schemaPath:"#/properties/forceCloseConnections/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[B]:i.push(B),o++}N!==void 0&&(g=N,e!==void 0&&(e.forceCloseConnections=N))}if(o===O&&typeof g=="string"&&!roe.test(g)){let C={instancePath:t+"/forceCloseConnections",schemaPath:"#/properties/forceCloseConnections/oneOf/0/pattern",keyword:"pattern",params:{pattern:"idle"},message:'must match pattern "idle"'};i===null?i=[C]:i.push(C),o++}var l=O===o;l&&(w=!0,P=0);let A=o;if(typeof g!="boolean"){let C;if(C===void 0)if(g==="false"||g===0||g===null)C=!1;else if(g==="true"||g===1)C=!0;else{let N={instancePath:t+"/forceCloseConnections",schemaPath:"#/properties/forceCloseConnections/oneOf/1/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};i===null?i=[N]:i.push(N),o++}C!==void 0&&(g=C,e!==void 0&&(e.forceCloseConnections=C))}var l=A===o;if(l&&w?(w=!1,P=[P,1]):l&&(w=!0,P=1),w)o=R,i!==null&&(R?i.length=R:i=null);else{let C={instancePath:t+"/forceCloseConnections",schemaPath:"#/properties/forceCloseConnections/oneOf",keyword:"oneOf",params:{passingSchemas:P},message:"must match exactly one schema in oneOf"};return i===null?i=[C]:i.push(C),o++,ge.errors=i,!1}var a=T===o}else var a=!0;if(a){let g=e.maxRequestsPerSocket,T=o;if(!(typeof g=="number"&&!(g%1)&&!isNaN(g)&&isFinite(g))&&g!==null){let w=typeof g,P;if(P===void 0)if(w==="boolean"||g===null||w==="string"&&g&&g==+g&&!(g%1))P=+g;else if(g===""||g===0||g===!1)P=null;else return ge.errors=[{instancePath:t+"/maxRequestsPerSocket",schemaPath:"#/properties/maxRequestsPerSocket/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;P!==void 0&&(g=P,e!==void 0&&(e.maxRequestsPerSocket=P))}var a=T===o;if(a){let w=e.requestTimeout,P=o;if(!(typeof w=="number"&&!(w%1)&&!isNaN(w)&&isFinite(w))){let A=typeof w,q;if(q===void 0)if(A==="boolean"||w===null||A==="string"&&w&&w==+w&&!(w%1))q=+w;else return ge.errors=[{instancePath:t+"/requestTimeout",schemaPath:"#/properties/requestTimeout/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;q!==void 0&&(w=q,e!==void 0&&(e.requestTimeout=q))}var a=P===o;if(a){let A=e.bodyLimit,q=o;if(!(typeof A=="number"&&!(A%1)&&!isNaN(A)&&isFinite(A))){let N=typeof A,B;if(B===void 0)if(N==="boolean"||A===null||N==="string"&&A&&A==+A&&!(A%1))B=+A;else return ge.errors=[{instancePath:t+"/bodyLimit",schemaPath:"#/properties/bodyLimit/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;B!==void 0&&(A=B,e!==void 0&&(e.bodyLimit=B))}var a=q===o;if(a){let N=e.caseSensitive,B=o;if(typeof N!="boolean"){let D;if(D===void 0)if(N==="false"||N===0||N===null)D=!1;else if(N==="true"||N===1)D=!0;else return ge.errors=[{instancePath:t+"/caseSensitive",schemaPath:"#/properties/caseSensitive/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;D!==void 0&&(N=D,e!==void 0&&(e.caseSensitive=D))}var a=B===o;if(a){let D=e.allowUnsafeRegex,K=o;if(typeof D!="boolean"){let U;if(U===void 0)if(D==="false"||D===0||D===null)U=!1;else if(D==="true"||D===1)U=!0;else return ge.errors=[{instancePath:t+"/allowUnsafeRegex",schemaPath:"#/properties/allowUnsafeRegex/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;U!==void 0&&(D=U,e!==void 0&&(e.allowUnsafeRegex=U))}var a=K===o;if(a){if(e.http2!==void 0){let U=e.http2,it=o;if(typeof U!="boolean"){let ve;if(ve===void 0)if(U==="false"||U===0||U===null)ve=!1;else if(U==="true"||U===1)ve=!0;else return ge.errors=[{instancePath:t+"/http2",schemaPath:"#/properties/http2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;ve!==void 0&&(U=ve,e!==void 0&&(e.http2=ve))}var a=it===o}else var a=!0;if(a){if(e.https!==void 0){let U=e.https,it=o,Vn=o,ve=!0,pe=o,Ni=o,Qe=o,me=o,je=!1,Q=null,Ft=o;if(typeof U!="boolean"){let I;if(I===void 0)if(U==="false"||U===0||U===null)I=!1;else if(U==="true"||U===1)I=!0;else{let x={};i===null?i=[x]:i.push(x),o++}I!==void 0&&(U=I,e!==void 0&&(e.https=I))}var c=Ft===o;c&&(je=!0,Q=0);let pa=o;if(U!==null){let I;if(I===void 0)if(U===""||U===0||U===!1)I=null;else{let x={};i===null?i=[x]:i.push(x),o++}I!==void 0&&(U=I,e!==void 0&&(e.https=I))}var c=pa===o;if(c&&je)je=!1,Q=[Q,1];else{c&&(je=!0,Q=1);let I=o;if(o===I)if(U&&typeof U=="object"&&!Array.isArray(U)){let M;if(U.allowHTTP1===void 0&&(M="allowHTTP1")){let H={};i===null?i=[H]:i.push(H),o++}else{let H=o;for(let ie in U)ie!=="allowHTTP1"&&delete U[ie];if(H===o&&U.allowHTTP1!==void 0){let ie=U.allowHTTP1;if(typeof ie!="boolean"){let V;if(V===void 0)if(ie==="false"||ie===0||ie===null)V=!1;else if(ie==="true"||ie===1)V=!0;else{let Ie={};i===null?i=[Ie]:i.push(Ie),o++}V!==void 0&&(ie=V,U!==void 0&&(U.allowHTTP1=V))}}}}else{let M={};i===null?i=[M]:i.push(M),o++}var c=I===o;c&&je?(je=!1,Q=[Q,2]):c&&(je=!0,Q=2)}if(je)o=me,i!==null&&(me?i.length=me:i=null);else{let I={};i===null?i=[I]:i.push(I),o++}var u=Qe===o;if(u){let I={};i===null?i=[I]:i.push(I),o++}else o=Ni,i!==null&&(Ni?i.length=Ni:i=null);var f=pe===o;if(o=Vn,i!==null&&(Vn?i.length=Vn:i=null),f){let I=o;e.https=!0;var f=I===o;ve=f}if(!ve){let I={instancePath:t+"/https",schemaPath:"#/properties/https/if",keyword:"if",params:{failingKeyword:"then"},message:'must match "then" schema'};return i===null?i=[I]:i.push(I),o++,ge.errors=i,!1}var a=it===o}else var a=!0;if(a){let U=e.ignoreTrailingSlash,it=o;if(typeof U!="boolean"){let ve;if(ve===void 0)if(U==="false"||U===0||U===null)ve=!1;else if(U==="true"||U===1)ve=!0;else return ge.errors=[{instancePath:t+"/ignoreTrailingSlash",schemaPath:"#/properties/ignoreTrailingSlash/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;ve!==void 0&&(U=ve,e!==void 0&&(e.ignoreTrailingSlash=ve))}var a=it===o;if(a){let ve=e.ignoreDuplicateSlashes,pe=o;if(typeof ve!="boolean"){let Qe;if(Qe===void 0)if(ve==="false"||ve===0||ve===null)Qe=!1;else if(ve==="true"||ve===1)Qe=!0;else return ge.errors=[{instancePath:t+"/ignoreDuplicateSlashes",schemaPath:"#/properties/ignoreDuplicateSlashes/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;Qe!==void 0&&(ve=Qe,e!==void 0&&(e.ignoreDuplicateSlashes=Qe))}var a=pe===o;if(a){let Qe=e.disableRequestLogging,me=o;if(typeof Qe!="boolean"){let Q;if(Q===void 0)if(Qe==="false"||Qe===0||Qe===null)Q=!1;else if(Qe==="true"||Qe===1)Q=!0;else return ge.errors=[{instancePath:t+"/disableRequestLogging",schemaPath:"#/properties/disableRequestLogging/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;Q!==void 0&&(Qe=Q,e!==void 0&&(e.disableRequestLogging=Q))}var a=me===o;if(a){let Q=e.maxParamLength,Ft=o;if(!(typeof Q=="number"&&!(Q%1)&&!isNaN(Q)&&isFinite(Q))){let Dr=typeof Q,I;if(I===void 0)if(Dr==="boolean"||Q===null||Dr==="string"&&Q&&Q==+Q&&!(Q%1))I=+Q;else return ge.errors=[{instancePath:t+"/maxParamLength",schemaPath:"#/properties/maxParamLength/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;I!==void 0&&(Q=I,e!==void 0&&(e.maxParamLength=I))}var a=Ft===o;if(a){let Dr=e.onProtoPoisoning,I=o;if(typeof Dr!="string"){let M=typeof Dr,H;if(H===void 0)if(M=="number"||M=="boolean")H=""+Dr;else if(Dr===null)H="";else return ge.errors=[{instancePath:t+"/onProtoPoisoning",schemaPath:"#/properties/onProtoPoisoning/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;H!==void 0&&(Dr=H,e!==void 0&&(e.onProtoPoisoning=H))}var a=I===o;if(a){let M=e.onConstructorPoisoning,H=o;if(typeof M!="string"){let V=typeof M,Ie;if(Ie===void 0)if(V=="number"||V=="boolean")Ie=""+M;else if(M===null)Ie="";else return ge.errors=[{instancePath:t+"/onConstructorPoisoning",schemaPath:"#/properties/onConstructorPoisoning/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;Ie!==void 0&&(M=Ie,e!==void 0&&(e.onConstructorPoisoning=Ie))}var a=H===o;if(a){let V=e.pluginTimeout,Ie=o;if(!(typeof V=="number"&&!(V%1)&&!isNaN(V)&&isFinite(V))){let ze=typeof V,cn;if(cn===void 0)if(ze==="boolean"||V===null||ze==="string"&&V&&V==+V&&!(V%1))cn=+V;else return ge.errors=[{instancePath:t+"/pluginTimeout",schemaPath:"#/properties/pluginTimeout/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;cn!==void 0&&(V=cn,e!==void 0&&(e.pluginTimeout=cn))}var a=Ie===o;if(a){let ze=e.requestIdHeader,cn=o,Qh=o,$i=!1,I2=o;if(typeof ze!="boolean"){let ft;if(ft===void 0)if(ze==="false"||ze===0||ze===null)ft=!1;else if(ze==="true"||ze===1)ft=!0;else{let Mc={instancePath:t+"/requestIdHeader",schemaPath:"#/properties/requestIdHeader/anyOf/0/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};i===null?i=[Mc]:i.push(Mc),o++}ft!==void 0&&(ze=ft,e!==void 0&&(e.requestIdHeader=ft))}var p=I2===o;if($i=$i||p,!$i){let ft=o;if(typeof ze!="string"){let Kv=typeof ze,Fe;if(Fe===void 0)if(Kv=="number"||Kv=="boolean")Fe=""+ze;else if(ze===null)Fe="";else{let wr={instancePath:t+"/requestIdHeader",schemaPath:"#/properties/requestIdHeader/anyOf/1/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[wr]:i.push(wr),o++}Fe!==void 0&&(ze=Fe,e!==void 0&&(e.requestIdHeader=Fe))}var p=ft===o;$i=$i||p}if($i)o=Qh,i!==null&&(Qh?i.length=Qh:i=null);else{let ft={instancePath:t+"/requestIdHeader",schemaPath:"#/properties/requestIdHeader/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return i===null?i=[ft]:i.push(ft),o++,ge.errors=i,!1}var a=cn===o;if(a){let ft=e.requestIdLogLabel,Mc=o;if(typeof ft!="string"){let Fe=typeof ft,wr;if(wr===void 0)if(Fe=="number"||Fe=="boolean")wr=""+ft;else if(ft===null)wr="";else return ge.errors=[{instancePath:t+"/requestIdLogLabel",schemaPath:"#/properties/requestIdLogLabel/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;wr!==void 0&&(ft=wr,e!==void 0&&(e.requestIdLogLabel=wr))}var a=Mc===o;if(a){let Fe=e.http2SessionTimeout,wr=o;if(!(typeof Fe=="number"&&!(Fe%1)&&!isNaN(Fe)&&isFinite(Fe))){let qr=typeof Fe,Ps;if(Ps===void 0)if(qr==="boolean"||Fe===null||qr==="string"&&Fe&&Fe==+Fe&&!(Fe%1))Ps=+Fe;else return ge.errors=[{instancePath:t+"/http2SessionTimeout",schemaPath:"#/properties/http2SessionTimeout/type",keyword:"type",params:{type:"integer"},message:"must be integer"}],!1;Ps!==void 0&&(Fe=Ps,e!==void 0&&(e.http2SessionTimeout=Ps))}var a=wr===o;if(a){let qr=e.exposeHeadRoutes,Ps=o;if(typeof qr!="boolean"){let Vt;if(Vt===void 0)if(qr==="false"||qr===0||qr===null)Vt=!1;else if(qr==="true"||qr===1)Vt=!0;else return ge.errors=[{instancePath:t+"/exposeHeadRoutes",schemaPath:"#/properties/exposeHeadRoutes/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;Vt!==void 0&&(qr=Vt,e!==void 0&&(e.exposeHeadRoutes=Vt))}var a=Ps===o;if(a){let Vt=e.useSemicolonDelimiter,A2=o;if(typeof Vt!="boolean"){let sr;if(sr===void 0)if(Vt==="false"||Vt===0||Vt===null)sr=!1;else if(Vt==="true"||Vt===1)sr=!0;else return ge.errors=[{instancePath:t+"/useSemicolonDelimiter",schemaPath:"#/properties/useSemicolonDelimiter/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;sr!==void 0&&(Vt=sr,e!==void 0&&(e.useSemicolonDelimiter=sr))}var a=A2===o;if(a)if(e.constraints!==void 0){let sr=e.constraints,Jv=o;if(o===Jv)if(sr&&typeof sr=="object"&&!Array.isArray(sr))for(let jc in sr){let Rr=sr[jc],Yv=o;if(o===Yv)if(Rr&&typeof Rr=="object"&&!Array.isArray(Rr)){let xi;if(Rr.name===void 0&&(xi="name")||Rr.storage===void 0&&(xi="storage")||Rr.validate===void 0&&(xi="validate")||Rr.deriveConstraint===void 0&&(xi="deriveConstraint"))return ge.errors=[{instancePath:t+"/constraints/"+jc.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/constraints/additionalProperties/required",keyword:"required",params:{missingProperty:xi},message:"must have required property '"+xi+"'"}],!1;if(Rr.name!==void 0){let ma=Rr.name;if(typeof ma!="string"){let Xv=typeof ma,ki;if(ki===void 0)if(Xv=="number"||Xv=="boolean")ki=""+ma;else if(ma===null)ki="";else return ge.errors=[{instancePath:t+"/constraints/"+jc.replace(/~/g,"~0").replace(/\//g,"~1")+"/name",schemaPath:"#/properties/constraints/additionalProperties/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;ki!==void 0&&(ma=ki,Rr!==void 0&&(Rr.name=ki))}}}else return ge.errors=[{instancePath:t+"/constraints/"+jc.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/constraints/additionalProperties/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=Yv===o;if(!d)break}else return ge.errors=[{instancePath:t+"/constraints",schemaPath:"#/properties/constraints/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var a=Jv===o}else var a=!0}}}}}}}}}}}}}}}}}}}}}}}else return ge.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return ge.errors=i,o===0}Xd.exports.defaultInitOptions={connectionTimeout:0,keepAliveTimeout:72e3,maxRequestsPerSocket:0,requestTimeout:0,bodyLimit:1048576,caseSensitive:!0,allowUnsafeRegex:!1,disableRequestLogging:!1,ignoreTrailingSlash:!1,ignoreDuplicateSlashes:!1,maxParamLength:100,onProtoPoisoning:"error",onConstructorPoisoning:"error",pluginTimeout:1e4,requestIdHeader:!1,requestIdLogLabel:"reqId",http2SessionTimeout:72e3,exposeHeadRoutes:!0,useSemicolonDelimiter:!1}});var JD=S((g_e,Qd)=>{"use strict";var Zd=KD(),noe=of()({circles:!0,proto:!1}),{FST_ERR_INIT_OPTS_INVALID:soe}=pt();function ioe(e){let t=noe(e);if(!Zd(t)){let r=new soe(JSON.stringify(Zd.errors.map(n=>n.message)));throw r.errors=Zd.errors,r}return Mb(t)}function Mb(e){let t=Object.getOwnPropertyNames(e);for(let r of t){let n=e[r];ArrayBuffer.isView(n)&&!(n instanceof DataView)||(e[r]=n&&typeof n=="object"?Mb(n):n)}return Object.freeze(e)}Qd.exports=ioe;Qd.exports.defaultInitOptions=Zd.defaultInitOptions;Qd.exports.utils={deepFreezeObject:Mb}});var sq=S((y_e,nq)=>{"use strict";var{kAvvioBoot:ooe,kChildren:YD,kRoutePrefix:XD,kLogLevel:ZD,kLogSerializers:jb,kHooks:Fb,kSchemaController:jo,kContentTypeParser:QD,kReply:eq,kRequest:tq,kFourOhFour:aoe,kPluginNameChain:rq}=at(),loe=gf(),coe=Ef(),uoe=G0(),foe=ty(),{buildHooks:doe}=Yn(),tc=gb();nq.exports=function(t,r,n){let s=tc.registerPlugin.call(t,r),i=tc.getPluginName(r)||tc.getFuncPreview(r);if(s)return t[rq].push(i),t;let o=Object.create(t);t[YD].push(o),o.ready=t[ooe].bind(o),o[YD]=[],o[eq]=loe.buildReply(o[eq]),o[tq]=coe.buildRequest(o[tq]),o[QD]=foe.helpers.buildContentTypeParser(o[QD]),o[Fb]=doe(o[Fb]),o[XD]=hoe(o[XD],n.prefix),o[ZD]=n.logLevel||o[ZD],o[jo]=uoe.buildSchemaController(t[jo]),o.getSchema=o[jo].getSchema.bind(o[jo]),o.getSchemas=o[jo].getSchemas.bind(o[jo]),o[tc.kRegisteredPlugins]=Object.create(o[tc.kRegisteredPlugins]),o[rq]=[i],(o[jb]||n.logSerializers)&&(o[jb]=Object.assign(Object.create(o[jb]),n.logSerializers)),n.prefix&&o[aoe].arrange404(o);for(let a of o[Fb].onRegister)a.call(t,o,n);return o};function hoe(e,t){return t?(e.endsWith("/")&&t[0]==="/"?t=t.slice(1):t[0]!=="/"&&(t="/"+t),e+t):e}});var oq=S((__e,iq)=>{"use strict";iq.exports=function(){return{[Symbol.iterator]:function*(){},add(){},delete(){},has(){return!0}}}});var cq=S(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});eh.parse=Soe;eh.serialize=voe;var poe=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,moe=/^[\u0021-\u003A\u003C-\u007E]*$/,goe=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,yoe=/^[\u0020-\u003A\u003D-\u007E]*$/,_oe=Object.prototype.toString,boe=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function Soe(e,t){let r=new boe,n=e.length;if(n<2)return r;let s=t?.decode||Eoe,i=0;do{let o=e.indexOf("=",i);if(o===-1)break;let a=e.indexOf(";",i),l=a===-1?n:a;if(o>l){i=e.lastIndexOf(";",o-1)+1;continue}let c=aq(e,i,o),u=lq(e,o,c),f=e.slice(c,u);if(r[f]===void 0){let p=aq(e,o+1,l),d=lq(e,l,p),h=s(e.slice(p,d));r[f]=h}i=l+1}while(i<n);return r}function aq(e,t,r){do{let n=e.charCodeAt(t);if(n!==32&&n!==9)return t}while(++t<r);return r}function lq(e,t,r){for(;t>r;){let n=e.charCodeAt(--t);if(n!==32&&n!==9)return t+1}return r}function voe(e,t,r){let n=r?.encode||encodeURIComponent;if(!poe.test(e))throw new TypeError(`argument name is invalid: ${e}`);let s=n(t);if(!moe.test(s))throw new TypeError(`argument val is invalid: ${t}`);let i=e+"="+s;if(!r)return i;if(r.maxAge!==void 0){if(!Number.isInteger(r.maxAge))throw new TypeError(`option maxAge is invalid: ${r.maxAge}`);i+="; Max-Age="+r.maxAge}if(r.domain){if(!goe.test(r.domain))throw new TypeError(`option domain is invalid: ${r.domain}`);i+="; Domain="+r.domain}if(r.path){if(!yoe.test(r.path))throw new TypeError(`option path is invalid: ${r.path}`);i+="; Path="+r.path}if(r.expires){if(!woe(r.expires)||!Number.isFinite(r.expires.valueOf()))throw new TypeError(`option expires is invalid: ${r.expires}`);i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.partitioned&&(i+="; Partitioned"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${r.sameSite}`)}return i}function Eoe(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch{return e}}function woe(e){return _oe.call(e)==="[object Date]"}});var dq=S((S_e,fq)=>{"use strict";var{URL:uq}=require("node:url"),Vb="http://localhost";fq.exports=function(t,r){(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]")&&t.startsWith("//")&&(t=Vb+t);let n=typeof t=="object"?Object.assign(new uq(Vb),t):new uq(t,Vb);if(typeof r=="string"){r=new URLSearchParams(r);for(let s of r.keys()){n.searchParams.delete(s);for(let i of r.getAll(s))n.searchParams.append(s,i)}}else{let s=Object.assign({},t.query,r);for(let i in s){let o=s[i];if(Array.isArray(o)){n.searchParams.delete(i);for(let a of o)n.searchParams.append(i,a)}else n.searchParams.set(i,o)}}return n}});var hq=S((v_e,Ub)=>{"use strict";var{randomUUID:Roe}=require("node:crypto"),{Readable:Toe}=require("node:stream"),Fo;function Ooe(e){return e&&typeof e=="object"&&typeof e.append=="function"&&typeof e.delete=="function"&&typeof e.get=="function"&&typeof e.getAll=="function"&&typeof e.has=="function"&&typeof e.set=="function"&&e[Symbol.toStringTag]==="FormData"}function Poe(e){Fo=Fo??new TextEncoder;let t=`----formdata-${Roe()}`,r=`--${t}\r
Content-Disposition: form-data`;let n=l=>l.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),s=l=>l.replace(/\r?\n|\r/g,`\r
`),i=new Uint8Array([13,10]);async function*o(){for(let[l,c]of e)if(typeof c=="string")yield Fo.encode(`${r}; name="${n(s(l))}"\r
\r
`),yield Fo.encode(`${s(c)}\r
`);else{let u=`${r}; name="${n(s(l))}"`;c.name&&(u+=`; filename="${n(c.name)}"`),u+=`\r
Content-Type: ${c.type||"application/octet-stream"}\r
\r
`,yield Fo.encode(u),c.stream?yield*c.stream():yield c,yield i}yield Fo.encode(`--${t}--`)}return{stream:Toe.from(o()),contentType:`multipart/form-data; boundary=${t}`}}Ub.exports.isFormDataLike=Ooe;Ub.exports.formDataToStream=Poe});var gq=S((E_e,th)=>{"use strict";var{Readable:pq,addAbortSignal:Ioe}=require("node:stream"),Bb=require("node:util"),Aoe=cq(),Coe=require("node:assert"),{createDeprecation:Noe}=Em(),$oe=dq(),{isFormDataLike:xoe,formDataToStream:koe}=hq(),{EventEmitter:Loe}=require("node:events"),Doe=Noe({name:"FastifyDeprecationLightMyRequest",code:"FST_LIGHTMYREQUEST_DEP01",message:'You are accessing "request.connection", use "request.socket" instead.'});function qoe(e){return e.port?e.host:e.hostname+(e.protocol==="https:"?":443":":80")}var Hb=class extends Loe{constructor(t){super(),this.remoteAddress=t}};function mq(e){return new t(this);function t(r){ms.call(r,{...e,Request:void 0}),Object.assign(this,r);for(let n of Object.keys(ms.prototype))this.constructor.prototype[n]=ms.prototype[n];return Bb.inherits(this.constructor,e.Request),this}}function ms(e){pq.call(this,{autoDestroy:!1});let t=$oe(e.url||e.path,e.query);this.url=t.pathname+t.search,this.aborted=!1,this.httpVersionMajor=1,this.httpVersionMinor=1,this.httpVersion="1.1",this.method=e.method?e.method.toUpperCase():"GET",this.headers={},this.rawHeaders=[];let r=e.headers||{};for(let o in r){let a=o.toLowerCase();if((a==="user-agent"||a==="content-type")&&r[o]===void 0){this.headers[a]=void 0;continue}let l=r[o];Coe(l!==void 0,'invalid value "undefined" for header '+o),this.headers[a]=""+l}if("user-agent"in this.headers||(this.headers["user-agent"]="lightMyRequest"),this.headers.host=this.headers.host||e.authority||qoe(t),e.cookies){let{cookies:o}=e,a=Object.keys(o).map(l=>Aoe.serialize(l,o[l]));this.headers.cookie&&a.unshift(this.headers.cookie),this.headers.cookie=a.join("; ")}this.socket=new Hb(e.remoteAddress||"127.0.0.1"),Object.defineProperty(this,"connection",{get(){return Doe(),this.socket},configurable:!0});let n=e.payload||e.body||null,s=n&&typeof n.resume=="function";if(xoe(n)){let o=koe(n);n=o.stream,s=!0,this.headers["content-type"]=o.contentType,this.headers["transfer-encoding"]="chunked"}n&&typeof n!="string"&&!s&&!Buffer.isBuffer(n)&&(n=JSON.stringify(n),"content-type"in this.headers||(this.headers["content-type"]="application/json")),n&&!s&&!Object.hasOwn(this.headers,"content-length")&&(this.headers["content-length"]=(Buffer.isBuffer(n)?n.length:Buffer.byteLength(n)).toString());for(let o of Object.keys(this.headers))this.rawHeaders.push(o,this.headers[o]);this._lightMyRequest={payload:n,isDone:!1,simulate:e.simulate||{},payloadAsStream:e.payloadAsStream,signal:e.signal};let i=e.signal;i&&Ioe(i,this);{let o=this._lightMyRequest.payload;o?._readableState?(this._read=Moe,o.on("error",a=>{this.destroy(a)}),o.on("end",()=>{this.push(null)})):this._read=joe}return this}function Moe(){let e=this._lightMyRequest.payload,t=!0,r=!1,n;for(;t&&(n=e.read());)r=!0,t=this.push(n);t&&!r&&this._lightMyRequest.payload.once("readable",this._read.bind(this))}function joe(){setImmediate(()=>{if(this._lightMyRequest.isDone){this._lightMyRequest.simulate.end!==!1&&this.push(null);return}this._lightMyRequest.isDone=!0,this._lightMyRequest.payload&&(this._lightMyRequest.simulate.split?(this.push(this._lightMyRequest.payload.slice(0,1)),this.push(this._lightMyRequest.payload.slice(1))):this.push(this._lightMyRequest.payload)),this._lightMyRequest.simulate.error&&this.emit("error",new Error("Simulated")),this._lightMyRequest.simulate.close&&this.emit("close"),this._lightMyRequest.simulate.end!==!1&&this.push(null)})}Bb.inherits(ms,pq);Bb.inherits(mq,ms);ms.prototype.destroy=function(e){this.destroyed||this._lightMyRequest.isDone||(this.destroyed=!0,e&&(this._error=!0,process.nextTick(()=>this.emit("error",e))),process.nextTick(()=>this.emit("close")))};th.exports=ms;th.exports.Request=ms;th.exports.CustomRequest=mq});var _q=S((w_e,rc)=>{"use strict";var rh={decodeValues:!0,map:!1,silent:!1};function zb(e){return typeof e=="string"&&!!e.trim()}function Gb(e,t){var r=e.split(";").filter(zb),n=r.shift(),s=Foe(n),i=s.name,o=s.value;t=t?Object.assign({},rh,t):rh;try{o=t.decodeValues?decodeURIComponent(o):o}catch(l){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+o+"'. Set options.decodeValues to false to disable this feature.",l)}var a={name:i,value:o};return r.forEach(function(l){var c=l.split("="),u=c.shift().trimLeft().toLowerCase(),f=c.join("=");u==="expires"?a.expires=new Date(f):u==="max-age"?a.maxAge=parseInt(f,10):u==="secure"?a.secure=!0:u==="httponly"?a.httpOnly=!0:u==="samesite"?a.sameSite=f:u==="partitioned"?a.partitioned=!0:a[u]=f}),a}function Foe(e){var t="",r="",n=e.split("=");return n.length>1?(t=n.shift(),r=n.join("=")):r=e,{name:t,value:r}}function yq(e,t){if(t=t?Object.assign({},rh,t):rh,!e)return t.map?{}:[];if(e.headers)if(typeof e.headers.getSetCookie=="function")e=e.headers.getSetCookie();else if(e.headers["set-cookie"])e=e.headers["set-cookie"];else{var r=e.headers[Object.keys(e.headers).find(function(s){return s.toLowerCase()==="set-cookie"})];!r&&e.headers.cookie&&!t.silent&&console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),e=r}if(Array.isArray(e)||(e=[e]),t.map){var n={};return e.filter(zb).reduce(function(s,i){var o=Gb(i,t);return s[o.name]=o,s},n)}else return e.filter(zb).map(function(s){return Gb(s,t)})}function Voe(e){if(Array.isArray(e))return e;if(typeof e!="string")return[];var t=[],r=0,n,s,i,o,a;function l(){for(;r<e.length&&/\s/.test(e.charAt(r));)r+=1;return r<e.length}function c(){return s=e.charAt(r),s!=="="&&s!==";"&&s!==","}for(;r<e.length;){for(n=r,a=!1;l();)if(s=e.charAt(r),s===","){for(i=r,r+=1,l(),o=r;r<e.length&&c();)r+=1;r<e.length&&e.charAt(r)==="="?(a=!0,r=o,t.push(e.substring(n,i)),n=r):r=i+1}else r+=1;(!a||r>=e.length)&&t.push(e.substring(n,e.length))}return t}rc.exports=yq;rc.exports.parse=yq;rc.exports.parseString=Gb;rc.exports.splitCookiesString=Voe});var wq=S((R_e,Eq)=>{"use strict";var nc=require("node:http"),{Writable:Uoe,Readable:bq,addAbortSignal:Hoe}=require("node:stream"),Boe=require("node:util"),zoe=_q();function gs(e,t,r){if(nc.ServerResponse.call(this,e),e._lightMyRequest?.payloadAsStream){let a=this.emit.bind(this,"drain");this._lightMyRequest={headers:null,trailers:{},stream:new bq({read:a})};let l=e._lightMyRequest.signal;l&&Hoe(l,this._lightMyRequest.stream)}else this._lightMyRequest={headers:null,trailers:{},payloadChunks:[]};this.setHeader("foo","bar"),this.removeHeader("foo"),this.assignSocket(Goe()),this._promiseCallback=typeof r=="function";let n=!1,s=a=>{if(!n){if(n=!0,this._promiseCallback)return process.nextTick(()=>t(a));process.nextTick(()=>t(null,a))}};this._lightMyRequest.onEndSuccess=s;let i=!1,o=a=>{if(n){this._lightMyRequest.stream&&!i&&(a||(a=new Error("response destroyed before completion"),a.code="LIGHT_ECONNRESET"),this._lightMyRequest.stream.destroy(a),this._lightMyRequest.stream.on("error",()=>{}));return}if(n=!0,a||(a=new Error("response destroyed before completion"),a.code="LIGHT_ECONNRESET"),this._promiseCallback)return process.nextTick(()=>r(a));process.nextTick(()=>t(a,null))};this._lightMyRequest.stream?this.once("finish",()=>{i=!0,this._lightMyRequest.stream.push(null)}):this.once("finish",()=>{let a=Sq(this);a.raw.req=e,s(a)}),this.connection.once("error",o),this.once("error",o),this.once("close",o)}Boe.inherits(gs,nc.ServerResponse);gs.prototype.setTimeout=function(e,t){return this.timeoutHandle=setTimeout(()=>{this.emit("timeout")},e),this.on("timeout",t),this};gs.prototype.writeHead=function(){let e=nc.ServerResponse.prototype.writeHead.apply(this,arguments);return vq(this),this._lightMyRequest.stream&&this._lightMyRequest.onEndSuccess(Sq(this)),e};gs.prototype.write=function(e,t,r){return this.timeoutHandle&&clearTimeout(this.timeoutHandle),nc.ServerResponse.prototype.write.call(this,e,t,r),this._lightMyRequest.stream?this._lightMyRequest.stream.push(Buffer.from(e,t)):(this._lightMyRequest.payloadChunks.push(Buffer.from(e,t)),!0)};gs.prototype.end=function(e,t,r){e&&this.write(e,t),nc.ServerResponse.prototype.end.call(this,r),this.emit("finish"),this.destroy()};gs.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&process.nextTick(()=>this.emit("error",e)),process.nextTick(()=>this.emit("close")))};gs.prototype.addTrailers=function(e){for(let t in e)this._lightMyRequest.trailers[t.toLowerCase().trim()]=e[t].toString().trim()};function Sq(e){e._lightMyRequest.headers===null&&vq(e),Woe(e);let t={raw:{res:e},headers:e._lightMyRequest.headers,statusCode:e.statusCode,statusMessage:e.statusMessage,trailers:{},get cookies(){return zoe.parse(this)}};if(t.trailers=e._lightMyRequest.trailers,e._lightMyRequest.payloadChunks){let r=Buffer.concat(e._lightMyRequest.payloadChunks);t.rawPayload=r,t.payload=r.toString(),t.body=t.payload,t.json=function(){return JSON.parse(t.payload)}}else t.json=function(){throw new Error("Response payload is not available with payloadAsStream: true")};return t.stream=function(){return e._lightMyRequest.stream?e._lightMyRequest.stream:bq.from(e._lightMyRequest.payloadChunks)},t}function Goe(){return new Uoe({write(e,t,r){setImmediate(r)}})}function Woe(e){let t=e._lightMyRequest.headers;for(let r of Object.keys(t)){let n=t[r];Array.isArray(n)?t[r]=n.map(s=>""+s):t[r]=""+n}}function vq(e){e._lightMyRequest.headers=Object.assign({},e.getHeaders()),["Date","Connection","Transfer-Encoding"].forEach(t=>{let r=new RegExp("\\r\\n"+t+": ([^\\r]*)\\r\\n"),n=e._header?.match(r);n&&(e._lightMyRequest.headers[t.toLowerCase()]=n[1])})}Eq.exports=gs});var Rq=S((T_e,Wb)=>{"use strict";Wb.exports=tt;Wb.exports.default=tt;var Koe={type:"object",properties:{url:{oneOf:[{type:"string"},{type:"object",properties:{protocol:{type:"string"},hostname:{type:"string"},pathname:{type:"string"}},additionalProperties:!0,required:["pathname"]}]},path:{oneOf:[{type:"string"},{type:"object",properties:{protocol:{type:"string"},hostname:{type:"string"},pathname:{type:"string"}},additionalProperties:!0,required:["pathname"]}]},cookies:{type:"object",additionalProperties:!0},headers:{type:"object",additionalProperties:!0},query:{anyOf:[{type:"object",additionalProperties:!0},{type:"string"}]},simulate:{type:"object",properties:{end:{type:"boolean"},split:{type:"boolean"},error:{type:"boolean"},close:{type:"boolean"}}},authority:{type:"string"},remoteAddress:{type:"string"},method:{type:"string",enum:["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","QUERY","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE","acl","bind","checkout","connect","copy","delete","get","head","link","lock","m-search","merge","mkactivity","mkcalendar","mkcol","move","notify","options","patch","post","propfind","proppatch","purge","put","query","rebind","report","search","source","subscribe","trace","unbind","unlink","unlock","unsubscribe"]},validate:{type:"boolean"}},additionalProperties:!0,oneOf:[{required:["url"]},{required:["path"]}]};function tt(e,{instancePath:t="",parentData:r,parentDataProperty:n,rootData:s=e}={}){let i=null,o=0,a=o,l=!1,c=null,u=o;if(e&&typeof e=="object"&&!Array.isArray(e)){let g;if(e.url===void 0&&(g="url")){let T={instancePath:t,schemaPath:"#/oneOf/0/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"};i===null?i=[T]:i.push(T),o++}}var p=u===o;p&&(l=!0,c=0);let f=o;if(e&&typeof e=="object"&&!Array.isArray(e)){let g;if(e.path===void 0&&(g="path")){let T={instancePath:t,schemaPath:"#/oneOf/1/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"};i===null?i=[T]:i.push(T),o++}}var p=f===o;if(p&&l?(l=!1,c=[c,1]):p&&(l=!0,c=1),l)o=a,i!==null&&(a?i.length=a:i=null);else{let g={instancePath:t,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:c},message:"must match exactly one schema in oneOf"};return i===null?i=[g]:i.push(g),o++,tt.errors=i,!1}if(o===0)if(e&&typeof e=="object"&&!Array.isArray(e)){if(e.url!==void 0){let g=e.url,T=o,R=o,w=!1,P=null,O=o;if(typeof g!="string"){let q=typeof g,C;if(C===void 0)if(q=="number"||q=="boolean")C=""+g;else if(g===null)C="";else{let N={instancePath:t+"/url",schemaPath:"#/properties/url/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[N]:i.push(N),o++}C!==void 0&&(g=C,e!==void 0&&(e.url=C))}var h=O===o;h&&(w=!0,P=0);let A=o;if(o===A)if(g&&typeof g=="object"&&!Array.isArray(g)){let q;if(g.pathname===void 0&&(q="pathname")){let C={instancePath:t+"/url",schemaPath:"#/properties/url/oneOf/1/required",keyword:"required",params:{missingProperty:q},message:"must have required property '"+q+"'"};i===null?i=[C]:i.push(C),o++}else{if(g.protocol!==void 0){let C=g.protocol,N=o;if(typeof C!="string"){let B=typeof C,se;if(se===void 0)if(B=="number"||B=="boolean")se=""+C;else if(C===null)se="";else{let D={instancePath:t+"/url/protocol",schemaPath:"#/properties/url/oneOf/1/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[D]:i.push(D),o++}se!==void 0&&(C=se,g!==void 0&&(g.protocol=se))}var d=N===o}else var d=!0;if(d){if(g.hostname!==void 0){let C=g.hostname,N=o;if(typeof C!="string"){let se=typeof C,D;if(D===void 0)if(se=="number"||se=="boolean")D=""+C;else if(C===null)D="";else{let K={instancePath:t+"/url/hostname",schemaPath:"#/properties/url/oneOf/1/properties/hostname/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[K]:i.push(K),o++}D!==void 0&&(C=D,g!==void 0&&(g.hostname=D))}var d=N===o}else var d=!0;if(d)if(g.pathname!==void 0){let C=g.pathname,N=o;if(typeof C!="string"){let se=typeof C,D;if(D===void 0)if(se=="number"||se=="boolean")D=""+C;else if(C===null)D="";else{let K={instancePath:t+"/url/pathname",schemaPath:"#/properties/url/oneOf/1/properties/pathname/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[K]:i.push(K),o++}D!==void 0&&(C=D,g!==void 0&&(g.pathname=D))}var d=N===o}else var d=!0}}}else{let q={instancePath:t+"/url",schemaPath:"#/properties/url/oneOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};i===null?i=[q]:i.push(q),o++}var h=A===o;if(h&&w?(w=!1,P=[P,1]):h&&(w=!0,P=1),w)o=R,i!==null&&(R?i.length=R:i=null);else{let q={instancePath:t+"/url",schemaPath:"#/properties/url/oneOf",keyword:"oneOf",params:{passingSchemas:P},message:"must match exactly one schema in oneOf"};return i===null?i=[q]:i.push(q),o++,tt.errors=i,!1}var m=T===o}else var m=!0;if(m){if(e.path!==void 0){let g=e.path,T=o,R=o,w=!1,P=null,O=o;if(typeof g!="string"){let C=typeof g,N;if(N===void 0)if(C=="number"||C=="boolean")N=""+g;else if(g===null)N="";else{let B={instancePath:t+"/path",schemaPath:"#/properties/path/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[B]:i.push(B),o++}N!==void 0&&(g=N,e!==void 0&&(e.path=N))}var b=O===o;b&&(w=!0,P=0);let A=o;if(o===A)if(g&&typeof g=="object"&&!Array.isArray(g)){let C;if(g.pathname===void 0&&(C="pathname")){let N={instancePath:t+"/path",schemaPath:"#/properties/path/oneOf/1/required",keyword:"required",params:{missingProperty:C},message:"must have required property '"+C+"'"};i===null?i=[N]:i.push(N),o++}else{if(g.protocol!==void 0){let N=g.protocol,B=o;if(typeof N!="string"){let se=typeof N,D;if(D===void 0)if(se=="number"||se=="boolean")D=""+N;else if(N===null)D="";else{let K={instancePath:t+"/path/protocol",schemaPath:"#/properties/path/oneOf/1/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[K]:i.push(K),o++}D!==void 0&&(N=D,g!==void 0&&(g.protocol=D))}var y=B===o}else var y=!0;if(y){if(g.hostname!==void 0){let N=g.hostname,B=o;if(typeof N!="string"){let D=typeof N,K;if(K===void 0)if(D=="number"||D=="boolean")K=""+N;else if(N===null)K="";else{let ut={instancePath:t+"/path/hostname",schemaPath:"#/properties/path/oneOf/1/properties/hostname/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[ut]:i.push(ut),o++}K!==void 0&&(N=K,g!==void 0&&(g.hostname=K))}var y=B===o}else var y=!0;if(y)if(g.pathname!==void 0){let N=g.pathname,B=o;if(typeof N!="string"){let D=typeof N,K;if(K===void 0)if(D=="number"||D=="boolean")K=""+N;else if(N===null)K="";else{let ut={instancePath:t+"/path/pathname",schemaPath:"#/properties/path/oneOf/1/properties/pathname/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[ut]:i.push(ut),o++}K!==void 0&&(N=K,g!==void 0&&(g.pathname=K))}var y=B===o}else var y=!0}}}else{let C={instancePath:t+"/path",schemaPath:"#/properties/path/oneOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};i===null?i=[C]:i.push(C),o++}var b=A===o;if(b&&w?(w=!1,P=[P,1]):b&&(w=!0,P=1),w)o=R,i!==null&&(R?i.length=R:i=null);else{let C={instancePath:t+"/path",schemaPath:"#/properties/path/oneOf",keyword:"oneOf",params:{passingSchemas:P},message:"must match exactly one schema in oneOf"};return i===null?i=[C]:i.push(C),o++,tt.errors=i,!1}var m=T===o}else var m=!0;if(m){if(e.cookies!==void 0){let g=e.cookies,T=o;if(o===T&&!(g&&typeof g=="object"&&!Array.isArray(g)))return tt.errors=[{instancePath:t+"/cookies",schemaPath:"#/properties/cookies/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var m=T===o}else var m=!0;if(m){if(e.headers!==void 0){let g=e.headers,T=o;if(o===T&&!(g&&typeof g=="object"&&!Array.isArray(g)))return tt.errors=[{instancePath:t+"/headers",schemaPath:"#/properties/headers/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var m=T===o}else var m=!0;if(m){if(e.query!==void 0){let g=e.query,T=o,R=o,w=!1,P=o;if(o===P&&!(g&&typeof g=="object"&&!Array.isArray(g))){let A={instancePath:t+"/query",schemaPath:"#/properties/query/anyOf/0/type",keyword:"type",params:{type:"object"},message:"must be object"};i===null?i=[A]:i.push(A),o++}var v=P===o;if(w=w||v,!w){let A=o;if(typeof g!="string"){let C=typeof g,N;if(N===void 0)if(C=="number"||C=="boolean")N=""+g;else if(g===null)N="";else{let B={instancePath:t+"/query",schemaPath:"#/properties/query/anyOf/1/type",keyword:"type",params:{type:"string"},message:"must be string"};i===null?i=[B]:i.push(B),o++}N!==void 0&&(g=N,e!==void 0&&(e.query=N))}var v=A===o;w=w||v}if(w)o=R,i!==null&&(R?i.length=R:i=null);else{let A={instancePath:t+"/query",schemaPath:"#/properties/query/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return i===null?i=[A]:i.push(A),o++,tt.errors=i,!1}var m=T===o}else var m=!0;if(m){if(e.simulate!==void 0){let g=e.simulate,T=o;if(o===T)if(g&&typeof g=="object"&&!Array.isArray(g)){if(g.end!==void 0){let w=g.end,P=o;if(typeof w!="boolean"){let O;if(O===void 0)if(w==="false"||w===0||w===null)O=!1;else if(w==="true"||w===1)O=!0;else return tt.errors=[{instancePath:t+"/simulate/end",schemaPath:"#/properties/simulate/properties/end/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;O!==void 0&&(w=O,g!==void 0&&(g.end=O))}var _=P===o}else var _=!0;if(_){if(g.split!==void 0){let w=g.split,P=o;if(typeof w!="boolean"){let A;if(A===void 0)if(w==="false"||w===0||w===null)A=!1;else if(w==="true"||w===1)A=!0;else return tt.errors=[{instancePath:t+"/simulate/split",schemaPath:"#/properties/simulate/properties/split/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;A!==void 0&&(w=A,g!==void 0&&(g.split=A))}var _=P===o}else var _=!0;if(_){if(g.error!==void 0){let w=g.error,P=o;if(typeof w!="boolean"){let A;if(A===void 0)if(w==="false"||w===0||w===null)A=!1;else if(w==="true"||w===1)A=!0;else return tt.errors=[{instancePath:t+"/simulate/error",schemaPath:"#/properties/simulate/properties/error/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;A!==void 0&&(w=A,g!==void 0&&(g.error=A))}var _=P===o}else var _=!0;if(_)if(g.close!==void 0){let w=g.close,P=o;if(typeof w!="boolean"){let A;if(A===void 0)if(w==="false"||w===0||w===null)A=!1;else if(w==="true"||w===1)A=!0;else return tt.errors=[{instancePath:t+"/simulate/close",schemaPath:"#/properties/simulate/properties/close/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;A!==void 0&&(w=A,g!==void 0&&(g.close=A))}var _=P===o}else var _=!0}}}else return tt.errors=[{instancePath:t+"/simulate",schemaPath:"#/properties/simulate/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var m=T===o}else var m=!0;if(m){if(e.authority!==void 0){let g=e.authority,T=o;if(typeof g!="string"){let w=typeof g,P;if(P===void 0)if(w=="number"||w=="boolean")P=""+g;else if(g===null)P="";else return tt.errors=[{instancePath:t+"/authority",schemaPath:"#/properties/authority/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;P!==void 0&&(g=P,e!==void 0&&(e.authority=P))}var m=T===o}else var m=!0;if(m){if(e.remoteAddress!==void 0){let g=e.remoteAddress,T=o;if(typeof g!="string"){let w=typeof g,P;if(P===void 0)if(w=="number"||w=="boolean")P=""+g;else if(g===null)P="";else return tt.errors=[{instancePath:t+"/remoteAddress",schemaPath:"#/properties/remoteAddress/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;P!==void 0&&(g=P,e!==void 0&&(e.remoteAddress=P))}var m=T===o}else var m=!0;if(m){if(e.method!==void 0){let g=e.method,T=o;if(typeof g!="string"){let w=typeof g,P;if(P===void 0)if(w=="number"||w=="boolean")P=""+g;else if(g===null)P="";else return tt.errors=[{instancePath:t+"/method",schemaPath:"#/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;P!==void 0&&(g=P,e!==void 0&&(e.method=P))}if(!(g==="ACL"||g==="BIND"||g==="CHECKOUT"||g==="CONNECT"||g==="COPY"||g==="DELETE"||g==="GET"||g==="HEAD"||g==="LINK"||g==="LOCK"||g==="M-SEARCH"||g==="MERGE"||g==="MKACTIVITY"||g==="MKCALENDAR"||g==="MKCOL"||g==="MOVE"||g==="NOTIFY"||g==="OPTIONS"||g==="PATCH"||g==="POST"||g==="PROPFIND"||g==="PROPPATCH"||g==="PURGE"||g==="PUT"||g==="QUERY"||g==="REBIND"||g==="REPORT"||g==="SEARCH"||g==="SOURCE"||g==="SUBSCRIBE"||g==="TRACE"||g==="UNBIND"||g==="UNLINK"||g==="UNLOCK"||g==="UNSUBSCRIBE"||g==="acl"||g==="bind"||g==="checkout"||g==="connect"||g==="copy"||g==="delete"||g==="get"||g==="head"||g==="link"||g==="lock"||g==="m-search"||g==="merge"||g==="mkactivity"||g==="mkcalendar"||g==="mkcol"||g==="move"||g==="notify"||g==="options"||g==="patch"||g==="post"||g==="propfind"||g==="proppatch"||g==="purge"||g==="put"||g==="query"||g==="rebind"||g==="report"||g==="search"||g==="source"||g==="subscribe"||g==="trace"||g==="unbind"||g==="unlink"||g==="unlock"||g==="unsubscribe"))return tt.errors=[{instancePath:t+"/method",schemaPath:"#/properties/method/enum",keyword:"enum",params:{allowedValues:Koe.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var m=T===o}else var m=!0;if(m)if(e.validate!==void 0){let g=e.validate,T=o;if(typeof g!="boolean"){let w;if(w===void 0)if(g==="false"||g===0||g===null)w=!1;else if(g==="true"||g===1)w=!0;else return tt.errors=[{instancePath:t+"/validate",schemaPath:"#/properties/validate/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;w!==void 0&&(g=w,e!==void 0&&(e.validate=w))}var m=T===o}else var m=!0}}}}}}}}}else return tt.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return tt.errors=i,o===0}});var Pq=S((O_e,ic)=>{"use strict";var Joe=require("node:assert"),Kb=gq(),nh=wq(),ih="The dispatch function has already been invoked",Tq=Rq();function Jb(e,t,r){return r===void 0?new sc(e,t):sh(e,t,r)}function Yoe(e,t){let r=e._lightMyRequest.payload;if(!r||r._readableState||typeof r.resume!="function")return t();let n=[];r.on("data",s=>n.push(Buffer.from(s))),r.on("end",()=>{let s=Buffer.concat(n);return e.headers["content-length"]=e.headers["content-length"]||""+s.length,delete e.headers["transfer-encoding"],e._lightMyRequest.payload=s,t()}),r.resume()}function Oq(e,t,r,n){return r.once("error",function(s){this.destroyed&&n.destroy(s)}),r.once("close",function(){this.destroyed&&!this._error&&n.destroy()}),Yoe(r,()=>e.call(t,r,n))}function sh(e,t,r){if(t=typeof t=="string"?{url:t}:t,t.validate!==!1&&(Joe(typeof e=="function","dispatchFunc should be a function"),!Tq(t)))throw new Error(Tq.errors.map(o=>o.message));let n=t.server||{},s=t.Request?Kb.CustomRequest:Kb;if(e.request&&e.request.app===e&&(Object.setPrototypeOf(Object.getPrototypeOf(e.request),s.prototype),Object.setPrototypeOf(Object.getPrototypeOf(e.response),nh.prototype)),typeof r=="function"){let i=new s(t),o=new nh(i,r);return Oq(e,n,i,o)}else return new Promise((i,o)=>{let a=new s(t),l=new nh(a,i,o);Oq(e,n,a,l)})}function sc(e,t){typeof t=="string"?this.option={url:t}:this.option=Object.assign({},t),this.dispatch=e,this._hasInvoked=!1,this._promise=null,this.option.autoStart!==!1&&process.nextTick(()=>{this._hasInvoked||this.end()})}var Xoe=["delete","get","head","options","patch","post","put","trace"];Xoe.forEach(e=>{sc.prototype[e]=function(t){if(this._hasInvoked===!0||this._promise)throw new Error(ih);return this.option.url=t,this.option.method=e.toUpperCase(),this}});var Zoe=["body","cookies","headers","payload","query"];Zoe.forEach(e=>{sc.prototype[e]=function(t){if(this._hasInvoked===!0||this._promise)throw new Error(ih);return this.option[e]=t,this}});sc.prototype.end=function(e){if(this._hasInvoked===!0||this._promise)throw new Error(ih);if(this._hasInvoked=!0,typeof e=="function")sh(this.dispatch,this.option,e);else return this._promise=sh(this.dispatch,this.option),this._promise};Object.getOwnPropertyNames(Promise.prototype).forEach(e=>{e!=="constructor"&&(sc.prototype[e]=function(...t){if(!this._promise){if(this._hasInvoked===!0)throw new Error(ih);this._hasInvoked=!0,this._promise=sh(this.dispatch,this.option)}return this._promise[e](...t)})});function Qoe(e){return e instanceof Kb||e instanceof nh||e?.constructor?.name==="_CustomLMRRequest"}ic.exports=Jb;ic.exports.default=Jb;ic.exports.inject=Jb;ic.exports.isInjection=Qoe});var Hq=S((P_e,uc)=>{"use strict";var eae="5.2.2",tae=TT(),oh=require("node:http"),rae=require("node:diagnostics_channel"),oc,{kAvvioBoot:ac,kChildren:Yb,kServerBindings:Iq,kBodyLimit:nae,kSupportedHTTPMethods:di,kRoutePrefix:Aq,kLogLevel:sae,kLogSerializers:iae,kHooks:Xb,kSchemaController:ys,kRequestAcceptVersion:oae,kReplySerializerDefault:Cq,kContentTypeParser:aae,kReply:lae,kRequest:cae,kFourOhFour:uae,kState:Je,kOptions:Zb,kPluginNameChain:lc,kSchemaErrorFormatter:Qb,kErrorHandler:ah,kKeepAliveConnections:eS,kChildLoggerFactory:tS,kGenReqId:rS}=at(),{createServer:fae}=WT(),cc=gf(),lh=Ef(),dae=wf(),Vo=Kg(),hi=ty(),Nq=G0(),{Hooks:hae,hookRunnerApplication:$q,supportedHooks:nS}=Yn(),{createChildLogger:xq,defaultChildLoggerFactory:pae,createLogger:mae}=Ka(),kq=gb(),{getGenReqId:Lq,reqIdGenFactory:Dq}=xd(),{buildRouting:gae,validateBodyLimitOption:yae}=FD(),_ae=WD(),Uq=JD(),bae=sq(),Sae=oq(),{appendStackTrace:vae,AVVIO_ERRORS_MAP:qq,...pi}=pt(),{defaultInitOptions:Qt}=Uq,{FST_ERR_ASYNC_CONSTRAINT:Eae,FST_ERR_BAD_URL:wae,FST_ERR_FORCE_CLOSE_CONNECTIONS_IDLE_NOT_AVAILABLE:Rae,FST_ERR_OPTIONS_NOT_OBJ:Tae,FST_ERR_QSP_NOT_FN:Oae,FST_ERR_SCHEMA_CONTROLLER_BUCKET_OPT_NOT_FN:Pae,FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_OBJ:Iae,FST_ERR_AJV_CUSTOM_OPTIONS_OPT_NOT_ARR:Aae,FST_ERR_INSTANCE_ALREADY_LISTENING:Cae,FST_ERR_REOPENED_CLOSE_SERVER:Nae,FST_ERR_ROUTE_REWRITE_NOT_STR:$ae,FST_ERR_SCHEMA_ERROR_FORMATTER_NOT_FN:Mq,FST_ERR_ERROR_HANDLER_NOT_FN:xae,FST_ERR_ROUTE_METHOD_INVALID:kae}=pi,{buildErrorHandler:jq}=Ya(),Fq=rae.channel("fastify.initialization");function Lae(e){let t={};return["errorHandler","logLevel","logSerializers"].concat(nS).forEach(n=>{t[n]=e.store[n]}),Object.assign({},t)}function sS(e){if(e&&typeof e!="object")throw new Tae;if(e=Object.assign({},e),e.querystringParser&&typeof e.querystringParser!="function")throw new Oae(typeof e.querystringParser);if(e.schemaController&&e.schemaController.bucket&&typeof e.schemaController.bucket!="function")throw new Pae(typeof e.schemaController.bucket);yae(e.bodyLimit);let t=typeof e.requestIdHeader=="string"&&e.requestIdHeader.length!==0?e.requestIdHeader.toLowerCase():e.requestIdHeader===!0&&"request-id",r=Dq(t,e.genReqId),n=e.requestIdLogLabel||"reqId",s=e.bodyLimit||Qt.bodyLimit,i=e.disableRequestLogging||!1,o=Object.assign({customOptions:{},plugins:[]},e.ajv),a=e.frameworkErrors;if(!o.customOptions||Object.prototype.toString.call(o.customOptions)!=="[object Object]")throw new Iae(typeof o.customOptions);if(!o.plugins||!Array.isArray(o.plugins))throw new Aae(typeof o.plugins);let{logger:l,hasLogger:c}=mae(e);e.connectionTimeout=e.connectionTimeout||Qt.connectionTimeout,e.keepAliveTimeout=e.keepAliveTimeout||Qt.keepAliveTimeout,e.maxRequestsPerSocket=e.maxRequestsPerSocket||Qt.maxRequestsPerSocket,e.requestTimeout=e.requestTimeout||Qt.requestTimeout,e.logger=l,e.requestIdHeader=t,e.requestIdLogLabel=n,e.disableRequestLogging=i,e.ajv=o,e.clientErrorHandler=e.clientErrorHandler||D;let u=Uq(e);e.exposeHeadRoutes=u.exposeHeadRoutes;let f=gae({config:{defaultRoute:K,onBadUrl:ut,constraints:e.constraints,ignoreTrailingSlash:e.ignoreTrailingSlash||Qt.ignoreTrailingSlash,ignoreDuplicateSlashes:e.ignoreDuplicateSlashes||Qt.ignoreDuplicateSlashes,maxParamLength:e.maxParamLength||Qt.maxParamLength,caseSensitive:e.caseSensitive,allowUnsafeRegex:e.allowUnsafeRegex||Qt.allowUnsafeRegex,buildPrettyMeta:Lae,querystringParser:e.querystringParser,useSemicolonDelimiter:e.useSemicolonDelimiter??Qt.useSemicolonDelimiter}}),p=_ae(e),d=Ft(f,e);e.http2SessionTimeout=u.http2SessionTimeout;let{server:h,listen:m}=fae(e,d),y=typeof h.closeAllConnections=="function",b=typeof h.closeIdleConnections=="function",v=e.forceCloseConnections;if(v==="idle"&&!b)throw new Rae;typeof v!="boolean"&&(v=b?"idle":!1);let _=!y&&v===!0?new Set:Sae(),g=cc.setupResponseListeners,T=Nq.buildSchemaController(null,e.schemaController),R={[Je]:{listening:!1,closing:!1,started:!1,ready:!1,booting:!1,readyPromise:null},[eS]:_,[di]:{bodyless:new Set(["GET","HEAD","TRACE"]),bodywith:new Set(["DELETE","OPTIONS","PATCH","PUT","POST"])},[Zb]:e,[Yb]:[],[Iq]:[],[nae]:s,[Aq]:"",[sae]:"",[iae]:null,[Xb]:new hae,[ys]:T,[Qb]:null,[ah]:jq(),[tS]:pae,[Cq]:null,[aae]:new hi(s,e.onProtoPoisoning||Qt.onProtoPoisoning,e.onConstructorPoisoning||Qt.onConstructorPoisoning),[lae]:cc.buildReply(cc),[cae]:lh.buildRequest(lh,e.trustProxy),[uae]:p,[kq.kRegisteredPlugins]:[],[lc]:["fastify"],[ac]:null,[rS]:r,routing:d,delete:function(x,M,H){return f.prepareRoute.call(this,{method:"DELETE",url:x,options:M,handler:H})},get:function(x,M,H){return f.prepareRoute.call(this,{method:"GET",url:x,options:M,handler:H})},head:function(x,M,H){return f.prepareRoute.call(this,{method:"HEAD",url:x,options:M,handler:H})},trace:function(x,M,H){return f.prepareRoute.call(this,{method:"TRACE",url:x,options:M,handler:H})},patch:function(x,M,H){return f.prepareRoute.call(this,{method:"PATCH",url:x,options:M,handler:H})},post:function(x,M,H){return f.prepareRoute.call(this,{method:"POST",url:x,options:M,handler:H})},put:function(x,M,H){return f.prepareRoute.call(this,{method:"PUT",url:x,options:M,handler:H})},options:function(x,M,H){return f.prepareRoute.call(this,{method:"OPTIONS",url:x,options:M,handler:H})},all:function(x,M,H){return f.prepareRoute.call(this,{method:this.supportedMethods,url:x,options:M,handler:H})},route:function(x){return f.route.call(this,{options:x})},hasRoute:function(x){return f.hasRoute.call(this,{options:x})},findRoute:function(x){return f.findRoute(x)},log:l,withTypeProvider:N,addHook:B,addSchema:se,getSchema:T.getSchema.bind(T),getSchemas:T.getSchemas.bind(T),setValidatorCompiler:Vn,setSerializerCompiler:pe,setSchemaController:Ni,setReplySerializer:Qe,setSchemaErrorFormatter:ve,setGenReqId:pa,addContentTypeParser:hi.helpers.addContentTypeParser,hasContentTypeParser:hi.helpers.hasContentTypeParser,getDefaultJsonParser:hi.defaultParsers.getDefaultJsonParser,defaultTextParser:hi.defaultParsers.defaultTextParser,removeContentTypeParser:hi.helpers.removeContentTypeParser,removeAllContentTypeParsers:hi.helpers.removeAllContentTypeParsers,register:null,after:null,ready:null,onClose:null,close:null,printPlugins:null,hasPlugin:function(I){return this[kq.kRegisteredPlugins].includes(I)||this[lc].includes(I)},listen:m,server:h,addresses:function(){let I=this[Iq].map(x=>x.address());return I.push(this.server.address()),I.filter(x=>x)},decorate:Vo.add,hasDecorator:Vo.exist,decorateReply:Vo.decorateReply,decorateRequest:Vo.decorateRequest,hasRequestDecorator:Vo.existRequest,hasReplyDecorator:Vo.existReply,addHttpMethod:Dr,inject:q,printRoutes:Q,setNotFoundHandler:it,setErrorHandler:me,setChildLoggerFactory:je,initialConfig:u,addConstraintStrategy:f.addConstraintStrategy.bind(f),hasConstraintStrategy:f.hasConstraintStrategy.bind(f)};Object.defineProperties(R,{listeningOrigin:{get(){let I=this.addresses().slice(-1).pop();if(typeof I=="string")return I;let x=I.family==="IPv6"?`[${I.address}]`:I.address;return`${this[Zb].https?"https":"http"}://${x}:${I.port}`}},pluginName:{configurable:!0,get(){return this[lc].length>1?this[lc].join(" -> "):this[lc][0]}},prefix:{configurable:!0,get(){return this[Aq]}},validatorCompiler:{configurable:!0,get(){return this[ys].getValidatorCompiler()}},serializerCompiler:{configurable:!0,get(){return this[ys].getSerializerCompiler()}},childLoggerFactory:{configurable:!0,get(){return this[tS]}},version:{configurable:!0,get(){return eae}},errorHandler:{configurable:!0,get(){return this[ah].func}},genReqId:{configurable:!0,get(){return this[rS]}},supportedMethods:{configurable:!1,get(){return[...this[di].bodyless,...this[di].bodywith]}}}),e.schemaErrorFormatter&&(Vq(e.schemaErrorFormatter),R[Qb]=e.schemaErrorFormatter.bind(R));let w=Number(e.pluginTimeout),P=tae(R,{autostart:!1,timeout:isNaN(w)===!1?w:Qt.pluginTimeout,expose:{use:"register"}});P.override=bae,P.on("start",()=>R[Je].started=!0),R[ac]=R.ready,R.ready=C,R.printPlugins=P.prettyPrint.bind(P),P.once("preReady",()=>{R.onClose((I,x)=>{R[Je].closing=!0,f.closeRoutes(),$q("preClose",R[ac],R,function(){if(R[Je].listening){if(v==="idle")I.server.closeIdleConnections();else if(y&&v)I.server.closeAllConnections();else if(v===!0)for(let M of R[eS])M.destroy(),R[eS].delete(M)}!e.serverFactory||R[Je].listening?I.server.close(function(M){M&&M.code!=="ERR_SERVER_NOT_RUNNING"?x(null):x()}):process.nextTick(x,null)})})});let O=new dae({server:R,config:{}});return R.setNotFoundHandler(),p.arrange404(R),f.setup(e,{avvio:P,fourOhFour:p,logger:l,hasLogger:c,setupResponseListeners:g,throwIfAlreadyStarted:A,keepAliveConnections:_}),h.on("clientError",e.clientErrorHandler.bind(R)),Fq.hasSubscribers&&Fq.publish({fastify:R}),"asyncDispose"in Symbol&&(R[Symbol.asyncDispose]=function(){return R.close()}),R;function A(I){if(R[Je].started)throw new Cae(I)}function q(I,x){if(oc===void 0&&(oc=Pq()),R[Je].started){if(R[Je].closing){let M=new Nae;if(x){x(M);return}else return Promise.reject(M)}return oc(d,I,x)}if(x)this.ready(M=>{M?x(M,null):oc(d,I,x)});else return oc((M,H)=>{this.ready(function(ie){if(ie){H.emit("error",ie);return}d(M,H)})},I)}function C(I){if(this[Je].readyPromise!==null){if(I!=null){this[Je].readyPromise.then(()=>I(null,R),I);return}return this[Je].readyPromise}let x,M;if(process.nextTick(H),this[Je].readyPromise=new Promise(function(V,Ie){x=V,M=Ie}),I)this[Je].readyPromise.then(()=>I(null,R),I);else return this[Je].readyPromise;function H(){R[ac]((V,Ie)=>{V||R[Je].started||R[Je].ready||R[Je].booting?ie(V):(R[Je].booting=!0,$q("onReady",R[ac],R,ie)),Ie()})}function ie(V){if(V=V!=null&&qq[V.code]!=null?vae(V,new qq[V.code](V.message)):V,V)return M(V);x(R),R[Je].booting=!1,R[Je].ready=!0,R[Je].promise=null}}function N(){return this}function B(I,x){if(A('Cannot call "addHook"!'),x==null)throw new pi.FST_ERR_HOOK_INVALID_HANDLER(I,x);if(I==="onSend"||I==="preSerialization"||I==="onError"||I==="preParsing"){if(x.constructor.name==="AsyncFunction"&&x.length===4)throw new pi.FST_ERR_HOOK_INVALID_ASYNC_HANDLER}else if(I==="onReady"||I==="onListen"){if(x.constructor.name==="AsyncFunction"&&x.length!==0)throw new pi.FST_ERR_HOOK_INVALID_ASYNC_HANDLER}else if(I==="onRequestAbort"){if(x.constructor.name==="AsyncFunction"&&x.length!==1)throw new pi.FST_ERR_HOOK_INVALID_ASYNC_HANDLER}else if(x.constructor.name==="AsyncFunction"&&x.length===3)throw new pi.FST_ERR_HOOK_INVALID_ASYNC_HANDLER;return I==="onClose"?this.onClose(x.bind(this)):I==="onReady"||I==="onListen"||I==="onRoute"?this[Xb].add(I,x):this.after((H,ie)=>{M.call(this,I,x),ie(H)}),this;function M(H,ie){this[Xb].add(H,ie),this[Yb].forEach(V=>M.call(V,H,ie))}}function se(I){return A('Cannot call "addSchema"!'),this[ys].add(I),this[Yb].forEach(x=>x.addSchema(I)),this}function D(I,x){if(I.code==="ECONNRESET"||x.destroyed)return;let M,H,ie,V;I.code==="ERR_HTTP_REQUEST_TIMEOUT"?(H="408",ie=oh.STATUS_CODES[H],M=`{"error":"${ie}","message":"Client Timeout","statusCode":408}`,V="timeout"):I.code==="HPE_HEADER_OVERFLOW"?(H="431",ie=oh.STATUS_CODES[H],M=`{"error":"${ie}","message":"Exceeded maximum allowed HTTP header size","statusCode":431}`,V="header_overflow"):(H="400",ie=oh.STATUS_CODES[H],M=`{"error":"${ie}","message":"Client Error","statusCode":400}`,V="error"),this.log.trace({err:I},`client ${V}`),x.writable&&x.write(`HTTP/1.1 ${H} ${ie}\r
Content-Length: ${M.length}\r
Content-Type: application/json\r
\r
${M}`),x.destroy(I)}function K(I,x){I.headers["accept-version"]!==void 0&&(I.headers[oae]=I.headers["accept-version"],I.headers["accept-version"]=void 0),p.router.lookup(I,x)}function ut(I,x,M){if(a){let ie=Lq(O.server,x),V=xq(O,l,x,ie),Ie=new lh(ie,null,x,null,V,O),ln=new cc(M,Ie,V);return i===!1&&V.info({req:Ie},"incoming request"),a(new wae(I),Ie,ln)}let H=`{"error":"Bad Request","code":"FST_ERR_BAD_URL","message":"'${I}' is not a valid url component","statusCode":400}`;M.writeHead(400,{"Content-Type":"application/json","Content-Length":H.length}),M.end(H)}function U(I,x,M){if(I!==!1)return function(ie){if(ie){if(a){let Ie=Lq(O.server,x),ln=xq(O,l,x,Ie),ze=new lh(Ie,null,x,null,ln,O),cn=new cc(M,ze,ln);return i===!1&&ln.info({req:ze},"incoming request"),a(new Eae,ze,cn)}let V='{"error":"Internal Server Error","message":"Unexpected error from async constraint","statusCode":500}';M.writeHead(500,{"Content-Type":"application/json","Content-Length":V.length}),M.end(V)}}}function it(I,x){return A('Cannot call "setNotFoundHandler"!'),p.setNotFoundHandler.call(this,I,x,P,f.routeHandler),this}function Vn(I){return A('Cannot call "setValidatorCompiler"!'),this[ys].setValidatorCompiler(I),this}function ve(I){return A('Cannot call "setSchemaErrorFormatter"!'),Vq(I),this[Qb]=I.bind(this),this}function pe(I){return A('Cannot call "setSerializerCompiler"!'),this[ys].setSerializerCompiler(I),this}function Ni(I){A('Cannot call "setSchemaController"!');let x=this[ys],M=Nq.buildSchemaController(x,Object.assign({},x.opts,I));return this[ys]=M,this.getSchema=M.getSchema.bind(M),this.getSchemas=M.getSchemas.bind(M),this}function Qe(I){return A('Cannot call "setReplySerializer"!'),this[Cq]=I,this}function me(I){if(A('Cannot call "setErrorHandler"!'),typeof I!="function")throw new xae;return this[ah]=jq(this[ah],I.bind(this)),this}function je(I){return A('Cannot call "setChildLoggerFactory"!'),this[tS]=I,this}function Q(I={}){return I.includeMeta=I.includeHooks?I.includeMeta?nS.concat(I.includeMeta):nS:I.includeMeta,f.printRoutes(I)}function Ft(I,{rewriteUrl:x,logger:M}){let H;return function(V,Ie){if(H===void 0&&(H=I.isAsyncConstraint()),x){V.originalUrl=V.url;let ln=x.call(R,V);if(typeof ln=="string")V.url=ln;else{let ze=new $ae(V.url,typeof ln);V.destroy(ze)}}I.routing(V,Ie,U(H,V,Ie))}}function pa(I){return A('Cannot call "setGenReqId"!'),this[rS]=Dq(this[Zb].requestIdHeader,I),this}function Dr(I,{hasBody:x=!1}={}){if(typeof I!="string"||oh.METHODS.indexOf(I)===-1)throw new kae;x===!0?(this[di].bodywith.add(I),this[di].bodyless.delete(I)):(this[di].bodywith.delete(I),this[di].bodyless.add(I));let M=I.toLowerCase();return this.hasDecorator(M)||this.decorate(M,function(H,ie,V){return f.prepareRoute.call(this,{method:I,url:H,options:ie,handler:V})}),this}}function Vq(e){if(typeof e!="function")throw new Mq(typeof e);if(e.constructor.name==="AsyncFunction")throw new Mq("AsyncFunction")}uc.exports=sS;uc.exports.errorCodes=pi;uc.exports.fastify=sS;uc.exports.default=sS});var zq=S((I_e,Bq)=>{"use strict";var er=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(typeof process>"u"||typeof process.domain>"u")throw new Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||er.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||er.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||er.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=er.DEFAULT_MAX_PENDING};er.DEFAULT_TIMEOUT=0;er.DEFAULT_MAX_OCCUPATION_TIME=0;er.DEFAULT_MAX_EXECUTION_TIME=0;er.DEFAULT_MAX_PENDING=1e3;er.prototype.acquire=function(e,t,r,n){if(Array.isArray(e))return this._acquireBatch(e,t,r,n);if(typeof t!="function")throw new Error("You must pass a function to execute");var s=null,i=null,o=null;typeof r!="function"&&(n=r,r=null,o=new this.Promise(function(v,_){s=v,i=_})),n=n||{};var a=!1,l=null,c=null,u=null,f=this,p=function(v,_,g){c&&(clearTimeout(c),c=null),u&&(clearTimeout(u),u=null),v&&(f.queues[e]&&f.queues[e].length===0&&delete f.queues[e],f.domainReentrant&&delete f.domains[e]),a||(o?_?i(_):s(g):typeof r=="function"&&r(_,g),a=!0),v&&f.queues[e]&&f.queues[e].length>0&&f.queues[e].shift()()},d=function(v){if(a)return p(v);l&&(clearTimeout(l),l=null),f.domainReentrant&&v&&(f.domains[e]=process.domain);var _=n.maxExecutionTime||f.maxExecutionTime;if(_&&(u=setTimeout(function(){f.queues[e]&&p(v,new Error("Maximum execution time is exceeded "+e))},_)),t.length===1){var g=!1;try{t(function(T,R){g||(g=!0,p(v,T,R))})}catch(T){g||(g=!0,p(v,T))}}else f._promiseTry(function(){return t()}).then(function(T){p(v,void 0,T)},function(T){p(v,T)})};f.domainReentrant&&process.domain&&(d=process.domain.bind(d));var h=n.maxPending||f.maxPending;if(!f.queues[e])f.queues[e]=[],d(!0);else if(f.domainReentrant&&process.domain&&process.domain===f.domains[e])d(!1);else if(f.queues[e].length>=h)p(!1,new Error("Too many pending tasks in queue "+e));else{var m=function(){d(!0)};n.skipQueue?f.queues[e].unshift(m):f.queues[e].push(m);var y=n.timeout||f.timeout;y&&(l=setTimeout(function(){l=null,p(!1,new Error("async-lock timed out in queue "+e))},y))}var b=n.maxOccupationTime||f.maxOccupationTime;if(b&&(c=setTimeout(function(){f.queues[e]&&p(!1,new Error("Maximum occupation time is exceeded in queue "+e))},b)),o)return o};er.prototype._acquireBatch=function(e,t,r,n){typeof r!="function"&&(n=r,r=null);var s=this,i=function(a,l){return function(c){s.acquire(a,l,c,n)}},o=e.reduceRight(function(a,l){return i(l,a)},t);if(typeof r=="function")o(r);else return new this.Promise(function(a,l){o.length===1?o(function(c,u){c?l(c):a(u)}):a(o())})};er.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0};er.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(t){return this.Promise.reject(t)}};Bq.exports=er});var Wq=S((A_e,Gq)=>{"use strict";Gq.exports=zq()});var lS=S((N_e,Qq)=>{var Zq="Expected a function",Yq=NaN,Mae="[object Symbol]",jae=/^\s+|\s+$/g,Fae=/^[-+]0x[0-9a-f]+$/i,Vae=/^0b[01]+$/i,Uae=/^0o[0-7]+$/i,Hae=parseInt,Bae=typeof global=="object"&&global&&global.Object===Object&&global,zae=typeof self=="object"&&self&&self.Object===Object&&self,Gae=Bae||zae||Function("return this")(),Wae=Object.prototype,Kae=Wae.toString,Jae=Math.max,Yae=Math.min,aS=function(){return Gae.Date.now()};function Xae(e,t,r){var n,s,i,o,a,l,c=0,u=!1,f=!1,p=!0;if(typeof e!="function")throw new TypeError(Zq);t=Xq(t)||0,ch(r)&&(u=!!r.leading,f="maxWait"in r,i=f?Jae(Xq(r.maxWait)||0,t):i,p="trailing"in r?!!r.trailing:p);function d(R){var w=n,P=s;return n=s=void 0,c=R,o=e.apply(P,w),o}function h(R){return c=R,a=setTimeout(b,t),u?d(R):o}function m(R){var w=R-l,P=R-c,O=t-w;return f?Yae(O,i-P):O}function y(R){var w=R-l,P=R-c;return l===void 0||w>=t||w<0||f&&P>=i}function b(){var R=aS();if(y(R))return v(R);a=setTimeout(b,m(R))}function v(R){return a=void 0,p&&n?d(R):(n=s=void 0,o)}function _(){a!==void 0&&clearTimeout(a),c=0,n=l=s=a=void 0}function g(){return a===void 0?o:v(aS())}function T(){var R=aS(),w=y(R);if(n=arguments,s=this,l=R,w){if(a===void 0)return h(l);if(f)return a=setTimeout(b,t),d(l)}return a===void 0&&(a=setTimeout(b,t)),o}return T.cancel=_,T.flush=g,T}function Zae(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(Zq);return ch(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),Xae(e,t,{leading:n,maxWait:t,trailing:s})}function ch(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Qae(e){return!!e&&typeof e=="object"}function ele(e){return typeof e=="symbol"||Qae(e)&&Kae.call(e)==Mae}function Xq(e){if(typeof e=="number")return e;if(ele(e))return Yq;if(ch(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ch(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(jae,"");var r=Vae.test(e);return r||Uae.test(e)?Hae(e.slice(2),r?2:8):Fae.test(e)?Yq:+e}Qq.exports=Zae});var oM=S(($_e,iM)=>{var tle=200,fS="__lodash_hash_undefined__",rle=1/0,nle="[object Function]",sle="[object GeneratorFunction]",ile=/[\\^$.*+?()[\]{}|]/g,ole=/^\[object .+?Constructor\]$/,ale=typeof global=="object"&&global&&global.Object===Object&&global,lle=typeof self=="object"&&self&&self.Object===Object&&self,dS=ale||lle||Function("return this")();function cle(e,t){var r=e?e.length:0;return!!r&&dle(e,t,0)>-1}function ule(e,t,r){for(var n=-1,s=e?e.length:0;++n<s;)if(r(t,e[n]))return!0;return!1}function fle(e,t,r,n){for(var s=e.length,i=r+(n?1:-1);n?i--:++i<s;)if(t(e[i],i,e))return i;return-1}function dle(e,t,r){if(t!==t)return fle(e,hle,r);for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function hle(e){return e!==e}function ple(e,t){return e.has(t)}function mle(e,t){return e?.[t]}function gle(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function tM(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var yle=Array.prototype,_le=Function.prototype,rM=Object.prototype,cS=dS["__core-js_shared__"],eM=function(){var e=/[^.]+$/.exec(cS&&cS.keys&&cS.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),nM=_le.toString,hS=rM.hasOwnProperty,ble=rM.toString,Sle=RegExp("^"+nM.call(hS).replace(ile,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vle=yle.splice,Ele=pS(dS,"Map"),uS=pS(dS,"Set"),fc=pS(Object,"create");function mi(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function wle(){this.__data__=fc?fc(null):{}}function Rle(e){return this.has(e)&&delete this.__data__[e]}function Tle(e){var t=this.__data__;if(fc){var r=t[e];return r===fS?void 0:r}return hS.call(t,e)?t[e]:void 0}function Ole(e){var t=this.__data__;return fc?t[e]!==void 0:hS.call(t,e)}function Ple(e,t){var r=this.__data__;return r[e]=fc&&t===void 0?fS:t,this}mi.prototype.clear=wle;mi.prototype.delete=Rle;mi.prototype.get=Tle;mi.prototype.has=Ole;mi.prototype.set=Ple;function Uo(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ile(){this.__data__=[]}function Ale(e){var t=this.__data__,r=fh(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():vle.call(t,r,1),!0}function Cle(e){var t=this.__data__,r=fh(t,e);return r<0?void 0:t[r][1]}function Nle(e){return fh(this.__data__,e)>-1}function $le(e,t){var r=this.__data__,n=fh(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}Uo.prototype.clear=Ile;Uo.prototype.delete=Ale;Uo.prototype.get=Cle;Uo.prototype.has=Nle;Uo.prototype.set=$le;function Ho(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xle(){this.__data__={hash:new mi,map:new(Ele||Uo),string:new mi}}function kle(e){return dh(this,e).delete(e)}function Lle(e){return dh(this,e).get(e)}function Dle(e){return dh(this,e).has(e)}function qle(e,t){return dh(this,e).set(e,t),this}Ho.prototype.clear=xle;Ho.prototype.delete=kle;Ho.prototype.get=Lle;Ho.prototype.has=Dle;Ho.prototype.set=qle;function uh(e){var t=-1,r=e?e.length:0;for(this.__data__=new Ho;++t<r;)this.add(e[t])}function Mle(e){return this.__data__.set(e,fS),this}function jle(e){return this.__data__.has(e)}uh.prototype.add=uh.prototype.push=Mle;uh.prototype.has=jle;function fh(e,t){for(var r=e.length;r--;)if(Wle(e[r][0],t))return r;return-1}function Fle(e){if(!sM(e)||Ble(e))return!1;var t=Kle(e)||gle(e)?Sle:ole;return t.test(zle(e))}function Vle(e,t,r){var n=-1,s=cle,i=e.length,o=!0,a=[],l=a;if(r)o=!1,s=ule;else if(i>=tle){var c=t?null:Ule(e);if(c)return tM(c);o=!1,s=ple,l=new uh}else l=t?[]:a;e:for(;++n<i;){var u=e[n],f=t?t(u):u;if(u=r||u!==0?u:0,o&&f===f){for(var p=l.length;p--;)if(l[p]===f)continue e;t&&l.push(f),a.push(u)}else s(l,f,r)||(l!==a&&l.push(f),a.push(u))}return a}var Ule=uS&&1/tM(new uS([,-0]))[1]==rle?function(e){return new uS(e)}:Jle;function dh(e,t){var r=e.__data__;return Hle(t)?r[typeof t=="string"?"string":"hash"]:r.map}function pS(e,t){var r=mle(e,t);return Fle(r)?r:void 0}function Hle(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ble(e){return!!eM&&eM in e}function zle(e){if(e!=null){try{return nM.call(e)}catch{}try{return e+""}catch{}}return""}function Gle(e){return e&&e.length?Vle(e):[]}function Wle(e,t){return e===t||e!==e&&t!==t}function Kle(e){var t=sM(e)?ble.call(e):"";return t==nle||t==sle}function sM(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Jle(){}iM.exports=Gle});var Sc=S((mc,Qo)=>{var Fce=200,GS="__lodash_hash_undefined__",Lh=1,YM=2,XM=9007199254740991,Ih="[object Arguments]",jS="[object Array]",Vce="[object AsyncFunction]",ZM="[object Boolean]",QM="[object Date]",ej="[object Error]",tj="[object Function]",Uce="[object GeneratorFunction]",Ah="[object Map]",rj="[object Number]",Hce="[object Null]",Zo="[object Object]",jM="[object Promise]",Bce="[object Proxy]",nj="[object RegExp]",Ch="[object Set]",sj="[object String]",zce="[object Symbol]",Gce="[object Undefined]",FS="[object WeakMap]",ij="[object ArrayBuffer]",Nh="[object DataView]",Wce="[object Float32Array]",Kce="[object Float64Array]",Jce="[object Int8Array]",Yce="[object Int16Array]",Xce="[object Int32Array]",Zce="[object Uint8Array]",Qce="[object Uint8ClampedArray]",eue="[object Uint16Array]",tue="[object Uint32Array]",rue=/[\\^$.*+?()[\]{}|]/g,nue=/^\[object .+?Constructor\]$/,sue=/^(?:0|[1-9]\d*)$/,xe={};xe[Wce]=xe[Kce]=xe[Jce]=xe[Yce]=xe[Xce]=xe[Zce]=xe[Qce]=xe[eue]=xe[tue]=!0;xe[Ih]=xe[jS]=xe[ij]=xe[ZM]=xe[Nh]=xe[QM]=xe[ej]=xe[tj]=xe[Ah]=xe[rj]=xe[Zo]=xe[nj]=xe[Ch]=xe[sj]=xe[FS]=!1;var oj=typeof global=="object"&&global&&global.Object===Object&&global,iue=typeof self=="object"&&self&&self.Object===Object&&self,Ln=oj||iue||Function("return this")(),aj=typeof mc=="object"&&mc&&!mc.nodeType&&mc,FM=aj&&typeof Qo=="object"&&Qo&&!Qo.nodeType&&Qo,lj=FM&&FM.exports===aj,DS=lj&&oj.process,VM=function(){try{return DS&&DS.binding&&DS.binding("util")}catch{}}(),UM=VM&&VM.isTypedArray;function oue(e,t){for(var r=-1,n=e==null?0:e.length,s=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[s++]=o)}return i}function aue(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}function lue(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function cue(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function uue(e){return function(t){return e(t)}}function fue(e,t){return e.has(t)}function due(e,t){return e?.[t]}function hue(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}function pue(e,t){return function(r){return e(t(r))}}function mue(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var gue=Array.prototype,yue=Function.prototype,Dh=Object.prototype,qS=Ln["__core-js_shared__"],cj=yue.toString,sn=Dh.hasOwnProperty,HM=function(){var e=/[^.]+$/.exec(qS&&qS.keys&&qS.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),uj=Dh.toString,_ue=RegExp("^"+cj.call(sn).replace(rue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),BM=lj?Ln.Buffer:void 0,$h=Ln.Symbol,zM=Ln.Uint8Array,fj=Dh.propertyIsEnumerable,bue=gue.splice,_i=$h?$h.toStringTag:void 0,GM=Object.getOwnPropertySymbols,Sue=BM?BM.isBuffer:void 0,vue=pue(Object.keys,Object),VS=ea(Ln,"DataView"),gc=ea(Ln,"Map"),US=ea(Ln,"Promise"),HS=ea(Ln,"Set"),BS=ea(Ln,"WeakMap"),yc=ea(Object,"create"),Eue=vi(VS),wue=vi(gc),Rue=vi(US),Tue=vi(HS),Oue=vi(BS),WM=$h?$h.prototype:void 0,MS=WM?WM.valueOf:void 0;function bi(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Pue(){this.__data__=yc?yc(null):{},this.size=0}function Iue(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Aue(e){var t=this.__data__;if(yc){var r=t[e];return r===GS?void 0:r}return sn.call(t,e)?t[e]:void 0}function Cue(e){var t=this.__data__;return yc?t[e]!==void 0:sn.call(t,e)}function Nue(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=yc&&t===void 0?GS:t,this}bi.prototype.clear=Pue;bi.prototype.delete=Iue;bi.prototype.get=Aue;bi.prototype.has=Cue;bi.prototype.set=Nue;function Dn(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function $ue(){this.__data__=[],this.size=0}function xue(e){var t=this.__data__,r=qh(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():bue.call(t,r,1),--this.size,!0}function kue(e){var t=this.__data__,r=qh(t,e);return r<0?void 0:t[r][1]}function Lue(e){return qh(this.__data__,e)>-1}function Due(e,t){var r=this.__data__,n=qh(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}Dn.prototype.clear=$ue;Dn.prototype.delete=xue;Dn.prototype.get=kue;Dn.prototype.has=Lue;Dn.prototype.set=Due;function Si(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function que(){this.size=0,this.__data__={hash:new bi,map:new(gc||Dn),string:new bi}}function Mue(e){var t=Mh(this,e).delete(e);return this.size-=t?1:0,t}function jue(e){return Mh(this,e).get(e)}function Fue(e){return Mh(this,e).has(e)}function Vue(e,t){var r=Mh(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}Si.prototype.clear=que;Si.prototype.delete=Mue;Si.prototype.get=jue;Si.prototype.has=Fue;Si.prototype.set=Vue;function xh(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Si;++t<r;)this.add(e[t])}function Uue(e){return this.__data__.set(e,GS),this}function Hue(e){return this.__data__.has(e)}xh.prototype.add=xh.prototype.push=Uue;xh.prototype.has=Hue;function Es(e){var t=this.__data__=new Dn(e);this.size=t.size}function Bue(){this.__data__=new Dn,this.size=0}function zue(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function Gue(e){return this.__data__.get(e)}function Wue(e){return this.__data__.has(e)}function Kue(e,t){var r=this.__data__;if(r instanceof Dn){var n=r.__data__;if(!gc||n.length<Fce-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Si(n)}return r.set(e,t),this.size=r.size,this}Es.prototype.clear=Bue;Es.prototype.delete=zue;Es.prototype.get=Gue;Es.prototype.has=Wue;Es.prototype.set=Kue;function Jue(e,t){var r=kh(e),n=!r&&ufe(e),s=!r&&!n&&zS(e),i=!r&&!n&&!s&&_j(e),o=r||n||s||i,a=o?cue(e.length,String):[],l=a.length;for(var c in e)(t||sn.call(e,c))&&!(o&&(c=="length"||s&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ife(c,l)))&&a.push(c);return a}function qh(e,t){for(var r=e.length;r--;)if(pj(e[r][0],t))return r;return-1}function Yue(e,t,r){var n=t(e);return kh(e)?n:aue(n,r(e))}function bc(e){return e==null?e===void 0?Gce:Hce:_i&&_i in Object(e)?nfe(e):cfe(e)}function KM(e){return _c(e)&&bc(e)==Ih}function dj(e,t,r,n,s){return e===t?!0:e==null||t==null||!_c(e)&&!_c(t)?e!==e&&t!==t:Xue(e,t,r,n,dj,s)}function Xue(e,t,r,n,s,i){var o=kh(e),a=kh(t),l=o?jS:vs(e),c=a?jS:vs(t);l=l==Ih?Zo:l,c=c==Ih?Zo:c;var u=l==Zo,f=c==Zo,p=l==c;if(p&&zS(e)){if(!zS(t))return!1;o=!0,u=!1}if(p&&!u)return i||(i=new Es),o||_j(e)?hj(e,t,r,n,s,i):tfe(e,t,l,r,n,s,i);if(!(r&Lh)){var d=u&&sn.call(e,"__wrapped__"),h=f&&sn.call(t,"__wrapped__");if(d||h){var m=d?e.value():e,y=h?t.value():t;return i||(i=new Es),s(m,y,r,n,i)}}return p?(i||(i=new Es),rfe(e,t,r,n,s,i)):!1}function Zue(e){if(!yj(e)||afe(e))return!1;var t=mj(e)?_ue:nue;return t.test(vi(e))}function Que(e){return _c(e)&&gj(e.length)&&!!xe[bc(e)]}function efe(e){if(!lfe(e))return vue(e);var t=[];for(var r in Object(e))sn.call(e,r)&&r!="constructor"&&t.push(r);return t}function hj(e,t,r,n,s,i){var o=r&Lh,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var u=-1,f=!0,p=r&YM?new xh:void 0;for(i.set(e,t),i.set(t,e);++u<a;){var d=e[u],h=t[u];if(n)var m=o?n(h,d,u,t,e,i):n(d,h,u,e,t,i);if(m!==void 0){if(m)continue;f=!1;break}if(p){if(!lue(t,function(y,b){if(!fue(p,b)&&(d===y||s(d,y,r,n,i)))return p.push(b)})){f=!1;break}}else if(!(d===h||s(d,h,r,n,i))){f=!1;break}}return i.delete(e),i.delete(t),f}function tfe(e,t,r,n,s,i,o){switch(r){case Nh:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ij:return!(e.byteLength!=t.byteLength||!i(new zM(e),new zM(t)));case ZM:case QM:case rj:return pj(+e,+t);case ej:return e.name==t.name&&e.message==t.message;case nj:case sj:return e==t+"";case Ah:var a=hue;case Ch:var l=n&Lh;if(a||(a=mue),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;n|=YM,o.set(e,t);var u=hj(a(e),a(t),n,s,i,o);return o.delete(e),u;case zce:if(MS)return MS.call(e)==MS.call(t)}return!1}function rfe(e,t,r,n,s,i){var o=r&Lh,a=JM(e),l=a.length,c=JM(t),u=c.length;if(l!=u&&!o)return!1;for(var f=l;f--;){var p=a[f];if(!(o?p in t:sn.call(t,p)))return!1}var d=i.get(e);if(d&&i.get(t))return d==t;var h=!0;i.set(e,t),i.set(t,e);for(var m=o;++f<l;){p=a[f];var y=e[p],b=t[p];if(n)var v=o?n(b,y,p,t,e,i):n(y,b,p,e,t,i);if(!(v===void 0?y===b||s(y,b,r,n,i):v)){h=!1;break}m||(m=p=="constructor")}if(h&&!m){var _=e.constructor,g=t.constructor;_!=g&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof g=="function"&&g instanceof g)&&(h=!1)}return i.delete(e),i.delete(t),h}function JM(e){return Yue(e,hfe,sfe)}function Mh(e,t){var r=e.__data__;return ofe(t)?r[typeof t=="string"?"string":"hash"]:r.map}function ea(e,t){var r=due(e,t);return Zue(r)?r:void 0}function nfe(e){var t=sn.call(e,_i),r=e[_i];try{e[_i]=void 0;var n=!0}catch{}var s=uj.call(e);return n&&(t?e[_i]=r:delete e[_i]),s}var sfe=GM?function(e){return e==null?[]:(e=Object(e),oue(GM(e),function(t){return fj.call(e,t)}))}:pfe,vs=bc;(VS&&vs(new VS(new ArrayBuffer(1)))!=Nh||gc&&vs(new gc)!=Ah||US&&vs(US.resolve())!=jM||HS&&vs(new HS)!=Ch||BS&&vs(new BS)!=FS)&&(vs=function(e){var t=bc(e),r=t==Zo?e.constructor:void 0,n=r?vi(r):"";if(n)switch(n){case Eue:return Nh;case wue:return Ah;case Rue:return jM;case Tue:return Ch;case Oue:return FS}return t});function ife(e,t){return t=t??XM,!!t&&(typeof e=="number"||sue.test(e))&&e>-1&&e%1==0&&e<t}function ofe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function afe(e){return!!HM&&HM in e}function lfe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Dh;return e===r}function cfe(e){return uj.call(e)}function vi(e){if(e!=null){try{return cj.call(e)}catch{}try{return e+""}catch{}}return""}function pj(e,t){return e===t||e!==e&&t!==t}var ufe=KM(function(){return arguments}())?KM:function(e){return _c(e)&&sn.call(e,"callee")&&!fj.call(e,"callee")},kh=Array.isArray;function ffe(e){return e!=null&&gj(e.length)&&!mj(e)}var zS=Sue||mfe;function dfe(e,t){return dj(e,t)}function mj(e){if(!yj(e))return!1;var t=bc(e);return t==tj||t==Uce||t==Vce||t==Bce}function gj(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=XM}function yj(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function _c(e){return e!=null&&typeof e=="object"}var _j=UM?uue(UM):Que;function hfe(e){return ffe(e)?Jue(e):efe(e)}function pfe(){return[]}function mfe(){return!1}Qo.exports=dfe});var R2=Tr(cE()),T2=Tr(FR()),O2=Tr(Hq()),P2=require("fs/promises");var b2=Tr(Wq());var iS="__TLDRAW_LIBRARY_VERSIONS__";function Dae(){if(globalThis[iS])return globalThis[iS];let e={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,iS,{value:e,writable:!1,configurable:!1,enumerable:!1}),e}function tr(e,t,r){if(!e||!t||!r)throw new Error("Missing name/version/module system in built version of tldraw library");let n=Dae();if(n.versions.push({name:e,version:t,modules:r}),!n.scheduledNotice)try{n.scheduledNotice=setTimeout(()=>{n.scheduledNotice=null,Kq(n)},100)}catch{Kq(n)}}function Kq(e){if(!e.versions.length||e.didWarn)return;let t=e.versions.sort((a,l)=>Jq(a.version,l.version)),r=t[t.length-1].version,n=new Set,s=new Map;for(let a of t){if(s.has(a.name)){n.delete(a.name),oS(s,a.name,new Set).add(a.version);continue}a.version===r?n.add(a.name):(n.delete(a.name),oS(s,a.name,new Set).add(a.version))}if(s.size>0){let a=[`${xn("[tldraw]",["bold","bgRed","textWhite"])} ${xn("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${xn(`v${r}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(n,l=>`  \u2022 \u2705 ${xn(l,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(s,([l,c])=>{let u=Array.from(c).sort(Jq).map(f=>xn(`v${f}`,f===r?["textGreen"]:["textRed"]));return`  \u2022 \u274C ${xn(l,["bold"])} (${u.join(", ")})`})];console.log(a.join(`
`)),e.didWarn=!0;return}let i=new Map;for(let a of t)oS(i,a.name,{version:a.version,modules:[]}).modules.push(a.modules);let o=new Map;for(let[a,l]of i)l.modules.length>1&&o.set(a,l);if(o.size>0){let a=[`${xn("[tldraw]",["bold","bgRed","textWhite"])} ${xn("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([l,c])=>{let u=c.modules.map((f,p)=>f==="esm"?`      ${p+1}. ES Modules`:`      ${p+1}. CommonJS`).join(`
`);return`  \u2022 \u274C ${xn(l,["bold"])} v${c.version}: 
${u}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),e.didWarn=!0;return}}function Jq(e,t){let r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),n=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!r||!n?e.localeCompare(t):r[1]!==n[1]?Number(r[1])-Number(n[1]):r[2]!==n[2]?Number(r[2])-Number(n[2]):r[3]!==n[3]?Number(r[3])-Number(n[3]):r[4]&&n[4]?r[4].localeCompare(n[4]):r[4]?1:n[4]?-1:0}var qae={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function xn(e,t=[]){return`\x1B[${t.map(r=>qae[r]).join(";")}m${e}\x1B[m`}function oS(e,t,r){return e.has(t)?e.get(t):(e.set(t,r),r)}var Cce=Tr(lS(),1),Nce=Tr(oM(),1);function hh(e){let t=(...r)=>{try{return e(...r)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,t),n}};return t}var He={ok(e){return{ok:!0,value:e}},err(e){return{ok:!1,error:e}}};function kn(e,t){let r=t&&e&&typeof e=="object"&&t in e?e[t]:e;throw new Error(`Unknown switch case ${r}`)}var Be=hh((e,t)=>{if(!e)throw new Error(t||"Assertion Error")}),dc=hh((e,t)=>{if(e==null)throw new Error(t??"value must be defined");return e});var lM={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},Yle=lM.Good;var cM=new WeakMap;function mS(e,t){if(typeof e!="object"||e===null)return;let r=cM.get(e);r||(r={tags:{},extras:{}},cM.set(e,r)),t.tags&&(r.tags={...r.tags,...t.tags}),t.extras&&(r.extras={...r.extras,...t.extras})}var uM=globalThis.crypto,Zle="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Qle=128,gi,Bo;function ece(e){!gi||gi.length<e?(gi=new Uint8Array(e*Qle),uM.getRandomValues(gi),Bo=0):Bo+e>gi.length&&(uM.getRandomValues(gi),Bo=0),Bo+=e}function tce(e=21){ece(e-=0);let t="";for(let r=Bo-e;r<Bo;r++)t+=Zle[gi[r]&63];return t}var rce=tce;function _s(e){return rce(e)}var fM=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(fM=new Int32Array(fM));var oce=Object.freeze(["image/svg+xml"]),ace=Object.freeze(["image/jpeg","image/png","image/webp"]),lce=Object.freeze(["image/gif","image/apng","image/avif"]),dM=Object.freeze([...ace,...oce,...lce]),hM=Object.freeze(["video/mp4","video/webm","video/quicktime"]),cce=[...dM,...hM].join(",");function qt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function bt(e,t){if(qt(e,t))return e[t]}function ph(e){return Object.keys(e)}function bs(e){return Object.values(e)}function St(e){return Object.entries(e)}function gS(e){return Object.fromEntries(e)}function zo(e,t){let r={};for(let[n,s]of St(e)){let i=t(n,s);r[n]=i}return r}function uce(e){let t=fce(e.chars),r=dce(t,e.firstPositive,e.mostPositive,e.mostNegative),n=e.jitterRange??Math.floor(Math.pow(t.length,3)/5),s=hce(n,t.length);return{chars:e.chars,byChar:t.byChar,byCode:t.byCode,length:t.length,first:t.byCode[0],last:t.byCode[t.length-1],firstPositive:r.firstPositive,mostPositive:r.mostPositive,firstNegative:r.firstNegative,mostNegative:r.mostNegative,jitterRange:n,paddingDict:s}}function fce(e){let t={},r={},n=e.length;for(let s=0;s<n;s++){let i=e[s];t[s]=i,r[i]=s}return{byCode:t,byChar:r,length:n}}function dce(e,t,r,n){let s=t?e.byChar[t]:Math.ceil(e.length/2),i=r?e.byChar[r]:e.length-1,o=n?e.byChar[n]:0;if(s===void 0||i===void 0||o===void 0)throw new Error("invalid charSet");if(i-s<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(s-o<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:e.byCode[s],mostPositive:e.byCode[i],firstNegative:e.byCode[s-1],mostNegative:e.byCode[o]}}function hce(e,t){let r={},n=0;for(let s=0;s<100&&(r[s]=Math.pow(t,s),!(r[s]>e));s++);return r}var yS=null;function yh(){return yS||(yS=uce({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function Ss(e,t,r){let n=r.byChar[e],s=r.byChar[t];return Math.abs(n-s)}function SS(e,t){let r=e[0];if(r>t.mostPositive||r<t.mostNegative)throw new Error("invalid firstChar on key");return r===t.mostPositive?Ss(r,t.firstPositive,t)+1+mh(e.slice(1),"positive",t):r===t.mostNegative?Ss(r,t.firstNegative,t)+1+mh(e.slice(1),"negative",t):r>=t.firstPositive?Ss(r,t.firstPositive,t)+2:Ss(r,t.firstNegative,t)+2}function mh(e,t,r){let n=e[0];if(n>r.mostPositive||n<r.mostNegative)throw new Error("invalid firstChar on key");return n===r.mostPositive&&t==="positive"?Ss(n,r.mostNegative,r)+1+mh(e.slice(1),t,r):n===r.mostNegative&&t==="negative"?Ss(n,r.mostPositive,r)+1+mh(e.slice(1),t,r):t==="positive"?Ss(n,r.mostNegative,r)+2:Ss(n,r.mostPositive,r)+2}function _h(e,t,r,n,s){let i=s??Math.max(e.length,t.length);return r==="start"?[e.padStart(i,n),t.padStart(i,n)]:[e.padEnd(i,n),t.padEnd(i,n)]}function pce(e,t,r){let[n,s]=_h(e,t,"end",r.first),i=_S(n,s,r);i===1&&(n=n.padEnd(n.length+1,r.first),i=r.length);let o=_M(Math.floor(i/2),r);return vS(n,o,r)}function _S(e,t,r){let[n,s]=_h(e,t,"end",r.first).sort(),i=gM(s,n,r);return mce(i,r)}function vS(e,t,r){let n=r.length,[s,i]=_h(e,t,"start",r.first),o=[],a=0;for(let l=s.length-1;l>=0;l--){let c=r.byChar[s[l]],u=r.byChar[i[l]],f=c+u+a;a=Math.floor(f/n);let p=f%n;o.unshift(r.byCode[p])}return a>0&&o.unshift(r.byCode[a]),o.join("")}function gM(e,t,r){let n=r.length,[s,i]=_h(e,t,"start",r.first),o=[],a=0;for(let l=s.length-1;l>=0;l--){let c=r.byChar[s[l]],u=r.byChar[i[l]]+a;c<u?(a=1,c+=n):a=0;let f=c-u;o.unshift(r.byCode[f])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;o.length>1&&o[0]===r.byCode[0];)o.shift();return o.join("")}function yM(e,t){return vS(e,t.byCode[1],t)}function bS(e,t){return gM(e,t.byCode[1],t)}function _M(e,t){if(e===0)return t.byCode[0];let r="",n=t.length;for(;e>0;)r=t.byCode[e%n]+r,e=Math.floor(e/n);return r}function mce(e,t){let r=0,n=e.length,s=t.length;for(let i=0;i<n;i++)r+=t.byChar[e[i]]*Math.pow(s,n-i-1);return r}function gce(e){return e.firstPositive+e.byCode[0]}function yce(e,t){return SS(e,t)===e.length}function pM(e,t){gh(e,t)}function gh(e,t){let r=vM(e,t),n=SS(r,t);if(n>e.length)throw new Error("invalid order key length: "+e);return e.slice(0,n)}function bM(e,t){if(!yce(e,t))throw new Error("invalid integer length: "+e)}function SM(e,t){bM(e,t);let[r,n]=EM(e,t);if(n.split("").some(o=>o!==t.byCode[t.length-1])){let o=yM(n,t);return r+o}let i=bce(r,t);return wM(i,"lower",t)}function _ce(e,t){bM(e,t);let[r,n]=EM(e,t);if(n.split("").some(o=>o!==t.byCode[0])){let o=bS(n,t);return r+o}let i=Sce(r,t);return wM(i,"upper",t)}function vM(e,t){let r=0;if(e[0]===t.mostPositive)for(;e[r]===t.mostPositive;)r=r+1;if(e[0]===t.mostNegative)for(;e[r]===t.mostNegative;)r=r+1;return e.slice(0,r+1)}function EM(e,t){let r=vM(e,t),n=e.slice(r.length);return[r,n]}function bce(e,t){let r=e>=t.firstPositive,n=yM(e,t),s=e[e.length-1]===t.mostPositive,i=n[n.length-1]===t.mostPositive;return r&&i?n+t.mostNegative:!r&&s?e.slice(0,e.length-1):n}function Sce(e,t){let r=e>=t.firstPositive,n=e[e.length-1]===t.mostNegative;if(r&&n){let s=e.slice(0,e.length-1);return bS(s,t)}return!r&&n?e+t.mostPositive:bS(e,t)}function wM(e,t,r){let n=SS(e,r),s=t==="upper"?r.byCode[r.length-1]:r.byCode[0];return e+s.repeat(n-e.length)}function RM(e,t){let r=_M(Math.floor(Math.random()*t.jitterRange),t);return vS(e,r,t)}function vce(e,t,r){let n=e.padEnd(e.length+t,r.first);return RM(n,r)}function Ece(e,t,r){let n=gh(e,r),s=SM(n,r),i=0;if(t!==null){let a=_S(e,t,r);a<r.jitterRange+1&&(i=Math.max(i,mM(a,r)))}let o=_S(e,s,r);return o<r.jitterRange+1&&(i=Math.max(i,mM(o,r))),i}function mM(e,t){let r=t.jitterRange-e,n=Object.entries(t.paddingDict).find(([s,i])=>i>r);return n?parseInt(n[0]):0}function TM(e,t,r=yh()){if(e!==null&&pM(e,r),t!==null&&pM(t,r),e===null&&t===null)return gce(r);if(e===null){let n=gh(t,r);return _ce(n,r)}if(t===null){let n=gh(e,r);return SM(n,r)}if(e>=t)throw new Error(e+" >= "+t);return pce(e,t,r)}function ES(e,t,r,n=yh()){return OM(e,t,r,n,TM,ES)}function wS(e,t,r=yh()){let n=TM(e,t,r),s=Ece(n,t,r);return s?vce(n,s,r):RM(n,r)}function RS(e,t,r,n=yh()){return OM(e,t,r,n,wS,RS)}function OM(e,t,r,n,s,i){if(r===0)return[];if(r===1)return[s(e,t,n)];if(t==null){let l=s(e,t,n),c=[l];for(let u=0;u<r-1;u++)l=s(l,t,n),c.push(l);return c}if(e==null){let l=s(e,t,n),c=[l];for(let u=0;u<r-1;u++)l=s(e,l,n),c.push(l);return c.reverse(),c}let o=Math.floor(r/2),a=s(e,t,n);return[...i(e,a,o,n),a,...i(a,t,r-o-1,n)]}var wce=process.env.NODE_ENV==="test"?ES:RS;function TS(e){try{wS(e,null)}catch{throw new Error("invalid index: "+e)}}function bh(e,t="a1"){return[t,...wce(t,null,e)]}function hc(e,t){return e.index<t.index?-1:e.index>t.index?1:0}var O0e=Math.ceil(16.666666666666668);var ct=(e,t)=>{try{return new URL(e,t)}catch{return}};function Rce(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[e=>e&&JSON.parse(JSON.stringify(e)),!1]}var PM=Rce(),rt=PM[0],OS=PM[1],Sh=Object.getPrototypeOf(rt({}));tr("@tldraw/utils","3.11.0","esm");function AM(e){return e&&typeof e=="object"&&"parents"in e}function vh(e){for(let t=0,r=e.parents.length;t<r;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}function Go(e,t){if(e.children.remove(t)&&e.children.isEmpty&&AM(e))for(let r=0,n=e.parents.length;r<n;r++)Go(e.parents[r],e)}function pc(e,t){if(e.children.add(t)&&AM(e))for(let r=0,n=e.parents.length;r<n;r++)pc(e.parents[r],e)}function Eh(e,t){return e===t||Object.is(e,t)||!!(e&&t&&typeof e.equals=="function"&&e.equals(t))}function Kt(e,t){let r=Symbol.for(`com.tldraw.state/${e}`),n=globalThis;return n[r]??=t(),n[r]}var Wo=Kt("empty_array",()=>Object.freeze([]));var rn=class{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(t){if(this.array)return this.array.indexOf(t)!==-1?!1:this.arraySize<8?(this.array[this.arraySize]=t,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(t),!0);if(this.set)return this.set.has(t)?!1:(this.set.add(t),!0);throw new Error("no set or array")}remove(t){if(this.array){let r=this.array.indexOf(t);return r===-1?!1:(this.array[r]=void 0,this.arraySize--,r!==this.arraySize&&(this.array[r]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(t)?(this.set.delete(t),!0):!1;throw new Error("no set or array")}visit(t){if(this.array){for(let r=0;r<this.arraySize;r++){let n=this.array[r];typeof n<"u"&&t(n)}return}if(this.set){this.set.forEach(t);return}throw new Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let t=0;t<this.arraySize;t++){let r=this.array[t];typeof r<"u"&&(yield r)}else if(this.set)yield*this.set;else throw new Error("no set or array")}has(t){return this.array?this.array.indexOf(t)!==-1:this.set.has(t)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}};var vr=Symbol.for("com.tldraw.state/RESET_VALUE");var Ko=class{constructor(t){this.capacity=t,this.buffer=new Array(t)}index=0;buffer;pushEntry(t,r,n){if(n!==void 0){if(n===vr){this.clear();return}this.buffer[this.index]=[t,r,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(t){let{index:r,capacity:n,buffer:s}=this;for(let i=0;i<n;i++){let o=(r-1+n-i)%n,a=s[o];if(!a)return vr;let[l,c]=a;if(i===0&&t>=c)return[];if(l<=t&&t<c){let u=i+1,f=new Array(u);for(let p=0;p<u;p++)f[p]=s[(o+p)%n][2];return f}}return vr}};var PS=class{constructor(t,r){this.below=t,this.child=r}offset=0;maybeRemoved},Ye=Kt("capture",()=>({stack:null}));function wh(e){Ye.stack=new PS(Ye.stack,e),e.parentSet.clear()}function Rh(){let e=Ye.stack;if(Ye.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){let r=e.child.parents[t];e.child.parentSet.has(r)||Go(r,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){let r=e.maybeRemoved[t];e.child.parentSet.has(r)||Go(r,e.child)}}function Jo(e){if(Ye.stack){if(Ye.stack.child.parentSet.has(e))return;if(Ye.stack.child.parentSet.add(e),Ye.stack.child.isActivelyListening&&pc(e,Ye.stack.child),Ye.stack.offset<Ye.stack.child.parents.length){let r=Ye.stack.child.parents[Ye.stack.offset];r!==e&&(Ye.stack.maybeRemoved?Ye.stack.maybeRemoved.push(r):Ye.stack.maybeRemoved=[r])}Ye.stack.child.parents[Ye.stack.offset]=e,Ye.stack.child.parentEpochs[Ye.stack.offset]=e.lastChangedEpoch,Ye.stack.offset++}}var IS=class{constructor(t,r,n){this.name=t,this.runEffect=r,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentSet=new rn;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==vt()){if(this.parents.length&&!vh(this)){this.lastReactedEpoch=vt();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let t=0,r=this.parents.length;t<r;t++)pc(this.parents[t],this)}detach(){this._isActivelyListening=!1;for(let t=0,r=this.parents.length;t<r;t++)Go(this.parents[t],this)}execute(){try{wh(this);let t=vt(),r=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=t,r}finally{Rh()}}},AS=Kt("EffectScheduler",()=>IS);var CS=class{constructor(t){this.parent=t}initialAtomValues=new Map;get isRoot(){return this.parent===null}commit(){if(_e.globalIsReacting)for(let t of this.initialAtomValues.keys())kM(t);else this.isRoot?$M(this.initialAtomValues.keys()):this.initialAtomValues.forEach((t,r)=>{this.parent.initialAtomValues.has(r)||this.parent.initialAtomValues.set(r,t)})}abort(){_e.globalEpoch++,this.initialAtomValues.forEach((t,r)=>{r.set(t),r.historyBuffer?.clear()}),this.commit()}},_e=Kt("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0}));function CM(){return _e.reactionEpoch}function vt(){return _e.globalEpoch}function NM(){return _e.globalIsReacting}function NS(e,t){t.lastTraversedEpoch!==_e.globalEpoch&&(t.lastTraversedEpoch=_e.globalEpoch,t instanceof AS?e.add(t):t.children.visit(r=>NS(e,r)))}function $M(e){if(_e.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");let t=_e.currentTransaction;try{_e.currentTransaction=null,_e.globalIsReacting=!0,_e.reactionEpoch=_e.globalEpoch;let r=new Set;for(let s of e)s.children.visit(i=>NS(r,i));for(let s of r)s.maybeScheduleEffect();let n=0;for(;_e.cleanupReactors?.size;){if(n++>1e3)throw new Error("Reaction update depth limit exceeded");let s=_e.cleanupReactors;_e.cleanupReactors=null;for(let i of s)i.maybeScheduleEffect()}}finally{_e.cleanupReactors=null,_e.globalIsReacting=!1,_e.currentTransaction=t}}function xM(e,t){_e.currentTransaction?_e.currentTransaction.initialAtomValues.has(e)||_e.currentTransaction.initialAtomValues.set(e,t):_e.globalIsReacting?kM(e):$M([e])}function kM(e){let t=_e.cleanupReactors??=new Set;e.children.visit(r=>NS(t,r))}function LM(){_e.globalEpoch++}function Th(e){let t=new CS(_e.currentTransaction);_e.currentTransaction=t;try{let r,n=!1;try{r=e(()=>n=!0)}catch(s){throw t.abort(),s}return n?t.abort():t.commit(),r}finally{_e.currentTransaction=_e.currentTransaction.parent}}var $S=class{constructor(t,r,n){this.name=t,this.current=r,this.isEqual=n?.isEqual??null,n&&(n.historyLength&&(this.historyBuffer=new Ko(n.historyLength)),this.computeDiff=n.computeDiff)}isEqual;computeDiff;lastChangedEpoch=vt();children=new rn;historyBuffer;__unsafe__getWithoutCapture(t){return this.current}get(){return Jo(this),this.current}set(t,r){if(this.isEqual?.(this.current,t)??Eh(this.current,t))return this.current;LM(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,vt(),r??this.computeDiff?.(this.current,t,this.lastChangedEpoch,vt())??vr),this.lastChangedEpoch=vt();let n=this.current;return this.current=t,xM(this,n),t}update(t){return this.set(t(this.current))}getDiffSince(t){return Jo(this),t>=this.lastChangedEpoch?Wo:this.historyBuffer?.getChangesSince(t)??vr}},DM=Kt("Atom",()=>$S);function yi(e,t,r){return new DM(e,t,r)}var Yo=Symbol.for("com.tldraw.state/UNINITIALIZED");var qM=Kt("WithDiff",()=>class{constructor(t,r){this.value=t,this.diff=r}});var xS=class{constructor(t,r,n){this.name=t,this.derive=r,n?.historyLength&&(this.historyBuffer=new Ko(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??Eh}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parentSet=new rn;parents=[];parentEpochs=[];children=new rn;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=Yo;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(t){let r=this.lastChangedEpoch===-1,n=vt();if(!r&&(this.lastCheckedEpoch===n||this.isActivelyListening&&NM()&&this.lastTraversedEpoch<CM()||!vh(this)))if(this.lastCheckedEpoch=n,this.error){if(t)return this.state;throw this.error.thrownValue}else return this.state;try{wh(this);let s=this.derive(this.state,this.lastCheckedEpoch),i=s instanceof qM?s.value:s,o=this.state===Yo;if(o||!this.isEqual(i,this.state)){if(this.historyBuffer&&!o){let a=s instanceof qM?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,vt(),a??this.computeDiff?.(this.state,i,this.lastCheckedEpoch,vt())??vr)}this.lastChangedEpoch=vt(),this.state=i}return this.error=null,this.lastCheckedEpoch=vt(),this.state}catch(s){if(this.state!==Yo&&(this.state=Yo,this.lastChangedEpoch=vt()),this.lastCheckedEpoch=vt(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!t)throw s;return this.state}finally{Rh()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Jo(this)}}getDiffSince(t){return this.__unsafe__getWithoutCapture(!0),Jo(this),t>=this.lastChangedEpoch?Wo:this.historyBuffer?.getChangesSince(t)??vr}},$ce=Kt("Computed",()=>xS);var MM=1,qce=Kt("apiVersion",()=>MM);if(qce!==MM)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");tr("@tldraw/state","3.11.0","esm");var Mce=/^(\d+)_(.*)$/,Oh=class{state="idle";handleMessage(t){if(t.startsWith("{")){let r=this.state==="idle"?void 0:new Error("Unexpected non-chunk message");return this.state="idle",r?{error:r}:{data:JSON.parse(t),stringified:t}}else{let r=Mce.exec(t);if(!r)return this.state="idle",{error:new Error("Invalid chunk: "+JSON.stringify(t.slice(0,20)+"..."))};let n=Number(r[1]),s=r[2];if(this.state==="idle")this.state={chunksReceived:[s],totalChunks:n+1};else if(this.state.chunksReceived.push(s),n!==this.state.totalChunks-this.state.chunksReceived.length)return this.state="idle",{error:new Error("Chunks received in wrong order")};if(this.state.chunksReceived.length===this.state.totalChunks)try{let i=this.state.chunksReceived.join("");return{data:JSON.parse(i),stringified:i}}catch(i){return{error:i}}finally{this.state="idle"}return null}}};var jce=5,Ph=1<<jce,gve=Ph-1;var yve=Ph/4,_ve=Ph/2,bve=Ph/4;var Xo=class e{constructor(t,r){this.typeName=t,this.createDefaultProperties=r.createDefaultProperties,this.validator=r.validator??{validate:s=>s},this.scope=r.scope??"document",this.ephemeralKeys=r.ephemeralKeys;let n=new Set;if(r.ephemeralKeys)for(let[s,i]of St(r.ephemeralKeys))i&&n.add(s);this.ephemeralKeySet=n}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(t){let r={...this.createDefaultProperties(),id:this.createId()};for(let[n,s]of Object.entries(t))s!==void 0&&(r[n]=s);return r.typeName=this.typeName,r}clone(t){return{...rt(t),id:this.createId()}}createId(t){return this.typeName+":"+(t??_s())}createCustomId(t){return this.typeName+":"+t}parseId(t){if(!this.isId(t))throw new Error(`ID "${t}" is not a valid ID for type "${this.typeName}"`);return t.slice(this.typeName.length+1)}isInstance(t){return t?.typeName===this.typeName}isId(t){if(!t)return!1;for(let r=0;r<this.typeName.length;r++)if(t[r]!==this.typeName[r])return!1;return t[this.typeName.length]===":"}withDefaultProperties(t){return new e(this.typeName,{createDefaultProperties:t,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(t,r){return r&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(r,t):this.validator.validate(t)}};function Xe(e,t){return new Xo(e,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}var yfe=Tr(Sc(),1);function Efe(e){let t=[];for(let r=e.length-1;r>=0;r--){let n=e[r];if("id"in n)t.unshift(n);else{let s=n.dependsOn,i=t[0];i&&(t[0]={...i,dependsOn:s.concat(i.dependsOn??[])})}}return t}function on({sequence:e,sequenceId:t,retroactive:r=!0}){let n={sequenceId:t,retroactive:r,sequence:Efe(e)};return WS(n),n}function be(e,t){return Object.fromEntries(St(t).map(([r,n])=>[r,`${e}/${n}`]))}function Te(e){let t=e.sequenceId;return on({sequenceId:t,retroactive:e.retroactive??!0,sequence:e.sequence.map(r=>"id"in r?{...r,scope:"record",filter:n=>n.typeName===e.recordType&&(r.filter?.(n)??!0)&&(e.filter?.(n)??!0)}:r)})}function vj(e){let t=new Map(e.map(i=>[i.id,i])),r=new Set,n=[];function s(i){Be(!r.has(i.id),`Circular dependency in migrations: ${i.id}`),r.add(i.id);let{version:o,sequenceId:a}=ta(i.id),l=t.get(`${a}/${o-1}`);if(l&&s(l),i.dependsOn)for(let c of i.dependsOn){let u=t.get(c);u&&s(u)}t.delete(i.id),n.push(i)}for(let i of t.values())s(i);return n}function ta(e){let[t,r]=e.split("/");return{sequenceId:t,version:parseInt(r)}}function Sj(e,t){t&&Be(e.startsWith(t+"/"),`Every migration in sequence '${t}' must have an id starting with '${t}/'. Got invalid id: '${e}'`),Be(e.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${e}'`)}function WS(e){if(Be(!e.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${e.sequenceId}`),Be(e.sequenceId.length,"sequenceId must be a non-empty string"),e.sequence.length===0)return;Sj(e.sequence[0].id,e.sequenceId);let t=ta(e.sequence[0].id).version;Be(t===1,`Expected the first migrationId to be '${e.sequenceId}/1' but got '${e.sequence[0].id}'`);for(let r=1;r<e.sequence.length;r++){let n=e.sequence[r].id;Sj(n,e.sequenceId);let s=ta(n).version;Be(s===t+1,`Migration id numbers must increase in increments of 1, expected ${e.sequenceId}/${t+1} but got '${e.sequence[r].id}'`),t=s}}var Ct=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(Ct||{});function wfe(e){if(e.schemaVersion>2||e.schemaVersion<1)return He.err("Bad schema version");if(e.schemaVersion===2)return He.ok(e);let t={schemaVersion:2,sequences:{"com.tldraw.store":e.storeVersion}};for(let[r,n]of Object.entries(e.recordVersions))if(t.sequences[`com.tldraw.${r}`]=n.version,"subTypeKey"in n)for(let[s,i]of Object.entries(n.subTypeVersions))t.sequences[`com.tldraw.${r}.${s}`]=i;return He.ok(t)}var vc=class e{constructor(t,r){this.types=t,this.options=r;for(let s of r.migrations??[])Be(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),WS(s),this.migrations[s.sequenceId]=s;let n=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=vj(n);for(let s of this.sortedMigrations)if(s.dependsOn?.length)for(let i of s.dependsOn){let o=n.find(a=>a.id===i);Be(o,`Migration '${s.id}' depends on missing migration '${i}'`)}}static create(t,r){return new e(t,r??{})}migrations={};sortedMigrations;validateRecord(t,r,n,s){try{let i=bt(this.types,r.typeName);if(!i)throw new Error(`Missing definition for record type ${r.typeName}`);return i.validate(r,s??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:t,record:r,phase:n,recordBefore:s,error:i});throw i}}getMigrationsSince(t){let r=wfe(t);if(!r.ok)return r;let n=r.value,s=new Set(Object.keys(n.sequences).filter(o=>this.migrations[o]));for(let o in this.migrations)n.sequences[o]===void 0&&this.migrations[o].retroactive&&s.add(o);if(s.size===0)return He.ok([]);let i=new Set;for(let o of s){let a=n.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(let u of this.migrations[o].sequence)i.add(u.id);continue}let l=`${o}/${a}`,c=this.migrations[o].sequence.findIndex(u=>u.id===l);if(c===-1)return He.err("Incompatible schema?");for(let u of this.migrations[o].sequence.slice(c+1))i.add(u.id)}return He.ok(this.sortedMigrations.filter(({id:o})=>i.has(o)))}migratePersistedRecord(t,r,n="up"){let s=this.getMigrationsSince(r);if(!s.ok)return console.error("Error migrating record",s.error),{type:"error",reason:Ct.MigrationError};let i=s.value;if(i.length===0)return{type:"success",value:t};if(i.some(o=>o.scope==="store"))return{type:"error",reason:n==="down"?Ct.TargetVersionTooOld:Ct.TargetVersionTooNew};if(n==="down"){if(!i.every(o=>o.down))return{type:"error",reason:Ct.TargetVersionTooOld};i=i.slice().reverse()}t=rt(t);try{for(let o of i){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(t):!0))continue;let l=o[n](t);l&&(t=rt(l))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Ct.MigrationError}}return{type:"success",value:t}}migrateStoreSnapshot(t){let{store:r}=t,n=this.getMigrationsSince(t.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:Ct.MigrationError};let s=n.value;if(s.length===0)return{type:"success",value:r};r=rt(r);try{for(let i of s)if(i.scope==="record")for(let[o,a]of Object.entries(r)){if(!(i.filter?i.filter(a):!0))continue;let c=i.up(a);c&&(r[o]=rt(c))}else if(i.scope==="store"){let o=i.up(r);o&&(r=rt(o))}else kn(i)}catch(i){return console.error("Error migrating store",i),{type:"error",reason:Ct.MigrationError}}return{type:"success",value:r}}createIntegrityChecker(t){return this.options.createIntegrityChecker?.(t)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:t,sequence:r})=>[t,r.length?ta(r.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:t})=>[t,0]))}}getType(t){let r=bt(this.types,t);return Be(r,"record type does not exists"),r}};tr("@tldraw/store","3.11.0","esm");var Pfe=Tr(Sc(),1);var ra=Tr(Sc(),1),Ze={Put:"put",Patch:"patch",Remove:"remove"};var nt={Put:"put",Delete:"delete",Append:"append",Patch:"patch"};function jh(e,t){return KS(e,t,new Set(["props"]))}function KS(e,t,r){if(e===t)return null;let n=null;for(let s of Object.keys(e)){if(!(s in t)){n||(n={}),n[s]=[nt.Delete];continue}let i=e[s],o=t[s];if(!(0,ra.default)(i,o))if(r?.has(s)&&i&&o){let a=KS(i,o);a&&(n||(n={}),n[s]=[nt.Patch,a])}else if(Array.isArray(o)&&Array.isArray(i)){let a=Ej(i,o);a&&(n||(n={}),n[s]=a)}else n||(n={}),n[s]=[nt.Put,o]}for(let s of Object.keys(t))s in e||(n||(n={}),n[s]=[nt.Put,t[s]]);return n}function Tfe(e,t){if(Object.is(e,t))return null;if(Array.isArray(e)&&Array.isArray(t))return Ej(e,t);if(!e||!t||typeof e!="object"||typeof t!="object")return(0,ra.default)(e,t)?null:[nt.Put,t];{let r=KS(e,t);return r?[nt.Patch,r]:null}}function Ej(e,t){if(Object.is(e,t))return null;if(e.length===t.length){let r=Math.max(e.length/5,1),n=[];for(let i=0;i<e.length;i++)if(!(0,ra.default)(e[i],t[i])&&(n.push(i),n.length>r))return[nt.Put,t];if(n.length===0)return null;let s={};for(let i of n){let o=e[i],a=t[i];if(!o||!a)s[i]=[nt.Put,a];else if(typeof o=="object"&&typeof a=="object"){let l=Tfe(o,a);l&&(s[i]=l)}else s[i]=[nt.Put,a]}return[nt.Patch,s]}for(let r=0;r<e.length;r++)if(!(0,ra.default)(e[r],t[r]))return[nt.Put,t];return[nt.Append,t.slice(e.length),e.length]}function na(e,t){if(!e||typeof e!="object")return e;let r=Array.isArray(e),n,s=(i,o)=>{n||(r?n=[...e]:n={...e}),r?n[Number(i)]=o:n[i]=o};for(let[i,o]of Object.entries(t))switch(o[0]){case nt.Put:{let a=o[1];(0,ra.default)(e[i],a)||s(i,a);break}case nt.Append:{let a=o[1],l=o[2],c=e[i];Array.isArray(c)&&c.length===l&&s(i,[...c,...a]);break}case nt.Patch:{if(e[i]&&typeof e[i]=="object"){let a=o[1],l=na(e[i],a);l!==e[i]&&s(i,l)}break}case nt.Delete:i in e&&(n||(r?(console.error("Can't delete array item yet (this should never happen)"),n=[...e]):n={...e}),delete n[i])}return n??e}function JS(e,t){let r=setInterval(e,t);return()=>clearInterval(r)}function Ei(){return 7}var sa={ClientTooOld:"clientTooOld",ServerTooOld:"serverTooOld",InvalidRecord:"invalidRecord",InvalidOperation:"invalidOperation"};var Fh=4099,Se={NOT_FOUND:"NOT_FOUND",FORBIDDEN:"FORBIDDEN",NOT_AUTHENTICATED:"NOT_AUTHENTICATED",UNKNOWN_ERROR:"UNKNOWN_ERROR",CLIENT_TOO_OLD:"CLIENT_TOO_OLD",SERVER_TOO_OLD:"SERVER_TOO_OLD",INVALID_RECORD:"INVALID_RECORD",RATE_LIMITED:"RATE_LIMITED",ROOM_FULL:"ROOM_FULL"},Ife=5e3,LEe=Ife*2;var VEe=1e3*60*5;var Nt={AwaitingConnectMessage:"awaiting-connect-message",AwaitingRemoval:"awaiting-removal",Connected:"connected"},wj=1e4,Rj=5e3,Tj=2e4;var E={};L2(E,{ArrayOfValidator:()=>Ec,DictValidator:()=>Rc,ObjectValidator:()=>wc,UnionValidator:()=>ia,ValidationError:()=>te,Validator:()=>st,any:()=>$fe,array:()=>YS,arrayOf:()=>Ffe,bigint:()=>Mfe,boolean:()=>qfe,dict:()=>Oj,httpUrl:()=>Zfe,indexKey:()=>Qfe,integer:()=>QS,jsonDict:()=>Hfe,jsonValue:()=>wi,linkUrl:()=>Jfe,literal:()=>jfe,literalEnum:()=>Wfe,model:()=>Gfe,nonZeroInteger:()=>Dfe,nonZeroNumber:()=>kfe,nullable:()=>Aj,number:()=>Uh,numberUnion:()=>zfe,object:()=>Ufe,optional:()=>Ij,or:()=>ede,positiveInteger:()=>Lfe,positiveNumber:()=>xfe,setEnum:()=>Pj,srcUrl:()=>Xfe,string:()=>oa,union:()=>Bfe,unknown:()=>Nfe,unknownObject:()=>Vfe});function Cfe(e){if(!e.length)return null;let t="";for(let r of e)typeof r=="number"?t+=`.${r}`:r.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${r.slice(1)}`:t+=r:t+=`.${r}`;return t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),t.startsWith(".")?t.slice(1):t}var te=class extends Error{constructor(t,r=[]){let n=Cfe(r),s=t.split(`
`).map((i,o)=>o===0?i:`  ${i}`).join(`
`);super(r?`At ${n}: ${s}`:s),this.rawMessage=t,this.path=r}name="ValidationError"};function Jt(e,t){try{return t()}catch(r){throw r instanceof te?new te(r.rawMessage,[e,...r.path]):new te(r.toString(),[e])}}function qn(e){if(e===null)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:kn(t)}}var st=class e{constructor(t,r){this.validationFn=t,this.validateUsingKnownGoodVersionFn=r}validate(t){let r=this.validationFn(t);if(process.env.NODE_ENV!=="production"&&!Object.is(t,r))throw new te("Validator functions must return the same value they were passed");return r}validateUsingKnownGoodVersion(t,r){return Object.is(t,r)?t:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(t,r):this.validate(r)}isValid(t){try{return this.validate(t),!0}catch{return!1}}nullable(){return Aj(this)}optional(){return Ij(this)}refine(t){return new e(r=>t(this.validate(r)),(r,n)=>{let s=this.validateUsingKnownGoodVersion(r,n);return Object.is(r,s)?r:t(s)})}check(t,r){return typeof t=="string"?this.refine(n=>(Jt(`(check ${t})`,()=>r(n)),n)):this.refine(n=>(t(n),n))}},Ec=class extends st{constructor(t){super(r=>{let n=YS.validate(r);for(let s=0;s<n.length;s++)Jt(s,()=>t.validate(n[s]));return n},(r,n)=>{if(!t.validateUsingKnownGoodVersion)return this.validate(n);let s=YS.validate(n),i=r.length!==s.length;for(let o=0;o<s.length;o++){let a=s[o];if(o>=r.length){i=!0,Jt(o,()=>t.validate(a));continue}if(Object.is(r[o],a))continue;let l=Jt(o,()=>t.validateUsingKnownGoodVersion(r[o],a));Object.is(l,r[o])||(i=!0)}return i?n:r}),this.itemValidator=t}nonEmpty(){return this.check(t=>{if(t.length===0)throw new te("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(t=>{if(t.length<=1)throw new te("Expected an array with length greater than 1")})}},wc=class e extends st{constructor(t,r=!1){super(n=>{if(typeof n!="object"||n===null)throw new te(`Expected object, got ${qn(n)}`);for(let[s,i]of Object.entries(t))Jt(s,()=>{i.validate(bt(n,s))});if(!r){for(let s of Object.keys(n))if(!qt(t,s))throw new te("Unexpected property",[s])}return n},(n,s)=>{if(typeof s!="object"||s===null)throw new te(`Expected object, got ${qn(s)}`);let i=!1;for(let[o,a]of Object.entries(t)){let l=bt(n,o),c=bt(s,o);if(Object.is(l,c))continue;let u=Jt(o,()=>{let f=a;return f.validateUsingKnownGoodVersion?f.validateUsingKnownGoodVersion(l,c):f.validate(c)});Object.is(u,l)||(i=!0)}if(!r){for(let o of Object.keys(s))if(!qt(t,o))throw new te("Unexpected property",[o])}for(let o of Object.keys(n))if(!qt(s,o)){i=!0;break}return i?s:n}),this.config=t,this.shouldAllowUnknownProperties=r}allowUnknownProperties(){return new e(this.config,!0)}extend(t){return new e({...this.config,...t})}},ia=class e extends st{constructor(t,r,n,s){super(i=>{this.expectObject(i);let{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(i);return o===void 0?this.unknownValueValidation(i,a):Jt(`(${t} = ${a})`,()=>o.validate(i))},(i,o)=>{this.expectObject(o),this.expectObject(i);let{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,l):bt(i,t)!==bt(o,t)?Jt(`(${t} = ${l})`,()=>a.validate(o)):Jt(`(${t} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(i,o):a.validate(o))}),this.key=t,this.config=r,this.unknownValueValidation=n,this.useNumberKeys=s}expectObject(t){if(typeof t!="object"||t===null)throw new te(`Expected an object, got ${qn(t)}`,[])}getMatchingSchemaAndVariant(t){let r=bt(t,this.key);if(!this.useNumberKeys&&typeof r!="string")throw new te(`Expected a string for key "${this.key}", got ${qn(r)}`);if(this.useNumberKeys&&!Number.isFinite(Number(r)))throw new te(`Expected a number for key "${this.key}", got "${r}"`);return{matchingSchema:qt(this.config,r)?this.config[r]:void 0,variant:r}}validateUnknownVariants(t){return new e(this.key,this.config,t,this.useNumberKeys)}},Rc=class extends st{constructor(t,r){super(n=>{if(typeof n!="object"||n===null)throw new te(`Expected object, got ${qn(n)}`);for(let[s,i]of Object.entries(n))Jt(s,()=>{t.validate(s),r.validate(i)});return n},(n,s)=>{if(typeof s!="object"||s===null)throw new te(`Expected object, got ${qn(s)}`);let i=!1;for(let[o,a]of Object.entries(s)){if(!qt(n,o)){i=!0,Jt(o,()=>{t.validate(o),r.validate(a)});continue}let l=bt(n,o),c=a;if(Object.is(l,c))continue;let u=Jt(o,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(l,c):r.validate(c));Object.is(u,l)||(i=!0)}for(let o of Object.keys(n))if(!qt(s,o)){i=!0;break}return i?s:n}),this.keyValidator=t,this.valueValidator=r}};function Vh(e){return new st(t=>{if(typeof t!==e)throw new te(`Expected ${e}, got ${qn(t)}`);return t})}var Nfe=new st(e=>e),$fe=new st(e=>e),oa=Vh("string"),Uh=Vh("number").check(e=>{if(Number.isNaN(e))throw new te("Expected a number, got NaN");if(!Number.isFinite(e))throw new te(`Expected a finite number, got ${e}`)}),xfe=Uh.check(e=>{if(e<0)throw new te(`Expected a positive number, got ${e}`)}),kfe=Uh.check(e=>{if(e<=0)throw new te(`Expected a non-zero positive number, got ${e}`)}),QS=Uh.check(e=>{if(!Number.isInteger(e))throw new te(`Expected an integer, got ${e}`)}),Lfe=QS.check(e=>{if(e<0)throw new te(`Expected a positive integer, got ${e}`)}),Dfe=QS.check(e=>{if(e<=0)throw new te(`Expected a non-zero positive integer, got ${e}`)}),qfe=Vh("boolean"),Mfe=Vh("bigint");function jfe(e){return new st(t=>{if(t!==e)throw new te(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}var YS=new st(e=>{if(!Array.isArray(e))throw new te(`Expected an array, got ${qn(e)}`);return e});function Ffe(e){return new Ec(e)}var Vfe=new st(e=>{if(typeof e!="object"||e===null)throw new te(`Expected object, got ${qn(e)}`);return e});function Ufe(e){return new wc(e)}function XS(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null||Object.getPrototypeOf(e)===Sh)}function ZS(e){return e===null||typeof e=="number"||typeof e=="string"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(ZS):XS(e)?Object.values(e).every(ZS):!1}var wi=new st(e=>{if(ZS(e))return e;throw new te(`Expected json serializable value, got ${typeof e}`)},(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let r=e.length!==t.length;for(let n=0;n<t.length;n++){if(n>=e.length){r=!0,wi.validate(t[n]);continue}let s=e[n],i=t[n];if(Object.is(s,i))continue;let o=wi.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(r=!0)}return r?t:e}else if(XS(e)&&XS(t)){let r=!1;for(let n of Object.keys(t)){if(!qt(e,n)){r=!0,wi.validate(t[n]);continue}let s=e[n],i=t[n];if(Object.is(s,i))continue;let o=wi.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(r=!0)}for(let n of Object.keys(e))if(!qt(t,n)){r=!0;break}return r?t:e}else return wi.validate(t)});function Hfe(){return Oj(oa,wi)}function Oj(e,t){return new Rc(e,t)}function Bfe(e,t){return new ia(e,t,(r,n)=>{throw new te(`Expected one of ${Object.keys(t).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(n)}`,[e])},!1)}function zfe(e,t){return new ia(e,t,(r,n)=>{throw new te(`Expected one of ${Object.keys(t).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(n)}`,[e])},!0)}function Gfe(e,t){return new st(r=>Jt(e,()=>t.validate(r)),(r,n)=>Jt(e,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(r,n):t.validate(n)))}function Pj(e){return new st(t=>{if(!e.has(t)){let r=Array.from(e,n=>JSON.stringify(n)).join(" or ");throw new te(`Expected ${r}, got ${t}`)}return t})}function Ij(e){return new st(t=>{if(t!==void 0)return e.validate(t)},(t,r)=>{if(!(t===void 0&&r===void 0)&&r!==void 0)return e.validateUsingKnownGoodVersion&&t!==void 0?e.validateUsingKnownGoodVersion(t,r):e.validate(r)})}function Aj(e){return new st(t=>t===null?null:e.validate(t),(t,r)=>r===null?null:e.validateUsingKnownGoodVersion&&t!==null?e.validateUsingKnownGoodVersion(t,r):e.validate(r))}function Wfe(...e){return Pj(new Set(e))}function ev(e){try{return new URL(e)}catch{if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch{throw new te(`Expected a valid url, got ${JSON.stringify(e)}`)}throw new te(`Expected a valid url, got ${JSON.stringify(e)}`)}}var Kfe=new Set(["http:","https:","mailto:"]),Jfe=oa.check(e=>{if(e==="")return;let t=ev(e);if(!Kfe.has(t.protocol.toLowerCase()))throw new te(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),Yfe=new Set(["http:","https:","data:","asset:"]),Xfe=oa.check(e=>{if(e==="")return;let t=ev(e);if(!Yfe.has(t.protocol.toLowerCase()))throw new te(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),Zfe=oa.check(e=>{if(e==="")return;if(!ev(e).protocol.toLowerCase().match(/^https?:$/))throw new te(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),Qfe=oa.refine(e=>{try{return TS(e),e}catch{throw new te(`Expected an index key, got ${JSON.stringify(e)}`)}});function ede(e,t){return new st(r=>{try{return e.validate(r)}catch{return t.validate(r)}})}tr("@tldraw/validate","3.11.0","esm");function qe(e){return E.string.refine(t=>{if(!t.startsWith(`${e}:`))throw new Error(`${e} ID must start with "${e}:"`);return t})}var ws=qe("asset");function Ri(e,t){return E.object({id:ws,typeName:E.literal("asset"),type:E.literal(e),props:t,meta:E.jsonValue})}var rr=E.object({x:E.number,y:E.number,z:E.number.optional()}),Rs=E.object({x:E.number,y:E.number,w:E.number,h:E.number});var Tc=E.number.check(e=>{if(e<0||e>1)throw new E.ValidationError("Opacity must be between 0 and 1")});var Cj=E.string.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e}),nr=qe("shape");function tv(e,t,r){return E.object({id:nr,typeName:E.literal("shape"),x:E.number,y:E.number,rotation:E.number,index:E.indexKey,parentId:Cj,type:E.literal(e),isLocked:E.boolean,opacity:Tc,props:t?E.object(t):E.jsonValue,meta:r?E.object(r):E.jsonValue})}var Nj=qe("binding");function rv(e,t,r){return E.object({id:Nj,typeName:E.literal("binding"),type:E.literal(e),fromId:nr,toId:nr,props:t?E.object(t):E.jsonValue,meta:r?E.object(r):E.jsonValue})}var gwe=be("com.tldraw.binding",{}),tde=Te({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Hh(e){return`binding:${e??_s()}`}function $j(e){return Xe("binding",{scope:"document",validator:E.model("binding",E.union("type",zo(e,(t,{props:r,meta:n})=>rv(t,r,n))))}).withDefaultProperties(()=>({meta:{}}))}var ye=class e{constructor(t,r,n){this.id=t,this.defaultValue=r,this.type=n}static define(t,r){let{defaultValue:n,type:s=E.any}=r;return new e(t,n,s)}static defineEnum(t,r){let{defaultValue:n,values:s}=r;return new Bh(t,n,s)}setDefaultValue(t){this.defaultValue=t}validate(t){return this.type.validate(t)}validateUsingKnownGoodVersion(t,r){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(t,r):this.validate(r)}},Bh=class extends ye{constructor(t,r,n){super(t,r,E.literalEnum(...n)),this.values=n}};var zh=be("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),nv=Te({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:zh.AddIsLocked,up:e=>{e.isLocked=!1},down:e=>{delete e.isLocked}},{id:zh.HoistOpacity,up:e=>{e.opacity=Number(e.props.opacity??"1"),delete e.props.opacity},down:e=>{let t=e.opacity;delete e.opacity,e.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:zh.AddMeta,up:e=>{e.meta={}}},{id:zh.AddWhite,up:e=>{},down:e=>{e.props.color==="white"&&(e.props.color="black")}}]});function sv(e){let t=new Map;for(let[r,n]of Object.entries(e))if(n instanceof ye){if(t.has(n))throw new Error(`Duplicate style prop ${n.id}. Each style prop can only be used once within a shape.`);t.set(n,r)}return t}function Me(e,t){return zo(t,(r,n)=>`com.tldraw.shape.${e}/${n}`)}function xj(e){return Xe("shape",{scope:"document",validator:E.model("shape",E.union("type",zo(e,(t,{props:r,meta:n})=>tv(t,r,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function iv(e,t){let r=[];for(let[n,{migrations:s}]of Object.entries(t)){let i=`com.tldraw.${e}.${n}`;s?"sequenceId"in s?(Be(i===s.sequenceId,`sequenceId mismatch for ${n} ${Xo} migrations. Expected '${i}', got '${s.sequenceId}'`),r.push(s)):"sequence"in s?r.push(on({sequenceId:i,retroactive:!1,sequence:s.sequence.map(o=>"id"in o?ov(e,n,o):o)})):r.push(on({sequenceId:i,retroactive:!1,sequence:Object.keys(s.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${i}/${o}`,scope:"record",filter:a=>a.typeName===e&&a.type===n,up:a=>{let l=s.migrators[o].up(a);if(l)return l},down:a=>{let l=s.migrators[o].down(a);if(l)return l}}))})):r.push(on({sequenceId:i,retroactive:!1,sequence:[]}))}return r}function ov(e,t,r){return{id:r.id,dependsOn:r.dependsOn,scope:"record",filter:n=>n.typeName===e&&n.type===t,up:n=>{let s=r.up(n.props);s&&(n.props=s)},down:typeof r.down=="function"?n=>{let s=r.down(n.props);s&&(n.props=s)}:void 0}}var av=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"];var Mt=ye.defineEnum("tldraw:color",{defaultValue:"black",values:av}),aa=ye.defineEnum("tldraw:labelColor",{defaultValue:"black",values:av});var Mn=ye.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]});var Ti=ye.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]});var jn=ye.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]});var jt=ye.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]});var kj=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Lj=ye.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:kj}),Dj=ye.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:kj}),lv={labelColor:aa,color:Mt,fill:Ti,dash:Mn,size:jt,arrowheadStart:Lj,arrowheadEnd:Dj,font:jn,start:rr,end:rr,bend:E.number,text:E.string,labelPosition:E.number,scale:E.nonZeroNumber},Oi=Me("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Gh(e){return ov("shape","arrow",e)}var cv=on({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Gh({id:Oi.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"}),Gh({id:Oi.AddIsPrecise,up:({start:e,end:t})=>{e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5)),t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5))},down:({start:e,end:t})=>{e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise),t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise)}}),Gh({id:Oi.AddLabelPosition,up:e=>{e.labelPosition=.5},down:e=>{delete e.labelPosition}}),{id:Oi.ExtractBindings,scope:"store",up:e=>{let t=Object.values(e).filter(r=>r.typeName==="shape"&&r.type==="arrow");for(let r of t){let{start:n,end:s}=r.props;if(n.type==="binding"){let i=Hh(),o={typeName:"binding",id:i,type:"arrow",fromId:r.id,toId:n.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:n.normalizedAnchor,isExact:n.isExact,isPrecise:n.isPrecise}};e[i]=o,r.props.start={x:0,y:0}}else delete r.props.start.type;if(s.type==="binding"){let i=Hh(),o={typeName:"binding",id:i,type:"arrow",fromId:r.id,toId:s.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};e[i]=o,r.props.end={x:0,y:0}}else delete r.props.end.type}}},Gh({id:Oi.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}})]});var uv={terminal:E.literalEnum("start","end"),normalizedAnchor:rr,isExact:E.boolean,isPrecise:E.boolean};var fv={sequence:[{dependsOn:[Oi.ExtractBindings]}]};var nde=E.model("camera",E.object({typeName:E.literal("camera"),id:qe("camera"),x:E.number,y:E.number,z:E.number,meta:E.jsonValue})),sde=be("com.tldraw.camera",{AddMeta:1}),qj=Te({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:sde.AddMeta,up:e=>{e.meta={}}}]}),Pi=Xe("camera",{validator:nde,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}}));var Mj=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),dv=E.setEnum(Mj),jj=E.object({type:dv,rotation:E.number});var Fj=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),hv=E.setEnum(Fj);var Vj=new Set(["starting","paused","active","stopping"]),Oc=E.object({id:E.string,points:E.arrayOf(rr),size:E.positiveNumber,color:hv,opacity:E.number,state:E.setEnum(Vj),delay:E.number,shrink:E.number,taper:E.boolean});var la=qe("page"),ide=E.model("page",E.object({typeName:E.literal("page"),id:la,name:E.string,index:E.indexKey,meta:E.jsonValue})),ode=be("com.tldraw.page",{AddMeta:1}),Uj=Te({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:ode.AddMeta,up:e=>{e.meta={}}}]}),Ii=Xe("page",{validator:ide,scope:"document"}).withDefaultProperties(()=>({meta:{}}));var IRe=qe("instance");function Hj(e){let t={};for(let[n,s]of e)t[n]=E.optional(s);let r=E.model("instance",E.object({typeName:E.literal("instance"),id:qe("instance"),currentPageId:la,followingUserId:E.string.nullable(),brush:Rs.nullable(),opacityForNextShape:Tc,stylesForNextShape:E.object(t),cursor:jj,scribbles:E.arrayOf(Oc),isFocusMode:E.boolean,isDebugMode:E.boolean,isToolLocked:E.boolean,exportBackground:E.boolean,screenBounds:Rs,insets:E.arrayOf(E.boolean),zoomBrush:Rs.nullable(),isPenMode:E.boolean,isGridMode:E.boolean,chatMessage:E.string,isChatting:E.boolean,highlightedUserIds:E.arrayOf(E.string),isFocused:E.boolean,devicePixelRatio:E.number,isCoarsePointer:E.boolean,isHoveringCanvas:E.boolean.nullable(),openMenus:E.arrayOf(E.string),isChangingStyle:E.boolean,isReadonly:E.boolean,meta:E.jsonValue,duplicateProps:E.object({shapeIds:E.arrayOf(qe("shape")),offset:E.object({x:E.number,y:E.number})}).nullable()}));return Xe("instance",{validator:r,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}var ke=be("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),Bj=Te({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:ke.AddTransparentExportBgs,up:e=>({...e,exportBackground:!0})},{id:ke.RemoveDialog,up:({dialog:e,...t})=>t},{id:ke.AddToolLockMode,up:e=>({...e,isToolLocked:!1})},{id:ke.RemoveExtraPropsForNextShape,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([r])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(r)))})},{id:ke.AddLabelColor,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}})},{id:ke.AddFollowingUserId,up:e=>({...e,followingUserId:null})},{id:ke.RemoveAlignJustify,up:e=>{let t=e.propsForNextShape.align;return t==="justify"&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}}},{id:ke.AddZoom,up:e=>({...e,zoomBrush:null})},{id:ke.AddVerticalAlign,up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}})},{id:ke.AddScribbleDelay,up:e=>e.scribble!==null?{...e,scribble:{...e.scribble,delay:0}}:{...e}},{id:ke.RemoveUserId,up:({userId:e,...t})=>t},{id:ke.AddIsPenModeAndIsGridMode,up:e=>({...e,isPenMode:!1,isGridMode:!1})},{id:ke.HoistOpacity,up:({propsForNextShape:{opacity:e,...t},...r})=>({...r,opacityForNextShape:Number(e??"1"),propsForNextShape:t})},{id:ke.AddChat,up:e=>({...e,chatMessage:"",isChatting:!1})},{id:ke.AddHighlightedUserIds,up:e=>({...e,highlightedUserIds:[]})},{id:ke.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}})},{id:ke.AddMeta,up:e=>({...e,meta:{}})},{id:ke.RemoveCursorColor,up:e=>{let{color:t,...r}=e.cursor;return{...e,cursor:r}}},{id:ke.AddLonelyProperties,up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:ke.ReadOnlyReadonly,up:({isReadOnly:e,...t})=>({...t,isReadonly:e})},{id:ke.AddHoveringCanvas,up:e=>({...e,isHoveringCanvas:null})},{id:ke.AddScribbles,up:({scribble:e,...t})=>({...t,scribbles:[]})},{id:ke.AddInset,up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},{id:ke.AddDuplicateProps,up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})},{id:ke.RemoveCanMoveCamera,up:({canMoveCamera:e,...t})=>({...t}),down:e=>({...e,canMoveCamera:!0})}]}),Pc="instance:instance";var ade=E.model("instance_page_state",E.object({typeName:E.literal("instance_page_state"),id:qe("instance_page_state"),pageId:la,selectedShapeIds:E.arrayOf(nr),hintingShapeIds:E.arrayOf(nr),erasingShapeIds:E.arrayOf(nr),hoveredShapeId:nr.nullable(),editingShapeId:nr.nullable(),croppingShapeId:nr.nullable(),focusedGroupId:nr.nullable(),meta:E.jsonValue})),Ic=be("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),zj=Te({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Ic.AddCroppingId,up(e){e.croppingShapeId=null}},{id:Ic.RemoveInstanceIdAndCameraId,up(e){delete e.instanceId,delete e.cameraId}},{id:Ic.AddMeta,up:e=>{e.meta={}}},{id:Ic.RenameProperties,up:e=>{},down:e=>{}},{id:Ic.RenamePropertiesAgain,up:e=>{e.selectedShapeIds=e.selectedIds,delete e.selectedIds,e.hintingShapeIds=e.hintingIds,delete e.hintingIds,e.erasingShapeIds=e.erasingIds,delete e.erasingIds,e.hoveredShapeId=e.hoveredId,delete e.hoveredId,e.editingShapeId=e.editingId,delete e.editingId,e.croppingShapeId=e.croppingShapeId??e.croppingId??null,delete e.croppingId,e.focusedGroupId=e.focusLayerId,delete e.focusLayerId},down:e=>{e.selectedIds=e.selectedShapeIds,delete e.selectedShapeIds,e.hintingIds=e.hintingShapeIds,delete e.hintingShapeIds,e.erasingIds=e.erasingShapeIds,delete e.erasingShapeIds,e.hoveredId=e.hoveredShapeId,delete e.hoveredShapeId,e.editingId=e.editingShapeId,delete e.editingShapeId,e.croppingId=e.croppingShapeId,delete e.croppingShapeId,e.focusLayerId=e.focusedGroupId,delete e.focusedGroupId}}]}),Ts=Xe("instance_page_state",{validator:ade,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}));var lde=E.model("pointer",E.object({typeName:E.literal("pointer"),id:qe("pointer"),x:E.number,y:E.number,lastActivityTimestamp:E.number,meta:E.jsonValue})),cde=be("com.tldraw.pointer",{AddMeta:1}),Gj=Te({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:cde.AddMeta,up:e=>{e.meta={}}}]}),ca=Xe("pointer",{validator:lde,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Ac=ca.createId("pointer");var ude=E.model("instance_presence",E.object({typeName:E.literal("instance_presence"),id:qe("instance_presence"),userId:E.string,userName:E.string,lastActivityTimestamp:E.number.nullable(),followingUserId:E.string.nullable(),cursor:E.object({x:E.number,y:E.number,type:dv,rotation:E.number}).nullable(),color:E.string,camera:E.object({x:E.number,y:E.number,z:E.number}).nullable(),screenBounds:Rs.nullable(),selectedShapeIds:E.arrayOf(qe("shape")),currentPageId:qe("page"),brush:Rs.nullable(),scribbles:E.arrayOf(Oc),chatMessage:E.string,meta:E.jsonValue})),ua=be("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),Wj=Te({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:ua.AddScribbleDelay,up:e=>{e.scribble!==null&&(e.scribble.delay=0)}},{id:ua.RemoveInstanceId,up:e=>{delete e.instanceId}},{id:ua.AddChatMessage,up:e=>{e.chatMessage=""}},{id:ua.AddMeta,up:e=>{e.meta={}}},{id:ua.RenameSelectedShapeIds,up:e=>{}},{id:ua.NullableCameraCursor,up:e=>{},down:e=>{e.camera===null&&(e.camera={x:0,y:0,z:1}),e.lastActivityTimestamp===null&&(e.lastActivityTimestamp=0),e.cursor===null&&(e.cursor={type:"default",x:0,y:0,rotation:0}),e.screenBounds===null&&(e.screenBounds={x:0,y:0,w:1,h:1})}}]}),Wh=Xe("instance_presence",{validator:ude,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}));var fde=E.model("document",E.object({typeName:E.literal("document"),id:E.literal("document:document"),gridSize:E.number,name:E.string,meta:E.jsonValue}));var Kj=be("com.tldraw.document",{AddName:1,AddMeta:2}),Jj=Te({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:Kj.AddName,up:e=>{e.name=""},down:e=>{delete e.name}},{id:Kj.AddMeta,up:e=>{e.meta={}}}]}),Os=Xe("document",{validator:fde,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),fa=Os.createId("document");function dde(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function Yj(e){e.typeName==="asset"&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}function Xj({error:e,phase:t,record:r,recordBefore:n}){throw mS(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:t==="initialize"},extras:{recordBefore:n?Yj(rt(n)):void 0,recordAfter:Yj(rt(r))}}),e}function hde(){return[Ii.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function Zj(e){let t=e.query.ids("page"),r=e.query.records("instance_page_state"),n=()=>{if(!e.has(fa))return e.put([Os.create({id:fa,name:e.props.defaultName})]),n();if(!e.has(Ac))return e.put([ca.create({id:Ac})]),n();let s=t.get();if(s.size===0)return e.put(hde()),n();let i=()=>[...s].map(u=>e.get(u)).sort(dde)[0].id,o=e.get(Pc);if(o){if(!s.has(o.currentPageId))return e.put([{...o,currentPageId:i()}]),n()}else return e.put([e.schema.types.instance.create({id:Pc,currentPageId:i(),exportBackground:!0})]),n();let a=new Set,l=new Set;for(let u of s){let f=Ts.createId(u);e.get(f)||a.add(f);let d=Pi.createId(u);e.has(d)||l.add(d)}a.size>0&&e.put([...a].map(u=>Ts.create({id:u,pageId:Ts.parseId(u)}))),l.size>0&&e.put([...l].map(u=>Pi.create({id:u})));let c=r.get();for(let u of c){if(!s.has(u.pageId)){e.remove([u.id]);continue}if(u.croppingShapeId&&!e.has(u.croppingShapeId))return e.put([{...u,croppingShapeId:null}]),n();if(u.focusedGroupId&&!e.has(u.focusedGroupId))return e.put([{...u,focusedGroupId:null}]),n();if(u.hoveredShapeId&&!e.has(u.hoveredShapeId))return e.put([{...u,hoveredShapeId:null}]),n();let f=u.selectedShapeIds.filter(h=>e.has(h));if(f.length!==u.selectedShapeIds.length)return e.put([{...u,selectedShapeIds:f}]),n();let p=u.hintingShapeIds.filter(h=>e.has(h));if(p.length!==u.hintingShapeIds.length)return e.put([{...u,hintingShapeIds:p}]),n();let d=u.erasingShapeIds.filter(h=>e.has(h));if(d.length!==u.erasingShapeIds.length)return e.put([{...u,erasingShapeIds:d}]),n()}};return n}var e2=Ri("bookmark",E.object({title:E.string,description:E.string,image:E.string,favicon:E.string,src:E.srcUrl.nullable()})),Qj=be("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),t2=Te({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:e=>e.type==="bookmark",sequence:[{id:Qj.MakeUrlsValid,up:e=>{E.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:Qj.AddFavicon,up:e=>{E.srcUrl.isValid(e.props.favicon)||(e.props.favicon="")},down:e=>{delete e.props.favicon}}]});var r2=Ri("image",E.object({w:E.number,h:E.number,name:E.string,isAnimated:E.boolean,mimeType:E.string.nullable(),src:E.srcUrl.nullable(),fileSize:E.nonZeroNumber.optional()})),Cc=be("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),n2=Te({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:e=>e.type==="image",sequence:[{id:Cc.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:Cc.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:Cc.MakeUrlsValid,up:e=>{E.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:Cc.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:Cc.MakeFileSizeOptional,up:e=>{e.props.fileSize===-1&&(e.props.fileSize=void 0)},down:e=>{e.props.fileSize===void 0&&(e.props.fileSize=-1)}}]});var s2=Ri("video",E.object({w:E.number,h:E.number,name:E.string,isAnimated:E.boolean,mimeType:E.string.nullable(),src:E.srcUrl.nullable(),fileSize:E.number.optional()})),Nc=be("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),i2=Te({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:e=>e.type==="video",sequence:[{id:Nc.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:Nc.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:Nc.MakeUrlsValid,up:e=>{E.srcUrl.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:Nc.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:Nc.MakeFileSizeOptional,up:e=>{e.props.fileSize===-1&&(e.props.fileSize=void 0)},down:e=>{e.props.fileSize===void 0&&(e.props.fileSize=-1)}}]});var o2=E.model("asset",E.union("type",{image:r2,video:s2,bookmark:e2})),pde=be("com.tldraw.asset",{AddMeta:1}),pv=Te({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:pde.AddMeta,up:e=>{e.meta={}}}]}),mv=Xe("asset",{validator:o2,scope:"document"}).withDefaultProperties(()=>({meta:{}}));var gv={w:E.nonZeroNumber,h:E.nonZeroNumber,assetId:ws.nullable(),url:E.linkUrl},a2=Me("bookmark",{NullAssetId:1,MakeUrlsValid:2}),yv={sequence:[{id:a2.NullAssetId,up:e=>{e.assetId===void 0&&(e.assetId=null)},down:"retired"},{id:a2.MakeUrlsValid,up:e=>{E.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}}]};var _v=E.object({type:E.literalEnum("free","straight"),points:E.arrayOf(rr)}),bv={color:Mt,fill:Ti,dash:Mn,size:jt,segments:E.arrayOf(_v),isComplete:E.boolean,isClosed:E.boolean,isPen:E.boolean,scale:E.nonZeroNumber},l2=Me("draw",{AddInPen:1,AddScale:2}),Sv={sequence:[{id:l2.AddInPen,up:e=>{let{points:t}=e.segments[0];if(t.length===0){e.isPen=!1;return}let r=!(t[0].z===0||t[0].z===.5);t[1]&&(r=r&&!(t[1].z===0||t[1].z===.5)),e.isPen=r},down:"retired"},{id:l2.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]};var mde=/(^\/r\/[^/]+\/?$)/,gde=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(mde))return e}},{hostnames:["figma.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let r=t.searchParams.get("url");if(r)return r}}},{hostnames:["google.*"],fromEmbedUrl:e=>{let t=ct(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let n=t.searchParams.get("zoom"),[s,i]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${i},${n}z`}}},{hostnames:["val.town"],fromEmbedUrl:e=>{let t=ct(e),r=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(r)return`https://www.val.town/v/${r[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:e=>{let t=ct(e),r=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(r)return`https://codesandbox.io/s/${r[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:e=>{let t=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,r=e.match(t);if(r){let[n,s,i]=r;return`https://codepen.io/${s}/pen/${i}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:e=>{let t=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,r=e.match(t);if(r){let[n,s]=r;return`https://scratch.mit.edu/projects/${s}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:e=>{let t=ct(e);if(!t)return;if(t.hostname.replace(/^www./,"")==="youtube.com"){let n=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(n)return`https://www.youtube.com/watch?v=${n[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:e=>{let t=ct(e),r=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&r){t.pathname="/calendar/u/0";let n=Array.from(t.searchParams.keys());for(let s of n)t.searchParams.delete(s);return t.searchParams.set("cid",r),t.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:e=>{let t=ct(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");let r=Array.from(t.searchParams.keys());for(let n of r)t.searchParams.delete(n);return t.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return e.split("/").pop()?e:void 0}},{hostnames:["replit.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{hostnames:["felt.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.hostname==="player.vimeo.com"){let r=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(r)return"https://vimeo.com/"+r[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.hash.match(/#room=/))return e}},{hostnames:["observablehq.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","")}#cell-*`;if(t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:e=>{let t=ct(e);if(t&&t.hostname==="www.desmos.com"&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&t.search==="?embed"&&t.hash==="")return e.replace("?embed","")}}],vv={w:E.nonZeroNumber,h:E.nonZeroNumber,url:E.string},Kh=Me("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),Ev={sequence:[{id:Kh.GenOriginalUrlInEmbed,up:e=>{try{let t=e.url,r=new URL(t).host.replace("www.",""),n;for(let s of gde)if(s.hostnames.includes(r))try{n=s.fromEmbedUrl(t)}catch(i){console.warn(i)}e.tmpOldUrl=e.url,e.url=n??""}catch{e.url="",e.tmpOldUrl=e.url}},down:"retired"},{id:Kh.RemoveDoesResize,up:e=>{delete e.doesResize},down:"retired"},{id:Kh.RemoveTmpOldUrl,up:e=>{delete e.tmpOldUrl},down:"retired"},{id:Kh.RemovePermissionOverrides,up:e=>{delete e.overridePermissions},down:"retired"}]};var wv={w:E.nonZeroNumber,h:E.nonZeroNumber,name:E.string},Rv={sequence:[]};var Ai=E.object({type:E.string,content:E.arrayOf(E.unknown)});function Ci(e){return{type:"doc",content:e.split(`
`).map(n=>n?{type:"paragraph",content:[{type:"text",text:n}]}:{type:"paragraph"})}}var $c=ye.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]});var xc=ye.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]});var c2=ye.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),Tv={geo:c2,labelColor:aa,color:Mt,fill:Ti,dash:Mn,size:jt,font:jn,align:$c,verticalAlign:xc,url:E.linkUrl,w:E.nonZeroNumber,h:E.nonZeroNumber,growY:E.positiveNumber,richText:Ai,scale:E.nonZeroNumber},an=Me("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),Ov={sequence:[{id:an.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:an.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"},{id:an.RemoveJustify,up:e=>{e.align==="justify"&&(e.align="start")},down:"retired"},{id:an.AddCheckBox,up:e=>{},down:"retired"},{id:an.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:an.MigrateLegacyAlign,up:e=>{let t;switch(e.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}e.align=t},down:"retired"},{id:an.AddCloud,up:e=>{},down:"retired"},{id:an.MakeUrlsValid,up:e=>{E.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:an.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}},{id:an.AddRichText,up:e=>{e.richText=Ci(e.text),delete e.text}}]};var Pv={},Iv={sequence:[]};var Av={color:Mt,size:jt,segments:E.arrayOf(_v),isComplete:E.boolean,isPen:E.boolean,scale:E.nonZeroNumber},yde=Me("highlight",{AddScale:1}),Cv={sequence:[{id:yde.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]};var u2=E.object({topLeft:rr,bottomRight:rr}),Nv={w:E.nonZeroNumber,h:E.nonZeroNumber,playing:E.boolean,url:E.linkUrl,assetId:ws.nullable(),crop:u2.nullable(),flipX:E.boolean,flipY:E.boolean},Jh=Me("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),$v={sequence:[{id:Jh.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Jh.AddCropProp,up:e=>{e.crop=null},down:e=>{delete e.crop}},{id:Jh.MakeUrlsValid,up:e=>{E.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:Jh.AddFlipProps,up:e=>{e.flipX=!1,e.flipY=!1},down:e=>{delete e.flipX,delete e.flipY}}]};var f2=ye.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),_de=E.object({id:E.string,index:E.indexKey,x:E.number,y:E.number}),xv={color:Mt,dash:Mn,size:jt,spline:f2,points:E.dict(E.string,_de),scale:E.nonZeroNumber},kc=Me("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),kv={sequence:[{id:kc.AddSnapHandles,up:e=>{for(let t of Object.values(e.handles))t.canSnap=!0},down:"retired"},{id:kc.RemoveExtraHandleProps,up:e=>{e.handles=gS(Object.values(e.handles).map(t=>[t.index,{x:t.x,y:t.y}]))},down:e=>{let t=Object.entries(e.handles).map(([r,n])=>({index:r,...n})).sort(hc);e.handles=Object.fromEntries(t.map((r,n)=>{let s=n===0?"start":n===t.length-1?"end":`handle:${r.index}`;return[s,{id:s,type:"vertex",canBind:!1,canSnap:!0,index:r.index,x:r.x,y:r.y}]}))}},{id:kc.HandlesToPoints,up:e=>{let t=Object.entries(e.handles).map(([r,{x:n,y:s}])=>({x:n,y:s,index:r})).sort(hc);e.points=t.map(({x:r,y:n})=>({x:r,y:n})),delete e.handles},down:e=>{let t=bh(e.points.length);e.handles=Object.fromEntries(e.points.map((r,n)=>[t[n],{x:r.x,y:r.y}])),delete e.points}},{id:kc.PointIndexIds,up:e=>{let t=bh(e.points.length);e.points=Object.fromEntries(e.points.map((r,n)=>{let s=t[n];return[s,{id:s,index:s,x:r.x,y:r.y}]}))},down:e=>{let t=Object.values(e.points).sort(hc);e.points=t.map(({x:r,y:n})=>({x:r,y:n}))}},{id:kc.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]};var Lv={color:Mt,labelColor:aa,size:jt,font:jn,fontSizeAdjustment:E.positiveNumber,align:$c,verticalAlign:xc,growY:E.positiveNumber,url:E.linkUrl,richText:Ai,scale:E.nonZeroNumber},Fn=Me("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),Dv={sequence:[{id:Fn.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Fn.RemoveJustify,up:e=>{e.align==="justify"&&(e.align="start")},down:"retired"},{id:Fn.MigrateLegacyAlign,up:e=>{switch(e.align){case"start":e.align="start-legacy";return;case"end":e.align="end-legacy";return;default:e.align="middle-legacy";return}},down:"retired"},{id:Fn.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:Fn.MakeUrlsValid,up:e=>{E.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}},{id:Fn.AddFontSizeAdjustment,up:e=>{e.fontSizeAdjustment=0},down:e=>{delete e.fontSizeAdjustment}},{id:Fn.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}},{id:Fn.AddLabelColor,up:e=>{e.labelColor="black"},down:e=>{delete e.labelColor}},{id:Fn.AddRichText,up:e=>{e.richText=Ci(e.text),delete e.text}}]};var qv=ye.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]});var jv={color:Mt,size:jt,font:jn,textAlign:qv,w:E.nonZeroNumber,richText:Ai,scale:E.nonZeroNumber,autoSize:E.boolean},Mv=Me("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),Fv={sequence:[{id:Mv.RemoveJustify,up:e=>{e.align==="justify"&&(e.align="start")},down:"retired"},{id:Mv.AddTextAlign,up:e=>{e.textAlign=e.align,delete e.align},down:e=>{e.align=e.textAlign,delete e.textAlign}},{id:Mv.AddRichText,up:e=>{e.richText=Ci(e.text),delete e.text}}]};var Vv={w:E.nonZeroNumber,h:E.nonZeroNumber,time:E.number,playing:E.boolean,url:E.linkUrl,assetId:ws.nullable()},d2=Me("video",{AddUrlProp:1,MakeUrlsValid:2}),Uv={sequence:[{id:d2.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:d2.MakeUrlsValid,up:e=>{E.linkUrl.isValid(e.url)||(e.url="")},down:e=>{}}]};var Yh=be("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),h2=on({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Yh.RemoveCodeAndIconShapeTypes,scope:"store",up:e=>{for(let[t,r]of St(e))r.typeName==="shape"&&(r.type==="icon"||r.type==="code")&&delete e[t]}},{id:Yh.AddInstancePresenceType,scope:"store",up(e){}},{id:Yh.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:e=>{for(let[t,r]of St(e))r.typeName.match(/^(user|user_presence)$/)&&delete e[t]}},{id:Yh.RemoveUserDocument,scope:"store",up:e=>{for(let[t,r]of St(e))r.typeName.match("user_document")&&delete e[t]}}]});var p2={arrow:{migrations:cv,props:lv},bookmark:{migrations:yv,props:gv},draw:{migrations:Sv,props:bv},embed:{migrations:Ev,props:vv},frame:{migrations:Rv,props:wv},geo:{migrations:Ov,props:Tv},group:{migrations:Iv,props:Pv},highlight:{migrations:Cv,props:Av},image:{migrations:$v,props:Nv},line:{migrations:kv,props:xv},note:{migrations:Dv,props:Lv},text:{migrations:Fv,props:jv},video:{migrations:Uv,props:Vv}},m2={arrow:{migrations:fv,props:uv}};function Hv({shapes:e=p2,bindings:t=m2,migrations:r}={}){let n=new Map;for(let a of bs(e))for(let l of sv(a.props??{}).keys()){if(n.has(l.id)&&n.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);n.set(l.id,l)}let s=xj(e),i=$j(t),o=Hj(n);return vc.create({asset:mv,binding:i,camera:Pi,document:Os,instance:o,instance_page_state:Ts,page:Ii,instance_presence:Wh,pointer:ca,shape:s},{migrations:[h2,pv,qj,Jj,Bj,zj,Uj,Wj,Gj,nv,t2,n2,i2,...iv("shape",e),...iv("binding",t),...r??[]],onValidationFailure:Xj,createIntegrityChecker:Zj})}tr("@tldraw/tlschema","3.11.0","esm");var Xh=class{constructor(t){this.opts=t}get isOpen(){return this.opts.ws.readyState===1}sendMessage(t){let r=JSON.stringify(t);this.opts.onBeforeSendMessage?.(t,r),this.opts.ws.send(r)}close(t,r){this.opts.ws.close(t,r)}};var Lc=Tr(Sc(),1);var g2=()=>({events:{},emit(e,...t){let r=this.events[e]||[];for(let n=0,s=r.length;n<s;n++)r[n](...t)},on(e,t){return this.events[e]?.push(t)||(this.events[e]=[t]),()=>{this.events[e]=this.events[e]?.filter(r=>t!==r)}}});var y2=3e3,Sde=300,vde=1e3/60,Bv=e=>Date.now()-e,da=class e{constructor(t,r,n){this.recordType=n,this._atom=yi("document:"+t.id,{state:t,lastChangedClock:r})}_atom;static createWithoutValidating(t,r,n){return new e(t,r,n)}static createAndValidate(t,r,n){try{n.validate(t)}catch(s){return He.err(s)}return He.ok(new e(t,r,n))}get state(){return this._atom.get().state}get lastChangedClock(){return this._atom.get().lastChangedClock}replaceState(t,r){let n=jh(this.state,t);if(!n)return He.ok(null);try{this.recordType.validate(t)}catch(s){return He.err(s)}return this._atom.set({state:t,lastChangedClock:r}),He.ok(n)}mergeDiff(t,r){let n=na(this.state,t);return this.replaceState(n,r)}},ha=class{sessions=new Map;pruneSessions=()=>{for(let t of this.sessions.values())switch(t.state){case Nt.Connected:{(Bv(t.lastInteractionTime)>Tj||!t.socket.isOpen)&&this.cancelSession(t.sessionId);break}case Nt.AwaitingConnectMessage:{(Bv(t.sessionStartTime)>wj||!t.socket.isOpen)&&this.removeSession(t.sessionId);break}case Nt.AwaitingRemoval:{Bv(t.cancellationTime)>Rj&&this.removeSession(t.sessionId);break}default:kn(t)}};disposables=[JS(this.pruneSessions,2e3)];_isClosed=!1;close(){this.disposables.forEach(t=>t()),this.sessions.forEach(t=>{t.socket.close()}),this._isClosed=!0}isClosed(){return this._isClosed}events=g2();state=yi("room state",{documents:{},tombstones:{}});clock=1;documentClock=1;tombstoneHistoryStartsAtClock=this.clock;serializedSchema;documentTypes;presenceType;log;schema;constructor(t){this.schema=t.schema;let r=t.snapshot;this.log=t.log,this.onDataChange=t.onDataChange,Be(OS,"TLSyncRoom is supposed to run either on Cloudflare Workersor on a 18+ version of Node.js, which both support the native structuredClone API"),this.serializedSchema=JSON.parse(JSON.stringify(this.schema.serialize())),this.documentTypes=new Set(Object.values(this.schema.types).filter(u=>u.scope==="document").map(u=>u.typeName));let n=new Set(Object.values(this.schema.types).filter(u=>u.scope==="presence"));if(n.size>1)throw new Error(`TLSyncRoom: exactly zero or one presence type is expected, but found ${n.size}`);this.presenceType=n.values().next()?.value??null,r||(r={clock:0,documents:[{state:Os.create({id:fa}),lastChangedClock:0},{state:Ii.create({name:"Page 1",index:"a1"}),lastChangedClock:0}]}),this.clock=r.clock;let s=!1,i=u=>{s||(s=!0,this.clock++)},o={...r.tombstones},a=[];for(let u of r.documents)this.documentTypes.has(u.state.typeName)?a.push(u):(i("doc type was not doc type"),o[u.state.id]=this.clock);let l=Object.fromEntries(a.map(u=>[u.state.id,da.createWithoutValidating(u.state,u.lastChangedClock,dc(bt(this.schema.types,u.state.typeName)))])),c=this.schema.migrateStoreSnapshot({store:Object.fromEntries(St(l).map(([u,{state:f}])=>[u,f])),schema:r.schema??this.schema.serializeEarliestVersion()});if(c.type==="error")throw new Error("Failed to migrate: "+c.reason);for(let[u,f]of St(c.value)){let p=l[u];p?(0,Lc.default)(p.state,f)||(i("record was maybe updated during migration"),p.replaceState(f,this.clock)):(i("record was added during migration"),l[u]=da.createWithoutValidating(f,this.clock,dc(bt(this.schema.types,f.typeName))))}for(let u of ph(l))c.value[u]||(i("record was removed during migration"),o[u]=this.clock,delete l[u]);this.state.set({documents:l,tombstones:o}),this.pruneTombstones(),this.documentClock=this.clock,s&&t.onDataChange?.()}pruneTombstones=()=>{this.state.update(({tombstones:t,documents:r})=>{let n=Object.entries(this.state.get().tombstones);if(n.length>y2){n.sort((i,o)=>i[1]-o[1]);let s=n.length-y2;t=Object.fromEntries(n.slice(s+Sde))}return{documents:r,tombstones:t}})};getDocument(t){return this.state.get().documents[t]}addDocument(t,r,n){let{documents:s,tombstones:i}=this.state.get();qt(i,t)&&(i={...i},delete i[t]);let o=da.createAndValidate(r,n,dc(bt(this.schema.types,r.typeName)));return o.ok?(s={...s,[t]:o.value},this.state.set({documents:s,tombstones:i}),He.ok(void 0)):o}removeDocument(t,r){this.state.update(({documents:n,tombstones:s})=>(n={...n},delete n[t],s={...s,[t]:r},{documents:n,tombstones:s}))}getSnapshot(){let{documents:t,tombstones:r}=this.state.get();return{clock:this.clock,tombstones:r,schema:this.serializedSchema,documents:Object.values(t).filter(n=>this.documentTypes.has(n.state.typeName)).map(n=>({state:n.state,lastChangedClock:n.lastChangedClock}))}}sendMessage(t,r){let n=this.sessions.get(t);if(!n){this.log?.warn?.("Tried to send message to unknown session",r.type);return}if(n.state!==Nt.Connected){this.log?.warn?.("Tried to send message to disconnected client",r.type);return}n.socket.isOpen?r.type!=="patch"&&r.type!=="push_result"?(r.type!=="pong"&&this._flushDataMessages(t),n.socket.sendMessage(r)):n.debounceTimer===null?(n.socket.sendMessage({type:"data",data:[r]}),n.debounceTimer=setTimeout(()=>this._flushDataMessages(t),vde)):n.outstandingDataMessages.push(r):this.cancelSession(n.sessionId)}_flushDataMessages(t){let r=this.sessions.get(t);!r||r.state!==Nt.Connected||(r.debounceTimer=null,r.outstandingDataMessages.length>0&&(r.socket.sendMessage({type:"data",data:r.outstandingDataMessages}),r.outstandingDataMessages.length=0))}removeSession(t,r){let n=this.sessions.get(t);if(!n){this.log?.warn?.("Tried to remove unknown session");return}this.sessions.delete(t);let s=this.getDocument(n.presenceId??"");try{r?n.socket.close(Fh,r):n.socket.close()}catch{}s&&(this.state.update(({tombstones:i,documents:o})=>(o={...o},delete o[n.presenceId],{documents:o,tombstones:i})),this.broadcastPatch({diff:{[n.presenceId]:[Ze.Remove]},sourceSessionId:t})),this.events.emit("session_removed",{sessionId:t,meta:n.meta}),this.sessions.size===0&&this.events.emit("room_became_empty")}cancelSession(t){let r=this.sessions.get(t);if(r){if(r.state===Nt.AwaitingRemoval){this.log?.warn?.("Tried to cancel session that is already awaiting removal");return}this.sessions.set(t,{state:Nt.AwaitingRemoval,sessionId:t,presenceId:r.presenceId,socket:r.socket,cancellationTime:Date.now(),meta:r.meta,isReadonly:r.isReadonly,requiresLegacyRejection:r.requiresLegacyRejection});try{r.socket.close()}catch{}}}broadcastPatch(t){let{diff:r,sourceSessionId:n}=t;return this.sessions.forEach(s=>{if(s.state!==Nt.Connected||n===s.sessionId)return;if(!s.socket.isOpen){this.cancelSession(s.sessionId);return}let i=this.migrateDiffForSession(s.serializedSchema,r);if(!i.ok){this.rejectSession(s.sessionId,i.error===Ct.TargetVersionTooNew?Se.SERVER_TOO_OLD:Se.CLIENT_TOO_OLD);return}this.sendMessage(s.sessionId,{type:"patch",diff:i.value,serverClock:this.clock})}),this}handleNewSession(t){let{sessionId:r,socket:n,meta:s,isReadonly:i}=t,o=this.sessions.get(r);return this.sessions.set(r,{state:Nt.AwaitingConnectMessage,sessionId:r,socket:n,presenceId:o?.presenceId??this.presenceType?.createId()??null,sessionStartTime:Date.now(),meta:s,isReadonly:i??!1,requiresLegacyRejection:!1}),this}migrateDiffForSession(t,r){if(t===this.serializedSchema)return He.ok(r);let n={};for(let[s,i]of Object.entries(r)){if(i[0]===Ze.Remove){n[s]=i;continue}let o=this.schema.migratePersistedRecord(this.getDocument(s).state,t,"down");if(o.type==="error")return He.err(o.reason);n[s]=[Ze.Put,o.value]}return He.ok(n)}async handleMessage(t,r){let n=this.sessions.get(t);if(!n){this.log?.warn?.("Received message from unknown session");return}switch(r.type){case"connect":return this.handleConnectRequest(n,r);case"push":return this.handlePushRequest(n,r);case"ping":return n.state===Nt.Connected&&(n.lastInteractionTime=Date.now()),this.sendMessage(n.sessionId,{type:"pong"});default:kn(r)}}rejectSession(t,r){let n=this.sessions.get(t);if(n){if(!r){this.removeSession(t);return}if(n.requiresLegacyRejection)try{if(n.socket.isOpen){let s;switch(r){case Se.CLIENT_TOO_OLD:s=sa.ClientTooOld;break;case Se.SERVER_TOO_OLD:s=sa.ServerTooOld;break;case Se.INVALID_RECORD:s=sa.InvalidRecord;break;default:s=sa.InvalidOperation;break}n.socket.sendMessage({type:"incompatibility_error",reason:s})}}catch{}finally{this.removeSession(t)}else this.removeSession(t,r)}}handleConnectRequest(t,r){let n=r.protocolVersion;if(n===5&&(n=6),t.requiresLegacyRejection=n===6,n===6&&n++,n==null||n<Ei()){this.rejectSession(t.sessionId,Se.CLIENT_TOO_OLD);return}else if(n>Ei()){this.rejectSession(t.sessionId,Se.SERVER_TOO_OLD);return}if(r.schema==null){this.rejectSession(t.sessionId,Se.CLIENT_TOO_OLD);return}let s=this.schema.getMigrationsSince(r.schema);if(!s.ok||s.value.some(a=>a.scope==="store"||!a.down)){this.rejectSession(t.sessionId,Se.CLIENT_TOO_OLD);return}let i=(0,Lc.default)(r.schema,this.serializedSchema)?this.serializedSchema:r.schema,o=a=>{this.sessions.set(t.sessionId,{state:Nt.Connected,sessionId:t.sessionId,presenceId:t.presenceId,socket:t.socket,serializedSchema:i,lastInteractionTime:Date.now(),debounceTimer:null,outstandingDataMessages:[],meta:t.meta,isReadonly:t.isReadonly,requiresLegacyRejection:t.requiresLegacyRejection}),this.sendMessage(t.sessionId,a)};Th(a=>{if(r.lastServerClock<this.tombstoneHistoryStartsAtClock||r.lastServerClock>this.clock){let l={};for(let[u,f]of Object.entries(this.state.get().documents))u!==t.presenceId&&(l[u]=[Ze.Put,f.state]);let c=this.migrateDiffForSession(i,l);if(!c.ok){a(),this.rejectSession(t.sessionId,c.error===Ct.TargetVersionTooNew?Se.SERVER_TOO_OLD:Se.CLIENT_TOO_OLD);return}o({type:"connect",connectRequestId:r.connectRequestId,hydrationType:"wipe_all",protocolVersion:Ei(),schema:this.schema.serialize(),serverClock:this.clock,diff:c.value,isReadonly:t.isReadonly})}else{let l={},c=Object.values(this.state.get().documents).filter(d=>d.lastChangedClock>r.lastServerClock),u=this.presenceType?Object.values(this.state.get().documents).filter(d=>this.presenceType.typeName===d.state.typeName&&d.state.id!==t.presenceId):[],f=Object.entries(this.state.get().tombstones).filter(([d,h])=>h>r.lastServerClock).map(([d])=>d);for(let d of c)l[d.state.id]=[Ze.Put,d.state];for(let d of u)l[d.state.id]=[Ze.Put,d.state];for(let d of f)l[d]=[Ze.Remove];let p=this.migrateDiffForSession(i,l);if(!p.ok){a(),this.rejectSession(t.sessionId,p.error===Ct.TargetVersionTooNew?Se.SERVER_TOO_OLD:Se.CLIENT_TOO_OLD);return}o({type:"connect",connectRequestId:r.connectRequestId,hydrationType:"wipe_presence",schema:this.schema.serialize(),protocolVersion:Ei(),serverClock:this.clock,diff:p.value,isReadonly:t.isReadonly})}})}handlePushRequest(t,r){if(t&&t.state!==Nt.Connected)return;t&&(t.lastInteractionTime=Date.now()),this.clock++;let n=this.documentClock;Th(s=>{let i={diff:null},o={diff:null},a=(p,d,h)=>{p.diff||(p.diff={}),p.diff[d]=h},l=(p,d)=>{if(s(),t)this.rejectSession(t.sessionId,p);else throw new Error("failed to apply changes: "+p,d);return typeof process<"u"&&process.env.NODE_ENV!=="test"&&this.log?.error?.("failed to apply push",p,r,d),He.err(void 0)},c=(p,d,h)=>{let m=t?this.schema.migratePersistedRecord(h,t.serializedSchema,"up"):{type:"success",value:h};if(m.type==="error")return l(m.reason===Ct.TargetVersionTooOld?Se.SERVER_TOO_OLD:Se.CLIENT_TOO_OLD);let{value:y}=m,b=this.getDocument(d);if(b){let v=b.replaceState(y,this.clock);if(!v.ok)return l(Se.INVALID_RECORD);v.value&&a(p,d,[Ze.Patch,v.value])}else{if(!this.addDocument(d,y,this.clock).ok)return l(Se.INVALID_RECORD);a(p,d,[Ze.Put,y])}return He.ok(void 0)},u=(p,d,h)=>{let m=this.getDocument(d);if(!m)return He.ok(void 0);let y=t?this.schema.migratePersistedRecord(m.state,t.serializedSchema,"down"):{type:"success",value:m.state};if(y.type==="error")return l(Se.CLIENT_TOO_OLD);if(y.value===m.state){let b=m.mergeDiff(h,this.clock);if(!b.ok)return l(Se.INVALID_RECORD);b.value&&a(p,d,[Ze.Patch,b.value])}else{let b=na(y.value,h),v=t?this.schema.migratePersistedRecord(b,t.serializedSchema,"up"):{type:"success",value:b};if(v.type==="error")return l(Se.CLIENT_TOO_OLD);let _=m.replaceState(v.value,this.clock);if(!_.ok)return l(Se.INVALID_RECORD);_.value&&a(p,d,[Ze.Patch,_.value])}return He.ok(void 0)},{clientClock:f}=r;if(this.presenceType&&t?.presenceId&&"presence"in r&&r.presence){if(!t)throw new Error("session is required for presence pushes");let p=t.presenceId,[d,h]=r.presence,{typeName:m}=this.presenceType;switch(d){case Ze.Put:{if(!c(o,p,{...h,id:p,typeName:m}).ok)return;break}case Ze.Patch:{if(!u(o,p,{...h,id:[nt.Put,p],typeName:[nt.Put,m]}).ok)return;break}}}if(r.diff&&!t?.isReadonly)for(let[p,d]of Object.entries(r.diff))switch(d[0]){case Ze.Put:{if(!this.documentTypes.has(d[1].typeName))return l(Se.INVALID_RECORD);if(!c(i,p,d[1]).ok)return;break}case Ze.Patch:{if(!u(i,p,d[1]).ok)return;break}case Ze.Remove:{if(!this.getDocument(p))continue;this.removeDocument(p,this.clock),setTimeout(this.pruneTombstones,0),a(i,p,d);break}}if(!r.diff||(0,Lc.default)(i.diff,r.diff))t&&this.sendMessage(t.sessionId,{type:"push_result",serverClock:this.clock,clientClock:f,action:"commit"});else if(!i.diff)t&&this.sendMessage(t.sessionId,{type:"push_result",serverClock:this.clock,clientClock:f,action:"discard"});else if(t){let p=this.migrateDiffForSession(t.serializedSchema,i.diff);if(!p.ok)return l(p.error===Ct.TargetVersionTooNew?Se.SERVER_TOO_OLD:Se.CLIENT_TOO_OLD);this.sendMessage(t.sessionId,{type:"push_result",serverClock:this.clock,clientClock:f,action:{rebaseWithDiff:p.value}})}(i.diff||o.diff)&&this.broadcastPatch({sourceSessionId:t?.sessionId,diff:{...i.diff,...o.diff}}),i.diff&&(this.documentClock=this.clock)}),this.documentClock!==n&&this.onDataChange?.()}handleClose(t){this.cancelSession(t)}async updateStore(t){if(this._isClosed)throw new Error("Cannot update store on a closed room");let r=new zv(Object.fromEntries(this.getSnapshot().documents.map(s=>[s.state.id,s.state])));try{await t(r)}finally{r.close()}let n=r.toDiff();Object.keys(n).length!==0&&this.handlePushRequest(null,{type:"push",diff:n,clientClock:0})}},zv=class{constructor(t){this.snapshot=t}updates={puts:{},deletes:new Set};put(t){if(this._isClosed)throw new Error("StoreUpdateContext is closed");t.id in this.snapshot&&(0,Lc.default)(this.snapshot[t.id],t)?delete this.updates.puts[t.id]:this.updates.puts[t.id]=rt(t),this.updates.deletes.delete(t.id)}delete(t){if(this._isClosed)throw new Error("StoreUpdateContext is closed");let r=typeof t=="string"?t:t.id;delete this.updates.puts[r],this.snapshot[r]&&this.updates.deletes.add(r)}get(t){if(this._isClosed)throw new Error("StoreUpdateContext is closed");return qt(this.updates.puts,t)?rt(this.updates.puts[t]):this.updates.deletes.has(t)?null:rt(this.snapshot[t]??null)}getAll(){if(this._isClosed)throw new Error("StoreUpdateContext is closed");let t=Object.values(this.updates.puts);for(let[r,n]of Object.entries(this.snapshot))!this.updates.deletes.has(r)&&!qt(this.updates.puts,r)&&t.push(n);return rt(t)}toDiff(){let t={};for(let[r,n]of Object.entries(this.updates.puts))t[r]=[Ze.Put,n];for(let r of this.updates.deletes)t[r]=[Ze.Remove];return t}_isClosed=!1;close(){this._isClosed=!0}};var Dc=class{constructor(t){this.opts=t;let r=t.initialSnapshot&&"store"in t.initialSnapshot?_2(t.initialSnapshot):t.initialSnapshot;this.room=new ha({schema:t.schema??Hv(),snapshot:r,onDataChange:t.onDataChange,log:t.log}),this.room.events.on("session_removed",n=>{this.sessions.delete(n.sessionId),this.opts.onSessionRemoved&&this.opts.onSessionRemoved(this,{sessionId:n.sessionId,numSessionsRemaining:this.room.sessions.size,meta:n.meta})}),this.log="log"in t?t.log:{error:console.error}}room;sessions=new Map;log;getNumActiveSessions(){return this.room.sessions.size}handleSocketConnect(t){let{sessionId:r,socket:n,isReadonly:s=!1}=t,i=l=>this.handleSocketMessage(r,l.data),o=this.handleSocketError.bind(this,r),a=this.handleSocketClose.bind(this,r);this.sessions.set(r,{assembler:new Oh,socket:n,unlisten:()=>{n.removeEventListener?.("message",i),n.removeEventListener?.("close",a),n.removeEventListener?.("error",o)}}),this.room.handleNewSession({sessionId:r,isReadonly:s,socket:new Xh({ws:n,onBeforeSendMessage:this.opts.onBeforeSendMessage?(l,c)=>this.opts.onBeforeSendMessage({sessionId:r,message:l,stringified:c,meta:this.room.sessions.get(r)?.meta}):void 0}),meta:"meta"in t?t.meta:void 0}),n.addEventListener?.("message",i),n.addEventListener?.("close",a),n.addEventListener?.("error",o)}handleSocketMessage(t,r){let n=this.sessions.get(t)?.assembler;if(!n){this.log?.warn?.("Received message from unknown session",t);return}try{let s=typeof r=="string"?r:new TextDecoder().decode(r),i=n.handleMessage(s);if(!i)return;if("data"in i){if(this.opts.onAfterReceiveMessage){let o=this.room.sessions.get(t);o&&this.opts.onAfterReceiveMessage({sessionId:t,message:i.data,stringified:i.stringified,meta:o.meta})}this.room.handleMessage(t,i.data)}else this.log?.error?.("Error assembling message",i.error),this.handleSocketError(t)}catch(s){this.log?.error?.(s),this.room.rejectSession(t,Se.UNKNOWN_ERROR)}}handleSocketError(t){this.room.handleClose(t)}handleSocketClose(t){this.room.handleClose(t)}getCurrentDocumentClock(){return this.room.documentClock}getRecord(t){return rt(this.room.state.get().documents[t]?.state)}getSessions(){return[...this.room.sessions.values()].map(t=>({sessionId:t.sessionId,isConnected:t.state===Nt.Connected,isReadonly:t.isReadonly,meta:t.meta}))}getCurrentSnapshot(){return this.room.getSnapshot()}getCurrentSerializedSnapshot(){return JSON.stringify(this.room.getSnapshot())}loadSnapshot(t){"store"in t&&(t=_2(t));let r=this.room,n=r.getSnapshot().documents.map(l=>l.state.id),s=new Set(t.documents.map(l=>l.state.id)),i=n.filter(l=>!s.has(l)),o={...t.tombstones};i.forEach(l=>{o[l]=r.clock+1}),s.forEach(l=>{delete o[l]});let a=new ha({schema:r.schema,snapshot:{clock:r.clock+1,documents:t.documents.map(l=>({lastChangedClock:r.clock+1,state:l.state})),schema:t.schema,tombstones:o},log:this.log});this.room=a,r.close()}async updateStore(t){return this.room.updateStore(t)}closeSession(t,r){this.room.rejectSession(t,r)}close(){this.room.close()}isClosed(){return this.room.isClosed()}};function _2(e){return{clock:0,documents:bs(e.store).map(t=>({state:t,lastChangedClock:0})),schema:e.schema,tombstones:{}}}tr("@tldraw/sync-core","3.11.0","esm");var S2=Tr(lS()),Zh=require("fs/promises"),Wv=require("path"),v2=process.env.NICEGUI_TLDRAW_SYNC_STATE_DIR||"./.rooms";async function Ede(e){try{let t=await(0,Zh.readFile)((0,Wv.join)(v2,e));return JSON.parse(t.toString())??void 0}catch{return}}async function wde(e,t){await(0,Zh.writeFile)((0,Wv.join)(v2,e),JSON.stringify(t))}var Gv=new Map,Rde=new b2.default;async function E2(e){return await Rde.acquire(e,async()=>{if(Gv.has(e)){let n=Gv.get(e);if(!n.room.isClosed())return n.room}let t=await Ede(e),r={id:e,room:new Dc({initialSnapshot:t,onSessionRemoved(n,s){console.log("[nicegui_tldraw] client disconnected",s.sessionId,e)},onDataChange:(0,S2.default)(async()=>{try{console.log(`persist snapshot ${r.id}`),wde(r.id,r.room.getCurrentSnapshot())}catch(n){console.log("[nicegui_tldraw] error persisting snapshot"),console.error(n)}},1e4)})};return Gv.set(e,r),r.room})}var Tde=process.env.PORT?parseInt(process.env.PORT,10):8081,w2=process.env.NICEGUI_TLDRAW_SYNC_STATE_DIR||"./.rooms",qc=(0,O2.default)();qc.register(T2.default);qc.register(R2.default,{origin:"*"});qc.register(async e=>{e.get("/_nicegui_tldraw/connect/:roomId",{websocket:!0},async(t,r)=>{let n=r.params.roomId,s=r.query.sessionId;t.on("error",async o=>{console.error("WebSocket error:",o)}),(await E2(n)).handleSocketConnect({sessionId:s,socket:t})})});qc.listen({port:Tde}).then(async()=>{try{await(0,P2.mkdir)(w2,{recursive:!0})}catch{console.log(`${w2} already exists`)}let e=qc.server.address();console.log(`[nicegui_tldraw] server listening on http://${e.address}:${e.port}`)}).catch(e=>{console.error(e),process.exit(1)});
/*! Bundled license information:

toad-cache/dist/toad-cache.cjs:
  (**
   * toad-cache
   *
   * @copyright 2024 Igor Savin <kibertoad@gmail.com>
   * @license MIT
   * @version 3.7.0
   *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@fastify/forwarded/index.js:
  (*!
   * forwarded
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

@fastify/proxy-addr/index.js:
  (*!
   * proxy-addr
   * Copyright(c) 2021 Fastify collaborators
   * Copyright(c) 2014-2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

light-my-request/lib/form-data.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

@tldraw/utils/dist-esm/lib/bind.mjs:
  (*!
   * MIT License: https://github.com/NoHomey/bind-decorator/blob/master/License
   * Copyright (c) 2016 Ivo Stratev
   *)

@tldraw/utils/dist-esm/lib/id.mjs:
  (*!
   * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
   * Modified code originally from <https://github.com/ai/nanoid>
   * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
   *
   * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
   * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
   * CommonJS module. By including nanoid here, we can make sure it works well in every environment
   * where tldraw is used. We can also remove some unused features like custom alphabets.
   *)

@tldraw/utils/dist-esm/lib/media/apng.mjs:
  (*!
   * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
   * Copyright (c) Philip van Heemstra
   *)

@tldraw/utils/dist-esm/lib/media/gif.mjs:
  (*!
   * MIT License
   * Modified code originally from <https://github.com/qzb/is-animated>
   * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
   *)

@tldraw/utils/dist-esm/lib/media/png.mjs:
  (*!
   * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
   * Copyright: 2014 Alex Gorbatchev
   * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
   *)

@tldraw/utils/dist-esm/lib/media/webp.mjs:
  (*!
   * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
   * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
   *)

@tldraw/store/dist-esm/lib/ImmutableMap.mjs:
  (*!
   * This file was lovingly and delicately extracted from Immutable.js
   * MIT License: https://github.com/immutable-js/immutable-js/blob/main/LICENSE
   * Copyright (c) 2014-present, Lee Byron and other contributors.
   *)
*/
//# sourceMappingURL=server.min.js.map
